import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{At as t,Ft as n,I as r,Kt as i,L as a,Rt as o,X as s,Yt as c,et as ee,ft as l,jt as u,kt as d,mt as te,nt as ne,q as f,qt as p,t as re,yt as m}from"./vendor-D21qjNUp.js";import"./libs-Cg75ib7e.js";import"./tanstack-DEYdLxKO.js";import"./supabase-Bq88cUsz.js";import{_ as h,a as ie,i as g,l as ae,m as _,v as oe,y as se}from"./index-Dn29HZIG.js";import{n as v,t as y}from"./ShareModal-CC9PngAC.js";import"./useGetSuggestedUsers-X5p-e53x.js";import{t as b}from"./useFollowUser-BxXR8QOW.js";var ce=u(),x=e(c(),1),S=o(),le=re,ue=(0,x.memo)(e=>{let n=(0,ce.c)(132),{reel:i,showToast:o,theme:c,onUserClick:u,glassModal:p}=e,{setViewingReel:re}=se(),{user:m}=oe(),{mutate:ae}=g(),{mutate:_}=b(),[ue,de]=(0,x.useState)(!1),[C,fe]=(0,x.useState)(!0),[w,pe]=(0,x.useState)(!0),[me,he]=(0,x.useState)(!1),[ge,_e]=(0,x.useState)(!1),ve=(0,x.useRef)(null),ye=(0,x.useRef)(null),T=`${window.location.origin}/reels/${i.id}`,be=i.hasLiked||!1,xe;n[0]!==be||n[1]!==i.id||n[2]!==o||n[3]!==ae||n[4]!==m?(xe=()=>{if(!m){o(`লাইক করতে লগ ইন করুন`);return}ae({targetId:i.id,type:`reel`,userId:m.id,hasLiked:be})},n[0]=be,n[1]=i.id,n[2]=o,n[3]=ae,n[4]=m,n[5]=xe):xe=n[5];let E=xe,Se;n[6]!==_||n[7]!==i.user.isFollowing||n[8]!==i.user.username||n[9]!==i.userId||n[10]!==o||n[11]!==m?(Se=()=>{if(!m){o(`ফলো করতে লগ ইন করুন`);return}i.userId&&_({targetUserId:i.userId,currentUserId:m.id,isFollowing:i.user.isFollowing||!1,targetUsername:i.user.username},{onSuccess:()=>o(`ফলো করা হয়েছে`),onError:()=>o(`ফলো করতে সমস্যা হয়েছে`)})},n[6]=_,n[7]=i.user.isFollowing,n[8]=i.user.username,n[9]=i.userId,n[10]=o,n[11]=m,n[12]=Se):Se=n[12];let Ce=Se,we;n[13]===w?we=n[14]:(we=()=>{ye.current&&pe(!w)},n[13]=w,n[14]=we);let Te=we,Ee,De;n[15]===Symbol.for(`react.memo_cache_sentinel`)?(Ee=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(pe(!0),fe(!1)):(pe(!1),fe(!0))},{threshold:.6});return ve.current&&e.observe(ve.current),()=>e.disconnect()},De=[],n[15]=Ee,n[16]=De):(Ee=n[15],De=n[16]),(0,x.useEffect)(Ee,De);let Oe;n[17]===E?Oe=n[18]:(Oe=()=>{E(),de(!0),setTimeout(()=>de(!1),1e3)},n[17]=E,n[18]=Oe);let ke=Oe,Ae,je,Me,Ne;n[19]===Symbol.for(`react.memo_cache_sentinel`)?(je={opacity:0,scale:.95},Me={opacity:1,scale:1},Ne={once:!0},Ae={duration:.5},n[19]=Ae,n[20]=je,n[21]=Me,n[22]=Ne):(Ae=n[19],je=n[20],Me=n[21],Ne=n[22]);let D;n[23]!==p||n[24]!==me||n[25]!==T||n[26]!==o||n[27]!==c?(D=me&&(0,S.jsx)(v,{onClose:()=>he(!1),showToast:o,theme:c,glassModal:p,shareUrl:T}),n[23]=p,n[24]=me,n[25]=T,n[26]=o,n[27]=c,n[28]=D):D=n[28];let O;n[29]!==p||n[30]!==ge||n[31]!==T||n[32]!==o||n[33]!==c?(O=ge&&(0,S.jsx)(y,{onClose:()=>_e(!1),theme:c,showToast:o,glassModal:p,shareUrl:T}),n[29]=p,n[30]=ge,n[31]=T,n[32]=o,n[33]=c,n[34]=O):O=n[34];let k;n[35]!==C||n[36]!==w||n[37]!==i.src||n[38]!==Te?(k=i.src?(0,S.jsx)(`div`,{className:`w-full h-full cursor-pointer`,onClick:Te,children:(0,S.jsx)(le,{ref:ye,url:i.src,width:`100%`,height:`100%`,playing:w,muted:C,loop:!0,playsinline:!0,style:{objectFit:`cover`},className:`react-player pointer-events-none`})}):(0,S.jsx)(h,{src:i.src,width:400,className:`w-full h-full`,onClick:()=>fe(!C),alt:`reel`}),n[35]=C,n[36]=w,n[37]=i.src,n[38]=Te,n[39]=k):k=n[39];let A;n[40]===w?A=n[41]:(A=!w&&(0,S.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,S.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,S.jsx)(s,{className:`text-white w-10 h-10 fill-white`})})}),n[40]=w,n[41]=A);let j;n[42]===C?j=n[43]:(j=(0,S.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),fe(!C)},children:C?(0,S.jsx)(r,{className:`text-white w-5 h-5`}):(0,S.jsx)(a,{className:`text-white w-5 h-5`})}),n[42]=C,n[43]=j);let M;n[44]===ue?M=n[45]:(M=ue&&(0,S.jsx)(d.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,S.jsx)(l,{size:100,className:`text-white fill-white drop-shadow-lg`})}),n[44]=ue,n[45]=M);let N;n[46]===M?N=n[47]:(N=(0,S.jsx)(t,{children:M}),n[46]=M,n[47]=N);let P;n[48]!==u||n[49]!==i.user?(P=()=>u(i.user),n[48]=u,n[49]=i.user,n[50]=P):P=n[50];let F;n[51]===i.user.avatar?F=n[52]:(F=(0,S.jsx)(`div`,{className:`w-8 h-8 rounded-full border border-white/50 overflow-hidden cursor-pointer`,children:(0,S.jsx)(h,{src:i.user.avatar,width:100,className:`w-full h-full`,alt:`reel user`})}),n[51]=i.user.avatar,n[52]=F);let Pe;n[53]===i.user.username?Pe=n[54]:(Pe=(0,S.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:i.user.username}),n[53]=i.user.username,n[54]=Pe);let I;n[55]===i.user.isVerified?I=n[56]:(I=i.user.isVerified&&(0,S.jsx)(ie,{}),n[55]=i.user.isVerified,n[56]=I);let Fe,Ie;n[57]===Symbol.for(`react.memo_cache_sentinel`)?(Fe={scale:1.05},Ie={scale:.95},n[57]=Fe,n[58]=Ie):(Fe=n[57],Ie=n[58]);let Le=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${i.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,L;n[59]===Ce?L=n[60]:(L=e=>{e.stopPropagation(),Ce()},n[59]=Ce,n[60]=L);let Re=i.user.isFollowing?`ফলো করছেন`:`ফলো`,R;n[61]!==Le||n[62]!==L||n[63]!==Re?(R=(0,S.jsx)(d.button,{whileHover:Fe,whileTap:Ie,className:Le,onClick:L,children:Re}),n[61]=Le,n[62]=L,n[63]=Re,n[64]=R):R=n[64];let z;n[65]!==P||n[66]!==F||n[67]!==Pe||n[68]!==I||n[69]!==R?(z=(0,S.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:P,children:[F,Pe,I,R]}),n[65]=P,n[66]=F,n[67]=Pe,n[68]=I,n[69]=R,n[70]=z):z=n[70];let ze;n[71]===Symbol.for(`react.memo_cache_sentinel`)?(ze=(0,S.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`আরও`}),n[71]=ze):ze=n[71];let B;n[72]===i.caption?B=n[73]:(B=(0,S.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[i.caption,` `,ze]}),n[72]=i.caption,n[73]=B);let Be;n[74]===Symbol.for(`react.memo_cache_sentinel`)?(Be=(0,S.jsx)(ee,{size:12}),n[74]=Be):Be=n[74];let V;n[75]===i.audio?V=n[76]:(V=(0,S.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[Be,(0,S.jsx)(`div`,{className:`truncate w-40`,children:i.audio})]}),n[75]=i.audio,n[76]=V);let H;n[77]!==z||n[78]!==B||n[79]!==V?(H=(0,S.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[z,B,V]}),n[77]=z,n[78]=B,n[79]=V,n[80]=H):H=n[80];let Ve,He;n[81]===Symbol.for(`react.memo_cache_sentinel`)?(Ve={scale:1.1},He={scale:.9},n[81]=Ve,n[82]=He):(Ve=n[81],He=n[82]);let Ue=`cursor-pointer transition-colors ${be?`fill-[#f42a41] text-[#f42a41]`:``}`,U;n[83]!==E||n[84]!==Ue?(U=(0,S.jsx)(d.div,{whileHover:Ve,whileTap:He,children:(0,S.jsx)(l,{size:28,strokeWidth:1.5,className:Ue,onClick:E})}),n[83]=E,n[84]=Ue,n[85]=U):U=n[85];let W;n[86]===i.likes?W=n[87]:(W=(0,S.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:i.likes}),n[86]=i.likes,n[87]=W);let G;n[88]!==U||n[89]!==W?(G=(0,S.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[U,W]}),n[88]=U,n[89]=W,n[90]=G):G=n[90];let We,Ge;n[91]===Symbol.for(`react.memo_cache_sentinel`)?(We={scale:1.1},Ge={scale:.9},n[91]=We,n[92]=Ge):(We=n[91],Ge=n[92]);let K;n[93]!==i||n[94]!==re?(K=(0,S.jsx)(d.div,{whileHover:We,whileTap:Ge,children:(0,S.jsx)(ne,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>re(i)})}),n[93]=i,n[94]=re,n[95]=K):K=n[95];let q;n[96]===i.comments?q=n[97]:(q=(0,S.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:i.comments}),n[96]=i.comments,n[97]=q);let J;n[98]!==K||n[99]!==q?(J=(0,S.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[K,q]}),n[98]=K,n[99]=q,n[100]=J):J=n[100];let Ke,qe;n[101]===Symbol.for(`react.memo_cache_sentinel`)?(Ke={scale:1.1},qe={scale:.9},n[101]=Ke,n[102]=qe):(Ke=n[101],qe=n[102]);let Je;n[103]===Symbol.for(`react.memo_cache_sentinel`)?(Je=(0,S.jsx)(d.div,{whileHover:Ke,whileTap:qe,children:(0,S.jsx)(f,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>_e(!0)})}),n[103]=Je):Je=n[103];let Ye,Xe;n[104]===Symbol.for(`react.memo_cache_sentinel`)?(Ye={scale:1.1},Xe={scale:.9},n[104]=Ye,n[105]=Xe):(Ye=n[104],Xe=n[105]);let Ze;n[106]===Symbol.for(`react.memo_cache_sentinel`)?(Ze=(0,S.jsx)(d.div,{whileHover:Ye,whileTap:Xe,children:(0,S.jsx)(te,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>he(!0)})}),n[106]=Ze):Ze=n[106];let Qe;n[107]===Symbol.for(`react.memo_cache_sentinel`)?(Qe={scale:1.1},n[107]=Qe):Qe=n[107];let Y;n[108]!==u||n[109]!==i.user?(Y=()=>u(i.user),n[108]=u,n[109]=i.user,n[110]=Y):Y=n[110];let X;n[111]===i.user.avatar?X=n[112]:(X=(0,S.jsx)(h,{src:i.user.avatar,width:100,className:`w-full h-full`,alt:`user thumb`}),n[111]=i.user.avatar,n[112]=X);let Z;n[113]!==Y||n[114]!==X?(Z=(0,S.jsx)(d.div,{whileHover:Qe,className:`w-6 h-6 border-2 border-white rounded-md overflow-hidden mt-2 cursor-pointer`,onClick:Y,children:X}),n[113]=Y,n[114]=X,n[115]=Z):Z=n[115];let Q;n[116]!==G||n[117]!==J||n[118]!==Z?(Q=(0,S.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[G,J,Je,Ze,Z]}),n[116]=G,n[117]=J,n[118]=Z,n[119]=Q):Q=n[119];let $;n[120]!==ke||n[121]!==k||n[122]!==A||n[123]!==j||n[124]!==N||n[125]!==H||n[126]!==Q?($=(0,S.jsxs)(`div`,{ref:ve,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-zinc-900 md:rounded-lg overflow-hidden border-zinc-800 md:border group shadow-2xl`,onDoubleClick:ke,children:[k,A,j,N,H,Q]}),n[120]=ke,n[121]=k,n[122]=A,n[123]=j,n[124]=N,n[125]=H,n[126]=Q,n[127]=$):$=n[127];let $e;return n[128]!==D||n[129]!==O||n[130]!==$?($e=(0,S.jsxs)(d.div,{initial:je,whileInView:Me,viewport:Ne,transition:Ae,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[D,O,$]}),n[128]=D,n[129]=O,n[130]=$,n[131]=$e):$e=n[131],$e}),de=u();const C=e=>[`reel`,e],fe=(e,t)=>{let r=(0,de.c)(9),i=e||``,a;r[0]===i?a=r[1]:(a=C(i),r[0]=i,r[1]=a);let o=!!e,s;r[2]!==t||r[3]!==e?(s=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await _.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await _.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await _.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},r[2]=t,r[3]=e,r[4]=s):s=r[4];let c;return r[5]!==a||r[6]!==o||r[7]!==s?(c={queryKey:a,enabled:o,queryFn:s},r[5]=a,r[6]=o,r[7]=s,r[8]=c):c=r[8],n(c)};var w=u(),pe=()=>{let e=(0,w.c)(32),{theme:t,showToast:n}=se(),{user:r}=oe(),a=i(),{id:o}=p(),s=t===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,{data:c,isLoading:ee}=fe(o,r?.id),{data:l,isLoading:u}=ae(r?.id),d;e[0]===l?d=e[1]:(d=l===void 0?[]:l,e[0]=l,e[1]=d);let te=d,ne;e[2]===a?ne=e[3]:(ne=e=>{a(`/profile/${e.username}`)},e[2]=a,e[3]=ne);let f=ne,re=o?ee:u,h;e[4]!==te||e[5]!==o||e[6]!==c?(h=o?c?[c]:[]:te,e[4]=te,e[5]=o,e[6]=c,e[7]=h):h=e[7];let ie=h;if(re){let t;return e[8]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,S.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:`Loading reel...`}),e[8]=t):t=e[8],t}if(ie.length===0){let t=o?`Reel not found`:`No reels yet`,n;return e[9]===t?n=e[10]:(n=(0,S.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:t}),e[9]=t,e[10]=n),n}let g;e[11]===a?g=e[12]:(g=()=>a(`/`),e[11]=a,e[12]=g);let _;e[13]===Symbol.for(`react.memo_cache_sentinel`)?(_=(0,S.jsx)(m,{size:28}),e[13]=_):_=e[13];let v;e[14]===g?v=e[15]:(v=(0,S.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:g,children:_}),e[14]=g,e[15]=v);let y;if(e[16]!==ie||e[17]!==s||e[18]!==f||e[19]!==n||e[20]!==t){let r;e[22]!==s||e[23]!==f||e[24]!==n||e[25]!==t?(r=e=>(0,S.jsx)(ue,{reel:e,showToast:n,theme:t,onUserClick:f,glassModal:s},e.id),e[22]=s,e[23]=f,e[24]=n,e[25]=t,e[26]=r):r=e[26],y=ie.map(r),e[16]=ie,e[17]=s,e[18]=f,e[19]=n,e[20]=t,e[21]=y}else y=e[21];let b;e[27]===y?b=e[28]:(b=(0,S.jsx)(`div`,{className:`w-full md:w-[400px] h-full`,children:y}),e[27]=y,e[28]=b);let ce;return e[29]!==v||e[30]!==b?(ce=(0,S.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[v,b]}),e[29]=v,e[30]=b,e[31]=ce):ce=e[31],ce};export{pe as default};