import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{F as t,I as n,J as r,Mt as i,Nt as a,Pt as o,Qt as s,St as c,Vt as l,Xt as u,Yt as d,Z as ee,_t as te,at as ne,mt as re,nt as ie,t as f,zt as p}from"./vendor-CAA_jARP.js";import"./libs-_Iez8R9q.js";import"./tanstack-CjdblyHw.js";import"./supabase-Dn2JuWVq.js";import{S as ae,T as oe,b as m,c as se,d as ce,p as le,s as ue,v as h,w as de,x as g}from"./index-DvFnWlog.js";import{n as _,t as v}from"./ShareModal-OAdvdkHL.js";import"./useGetSuggestedUsers-BejqIf_C.js";import{t as y}from"./useFollowUser-DaQc2mGJ.js";var b=o(),x=e(s(),1),S=l(),fe=f,pe=(0,x.memo)(e=>{let o=(0,b.c)(143),{reel:s,showToast:c,theme:l,onUserClick:u,glassModal:d}=e,{setViewingReel:f}=oe(),{user:p}=de(),{mutate:le}=ue(),{mutate:h}=y(),[pe,me]=(0,x.useState)(!1),[C,he]=(0,x.useState)(!0),[w,ge]=(0,x.useState)(!0),[_e,ve]=(0,x.useState)(!1),[ye,be]=(0,x.useState)(!1),xe=(0,x.useRef)(null),Se=(0,x.useRef)(null),T=`${window.location.origin}/reels/${s.id}`,Ce=s.hasLiked||!1,we;o[0]!==Ce||o[1]!==s.id||o[2]!==c||o[3]!==le||o[4]!==p?(we=()=>{if(!p){c(`Log in to like`);return}le({targetId:s.id,type:`reel`,userId:p.id,hasLiked:Ce})},o[0]=Ce,o[1]=s.id,o[2]=c,o[3]=le,o[4]=p,o[5]=we):we=o[5];let E=we,Te;o[6]!==h||o[7]!==s.user.isFollowing||o[8]!==s.user.username||o[9]!==s.userId||o[10]!==c||o[11]!==p?(Te=()=>{if(!p){c(`Log in to follow`);return}s.userId&&h({targetUserId:s.userId,currentUserId:p.id,isFollowing:s.user.isFollowing||!1,targetUsername:s.user.username},{onSuccess:()=>c(`Followed`),onError:()=>c(`Failed to follow`)})},o[6]=h,o[7]=s.user.isFollowing,o[8]=s.user.username,o[9]=s.userId,o[10]=c,o[11]=p,o[12]=Te):Te=o[12];let Ee=Te,De;o[13]===w?De=o[14]:(De=()=>{Se.current&&ge(!w)},o[13]=w,o[14]=De);let Oe=De,ke,Ae;o[15]===Symbol.for(`react.memo_cache_sentinel`)?(ke=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(ge(!0),he(!1)):(ge(!1),he(!0))},{threshold:.6});return xe.current&&e.observe(xe.current),()=>e.disconnect()},Ae=[],o[15]=ke,o[16]=Ae):(ke=o[15],Ae=o[16]),(0,x.useEffect)(ke,Ae);let je;o[17]===E?je=o[18]:(je=()=>{E(),me(!0),setTimeout(()=>me(!1),1e3)},o[17]=E,o[18]=je);let Me=je,Ne,Pe,Fe,Ie;o[19]===Symbol.for(`react.memo_cache_sentinel`)?(Pe={opacity:0,scale:.95},Fe={opacity:1,scale:1},Ie={once:!0},Ne={duration:.5},o[19]=Ne,o[20]=Pe,o[21]=Fe,o[22]=Ie):(Ne=o[19],Pe=o[20],Fe=o[21],Ie=o[22]);let D;o[23]!==d||o[24]!==_e||o[25]!==T||o[26]!==c||o[27]!==l?(D=_e&&(0,S.jsx)(_,{onClose:()=>ve(!1),showToast:c,theme:l,glassModal:d,shareUrl:T}),o[23]=d,o[24]=_e,o[25]=T,o[26]=c,o[27]=l,o[28]=D):D=o[28];let O;o[29]!==d||o[30]!==ye||o[31]!==T||o[32]!==c||o[33]!==l?(O=ye&&(0,S.jsx)(v,{onClose:()=>be(!1),theme:l,showToast:c,glassModal:d,shareUrl:T}),o[29]=d,o[30]=ye,o[31]=T,o[32]=c,o[33]=l,o[34]=O):O=o[34];let k;o[35]!==C||o[36]!==w||o[37]!==s.src||o[38]!==Oe?(k=s.src?(0,S.jsx)(`div`,{className:`w-full h-full cursor-pointer`,onClick:Oe,children:(0,S.jsx)(fe,{ref:Se,url:s.src,width:`100%`,height:`100%`,playing:w,muted:C,loop:!0,playsinline:!0,style:{objectFit:`cover`},className:`react-player pointer-events-none`})}):(0,S.jsx)(ce,{src:s.src,width:400,className:`w-full h-full`,onClick:()=>he(!C),alt:`reel`}),o[35]=C,o[36]=w,o[37]=s.src,o[38]=Oe,o[39]=k):k=o[39];let A;o[40]===w?A=o[41]:(A=!w&&(0,S.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,S.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,S.jsx)(ee,{className:`text-white w-10 h-10 fill-white`})})}),o[40]=w,o[41]=A);let j;o[42]===C?j=o[43]:(j=(0,S.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),he(!C)},children:C?(0,S.jsx)(t,{className:`text-white w-5 h-5`}):(0,S.jsx)(n,{className:`text-white w-5 h-5`})}),o[42]=C,o[43]=j);let M;o[44]===pe?M=o[45]:(M=pe&&(0,S.jsx)(i.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,S.jsx)(re,{size:100,className:`text-white fill-white drop-shadow-lg`})}),o[44]=pe,o[45]=M);let N;o[46]===M?N=o[47]:(N=(0,S.jsx)(a,{children:M}),o[46]=M,o[47]=N);let P;o[48]!==u||o[49]!==s.user?(P=()=>u(s.user),o[48]=u,o[49]=s.user,o[50]=P):P=o[50];let F;o[51]===s.user.avatar?F=o[52]:(F=(0,S.jsx)(ae,{src:s.user.avatar}),o[51]=s.user.avatar,o[52]=F);let I;o[53]===s.user.username[0]?I=o[54]:(I=s.user.username[0].toUpperCase(),o[53]=s.user.username[0],o[54]=I);let L;o[55]===I?L=o[56]:(L=(0,S.jsx)(g,{children:I}),o[55]=I,o[56]=L);let R;o[57]!==F||o[58]!==L?(R=(0,S.jsxs)(m,{className:`w-8 h-8 border border-white/50 cursor-pointer`,children:[F,L]}),o[57]=F,o[58]=L,o[59]=R):R=o[59];let Le;o[60]===s.user.username?Le=o[61]:(Le=(0,S.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:s.user.username}),o[60]=s.user.username,o[61]=Le);let z;o[62]===s.user.isVerified?z=o[63]:(z=s.user.isVerified&&(0,S.jsx)(se,{}),o[62]=s.user.isVerified,o[63]=z);let Re,ze;o[64]===Symbol.for(`react.memo_cache_sentinel`)?(Re={scale:1.05},ze={scale:.95},o[64]=Re,o[65]=ze):(Re=o[64],ze=o[65]);let Be=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${s.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,B;o[66]===Ee?B=o[67]:(B=e=>{e.stopPropagation(),Ee()},o[66]=Ee,o[67]=B);let Ve=s.user.isFollowing?`Following`:`Follow`,V;o[68]!==Be||o[69]!==B||o[70]!==Ve?(V=(0,S.jsx)(i.button,{whileHover:Re,whileTap:ze,className:Be,onClick:B,children:Ve}),o[68]=Be,o[69]=B,o[70]=Ve,o[71]=V):V=o[71];let H;o[72]!==P||o[73]!==R||o[74]!==Le||o[75]!==z||o[76]!==V?(H=(0,S.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:P,children:[R,Le,z,V]}),o[72]=P,o[73]=R,o[74]=Le,o[75]=z,o[76]=V,o[77]=H):H=o[77];let He;o[78]===Symbol.for(`react.memo_cache_sentinel`)?(He=(0,S.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`More`}),o[78]=He):He=o[78];let U;o[79]===s.caption?U=o[80]:(U=(0,S.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[s.caption,` `,He]}),o[79]=s.caption,o[80]=U);let Ue;o[81]===Symbol.for(`react.memo_cache_sentinel`)?(Ue=(0,S.jsx)(ie,{size:12}),o[81]=Ue):Ue=o[81];let W;o[82]===s.audio?W=o[83]:(W=(0,S.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[Ue,(0,S.jsx)(`div`,{className:`truncate w-40`,children:s.audio})]}),o[82]=s.audio,o[83]=W);let G;o[84]!==H||o[85]!==U||o[86]!==W?(G=(0,S.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[H,U,W]}),o[84]=H,o[85]=U,o[86]=W,o[87]=G):G=o[87];let We,Ge;o[88]===Symbol.for(`react.memo_cache_sentinel`)?(We={scale:1.1},Ge={scale:.9},o[88]=We,o[89]=Ge):(We=o[88],Ge=o[89]);let Ke=`cursor-pointer transition-colors ${Ce?`fill-[#f42a41] text-[#f42a41]`:``}`,K;o[90]!==E||o[91]!==Ke?(K=(0,S.jsx)(i.div,{whileHover:We,whileTap:Ge,children:(0,S.jsx)(re,{size:28,strokeWidth:1.5,className:Ke,onClick:E})}),o[90]=E,o[91]=Ke,o[92]=K):K=o[92];let q;o[93]===s.likes?q=o[94]:(q=(0,S.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:s.likes}),o[93]=s.likes,o[94]=q);let J;o[95]!==K||o[96]!==q?(J=(0,S.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[K,q]}),o[95]=K,o[96]=q,o[97]=J):J=o[97];let qe,Je;o[98]===Symbol.for(`react.memo_cache_sentinel`)?(qe={scale:1.1},Je={scale:.9},o[98]=qe,o[99]=Je):(qe=o[98],Je=o[99]);let Y;o[100]!==s||o[101]!==f?(Y=(0,S.jsx)(i.div,{whileHover:qe,whileTap:Je,children:(0,S.jsx)(ne,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>f(s)})}),o[100]=s,o[101]=f,o[102]=Y):Y=o[102];let X;o[103]===s.comments?X=o[104]:(X=(0,S.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:s.comments}),o[103]=s.comments,o[104]=X);let Z;o[105]!==Y||o[106]!==X?(Z=(0,S.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[Y,X]}),o[105]=Y,o[106]=X,o[107]=Z):Z=o[107];let Ye,Xe;o[108]===Symbol.for(`react.memo_cache_sentinel`)?(Ye={scale:1.1},Xe={scale:.9},o[108]=Ye,o[109]=Xe):(Ye=o[108],Xe=o[109]);let Ze;o[110]===Symbol.for(`react.memo_cache_sentinel`)?(Ze=(0,S.jsx)(i.div,{whileHover:Ye,whileTap:Xe,children:(0,S.jsx)(r,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>be(!0)})}),o[110]=Ze):Ze=o[110];let Qe,$e;o[111]===Symbol.for(`react.memo_cache_sentinel`)?(Qe={scale:1.1},$e={scale:.9},o[111]=Qe,o[112]=$e):(Qe=o[111],$e=o[112]);let et;o[113]===Symbol.for(`react.memo_cache_sentinel`)?(et=(0,S.jsx)(i.div,{whileHover:Qe,whileTap:$e,children:(0,S.jsx)(te,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ve(!0)})}),o[113]=et):et=o[113];let Q;o[114]!==u||o[115]!==s.user?(Q=()=>u(s.user),o[114]=u,o[115]=s.user,o[116]=Q):Q=o[116];let tt;o[117]===s.user.avatar?tt=o[118]:(tt=(0,S.jsx)(ae,{src:s.user.avatar}),o[117]=s.user.avatar,o[118]=tt);let nt;o[119]===s.user.username[0]?nt=o[120]:(nt=s.user.username[0].toUpperCase(),o[119]=s.user.username[0],o[120]=nt);let rt;o[121]===nt?rt=o[122]:(rt=(0,S.jsx)(g,{children:nt}),o[121]=nt,o[122]=rt);let it;o[123]!==Q||o[124]!==tt||o[125]!==rt?(it=(0,S.jsxs)(m,{className:`w-6 h-6 border-2 border-white cursor-pointer mt-2`,onClick:Q,children:[tt,rt]}),o[123]=Q,o[124]=tt,o[125]=rt,o[126]=it):it=o[126];let at;o[127]!==J||o[128]!==Z||o[129]!==it?(at=(0,S.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[J,Z,Ze,et,it]}),o[127]=J,o[128]=Z,o[129]=it,o[130]=at):at=o[130];let $;o[131]!==Me||o[132]!==k||o[133]!==A||o[134]!==j||o[135]!==N||o[136]!==G||o[137]!==at?($=(0,S.jsxs)(`div`,{ref:xe,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-zinc-900 md:rounded-lg overflow-hidden border-zinc-800 md:border group shadow-2xl`,onDoubleClick:Me,children:[k,A,j,N,G,at]}),o[131]=Me,o[132]=k,o[133]=A,o[134]=j,o[135]=N,o[136]=G,o[137]=at,o[138]=$):$=o[138];let ot;return o[139]!==D||o[140]!==O||o[141]!==$?(ot=(0,S.jsxs)(i.div,{initial:Pe,whileInView:Fe,viewport:Ie,transition:Ne,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[D,O,$]}),o[139]=D,o[140]=O,o[141]=$,o[142]=ot):ot=o[142],ot}),me=o();const C=e=>[`reel`,e],he=(e,t)=>{let n=(0,me.c)(9),r=e||``,i;n[0]===r?i=n[1]:(i=C(r),n[0]=r,n[1]=i);let a=!!e,o;n[2]!==t||n[3]!==e?(o=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await h.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await h.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await h.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},n[2]=t,n[3]=e,n[4]=o):o=n[4];let s;return n[5]!==i||n[6]!==a||n[7]!==o?(s={queryKey:i,enabled:a,queryFn:o},n[5]=i,n[6]=a,n[7]=o,n[8]=s):s=n[8],p(s)};var w=o(),ge=()=>{let e=(0,w.c)(39),{theme:t,showToast:n}=oe(),{user:r}=de(),i=d(),{id:a}=u(),o=t===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,{data:s,isLoading:l}=he(a,r?.id),{data:ee,isLoading:te,fetchNextPage:ne,hasNextPage:re,isFetchingNextPage:ie}=le(r?.id),f;bb0:{if(!ee){let t;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t=[],e[0]=t):t=e[0],f=t;break bb0}let t;e[1]===ee.pages?t=e[2]:(t=ee.pages.flat(),e[1]=ee.pages,e[2]=t),f=t}let p=f,ae;e[3]===i?ae=e[4]:(ae=e=>{i(`/profile/${e.username}`)},e[3]=i,e[4]=ae);let m=ae,se=a?l:te,ce;e[5]!==p||e[6]!==a||e[7]!==s?(ce=a?s?[s]:[]:p,e[5]=p,e[6]=a,e[7]=s,e[8]=ce):ce=e[8];let ue=ce;if(se){let t;return e[9]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,S.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:`Loading reel...`}),e[9]=t):t=e[9],t}if(ue.length===0){let t=a?`Reel not found`:`No reels yet`,n;return e[10]===t?n=e[11]:(n=(0,S.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:t}),e[10]=t,e[11]=n),n}let h;e[12]===i?h=e[13]:(h=()=>i(`/`),e[12]=i,e[13]=h);let g;e[14]===Symbol.for(`react.memo_cache_sentinel`)?(g=(0,S.jsx)(c,{size:28}),e[14]=g):g=e[14];let _;e[15]===h?_=e[16]:(_=(0,S.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:h,children:g}),e[15]=h,e[16]=_);let v;if(e[17]!==ue||e[18]!==o||e[19]!==m||e[20]!==n||e[21]!==t){let r;e[23]!==o||e[24]!==m||e[25]!==n||e[26]!==t?(r=e=>(0,S.jsx)(pe,{reel:e,showToast:n,theme:t,onUserClick:m,glassModal:o},e.id),e[23]=o,e[24]=m,e[25]=n,e[26]=t,e[27]=r):r=e[27],v=ue.map(r),e[17]=ue,e[18]=o,e[19]=m,e[20]=n,e[21]=t,e[22]=v}else v=e[22];let y;e[28]!==ne||e[29]!==re||e[30]!==a||e[31]!==ie?(y=re&&!a&&(0,S.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center snap-start bg-black`,children:(0,S.jsx)(`button`,{onClick:()=>ne(),disabled:ie,className:`bg-white/10 hover:bg-white/20 text-white px-6 py-2 rounded-full border border-white/20 transition-colors`,children:ie?`Loading...`:`See more videos`})}),e[28]=ne,e[29]=re,e[30]=a,e[31]=ie,e[32]=y):y=e[32];let b;e[33]!==v||e[34]!==y?(b=(0,S.jsxs)(`div`,{className:`w-full md:w-[400px] h-full`,children:[v,y]}),e[33]=v,e[34]=y,e[35]=b):b=e[35];let x;return e[36]!==_||e[37]!==b?(x=(0,S.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[_,b]}),e[36]=_,e[37]=b,e[38]=x):x=e[38],x};export{ge as default};