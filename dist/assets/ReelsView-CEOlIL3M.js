import{a as e}from"./rolldown-runtime-DDUpfMIz.js";import{At as t,Ht as n,Jt as r,L as i,Q as a,R as o,Ut as s,Vt as c,Xt as l,an as u,ct as ee,ft as te,in as d,nt as ne,sn as f,t as p,wt as re,xt as ie}from"./vendor-DzZPmAFc.js";import"./libs-1HhmK8mh.js";import"./supabase-Bn9f_lp1.js";import{S as m,T as ae,b as h,c as oe,d as se,p as ce,s as le,v as g,w as ue,x as _}from"./index-DwUDN_aw.js";import{n as v,t as y}from"./ShareModal-Dhle8mjm.js";import"./useGetSuggestedUsers-DLDAZr20.js";import{t as b}from"./useFollowUser-6lFtaZYX.js";var x=s(),S=e(f(),1),C=e(l(),1),de=p,fe=(0,S.memo)(e=>{let t=(0,x.c)(143),{reel:r,showToast:s,theme:l,onUserClick:u,glassModal:d}=e,{setViewingReel:f}=ae(),{user:p}=ue(),{mutate:ce}=le(),{mutate:g}=b(),[fe,pe]=(0,S.useState)(!1),[w,me]=(0,S.useState)(!0),[T,he]=(0,S.useState)(!0),[ge,_e]=(0,S.useState)(!1),[ve,ye]=(0,S.useState)(!1),be=(0,S.useRef)(null),xe=(0,S.useRef)(null),E=`${window.location.origin}/reels/${r.id}`,Se=r.hasLiked||!1,Ce;t[0]!==Se||t[1]!==r.id||t[2]!==s||t[3]!==ce||t[4]!==p?(Ce=()=>{if(!p){s(`Log in to like`);return}ce({targetId:r.id,type:`reel`,userId:p.id,hasLiked:Se})},t[0]=Se,t[1]=r.id,t[2]=s,t[3]=ce,t[4]=p,t[5]=Ce):Ce=t[5];let D=Ce,we;t[6]!==g||t[7]!==r.user.isFollowing||t[8]!==r.user.username||t[9]!==r.userId||t[10]!==s||t[11]!==p?(we=()=>{if(!p){s(`Log in to follow`);return}r.userId&&g({targetUserId:r.userId,currentUserId:p.id,isFollowing:r.user.isFollowing||!1,targetUsername:r.user.username},{onSuccess:()=>s(`Followed`),onError:()=>s(`Failed to follow`)})},t[6]=g,t[7]=r.user.isFollowing,t[8]=r.user.username,t[9]=r.userId,t[10]=s,t[11]=p,t[12]=we):we=t[12];let Te=we,Ee;t[13]===T?Ee=t[14]:(Ee=()=>{xe.current&&he(!T)},t[13]=T,t[14]=Ee);let De=Ee,Oe,ke;t[15]===Symbol.for(`react.memo_cache_sentinel`)?(Oe=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(he(!0),me(!1)):(he(!1),me(!0))},{threshold:.6});return be.current&&e.observe(be.current),()=>e.disconnect()},ke=[],t[15]=Oe,t[16]=ke):(Oe=t[15],ke=t[16]),(0,S.useEffect)(Oe,ke);let Ae;t[17]===D?Ae=t[18]:(Ae=()=>{D(),pe(!0),setTimeout(()=>pe(!1),1e3)},t[17]=D,t[18]=Ae);let je=Ae,Me,Ne,Pe,Fe;t[19]===Symbol.for(`react.memo_cache_sentinel`)?(Ne={opacity:0,scale:.95},Pe={opacity:1,scale:1},Fe={once:!0},Me={duration:.5},t[19]=Me,t[20]=Ne,t[21]=Pe,t[22]=Fe):(Me=t[19],Ne=t[20],Pe=t[21],Fe=t[22]);let O;t[23]!==d||t[24]!==ge||t[25]!==E||t[26]!==s||t[27]!==l?(O=ge&&(0,C.jsx)(v,{onClose:()=>_e(!1),showToast:s,theme:l,glassModal:d,shareUrl:E}),t[23]=d,t[24]=ge,t[25]=E,t[26]=s,t[27]=l,t[28]=O):O=t[28];let k;t[29]!==d||t[30]!==ve||t[31]!==E||t[32]!==s||t[33]!==l?(k=ve&&(0,C.jsx)(y,{onClose:()=>ye(!1),theme:l,showToast:s,glassModal:d,shareUrl:E}),t[29]=d,t[30]=ve,t[31]=E,t[32]=s,t[33]=l,t[34]=k):k=t[34];let A;t[35]!==w||t[36]!==T||t[37]!==r.src||t[38]!==De?(A=r.src?(0,C.jsx)(`div`,{className:`w-full h-full cursor-pointer`,onClick:De,children:(0,C.jsx)(de,{ref:xe,url:r.src,width:`100%`,height:`100%`,playing:T,muted:w,loop:!0,playsinline:!0,style:{objectFit:`cover`},className:`react-player pointer-events-none`})}):(0,C.jsx)(se,{src:r.src,width:400,className:`w-full h-full`,onClick:()=>me(!w),alt:`reel`}),t[35]=w,t[36]=T,t[37]=r.src,t[38]=De,t[39]=A):A=t[39];let j;t[40]===T?j=t[41]:(j=!T&&(0,C.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,C.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,C.jsx)(ne,{className:`text-white w-10 h-10 fill-white`})})}),t[40]=T,t[41]=j);let M;t[42]===w?M=t[43]:(M=(0,C.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),me(!w)},children:w?(0,C.jsx)(i,{className:`text-white w-5 h-5`}):(0,C.jsx)(o,{className:`text-white w-5 h-5`})}),t[42]=w,t[43]=M);let N;t[44]===fe?N=t[45]:(N=fe&&(0,C.jsx)(c.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,C.jsx)(ie,{size:100,className:`text-white fill-white drop-shadow-lg`})}),t[44]=fe,t[45]=N);let P;t[46]===N?P=t[47]:(P=(0,C.jsx)(n,{children:N}),t[46]=N,t[47]=P);let F;t[48]!==u||t[49]!==r.user?(F=()=>u(r.user),t[48]=u,t[49]=r.user,t[50]=F):F=t[50];let I;t[51]===r.user.avatar?I=t[52]:(I=(0,C.jsx)(m,{src:r.user.avatar}),t[51]=r.user.avatar,t[52]=I);let L;t[53]===r.user.username[0]?L=t[54]:(L=r.user.username[0].toUpperCase(),t[53]=r.user.username[0],t[54]=L);let R;t[55]===L?R=t[56]:(R=(0,C.jsx)(_,{children:L}),t[55]=L,t[56]=R);let z;t[57]!==I||t[58]!==R?(z=(0,C.jsxs)(h,{className:`w-8 h-8 border border-white/50 cursor-pointer`,children:[I,R]}),t[57]=I,t[58]=R,t[59]=z):z=t[59];let Ie;t[60]===r.user.username?Ie=t[61]:(Ie=(0,C.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:r.user.username}),t[60]=r.user.username,t[61]=Ie);let B;t[62]===r.user.isVerified?B=t[63]:(B=r.user.isVerified&&(0,C.jsx)(oe,{}),t[62]=r.user.isVerified,t[63]=B);let Le,Re;t[64]===Symbol.for(`react.memo_cache_sentinel`)?(Le={scale:1.05},Re={scale:.95},t[64]=Le,t[65]=Re):(Le=t[64],Re=t[65]);let ze=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${r.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,V;t[66]===Te?V=t[67]:(V=e=>{e.stopPropagation(),Te()},t[66]=Te,t[67]=V);let Be=r.user.isFollowing?`Following`:`Follow`,H;t[68]!==ze||t[69]!==V||t[70]!==Be?(H=(0,C.jsx)(c.button,{whileHover:Le,whileTap:Re,className:ze,onClick:V,children:Be}),t[68]=ze,t[69]=V,t[70]=Be,t[71]=H):H=t[71];let U;t[72]!==F||t[73]!==z||t[74]!==Ie||t[75]!==B||t[76]!==H?(U=(0,C.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:F,children:[z,Ie,B,H]}),t[72]=F,t[73]=z,t[74]=Ie,t[75]=B,t[76]=H,t[77]=U):U=t[77];let Ve;t[78]===Symbol.for(`react.memo_cache_sentinel`)?(Ve=(0,C.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`More`}),t[78]=Ve):Ve=t[78];let W;t[79]===r.caption?W=t[80]:(W=(0,C.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[r.caption,` `,Ve]}),t[79]=r.caption,t[80]=W);let He;t[81]===Symbol.for(`react.memo_cache_sentinel`)?(He=(0,C.jsx)(ee,{size:12}),t[81]=He):He=t[81];let G;t[82]===r.audio?G=t[83]:(G=(0,C.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[He,(0,C.jsx)(`div`,{className:`truncate w-40`,children:r.audio})]}),t[82]=r.audio,t[83]=G);let K;t[84]!==U||t[85]!==W||t[86]!==G?(K=(0,C.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[U,W,G]}),t[84]=U,t[85]=W,t[86]=G,t[87]=K):K=t[87];let Ue,We;t[88]===Symbol.for(`react.memo_cache_sentinel`)?(Ue={scale:1.1},We={scale:.9},t[88]=Ue,t[89]=We):(Ue=t[88],We=t[89]);let Ge=`cursor-pointer transition-colors ${Se?`fill-[#f42a41] text-[#f42a41]`:``}`,q;t[90]!==D||t[91]!==Ge?(q=(0,C.jsx)(c.div,{whileHover:Ue,whileTap:We,children:(0,C.jsx)(ie,{size:28,strokeWidth:1.5,className:Ge,onClick:D})}),t[90]=D,t[91]=Ge,t[92]=q):q=t[92];let J;t[93]===r.likes?J=t[94]:(J=(0,C.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:r.likes}),t[93]=r.likes,t[94]=J);let Y;t[95]!==q||t[96]!==J?(Y=(0,C.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[q,J]}),t[95]=q,t[96]=J,t[97]=Y):Y=t[97];let Ke,qe;t[98]===Symbol.for(`react.memo_cache_sentinel`)?(Ke={scale:1.1},qe={scale:.9},t[98]=Ke,t[99]=qe):(Ke=t[98],qe=t[99]);let X;t[100]!==r||t[101]!==f?(X=(0,C.jsx)(c.div,{whileHover:Ke,whileTap:qe,children:(0,C.jsx)(te,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>f(r)})}),t[100]=r,t[101]=f,t[102]=X):X=t[102];let Z;t[103]===r.comments?Z=t[104]:(Z=(0,C.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:r.comments}),t[103]=r.comments,t[104]=Z);let Q;t[105]!==X||t[106]!==Z?(Q=(0,C.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[X,Z]}),t[105]=X,t[106]=Z,t[107]=Q):Q=t[107];let Je,Ye;t[108]===Symbol.for(`react.memo_cache_sentinel`)?(Je={scale:1.1},Ye={scale:.9},t[108]=Je,t[109]=Ye):(Je=t[108],Ye=t[109]);let Xe;t[110]===Symbol.for(`react.memo_cache_sentinel`)?(Xe=(0,C.jsx)(c.div,{whileHover:Je,whileTap:Ye,children:(0,C.jsx)(a,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ye(!0)})}),t[110]=Xe):Xe=t[110];let Ze,Qe;t[111]===Symbol.for(`react.memo_cache_sentinel`)?(Ze={scale:1.1},Qe={scale:.9},t[111]=Ze,t[112]=Qe):(Ze=t[111],Qe=t[112]);let $e;t[113]===Symbol.for(`react.memo_cache_sentinel`)?($e=(0,C.jsx)(c.div,{whileHover:Ze,whileTap:Qe,children:(0,C.jsx)(re,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>_e(!0)})}),t[113]=$e):$e=t[113];let et;t[114]!==u||t[115]!==r.user?(et=()=>u(r.user),t[114]=u,t[115]=r.user,t[116]=et):et=t[116];let $;t[117]===r.user.avatar?$=t[118]:($=(0,C.jsx)(m,{src:r.user.avatar}),t[117]=r.user.avatar,t[118]=$);let tt;t[119]===r.user.username[0]?tt=t[120]:(tt=r.user.username[0].toUpperCase(),t[119]=r.user.username[0],t[120]=tt);let nt;t[121]===tt?nt=t[122]:(nt=(0,C.jsx)(_,{children:tt}),t[121]=tt,t[122]=nt);let rt;t[123]!==et||t[124]!==$||t[125]!==nt?(rt=(0,C.jsxs)(h,{className:`w-6 h-6 border-2 border-white cursor-pointer mt-2`,onClick:et,children:[$,nt]}),t[123]=et,t[124]=$,t[125]=nt,t[126]=rt):rt=t[126];let it;t[127]!==Y||t[128]!==Q||t[129]!==rt?(it=(0,C.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[Y,Q,Xe,$e,rt]}),t[127]=Y,t[128]=Q,t[129]=rt,t[130]=it):it=t[130];let at;t[131]!==je||t[132]!==A||t[133]!==j||t[134]!==M||t[135]!==P||t[136]!==K||t[137]!==it?(at=(0,C.jsxs)(`div`,{ref:be,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-zinc-900 md:rounded-lg overflow-hidden border-zinc-800 md:border group shadow-2xl`,onDoubleClick:je,children:[A,j,M,P,K,it]}),t[131]=je,t[132]=A,t[133]=j,t[134]=M,t[135]=P,t[136]=K,t[137]=it,t[138]=at):at=t[138];let ot;return t[139]!==O||t[140]!==k||t[141]!==at?(ot=(0,C.jsxs)(c.div,{initial:Ne,whileInView:Pe,viewport:Fe,transition:Me,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[O,k,at]}),t[139]=O,t[140]=k,t[141]=at,t[142]=ot):ot=t[142],ot}),pe=s();const w=e=>[`reel`,e],me=(e,t)=>{let n=(0,pe.c)(9),i=e||``,a;n[0]===i?a=n[1]:(a=w(i),n[0]=i,n[1]=a);let o=!!e,s;n[2]!==t||n[3]!==e?(s=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await g.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await g.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await g.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},n[2]=t,n[3]=e,n[4]=s):s=n[4];let c;return n[5]!==a||n[6]!==o||n[7]!==s?(c={queryKey:a,enabled:o,queryFn:s},n[5]=a,n[6]=o,n[7]=s,n[8]=c):c=n[8],r(c)};var T=s(),he=()=>{let e=(0,T.c)(39),{theme:n,showToast:r}=ae(),{user:i}=ue(),a=d(),{id:o}=u(),s=n===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,{data:c,isLoading:l}=me(o,i?.id),{data:ee,isLoading:te,fetchNextPage:ne,hasNextPage:f,isFetchingNextPage:p}=ce(i?.id),re;bb0:{if(!ee){let t;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t=[],e[0]=t):t=e[0],re=t;break bb0}let t;e[1]===ee.pages?t=e[2]:(t=ee.pages.flat(),e[1]=ee.pages,e[2]=t),re=t}let ie=re,m;e[3]===a?m=e[4]:(m=e=>{a(`/profile/${e.username}`)},e[3]=a,e[4]=m);let h=m,oe=o?l:te,se;e[5]!==ie||e[6]!==o||e[7]!==c?(se=o?c?[c]:[]:ie,e[5]=ie,e[6]=o,e[7]=c,e[8]=se):se=e[8];let le=se;if(oe){let t;return e[9]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,C.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:`Loading reel...`}),e[9]=t):t=e[9],t}if(le.length===0){let t=o?`Reel not found`:`No reels yet`,n;return e[10]===t?n=e[11]:(n=(0,C.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:t}),e[10]=t,e[11]=n),n}let g;e[12]===a?g=e[13]:(g=()=>a(`/`),e[12]=a,e[13]=g);let _;e[14]===Symbol.for(`react.memo_cache_sentinel`)?(_=(0,C.jsx)(t,{size:28}),e[14]=_):_=e[14];let v;e[15]===g?v=e[16]:(v=(0,C.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:g,children:_}),e[15]=g,e[16]=v);let y;if(e[17]!==le||e[18]!==s||e[19]!==h||e[20]!==r||e[21]!==n){let t;e[23]!==s||e[24]!==h||e[25]!==r||e[26]!==n?(t=e=>(0,C.jsx)(fe,{reel:e,showToast:r,theme:n,onUserClick:h,glassModal:s},e.id),e[23]=s,e[24]=h,e[25]=r,e[26]=n,e[27]=t):t=e[27],y=le.map(t),e[17]=le,e[18]=s,e[19]=h,e[20]=r,e[21]=n,e[22]=y}else y=e[22];let b;e[28]!==ne||e[29]!==f||e[30]!==o||e[31]!==p?(b=f&&!o&&(0,C.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center snap-start bg-black`,children:(0,C.jsx)(`button`,{onClick:()=>ne(),disabled:p,className:`bg-white/10 hover:bg-white/20 text-white px-6 py-2 rounded-full border border-white/20 transition-colors`,children:p?`Loading...`:`See more videos`})}),e[28]=ne,e[29]=f,e[30]=o,e[31]=p,e[32]=b):b=e[32];let x;e[33]!==y||e[34]!==b?(x=(0,C.jsxs)(`div`,{className:`w-full md:w-[400px] h-full`,children:[y,b]}),e[33]=y,e[34]=b,e[35]=x):x=e[35];let S;return e[36]!==v||e[37]!==x?(S=(0,C.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[v,x]}),e[36]=v,e[37]=x,e[38]=S):S=e[38],S};export{he as default};