const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomeView-COILrELm.js","assets/libs-eJHw-jrC.js","assets/rolldown-runtime-Cn8xt2Gj.js","assets/vendor-BGrLWuzF.js","assets/tanstack-CjdblyHw.js","assets/supabase-CBM4FLKd.js","assets/PostItem-zGiQxJFi.js","assets/useViewTracker-DZ0rhIHR.js","assets/useGetSuggestedUsers-Db38dhF6.js","assets/useFollowUser-CPfbrqXX.js","assets/ProfileView-Diwj920U.js","assets/MessagesView-C9yCEpEn.js","assets/ReelsView-CWSTKDYz.js","assets/NotificationsView-Bh7cPNy8.js","assets/ExploreView-DWISBh23.js","assets/AuthView-BqAUgQUO.js","assets/PostView-C5xAmejt.js"])))=>i.map(i=>d[i]);
import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{$ as t,$t as n,A as r,At as i,B as a,Bt as o,C as s,D as c,E as l,Ft as u,Gt as d,H as f,Ht as p,I as m,It as h,J as g,Jt as _,Kt as v,Lt as y,M as b,N as ee,Nt as x,O as S,Ot as C,Pt as w,Q as T,Qt as E,R as D,Rt as O,S as k,St as A,T as j,Ut as M,V as N,Vt as P,W as F,Wt as I,X as L,Xt as te,Yt as R,Z as z,_ as B,_t as V,b as H,bt as U,dt as W,et as G,g as K,h as q,ht as J,it as ne,j as Y,jt as re,k as ie,lt as ae,mt as oe,nt as se,pt as ce,q as le,qt as ue,rt as de,st as fe,ut as pe,v as me,w as he,x as ge,xt as _e,y as ve,yt as ye,z as be,zt as xe}from"./vendor-BGrLWuzF.js";import{B as Se,Bt as Ce,Ht as we,Lt as Te,R as Ee,Rt as De,Vt as Oe,j as ke,z as Ae,zt as je}from"./libs-eJHw-jrC.js";import{i as Me,t as Ne}from"./tanstack-CjdblyHw.js";import{t as Pe}from"./supabase-CBM4FLKd.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var Fe=E(),X=n(),Ie=e(Oe(),1),Le=e(Ce(),1),Re=e(je(),1),ze=e(De(),1),Be=e(Te(),1);Ie.default.extend(Le.default),Ie.default.extend(Re.default),Ie.default.extend(ze.default),Ie.default.extend(Be.default);var Ve=u();const He=b((e,t)=>({currentUser:{id:``,username:``,name:``,avatar:``,stats:{posts:0,followers:0,following:0}},stories:[],posts:[],savedPostIds:new Set,followedUsers:new Set,theme:`dark`,toastMessage:null,isCreateModalOpen:!1,isEditProfileOpen:!1,viewingStory:null,viewingPost:null,viewingReel:null,isSidebarExpanded:!0,unreadNotificationsCount:0,unreadMessagesCount:0,setUnreadNotificationsCount:t=>e({unreadNotificationsCount:t}),setUnreadMessagesCount:t=>e({unreadMessagesCount:t}),toggleSidebar:()=>e(e=>({isSidebarExpanded:!e.isSidebarExpanded})),toggleTheme:()=>e(e=>({theme:e.theme===`dark`?`light`:`dark`})),setToastMessage:t=>e({toastMessage:t}),showToast:e=>{Y(e)},setCreateModalOpen:t=>e({isCreateModalOpen:t}),setEditProfileOpen:t=>e({isEditProfileOpen:t}),setViewingStory:t=>e({viewingStory:t}),setViewingPost:t=>e({viewingPost:t}),setViewingReel:t=>e({viewingReel:t}),setCurrentUser:t=>e({currentUser:t}),addStory:n=>e(e=>{let r={id:String(Date.now()),username:e.currentUser.username,img:n,isUser:!0};return t().showToast(`Story added`),{stories:[r,...e.stories.filter(e=>!e.isUser)]}})})),Ue=(0,X.createContext)(void 0),We=()=>{let e=(0,X.useContext)(Ue);if(e===void 0)throw Error(`useAuth must be used within an AuthProvider`);return e};function Z(...e){return Ae(Se(e))}var Q=p();function Ge(e){let t=(0,Ve.c)(8),n,r;t[0]===e?(n=t[1],r=t[2]):({className:n,...r}=e,t[0]=e,t[1]=n,t[2]=r);let i;t[3]===n?i=t[4]:(i=Z(`relative flex size-8 shrink-0 overflow-hidden rounded-full`,n),t[3]=n,t[4]=i);let a;return t[5]!==r||t[6]!==i?(a=(0,Q.jsx)(S,{"data-slot":`avatar`,className:i,...r}),t[5]=r,t[6]=i,t[7]=a):a=t[7],a}function Ke(e){let t=(0,Ve.c)(8),n,r;t[0]===e?(n=t[1],r=t[2]):({className:n,...r}=e,t[0]=e,t[1]=n,t[2]=r);let i;t[3]===n?i=t[4]:(i=Z(`aspect-square size-full`,n),t[3]=n,t[4]=i);let a;return t[5]!==r||t[6]!==i?(a=(0,Q.jsx)(c,{"data-slot":`avatar-image`,className:i,...r}),t[5]=r,t[6]=i,t[7]=a):a=t[7],a}function qe(e){let t=(0,Ve.c)(8),n,r;t[0]===e?(n=t[1],r=t[2]):({className:n,...r}=e,t[0]=e,t[1]=n,t[2]=r);let i;t[3]===n?i=t[4]:(i=Z(`bg-muted flex size-full items-center justify-center rounded-full`,n),t[3]=n,t[4]=i);let a;return t[5]!==r||t[6]!==i?(a=(0,Q.jsx)(l,{"data-slot":`avatar-fallback`,className:i,...r}),t[5]=r,t[6]=i,t[7]=a):a=t[7],a}var Je=u(),Ye=Ee(`inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive`,{variants:{variant:{default:`bg-primary text-primary-foreground hover:bg-primary/90`,destructive:`bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60`,outline:`border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50`,secondary:`bg-secondary text-secondary-foreground hover:bg-secondary/80`,ghost:`hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50`,link:`text-primary underline-offset-4 hover:underline`},size:{default:`h-9 px-4 py-2 has-[>svg]:px-3`,sm:`h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5`,lg:`h-10 rounded-md px-6 has-[>svg]:px-4`,icon:`size-9`,"icon-sm":`size-8`,"icon-lg":`size-10`}},defaultVariants:{variant:`default`,size:`default`}});function Xe(e){let t=(0,Je.c)(16),n,r,i,a,o;t[0]===e?(n=t[1],r=t[2],i=t[3],a=t[4],o=t[5]):({className:n,variant:i,size:a,asChild:o,...r}=e,t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o);let s=i===void 0?`default`:i,c=a===void 0?`default`:a,l=o!==void 0&&o?ie:`button`,u;t[6]!==n||t[7]!==c||t[8]!==s?(u=Z(Ye({variant:s,size:c,className:n})),t[6]=n,t[7]=c,t[8]=s,t[9]=u):u=t[9];let d;return t[10]!==l||t[11]!==r||t[12]!==c||t[13]!==u||t[14]!==s?(d=(0,Q.jsx)(l,{"data-slot":`button`,"data-variant":s,"data-size":c,className:u,...r}),t[10]=l,t[11]=r,t[12]=c,t[13]=u,t[14]=s,t[15]=d):d=t[15],d}var Ze=u(),Qe=()=>{let e=(0,Ze.c)(97),{theme:n,toggleTheme:r,currentUser:i,setCreateModalOpen:o,isSidebarExpanded:s,toggleSidebar:c,unreadNotificationsCount:l,unreadMessagesCount:u}=He(),{signOut:p}=We(),m,h,_,v;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(m={icon:(0,Q.jsx)(ce,{size:24}),label:`Home`,path:`/`},h={icon:(0,Q.jsx)(g,{size:24}),label:`Explore`,path:`/explore`},_={icon:(0,Q.jsx)(ye,{size:24}),label:`Reels`,path:`/reels`},v=(0,Q.jsx)(ne,{size:24}),e[0]=m,e[1]=h,e[2]=_,e[3]=v):(m=e[0],h=e[1],_=e[2],v=e[3]);let y=u>0?u>99?`99+`:u:void 0,b;e[4]===y?b=e[5]:(b={icon:v,label:`Messages`,path:`/messages`,badge:y},e[4]=y,e[5]=b);let ee;e[6]===Symbol.for(`react.memo_cache_sentinel`)?(ee=(0,Q.jsx)(oe,{size:24}),e[6]=ee):ee=e[6];let S=l>0?l>99?`99+`:l:void 0,C;e[7]===S?C=e[8]:(C={icon:ee,label:`Notifications`,path:`/notifications`,badge:S},e[7]=S,e[8]=C);let w;e[9]!==b||e[10]!==C?(w=[m,h,_,b,C],e[9]=b,e[10]=C,e[11]=w):w=e[11];let E=w,D=`hidden md:flex flex-col ${s?`w-[245px]`:`w-[72px]`} h-screen fixed border-r border-border p-4 pb-5 justify-between z-50 transition-all duration-300 bg-background text-foreground`,O=`mb-8 mt-4 ${s?`px-2`:`flex justify-center`}`,k;e[12]===s?k=e[13]:(k=s?(0,Q.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Q.jsx)(`img`,{src:`/icon.png`,alt:`Logo`,className:`w-8 h-8 object-contain`}),(0,Q.jsx)(`h1`,{className:`text-xl font-bold tracking-tight text-[#006a4e]`,children:`Banglagram`})]}):(0,Q.jsx)(I,{to:`/`,className:`flex justify-center items-center`,children:(0,Q.jsx)(`img`,{src:`/icon.png`,alt:`Banglagram`,className:`w-8 h-8 object-contain`})}),e[12]=s,e[13]=k);let A;e[14]!==O||e[15]!==k?(A=(0,Q.jsx)(`div`,{className:O,children:k}),e[14]=O,e[15]=k,e[16]=A):A=e[16];let j;e[17]!==s||e[18]!==E?(j=E.map((e,t)=>(0,Q.jsx)(d,{to:e.path,className:$e,children:t=>{let{isActive:n}=t;return(0,Q.jsxs)(x.div,{whileTap:{scale:.98},className:`flex items-center ${s?`gap-4 px-3`:`justify-center`} py-3 rounded-lg hover:bg-muted`,children:[(0,Q.jsxs)(`div`,{className:`relative`,children:[(0,Q.jsx)(`div`,{className:n?`text-[#006a4e]`:``,children:e.icon}),e.badge&&(0,Q.jsx)(`div`,{className:`absolute -top-2 -right-2 bg-[#f42a41] text-white text-[10px] font-bold h-4 min-w-[16px] px-1 flex items-center justify-center rounded-full border-2 border-black`,children:e.badge})]}),s&&(0,Q.jsx)(`span`,{className:`text-base truncate`,children:e.label===`Home`?`Home`:e.label===`Explore`?`Explore`:e.label===`Reels`?`Reels`:e.label===`Messages`?`Messages`:e.label===`Notifications`?`Notifications`:e.label})]})}},t)),e[17]=s,e[18]=E,e[19]=j):j=e[19];let M;e[20]===o?M=e[21]:(M=()=>o(!0),e[20]=o,e[21]=M);let N=!s&&`justify-center px-0`,P;e[22]===N?P=e[23]:(P=Z(`flex items-center justify-start w-full gap-4 px-3 py-6 rounded-lg transition-colors cursor-pointer group hover:bg-muted`,N),e[22]=N,e[23]=P);let F;e[24]===Symbol.for(`react.memo_cache_sentinel`)?(F={scale:.98},e[24]=F):F=e[24];let L;e[25]===Symbol.for(`react.memo_cache_sentinel`)?(L=(0,Q.jsx)(`div`,{className:`relative`,children:(0,Q.jsx)(f,{size:24})}),e[25]=L):L=e[25];let te;e[26]===s?te=e[27]:(te=s&&(0,Q.jsx)(`span`,{className:`text-base truncate ml-2 font-normal`,children:`Create`}),e[26]=s,e[27]=te);let R;e[28]===te?R=e[29]:(R=(0,Q.jsxs)(x.div,{whileTap:F,className:`w-full h-full flex items-center`,children:[L,te]}),e[28]=te,e[29]=R);let z;e[30]!==M||e[31]!==P||e[32]!==R?(z=(0,Q.jsx)(Xe,{variant:`ghost`,onClick:M,className:P,asChild:!0,children:R}),e[30]=M,e[31]=P,e[32]=R,e[33]=z):z=e[33];let B=`/profile/${i.username}`,V;e[34]!==i.avatar||e[35]!==i.username?.[0]||e[36]!==s?(V=e=>{let{isActive:t}=e;return(0,Q.jsxs)(x.div,{whileTap:{scale:.98},className:`flex items-center ${s?`gap-4 px-3`:`justify-center`} py-3 rounded-lg hover:bg-muted`,children:[(0,Q.jsxs)(Ge,{className:Z(`w-6 h-6`,t&&`border-2 border-[#006a4e]`),children:[(0,Q.jsx)(Ke,{src:i.avatar}),(0,Q.jsx)(qe,{children:i.username?.[0]?.toUpperCase()||`?`})]}),s&&(0,Q.jsx)(`span`,{className:`text-base truncate`,children:`Profile`})]})},e[34]=i.avatar,e[35]=i.username?.[0],e[36]=s,e[37]=V):V=e[37];let H;e[38]!==B||e[39]!==V?(H=(0,Q.jsx)(d,{to:B,className:et,children:V}),e[38]=B,e[39]=V,e[40]=H):H=e[40];let U;e[41]!==j||e[42]!==z||e[43]!==H?(U=(0,Q.jsxs)(`div`,{className:`flex flex-col gap-2`,children:[j,z,H]}),e[41]=j,e[42]=z,e[43]=H,e[44]=U):U=e[44];let W;e[45]!==A||e[46]!==U?(W=(0,Q.jsxs)(`div`,{children:[A,U]}),e[45]=A,e[46]=U,e[47]=W):W=e[47];let G=!s&&`justify-center px-0`,K;e[48]===G?K=e[49]:(K=Z(`flex items-center justify-start w-full gap-4 px-3 py-6 rounded-lg transition-colors cursor-pointer group hover:bg-muted`,G),e[48]=G,e[49]=K);let q;e[50]===Symbol.for(`react.memo_cache_sentinel`)?(q={scale:.98},e[50]=q):q=e[50];let J;e[51]===n?J=e[52]:(J=n===`dark`?(0,Q.jsx)(a,{size:24}):(0,Q.jsx)(se,{size:24}),e[51]=n,e[52]=J);let Y;e[53]===s?Y=e[54]:(Y=s&&(0,Q.jsx)(`span`,{className:`text-base ml-4 font-normal`,children:`Switch Appearance`}),e[53]=s,e[54]=Y);let re;e[55]!==J||e[56]!==Y?(re=(0,Q.jsxs)(x.div,{whileTap:q,className:`w-full h-full flex items-center`,children:[J,Y]}),e[55]=J,e[56]=Y,e[57]=re):re=e[57];let ie;e[58]!==K||e[59]!==re||e[60]!==r?(ie=(0,Q.jsx)(Xe,{variant:`ghost`,onClick:r,className:K,asChild:!0,children:re}),e[58]=K,e[59]=re,e[60]=r,e[61]=ie):ie=e[61];let ae=!s&&`justify-center px-0`,le;e[62]===ae?le=e[63]:(le=Z(`flex items-center justify-start w-full gap-4 px-3 py-6 rounded-lg transition-colors cursor-pointer group hover:bg-muted`,ae),e[62]=ae,e[63]=le);let ue;e[64]===Symbol.for(`react.memo_cache_sentinel`)?(ue={scale:.98},e[64]=ue):ue=e[64];let de,pe;e[65]===s?(de=e[66],pe=e[67]):(de=s?(0,Q.jsx)(t,{size:24}):(0,Q.jsx)(T,{size:24}),pe=s&&(0,Q.jsx)(`span`,{className:`text-base ml-4 font-normal`,children:`Collapse`}),e[65]=s,e[66]=de,e[67]=pe);let me;e[68]!==de||e[69]!==pe?(me=(0,Q.jsxs)(x.div,{whileTap:ue,className:`w-full h-full flex items-center`,children:[de,pe]}),e[68]=de,e[69]=pe,e[70]=me):me=e[70];let he;e[71]!==le||e[72]!==me||e[73]!==c?(he=(0,Q.jsx)(Xe,{variant:`ghost`,onClick:c,className:le,asChild:!0,children:me}),e[71]=le,e[72]=me,e[73]=c,e[74]=he):he=e[74];let ge;e[75]===p?ge=e[76]:(ge=()=>p(),e[75]=p,e[76]=ge);let _e=!s&&`justify-center px-0`,ve;e[77]===_e?ve=e[78]:(ve=Z(`flex items-center justify-start w-full gap-4 px-3 py-6 rounded-lg transition-colors cursor-pointer group hover:bg-muted text-destructive hover:text-destructive/80`,_e),e[77]=_e,e[78]=ve);let be;e[79]===Symbol.for(`react.memo_cache_sentinel`)?(be={scale:.98},e[79]=be):be=e[79];let xe;e[80]===Symbol.for(`react.memo_cache_sentinel`)?(xe=(0,Q.jsx)(fe,{size:24}),e[80]=xe):xe=e[80];let Se;e[81]===s?Se=e[82]:(Se=s&&(0,Q.jsx)(`span`,{className:`text-base ml-4 font-normal`,children:`Log Out`}),e[81]=s,e[82]=Se);let Ce;e[83]===Se?Ce=e[84]:(Ce=(0,Q.jsxs)(x.div,{whileTap:be,className:`w-full h-full flex items-center`,children:[xe,Se]}),e[83]=Se,e[84]=Ce);let we;e[85]!==ge||e[86]!==ve||e[87]!==Ce?(we=(0,Q.jsx)(Xe,{variant:`ghost`,onClick:ge,className:ve,asChild:!0,children:Ce}),e[85]=ge,e[86]=ve,e[87]=Ce,e[88]=we):we=e[88];let Te;e[89]!==ie||e[90]!==he||e[91]!==we?(Te=(0,Q.jsxs)(`div`,{className:`flex flex-col gap-2`,children:[ie,he,we]}),e[89]=ie,e[90]=he,e[91]=we,e[92]=Te):Te=e[92];let Ee;return e[93]!==D||e[94]!==W||e[95]!==Te?(Ee=(0,Q.jsxs)(`div`,{className:D,children:[W,Te]}),e[93]=D,e[94]=W,e[95]=Te,e[96]=Ee):Ee=e[96],Ee};function $e(e){let{isActive:t}=e;return`block rounded-lg transition-colors cursor-pointer group ${t?`font-bold`:``}`}function et(e){let{isActive:t}=e;return`block rounded-lg transition-colors cursor-pointer group ${t?`font-bold`:``}`}var tt=u(),nt=()=>{let e=(0,tt.c)(19),{currentUser:t,setCreateModalOpen:n}=He(),r;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(r=[{icon:(0,Q.jsx)(ce,{size:24}),label:`Home`,path:`/`},{icon:(0,Q.jsx)(g,{size:24}),label:`Explore`,path:`/explore`},{icon:(0,Q.jsx)(ye,{size:24}),label:`Reels`,path:`/reels`}],e[0]=r):r=e[0];let i=r,a;e[1]===Symbol.for(`react.memo_cache_sentinel`)?(a=i.map(it),e[1]=a):a=e[1];let o;e[2]===Symbol.for(`react.memo_cache_sentinel`)?(o={scale:.8},e[2]=o):o=e[2];let s;e[3]===n?s=e[4]:(s=()=>n(!0),e[3]=n,e[4]=s);let c;e[5]===Symbol.for(`react.memo_cache_sentinel`)?(c=(0,Q.jsx)(f,{size:24}),e[5]=c):c=e[5];let l;e[6]===s?l=e[7]:(l=(0,Q.jsx)(x.div,{whileTap:o,className:`p-3`,onClick:s,children:c}),e[6]=s,e[7]=l);let u;e[8]===Symbol.for(`react.memo_cache_sentinel`)?(u={scale:.8},e[8]=u):u=e[8];let p;e[9]===Symbol.for(`react.memo_cache_sentinel`)?(p=(0,Q.jsx)(d,{to:`/messages`,className:at,children:(0,Q.jsx)(x.div,{whileTap:u,className:`p-3`,children:(0,Q.jsx)(ne,{size:24})})}),e[9]=p):p=e[9];let m=`/profile/${t.username}`,h;e[10]!==t.avatar||e[11]!==t.username?.[0]?(h=e=>{let{isActive:n}=e;return(0,Q.jsx)(x.div,{whileTap:{scale:.8},className:`p-3`,children:(0,Q.jsxs)(Ge,{className:Z(`w-6 h-6`,n&&`border-2 border-[#006a4e]`),children:[(0,Q.jsx)(Ke,{src:t.avatar}),(0,Q.jsx)(qe,{children:t.username?.[0]?.toUpperCase()||`?`})]})})},e[10]=t.avatar,e[11]=t.username?.[0],e[12]=h):h=e[12];let _;e[13]!==m||e[14]!==h?(_=(0,Q.jsx)(d,{to:m,className:ot,children:h}),e[13]=m,e[14]=h,e[15]=_):_=e[15];let v;return e[16]!==_||e[17]!==l?(v=(0,Q.jsxs)(`div`,{className:`md:hidden fixed bottom-0 left-0 right-0 border-t border-border flex justify-around items-center h-12 z-50 px-2 pb-safe bg-background/90 text-foreground backdrop-blur-md bg-opacity-90`,children:[a,l,p,_]}),e[16]=_,e[17]=l,e[18]=v):v=e[18],v};function rt(e){let{isActive:t}=e;return`block ${t?`text-[#006a4e]`:``}`}function it(e,t){return(0,Q.jsx)(d,{to:e.path,className:rt,children:(0,Q.jsx)(x.div,{whileTap:{scale:.8},className:`p-3`,children:e.icon})},t)}function at(e){let{isActive:t}=e;return`block ${t?`text-[#006a4e]`:``}`}function ot(e){let{isActive:t}=e;return`block ${t?`text-[#006a4e]`:``}`}var st=u(),ct=()=>{let e=(0,st.c)(14),{isSidebarExpanded:t}=He(),{user:n}=We(),r=R(),i;e[0]===r.pathname?i=e[1]:(i=r.pathname.startsWith(`/messages`),e[0]=r.pathname,e[1]=i);let a=i,o;e[2]===r.pathname?o=e[3]:(o=r.pathname.startsWith(`/reels`),e[2]=r.pathname,e[3]=o);let s=o,c;e[4]!==a||e[5]!==s||e[6]!==n?(c=n?(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(Qe,{}),!a&&!s&&(0,Q.jsx)(nt,{})]}):(0,Q.jsx)(`div`,{className:`fixed top-4 right-4 z-[60]`,children:(0,Q.jsx)(I,{to:`/`,className:`bg-[#006a4e] text-white px-4 py-2 rounded-lg font-semibold text-sm shadow-lg hover:bg-[#00523c] transition-colors`,children:`Log In`})}),e[4]=a,e[5]=s,e[6]=n,e[7]=c):c=e[7];let l=`flex-grow ${n?t?`md:ml-[245px]`:`md:ml-[72px]`:``} flex justify-center transition-all duration-300 ${n&&!a&&!s?`pb-14 md:pb-0`:``}`,u;e[8]===Symbol.for(`react.memo_cache_sentinel`)?(u=(0,Q.jsx)(v,{}),e[8]=u):u=e[8];let d;e[9]===l?d=e[10]:(d=(0,Q.jsx)(`main`,{className:l,children:u}),e[9]=l,e[10]=d);let f;return e[11]!==c||e[12]!==d?(f=(0,Q.jsxs)(`div`,{className:`min-h-screen font-['Hind_Siliguri'] flex flex-col md:flex-row transition-colors duration-300 bg-background text-foreground`,children:[c,d]}),e[11]=c,e[12]=d,e[13]=f):f=e[13],f};const $=Pe(`https://uyffyqlgyjieayivgvhg.supabase.co`,`sb_publishable_WFDkcqORIdT_6pMJSoxjQg_EMHEKNfb`);var lt=u();const ut=()=>{let e=(0,lt.c)(12),{user:t}=We(),n;e[0]===t?n=e[1]:(n=async()=>{if(t)try{let e=new Date().toISOString();await $.from(`profiles`).update({last_seen:e,is_online:!0}).eq(`id`,t.id)}catch(e){let t=e;console.error(`Error updating last seen:`,t)}},e[0]=t,e[1]=n);let r=n,i;e[2]===t?i=e[3]:(i=async()=>{if(t)try{let e=new Date().toISOString();await $.from(`profiles`).update({last_seen:e,is_online:!1}).eq(`id`,t.id)}catch(e){let t=e;console.error(`Error updating offline status:`,t)}},e[2]=t,e[3]=i);let a=i,o,s;e[4]!==r||e[5]!==a||e[6]!==t?(o=()=>{if(!t)return;r();let e=setInterval(r,3e4),n=()=>{document.hidden?a():r()},i=()=>{a()};return document.addEventListener(`visibilitychange`,n),window.addEventListener(`beforeunload`,i),()=>{clearInterval(e),document.removeEventListener(`visibilitychange`,n),window.removeEventListener(`beforeunload`,i)}},s=[t,r,a],e[4]=r,e[5]=a,e[6]=t,e[7]=o,e[8]=s):(o=e[7],s=e[8]),(0,X.useEffect)(o,s);let c;return e[9]!==r||e[10]!==a?(c={updateLastSeen:r,updateOfflineStatus:a},e[9]=r,e[10]=a,e[11]=c):c=e[11],c};var dt=u(),ft=e(Oe(),1);const pt=[`feed`],mt=e=>{let t=(0,dt.c)(2),n;return t[0]===e?n=t[1]:(n={queryKey:pt,queryFn:async t=>{let{pageParam:n}=t,r=n===void 0?0:n,{data:i,error:a}=await $.rpc(`get_ranked_feed`,{current_user_id:e,limit_count:10,offset_count:r*10});if(a)throw a;let o=i||[];return o.length>0&&(console.log(`FIRST POST RAW DATA:`,o[0]),console.log(`VIEW COUNT VALUE:`,o[0].views_count)),o.map(ht)},initialPageParam:0,getNextPageParam:gt},t[0]=e,t[1]=n),O(n)};function ht(e){return{id:e.id,user:{id:e.user_id,username:e.username,name:e.full_name||e.username,avatar:e.avatar_url||``,isVerified:e.is_verified||!1},content:{type:e.type===`reel`?`video`:`image`,src:e.type===`reel`?e.video_url:e.image_url},likes:e.likes_count||0,caption:e.caption||``,comments:e.comments_count||0,views:e.views_count||0,time:(0,ft.default)(e.created_at).fromNow(),createdAt:e.created_at,isVerified:e.is_verified||!1,hasLiked:e.has_liked,hasSaved:e.has_saved}}function gt(e,t){return e.length===10?t.length:void 0}var _t=u(),vt=e(Oe(),1);const yt=e=>[`profile`,e],bt=(e,t)=>{let n=(0,_t.c)(9),r=e||``,i;n[0]===r?i=n[1]:(i=yt(r),n[0]=r,n[1]=i);let a=!!e,s;n[2]!==t||n[3]!==e?(s=async()=>{if(!e)throw Error(`Username required`);let{data:n,error:r}=await $.from(`profiles`).select(`id, username, full_name, avatar_url, bio, is_verified`).eq(`username`,e).single();if(r)throw r;let i=n,{count:a}=await $.from(`posts`).select(`*`,{count:`exact`,head:!0}).eq(`user_id`,i.id),{count:o}=await $.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`following_id`,i.id),{count:s}=await $.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,i.id),{data:c}=await $.from(`posts`).select(`
           id,
           image_url,
           caption,
           created_at,
           likes (count),
           comments (count)
        `).eq(`user_id`,i.id).order(`created_at`,{ascending:!1}),l=c||[],u=new Set;if(t&&l.length>0){let e=l.map(xt),{data:n}=await $.from(`likes`).select(`post_id`).eq(`user_id`,t).in(`post_id`,e);n&&n.forEach(e=>u.add(e.post_id||``))}let d=!1;if(t&&t!==i.id){let{count:e}=await $.from(`follows`).select(`*`,{count:`exact`,head:!0}).match({follower_id:t,following_id:i.id});d=!!e&&e>0}let f=l.map(e=>{let t=e.likes,n=e.comments;return{id:e.id,user:{id:i.id,username:i.username,name:i.full_name||i.username,avatar:i.avatar_url||``,isVerified:i.is_verified||!1},content:{type:`image`,src:e.image_url},likes:t[0]?.count||0,caption:e.caption||``,comments:n[0]?.count||0,time:(0,vt.default)(e.created_at).fromNow(),isVerified:i.is_verified||!1,hasLiked:u.has(e.id)}});return{user:{id:i.id,username:i.username,name:i.full_name||``,avatar:i.avatar_url||``,bio:i.bio||``,isVerified:i.is_verified||!1,stats:{posts:a||0,followers:o||0,following:s||0},isFollowing:d},posts:f}},n[2]=t,n[3]=e,n[4]=s):s=n[4];let c;return n[5]!==i||n[6]!==a||n[7]!==s?(c={queryKey:i,enabled:a,queryFn:s},n[5]=i,n[6]=a,n[7]=s,n[8]=c):c=n[8],o(c)};function xt(e){return e.id}var St=u(),Ct=e(Oe(),1);const wt=()=>{let e=(0,St.c)(2),t=P(),n;return e[0]===t?n=e[1]:(n={mutationFn:Tt,onSuccess:(e,n)=>{t.invalidateQueries({queryKey:pt}),t.invalidateQueries({queryKey:yt(n.username)})}},e[0]=t,e[1]=n),xe(n)};async function Tt(e){let{file:t,caption:n,userId:r}=e,i=t.name.split(`.`).pop(),a=`${r}/${(0,Ct.default)().valueOf()}.${i}`,{error:o}=await $.storage.from(`posts`).upload(a,t,{cacheControl:`3600`,upsert:!1,contentType:t.type});if(o)throw o;let{data:s}=$.storage.from(`posts`).getPublicUrl(a),{publicUrl:c}=s,{data:l,error:u}=await $.from(`posts`).insert({user_id:r,caption:n,image_url:c}).select().single();if(u)throw u;return l}var Et=u();const Dt=[`reels`],Ot=e=>{let t=(0,Et.c)(2),n;return t[0]===e?n=t[1]:(n={queryKey:Dt,initialPageParam:0,queryFn:async t=>{let{pageParam:n}=t,r=(n===void 0?0:n)*5,i=r+4,{data:a,error:o}=await $.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).order(`created_at`,{ascending:!1}).range(r,i);if(o)throw o;let s=a||[],c=s.map(kt),l=new Set,u=Array.from(new Set(s.map(At))),d=new Set;if(e){if(c.length>0){let{data:t}=await $.from(`likes`).select(`reel_id`).eq(`user_id`,e).in(`reel_id`,c);t&&t.forEach(e=>l.add(e.reel_id||``))}if(u.length>0){let{data:t}=await $.from(`follows`).select(`following_id`).eq(`follower_id`,e).in(`following_id`,u);t&&t.forEach(e=>d.add(e.following_id))}}return s.map(e=>({id:e.id,userId:e.user_id,user:{id:e.user_id,username:e.profiles?.username||`Unknown`,name:e.profiles?.full_name||`Unknown`,avatar:e.profiles?.avatar_url||``,isVerified:e.profiles?.is_verified||!1,isFollowing:d.has(e.user_id)},src:e.video_url,likes:e.likes?.[0]?.count||0,comments:e.comments?.[0]?.count||0,views:e.view_count||0,caption:e.caption||``,audio:e.audio_track_name||`Original Audio`,hasLiked:l.has(e.id)}))},getNextPageParam:jt},t[0]=e,t[1]=n),O(n)};function kt(e){return e.id}function At(e){return e.user_id}function jt(e,t){return e.length===5?t.length:void 0}var Mt=u(),Nt=e(Oe(),1);const Pt=()=>{let e=(0,Mt.c)(2),t=P(),n;return e[0]===t?n=e[1]:(n={mutationFn:Ft,onSuccess:()=>{t.invalidateQueries({queryKey:Dt})}},e[0]=t,e[1]=n),xe(n)};async function Ft(e){let{file:t,caption:n,userId:r}=e,i=t.name.split(`.`).pop(),a=`${r}/${(0,Nt.default)().valueOf()}.${i}`,{error:o}=await $.storage.from(`reels`).upload(a,t,{cacheControl:`3600`,upsert:!1,contentType:t.type});if(o)throw o;let{data:s}=$.storage.from(`reels`).getPublicUrl(a),{publicUrl:c}=s,{data:l,error:u}=await $.from(`reels`).insert({user_id:r,caption:n,video_url:c}).select().single();if(u)throw u;return l}var It=u();const Lt=[`stories`],Rt=e=>{let t=(0,It.c)(2),n;return t[0]===e?n=t[1]:(n={queryKey:Lt,queryFn:async()=>{let{data:t,error:n}=await $.from(`stories`).select(`
            *,
            user:profiles (
                username,
                avatar_url,
                is_verified
            )
        `).order(`created_at`,{ascending:!1});if(n)throw n;return t.map(t=>({id:t.id,username:t.user?.username||`User`,userAvatar:t.user?.avatar_url||``,img:t.media_url,isUser:t.user_id===e,isVerified:t.user?.is_verified||!1,createdAt:t.created_at}))}},t[0]=e,t[1]=n),o(n)};var zt=u(),Bt=e(Oe(),1);const Vt=()=>{let e=(0,zt.c)(2),t=P(),n;return e[0]===t?n=e[1]:(n={mutationFn:Ht,onSuccess:()=>{t.invalidateQueries({queryKey:Lt})}},e[0]=t,e[1]=n),xe(n)};async function Ht(e){let{file:t,userId:n}=e,r=t.name.split(`.`).pop(),i=`${`${n}-${(0,Bt.default)().valueOf()}.${r}`}`,{error:a}=await $.storage.from(`stories`).upload(i,t);if(a)throw a;let{data:o}=$.storage.from(`stories`).getPublicUrl(i),{publicUrl:s}=o,c=(0,Bt.default)().add(24,`hour`),{error:l}=await $.from(`stories`).insert({user_id:n,media_url:s,expires_at:c.toISOString()});if(l)throw l}var Ut=u();function Wt(e){let t=(0,Ut.c)(8),n,r;t[0]===e?(n=t[1],r=t[2]):({className:n,...r}=e,t[0]=e,t[1]=n,t[2]=r);let i;t[3]===n?i=t[4]:(i=Z(`border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,n),t[3]=n,t[4]=i);let a;return t[5]!==r||t[6]!==i?(a=(0,Q.jsx)(`textarea`,{"data-slot":`textarea`,className:i,...r}),t[5]=r,t[6]=i,t[7]=a):a=t[7],a}var Gt=({onFileSelect:e,accept:t={"image/*":[],"video/*":[]},maxSize:n=100*1024*1024})=>{let{theme:r}=He(),{getRootProps:i,getInputProps:a,isDragActive:o,isDragReject:s}=j({onDrop:(0,X.useCallback)(t=>{t&&t.length>0&&e(t[0])},[e]),accept:t,maxSize:n,multiple:!1}),c=o?`border-[#0095f6]`:s?`border-red-500`:r===`dark`?`border-zinc-700`:`border-zinc-300`,l=o?`bg-blue-500/10`:`bg-transparent`;return(0,Q.jsxs)(`div`,{...i(),className:`w-full h-full min-h-[300px] flex flex-col items-center justify-center border-2 border-dashed ${c} ${l} rounded-xl transition-colors cursor-pointer p-8`,children:[(0,Q.jsx)(`input`,{...a()}),(0,Q.jsxs)(`div`,{className:`flex flex-col items-center gap-4 text-center`,children:[(0,Q.jsxs)(`div`,{className:`flex gap-4 mb-2`,children:[(0,Q.jsx)(W,{size:40,className:`${r===`dark`?`text-white`:`text-black`} opacity-80`}),(0,Q.jsx)(m,{size:40,className:`${r===`dark`?`text-white`:`text-black`} opacity-80`})]}),o?(0,Q.jsx)(`p`,{className:`text-xl font-medium text-[#0095f6]`,children:`Drop files here`}):s?(0,Q.jsx)(`p`,{className:`text-xl font-medium text-red-500`,children:`File not supported`}):(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(`p`,{className:`text-xl font-light ${r===`dark`?`text-white`:`text-black`}`,children:`Drag photos or videos here`}),(0,Q.jsx)(`button`,{className:`bg-[#0095f6] hover:bg-[#1877f2] text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors mt-4`,children:`Select`})]})]})]})},Kt=u(),qt=()=>{let e=(0,Kt.c)(64),{theme:t,setCreateModalOpen:n,showToast:r}=He(),{user:a,profile:o}=We(),s=t===`dark`?`bg-[#121212] md:bg-[#121212]/95 md:backdrop-blur-xl md:border md:border-zinc-800`:`bg-white md:bg-white/95 md:backdrop-blur-xl md:border md:border-zinc-200`,[c,l]=(0,X.useState)(null),[u,d]=(0,X.useState)(null),[f,p]=(0,X.useState)(``),[m,h]=(0,X.useState)(!1),[g,_]=(0,X.useState)(null),{mutate:v,isPending:y}=wt(),{mutate:b,isPending:S}=Pt(),{mutate:C,isPending:w}=Vt(),T=y||S||w,E;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(E=e=>{if(e){l(e);let t=e.type.startsWith(`video/`);h(t),d(URL.createObjectURL(e)),_(t?`reel`:`post`)}},e[0]=E):E=e[0];let D=E,O;e[1]!==f||e[2]!==v||e[3]!==b||e[4]!==C||e[5]!==g||e[6]!==c||e[7]!==o||e[8]!==n||e[9]!==r||e[10]!==a?(O=async()=>{!c||!a||!o||(g===`reel`?b({file:c,caption:f,userId:a.id,username:o.username},{onSuccess:()=>{r(`Reel shared`),n(!1)},onError:()=>r(`Failed to share reel`)}):g===`story`?C({file:c,userId:a.id},{onSuccess:()=>{r(`Story shared`),n(!1)},onError:()=>r(`Failed to share story`)}):v({file:c,caption:f,userId:a.id,username:o.username},{onSuccess:()=>{r(`Post shared`),n(!1)},onError:()=>r(`Failed to share post`)}))},e[1]=f,e[2]=v,e[3]=b,e[4]=C,e[5]=g,e[6]=c,e[7]=o,e[8]=n,e[9]=r,e[10]=a,e[11]=O):O=e[11];let k=O,A;e[12]===n?A=e[13]:(A=()=>n(!1),e[12]=n,e[13]=A);let j=A,M,N,P;e[14]===Symbol.for(`react.memo_cache_sentinel`)?(M={opacity:0},N={opacity:1},P={opacity:0},e[14]=M,e[15]=N,e[16]=P):(M=e[14],N=e[15],P=e[16]);let F,I,L;e[17]===Symbol.for(`react.memo_cache_sentinel`)?(F={scale:.95,opacity:0,y:20},I={scale:1,opacity:1,y:0},L={scale:.95,opacity:0,y:20},e[17]=F,e[18]=I,e[19]=L):(F=e[17],I=e[18],L=e[19]);let te=`w-full h-full md:w-full md:max-w-5xl md:h-[85vh] md:rounded-2xl overflow-hidden shadow-2xl flex flex-col ${s} ${t===`dark`?`text-white`:`text-black`}`,R=t===`dark`?`border-zinc-800`:`border-zinc-200`,z;e[20]===R?z=e[21]:(z=Z(`px-4 h-14 border-b flex items-center justify-between shrink-0`,R),e[20]=R,e[21]=z);let B;e[22]!==j||e[23]!==u?(B=(0,Q.jsx)(`div`,{className:`w-20 flex justify-start`,children:u?(0,Q.jsx)(Xe,{variant:`ghost`,size:`icon`,className:`-ml-2`,onClick:()=>{d(null),l(null),_(null)},children:(0,Q.jsx)(re,{className:`h-6 w-6`})}):(0,Q.jsx)(Xe,{variant:`ghost`,size:`icon`,className:`-ml-2`,onClick:j,children:(0,Q.jsx)(ee,{className:`h-6 w-6`})})}),e[22]=j,e[23]=u,e[24]=B):B=e[24];let V=u?g===`reel`?`New Reel`:g===`story`?`New Story`:`New Post`:`Create`,H;e[25]===V?H=e[26]:(H=(0,Q.jsx)(`span`,{className:`font-semibold text-lg`,children:V}),e[25]=V,e[26]=H);let U;e[27]!==k||e[28]!==T||e[29]!==u?(U=u&&(0,Q.jsx)(Xe,{variant:`ghost`,onClick:k,disabled:T,className:`text-blue-500 hover:text-blue-600 hover:bg-blue-500/10 font-semibold px-2`,children:T?(0,Q.jsx)(ae,{className:`h-5 w-5 animate-spin`}):`Share`}),e[27]=k,e[28]=T,e[29]=u,e[30]=U):U=e[30];let W;e[31]===U?W=e[32]:(W=(0,Q.jsx)(`div`,{className:`w-20 flex justify-end`,children:U}),e[31]=U,e[32]=W);let G;e[33]!==z||e[34]!==B||e[35]!==H||e[36]!==W?(G=(0,Q.jsxs)(`div`,{className:z,children:[B,H,W]}),e[33]=z,e[34]=B,e[35]=H,e[36]=W,e[37]=G):G=e[37];let K=u?`md:border-r border-zinc-800`:``,q;e[38]===K?q=e[39]:(q=Z(`flex-1 bg-black relative flex items-center justify-center overflow-hidden`,K),e[38]=K,e[39]=q);let ne;e[40]!==m||e[41]!==u?(ne=u?(0,Q.jsx)(`div`,{className:`relative w-full h-full flex items-center justify-center bg-[#1a1a1a]`,children:m?(0,Q.jsx)(`video`,{src:u,controls:!0,className:`max-h-full max-w-full object-contain`}):(0,Q.jsx)(`img`,{src:u,className:`max-h-full max-w-full object-contain`,alt:`preview`})}):(0,Q.jsx)(`div`,{className:`w-full h-full p-8 flex flex-col items-center justify-center`,children:(0,Q.jsx)(Gt,{onFileSelect:D})}),e[40]=m,e[41]=u,e[42]=ne):ne=e[42];let Y;e[43]!==q||e[44]!==ne?(Y=(0,Q.jsx)(`div`,{className:q,children:ne}),e[43]=q,e[44]=ne,e[45]=Y):Y=e[45];let ie;e[46]!==f||e[47]!==g||e[48]!==m||e[49]!==u||e[50]!==o?.avatar_url||e[51]!==o?.username||e[52]!==t?(ie=u&&(0,Q.jsxs)(`div`,{className:Z(`w-full md:w-[400px] flex flex-col bg-background/50 backdrop-blur-sm`,t===`dark`?`bg-[#121212]`:`bg-white`),children:[(0,Q.jsxs)(`div`,{className:`p-4 flex items-center gap-3`,children:[(0,Q.jsxs)(Ge,{className:`w-10 h-10 border border-border`,children:[(0,Q.jsx)(Ke,{src:o?.avatar_url||``}),(0,Q.jsx)(qe,{children:o?.username?.[0]?.toUpperCase()})]}),(0,Q.jsx)(`span`,{className:`font-semibold text-sm`,children:o?.username})]}),g===`story`?(0,Q.jsx)(`div`,{className:`flex-grow flex items-center justify-center p-8 text-center text-muted-foreground`,children:(0,Q.jsx)(`p`,{className:`text-sm`,children:`Stories are visible for 24 hours. Captions are not supported on stories yet.`})}):(0,Q.jsxs)(`div`,{className:`flex-grow flex flex-col overflow-y-auto`,children:[(0,Q.jsx)(`div`,{className:`px-4 pb-4`,children:(0,Q.jsx)(Wt,{className:`w-full min-h-[120px] bg-transparent border-none focus-visible:ring-0 resize-none text-base p-1 placeholder:text-muted-foreground/50`,placeholder:`Write a caption...`,value:f,onChange:e=>p(e.target.value)})}),(0,Q.jsx)(`div`,{className:Z(`h-px w-full`,t===`dark`?`bg-zinc-800`:`bg-zinc-100`)}),(0,Q.jsxs)(`div`,{className:`flex flex-col`,children:[(0,Q.jsxs)(`div`,{className:`px-4 py-3 flex items-center justify-between cursor-pointer hover:bg-accent/50 transition-colors border-b border-border/50`,children:[(0,Q.jsxs)(`div`,{className:`flex items-center gap-3 text-sm`,children:[(0,Q.jsx)(i,{size:20,className:`text-muted-foreground`}),(0,Q.jsx)(`span`,{children:`Tag People`})]}),(0,Q.jsx)(_e,{size:16,className:`text-muted-foreground`})]}),(0,Q.jsxs)(`div`,{className:`px-4 py-3 flex items-center justify-between cursor-pointer hover:bg-accent/50 transition-colors border-b border-border/50`,children:[(0,Q.jsxs)(`div`,{className:`flex items-center gap-3 text-sm`,children:[(0,Q.jsx)(J,{size:20,className:`text-muted-foreground`}),(0,Q.jsx)(`span`,{children:`Add Topics`})]}),(0,Q.jsx)(_e,{size:16,className:`text-muted-foreground`})]})]})]}),(0,Q.jsx)(`div`,{className:Z(`p-4 border-t`,t===`dark`?`border-zinc-800`:`border-zinc-200`),children:(0,Q.jsxs)(`div`,{className:`grid grid-cols-2 gap-2 bg-muted/50 p-1 rounded-lg`,children:[!m&&(0,Q.jsx)(`button`,{onClick:()=>_(`post`),className:Z(`text-sm font-semibold py-2 rounded-md transition-all`,g===`post`?`bg-background text-foreground shadow-sm`:`text-muted-foreground hover:text-foreground`),children:`Post`}),(0,Q.jsx)(`button`,{onClick:()=>_(m?`reel`:`story`),className:Z(`text-sm font-semibold py-2 rounded-md transition-all`,g===(m?`reel`:`story`)?`bg-background text-foreground shadow-sm`:`text-muted-foreground hover:text-foreground`),children:m?`Reel`:`Story`})]})})]}),e[46]=f,e[47]=g,e[48]=m,e[49]=u,e[50]=o?.avatar_url,e[51]=o?.username,e[52]=t,e[53]=ie):ie=e[53];let oe;e[54]!==Y||e[55]!==ie?(oe=(0,Q.jsxs)(`div`,{className:`flex-grow flex flex-col md:flex-row overflow-hidden`,children:[Y,ie]}),e[54]=Y,e[55]=ie,e[56]=oe):oe=e[56];let se;e[57]!==G||e[58]!==oe||e[59]!==te?(se=(0,Q.jsxs)(x.div,{initial:F,animate:I,exit:L,className:te,onClick:Jt,children:[G,oe]}),e[57]=G,e[58]=oe,e[59]=te,e[60]=se):se=e[60];let ce;return e[61]!==j||e[62]!==se?(ce=(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)(x.div,{initial:M,animate:N,exit:P,className:`fixed inset-0 z-[100] bg-black/80 flex items-center justify-center md:p-4`,onClick:j,children:se})}),e[61]=j,e[62]=se,e[63]=ce):ce=e[63],ce};function Jt(e){return e.stopPropagation()}var Yt=u();const Xt=()=>{let e=(0,Yt.c)(10),t=P(),{showToast:n,setCurrentUser:r,currentUser:i}=He(),a;e[0]!==i||e[1]!==t||e[2]!==r||e[3]!==n?(a=e=>{n(`Profile updated`),r({...i,name:e?.full_name||``,bio:e?.bio||``,avatar:e?.avatar_url||``}),t.invalidateQueries({queryKey:[`profile`]}),e?.username&&t.invalidateQueries({queryKey:[`profile`,e.username]})},e[0]=i,e[1]=t,e[2]=r,e[3]=n,e[4]=a):a=e[4];let o;e[5]===n?o=e[6]:(o=e=>{console.error(`Update profile error:`,e),n(`Failed to update profile`)},e[5]=n,e[6]=o);let s;return e[7]!==a||e[8]!==o?(s={mutationFn:Zt,onSuccess:a,onError:o},e[7]=a,e[8]=o,e[9]=s):s=e[9],xe(s)};async function Zt(e){let{userId:t,name:n,bio:r,avatar:i}=e,{data:a,error:o}=await $.from(`profiles`).update({full_name:n,bio:r,avatar_url:i}).eq(`id`,t).select().single();if(o)throw o;return a}var Qt=u();function $t(e){let t=(0,Qt.c)(10),n,r,i;t[0]===e?(n=t[1],r=t[2],i=t[3]):({className:n,type:i,...r}=e,t[0]=e,t[1]=n,t[2]=r,t[3]=i);let a;t[4]===n?a=t[5]:(a=Z(`file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,`focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]`,`aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive`,n),t[4]=n,t[5]=a);let o;return t[6]!==r||t[7]!==a||t[8]!==i?(o=(0,Q.jsx)(`input`,{type:i,"data-slot":`input`,className:a,...r}),t[6]=r,t[7]=a,t[8]=i,t[9]=o):o=t[9],o}var en=u();function tn(e){let t=(0,en.c)(8),n,r;t[0]===e?(n=t[1],r=t[2]):({className:n,...r}=e,t[0]=e,t[1]=n,t[2]=r);let i;t[3]===n?i=t[4]:(i=Z(`flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50`,n),t[3]=n,t[4]=i);let a;return t[5]!==r||t[6]!==i?(a=(0,Q.jsx)(he,{"data-slot":`label`,className:i,...r}),t[5]=r,t[6]=i,t[7]=a):a=t[7],a}var nn=u(),rn=()=>{let e=(0,nn.c)(69),{currentUser:t,theme:n,setEditProfileOpen:r}=He(),{user:i}=We(),{mutate:a,isPending:o}=Xt(),s=n===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,[c,l]=(0,X.useState)(t.name),[u,d]=(0,X.useState)(t.bio),[f,p]=(0,X.useState)(t.avatar),m;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(m=e=>{if(e.target.files&&e.target.files[0]){let t=new FileReader;t.onload=e=>p(e.target?.result),t.readAsDataURL(e.target.files[0])}},e[0]=m):m=e[0];let h=m,g;e[1]===r?g=e[2]:(g=()=>r(!1),e[1]=r,e[2]=g);let _=g,v;e[3]!==f||e[4]!==u||e[5]!==c||e[6]!==_||e[7]!==a||e[8]!==i?(v=()=>{i&&a({userId:i.id,name:c,bio:u||``,avatar:f},{onSuccess:()=>{_()}})},e[3]=f,e[4]=u,e[5]=c,e[6]=_,e[7]=a,e[8]=i,e[9]=v):v=e[9];let y=v,b,S,C;e[10]===Symbol.for(`react.memo_cache_sentinel`)?(b={opacity:0},S={opacity:1},C={opacity:0},e[10]=b,e[11]=S,e[12]=C):(b=e[10],S=e[11],C=e[12]);let w,T,E;e[13]===Symbol.for(`react.memo_cache_sentinel`)?(w={y:50,opacity:0},T={y:0,opacity:1},E={y:50,opacity:0},e[13]=w,e[14]=T,e[15]=E):(w=e[13],T=e[14],E=e[15]);let D=`w-full max-w-md rounded-xl overflow-hidden shadow-2xl ${s} ${n===`dark`?`text-white`:`text-black`}`,O=`p-4 border-b font-bold flex justify-between items-center ${n===`dark`?`border-zinc-800`:`border-zinc-200`}`,k;e[16]===Symbol.for(`react.memo_cache_sentinel`)?(k=(0,Q.jsx)(`span`,{children:`Edit Profile`}),e[16]=k):k=e[16];let A;e[17]===Symbol.for(`react.memo_cache_sentinel`)?(A=(0,Q.jsx)(ee,{className:`h-5 w-5`}),e[17]=A):A=e[17];let j;e[18]===_?j=e[19]:(j=(0,Q.jsx)(Xe,{variant:`ghost`,size:`icon`,onClick:_,children:A}),e[18]=_,e[19]=j);let M;e[20]!==O||e[21]!==j?(M=(0,Q.jsxs)(`div`,{className:O,children:[k,j]}),e[20]=O,e[21]=j,e[22]=M):M=e[22];let N=`flex items-center gap-4 p-4 rounded-lg ${n===`dark`?`bg-white/5`:`bg-black/5`}`,P;e[23]===f?P=e[24]:(P=(0,Q.jsx)(Ke,{src:f}),e[23]=f,e[24]=P);let F;e[25]===t.username?.[0]?F=e[26]:(F=t.username?.[0]?.toUpperCase()||`?`,e[25]=t.username?.[0],e[26]=F);let I;e[27]===F?I=e[28]:(I=(0,Q.jsx)(qe,{children:F}),e[27]=F,e[28]=I);let L;e[29]!==P||e[30]!==I?(L=(0,Q.jsxs)(Ge,{className:`w-16 h-16`,children:[P,I]}),e[29]=P,e[30]=I,e[31]=L):L=e[31];let te;e[32]===t.username?te=e[33]:(te=(0,Q.jsx)(`div`,{className:`font-semibold text-lg`,children:t.username}),e[32]=t.username,e[33]=te);let R;e[34]===Symbol.for(`react.memo_cache_sentinel`)?(R=(0,Q.jsxs)(`label`,{className:`text-[#006a4e] text-sm font-bold cursor-pointer hover:underline`,children:[`Change profile photo`,(0,Q.jsx)(`input`,{type:`file`,className:`hidden`,accept:`image/*`,onChange:h})]}),e[34]=R):R=e[34];let z;e[35]===te?z=e[36]:(z=(0,Q.jsxs)(`div`,{children:[te,R]}),e[35]=te,e[36]=z);let B;e[37]!==N||e[38]!==L||e[39]!==z?(B=(0,Q.jsxs)(`div`,{className:N,children:[L,z]}),e[37]=N,e[38]=L,e[39]=z,e[40]=B):B=e[40];let V;e[41]===Symbol.for(`react.memo_cache_sentinel`)?(V=(0,Q.jsx)(tn,{children:`Name`}),e[41]=V):V=e[41];let H;e[42]===Symbol.for(`react.memo_cache_sentinel`)?(H=e=>l(e.target.value),e[42]=H):H=e[42];let U;e[43]===c?U=e[44]:(U=(0,Q.jsxs)(`div`,{className:`space-y-2`,children:[V,(0,Q.jsx)($t,{type:`text`,value:c,onChange:H,className:`bg-transparent`})]}),e[43]=c,e[44]=U);let W;e[45]===Symbol.for(`react.memo_cache_sentinel`)?(W=(0,Q.jsx)(tn,{children:`Bio`}),e[45]=W):W=e[45];let G;e[46]===Symbol.for(`react.memo_cache_sentinel`)?(G=e=>d(e.target.value),e[46]=G):G=e[46];let K;e[47]===u?K=e[48]:(K=(0,Q.jsxs)(`div`,{className:`space-y-2`,children:[W,(0,Q.jsx)(Wt,{value:u,onChange:G,className:`bg-transparent h-24 resize-none`})]}),e[47]=u,e[48]=K);let q;e[49]===o?q=e[50]:(q=o?(0,Q.jsx)(ae,{className:`mr-2 h-4 w-4 animate-spin`}):`Save`,e[49]=o,e[50]=q);let J;e[51]!==y||e[52]!==o||e[53]!==q?(J=(0,Q.jsx)(Xe,{onClick:y,disabled:o,className:`w-full bg-[#006a4e] hover:bg-[#00523c] text-white font-bold`,children:q}),e[51]=y,e[52]=o,e[53]=q,e[54]=J):J=e[54];let ne;e[55]!==U||e[56]!==K||e[57]!==J?(ne=(0,Q.jsxs)(`div`,{className:`space-y-4`,children:[U,K,J]}),e[55]=U,e[56]=K,e[57]=J,e[58]=ne):ne=e[58];let Y;e[59]!==B||e[60]!==ne?(Y=(0,Q.jsxs)(`div`,{className:`p-6 flex flex-col gap-4`,children:[B,ne]}),e[59]=B,e[60]=ne,e[61]=Y):Y=e[61];let re;e[62]!==M||e[63]!==Y||e[64]!==D?(re=(0,Q.jsxs)(x.div,{initial:w,animate:T,exit:E,className:D,onClick:an,children:[M,Y]}),e[62]=M,e[63]=Y,e[64]=D,e[65]=re):re=e[65];let ie;return e[66]!==_||e[67]!==re?(ie=(0,Q.jsx)(x.div,{initial:b,animate:S,exit:C,className:`fixed inset-0 z-[100] bg-black/60 flex items-center justify-center p-4`,onClick:_,children:re}),e[66]=_,e[67]=re,e[68]=ie):ie=e[68],ie};function an(e){return e.stopPropagation()}var on=u(),sn=e=>{let t=(0,on.c)(3),{className:n}=e,r=`inline-block ml-1 ${n}`,i;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(i=(0,Q.jsxs)(`g`,{transform:`translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)`,children:[(0,Q.jsx)(`path`,{d:`M 30.091 10.131 L 30.091 10.131 c 5.28 -13.046 23.695 -13.207 29.202 -0.255 l 0 0 l 0 0 c 12.959 -5.491 26.093 7.416 20.829 20.469 l 0 0 l 0 0 c 13.046 5.28 13.207 23.695 0.255 29.202 l 0 0 l 0 0 c 5.491 12.959 -7.416 26.093 -20.469 20.829 l 0 0 l 0 0 c -5.28 13.046 -23.695 13.207 -29.202 0.255 l 0 0 l 0 0 C 17.748 86.122 4.613 73.215 9.878 60.162 l 0 0 l 0 0 C -3.169 54.881 -3.33 36.467 9.623 30.96 l 0 0 l 0 0 C 4.131 18.001 17.038 4.866 30.091 10.131 L 30.091 10.131 z`,fill:`#0096F1`}),(0,Q.jsx)(`polygon`,{points:`39.66,63.79 23.36,47.76 28.97,42.05 39.3,52.21 59.6,29.58 65.56,34.93`,fill:`#FFFFFF`})]}),t[0]=i):i=t[0];let a;return t[1]===r?a=t[2]:(a=(0,Q.jsx)(`svg`,{width:`16`,height:`16`,viewBox:`0 0 256 256`,xmlns:`http://www.w3.org/2000/svg`,className:r,children:i}),t[1]=r,t[2]=a),a},cn=u(),ln=e(Oe(),1),un=e(Ce(),1);ke(),ln.default.extend(un.default),ln.default.locale(`en`);var dn=()=>{let e=(0,cn.c)(108),{viewingStory:t,setViewingStory:n,showToast:r}=He(),{user:i}=We(),a=te(),{data:o}=Rt(i?.id),s;e[0]===o?s=e[1]:(s=o===void 0?[]:o,e[0]=o,e[1]=s);let c=s,l;e[2]===t?l=e[3]:(l=e=>e.id===t,e[2]=t,e[3]=l);let u=c.findIndex(l),[d,f]=(0,X.useState)(-1),[p,m]=(0,X.useState)(0);u!==-1&&d===-1&&f(u);let h;e[4]!==d||e[5]!==n||e[6]!==c.length?(h=()=>{d<c.length-1?(f(fn),m(0)):n(null)},e[4]=d,e[5]=n,e[6]=c.length,e[7]=h):h=e[7];let g=h,_;e[8]===d?_=e[9]:(_=()=>{d>0&&(f(pn),m(0))},e[8]=d,e[9]=_);let v=_,y,b;if(e[10]!==d||e[11]!==g||e[12]!==t?(y=()=>{if(t===null||d===-1)return;let e=setInterval(()=>{m(e=>e>=100?(g(),0):e+1)},50);return()=>clearInterval(e)},b=[d,t,g],e[10]=d,e[11]=g,e[12]=t,e[13]=y,e[14]=b):(y=e[13],b=e[14]),(0,X.useEffect)(y,b),t===null||d===-1||c.length===0)return null;let S=c[d];if(!S)return null;let C;e[15]===n?C=e[16]:(C=()=>n(null),e[15]=n,e[16]=C);let T=C,E,D,O;e[17]===Symbol.for(`react.memo_cache_sentinel`)?(D={opacity:0,scale:.9},O={opacity:1,scale:1},E={opacity:0,scale:.9},e[17]=E,e[18]=D,e[19]=O):(E=e[17],D=e[18],O=e[19]);let k;e[20]===Symbol.for(`react.memo_cache_sentinel`)?(k=(0,Q.jsx)(ee,{size:32}),e[20]=k):k=e[20];let j;e[21]===T?j=e[22]:(j=(0,Q.jsx)(Xe,{variant:`ghost`,size:`icon`,className:`absolute top-4 right-4 z-50 text-white hover:bg-white/10 hover:text-white`,onClick:T,children:k}),e[21]=T,e[22]=j);let M;if(e[23]!==d||e[24]!==p||e[25]!==c){let t;e[27]!==d||e[28]!==p?(t=(e,t)=>(0,Q.jsx)(`div`,{className:`h-1 bg-white/30 flex-1 rounded-full overflow-hidden`,children:(0,Q.jsx)(x.div,{className:`h-full bg-white origin-left`,initial:{scaleX:0},animate:{scaleX:t<d?1:t===d?p/100:0},transition:{type:`tween`,ease:`linear`}})},t),e[27]=d,e[28]=p,e[29]=t):t=e[29],M=c.map(t),e[23]=d,e[24]=p,e[25]=c,e[26]=M}else M=e[26];let N;e[30]===M?N=e[31]:(N=(0,Q.jsx)(`div`,{className:`absolute top-4 left-0 right-0 flex gap-1 px-2 z-20`,children:M}),e[30]=M,e[31]=N);let P;e[32]!==S.username||e[33]!==a||e[34]!==n?(P=e=>{e.stopPropagation(),n(null),a(`/profile/${S.username}`)},e[32]=S.username,e[33]=a,e[34]=n,e[35]=P):P=e[35];let F=S.userAvatar||S.img,I;e[36]===F?I=e[37]:(I=(0,Q.jsx)(Ke,{src:F}),e[36]=F,e[37]=I);let L;e[38]===S.username?.[0]?L=e[39]:(L=S.username?.[0]?.toUpperCase()||`?`,e[38]=S.username?.[0],e[39]=L);let R;e[40]===L?R=e[41]:(R=(0,Q.jsx)(qe,{children:L}),e[40]=L,e[41]=R);let z;e[42]!==P||e[43]!==I||e[44]!==R?(z=(0,Q.jsxs)(Ge,{className:`w-8 h-8 border border-white cursor-pointer`,onClick:P,children:[I,R]}),e[42]=P,e[43]=I,e[44]=R,e[45]=z):z=e[45];let B;e[46]!==S.username||e[47]!==a||e[48]!==n?(B=e=>{e.stopPropagation(),n(null),a(`/profile/${S.username}`)},e[46]=S.username,e[47]=a,e[48]=n,e[49]=B):B=e[49];let V;e[50]!==S.username||e[51]!==B?(V=(0,Q.jsx)(`span`,{className:`font-semibold text-sm cursor-pointer hover:underline`,onClick:B,children:S.username}),e[50]=S.username,e[51]=B,e[52]=V):V=e[52];let H;e[53]===S.isVerified?H=e[54]:(H=S.isVerified&&(0,Q.jsx)(sn,{}),e[53]=S.isVerified,e[54]=H);let U;e[55]!==V||e[56]!==H?(U=(0,Q.jsxs)(`div`,{className:`flex items-center`,children:[V,H]}),e[55]=V,e[56]=H,e[57]=U):U=e[57];let W;e[58]===S.createdAt?W=e[59]:(W=S.createdAt?(0,ln.default)(S.createdAt).fromNow(!0):``,e[58]=S.createdAt,e[59]=W);let G;e[60]===W?G=e[61]:(G=(0,Q.jsx)(`span`,{className:`text-white/70 text-xs`,children:W}),e[60]=W,e[61]=G);let K;e[62]!==z||e[63]!==U||e[64]!==G?(K=(0,Q.jsxs)(`div`,{className:`absolute top-8 left-4 flex items-center gap-3 z-20 text-white`,children:[z,U,G]}),e[62]=z,e[63]=U,e[64]=G,e[65]=K):K=e[65];let q,J,ne;e[66]===Symbol.for(`react.memo_cache_sentinel`)?(q={opacity:0,x:20},J={opacity:1,x:0},ne={opacity:0,x:-20},e[66]=q,e[67]=J,e[68]=ne):(q=e[66],J=e[67],ne=e[68]);let Y;e[69]===S.img?Y=e[70]:(Y=(0,Q.jsx)(`img`,{src:S.img,className:`w-full h-full object-contain`,alt:`story`,loading:`lazy`}),e[69]=S.img,e[70]=Y);let re;e[71]!==S.id||e[72]!==Y?(re=(0,Q.jsx)(w,{mode:`wait`,children:(0,Q.jsx)(x.div,{initial:q,animate:J,exit:ne,className:`w-full h-full`,children:Y},S.id)}),e[71]=S.id,e[72]=Y,e[73]=re):re=e[73];let ie;e[74]===v?ie=e[75]:(ie=(0,Q.jsx)(`div`,{className:`absolute inset-y-0 left-0 w-1/3 z-10`,onClick:v}),e[74]=v,e[75]=ie);let ae;e[76]===g?ae=e[77]:(ae=(0,Q.jsx)(`div`,{className:`absolute inset-y-0 right-0 w-1/3 z-10`,onClick:g}),e[76]=g,e[77]=ae);let se;e[78]!==re||e[79]!==ie||e[80]!==ae?(se=(0,Q.jsxs)(`div`,{className:`flex-1 relative flex items-center justify-center bg-gray-900`,children:[re,ie,ae]}),e[78]=re,e[79]=ie,e[80]=ae,e[81]=se):se=e[81];let ce=`Reply to ${S.username}...`,ue;e[82]===ce?ue=e[83]:(ue=(0,Q.jsx)(`div`,{className:`flex-1 relative`,children:(0,Q.jsx)($t,{type:`text`,placeholder:ce,className:`w-full bg-transparent border-white/50 rounded-full py-6 px-4 text-white text-sm placeholder:text-white/70 focus-visible:ring-0 focus-visible:border-white`})}),e[82]=ce,e[83]=ue);let de;e[84]===r?de=e[85]:(de=(0,Q.jsx)(oe,{size:28,className:`text-white cursor-pointer hover:scale-110 transition-transform`,onClick:()=>r(`Liked story`)}),e[84]=r,e[85]=de);let fe;e[86]===Symbol.for(`react.memo_cache_sentinel`)?(fe=(0,Q.jsx)(le,{size:28,className:`text-white cursor-pointer hover:scale-110 transition-transform`}),e[86]=fe):fe=e[86];let pe;e[87]!==ue||e[88]!==de?(pe=(0,Q.jsxs)(`div`,{className:`absolute bottom-0 w-full p-4 flex items-center gap-4 z-20 bg-gradient-to-t from-black/50 to-transparent`,children:[ue,de,fe]}),e[87]=ue,e[88]=de,e[89]=pe):pe=e[89];let me;e[90]!==N||e[91]!==K||e[92]!==se||e[93]!==pe?(me=(0,Q.jsxs)(`div`,{className:`relative w-full md:w-[400px] h-full md:h-[90vh] bg-black md:rounded-lg overflow-hidden flex flex-col`,children:[N,K,se,pe]}),e[90]=N,e[91]=K,e[92]=se,e[93]=pe,e[94]=me):me=e[94];let he=d===0,ge;e[95]===Symbol.for(`react.memo_cache_sentinel`)?(ge=(0,Q.jsx)(A,{size:48}),e[95]=ge):ge=e[95];let ve;e[96]!==v||e[97]!==he?(ve=(0,Q.jsx)(`button`,{className:`hidden md:block absolute left-4 text-white/50 hover:text-white`,onClick:v,disabled:he,children:ge}),e[96]=v,e[97]=he,e[98]=ve):ve=e[98];let ye=d===c.length-1,be;e[99]===Symbol.for(`react.memo_cache_sentinel`)?(be=(0,Q.jsx)(_e,{size:48}),e[99]=be):be=e[99];let xe;e[100]!==g||e[101]!==ye?(xe=(0,Q.jsx)(`button`,{className:`hidden md:block absolute right-4 text-white/50 hover:text-white`,onClick:g,disabled:ye,children:be}),e[100]=g,e[101]=ye,e[102]=xe):xe=e[102];let Se;return e[103]!==j||e[104]!==me||e[105]!==ve||e[106]!==xe?(Se=(0,Q.jsxs)(x.div,{initial:D,animate:O,exit:E,className:`fixed inset-0 z-[200] bg-black flex items-center justify-center`,children:[j,me,ve,xe]}),e[103]=j,e[104]=me,e[105]=ve,e[106]=xe,e[107]=Se):Se=e[107],Se};function fn(e){return e+1}function pn(e){return e-1}var mn=u();const hn=()=>{let e=(0,mn.c)(2),t=P(),n;return e[0]===t?n=e[1]:(n={mutationFn:gn,onMutate:async e=>{let{targetId:n,type:r,hasLiked:i}=e,a=r===`post`?pt:Dt;await t.cancelQueries({queryKey:a});let o=t.getQueryData(a);return t.setQueryData(a,e=>{if(!e)return e;if(r===`post`&&typeof e==`object`&&e&&`pages`in e){let t=e;return{...t,pages:t.pages.map(e=>e.map(e=>{if(e.id===n){let t=Number(e.likes);return{...e,hasLiked:!i,likes:i?Math.max(0,t-1):t+1}}return e}))}}return r===`reel`&&Array.isArray(e)?e.map(e=>{if(e.id===n){let t=Number(e.likes);return{...e,hasLiked:!i,likes:i?Math.max(0,t-1):t+1}}return e}):e}),{previousData:o,queryKey:a}},onError:(e,n,r)=>{r?.previousData&&t.setQueryData(r.queryKey,r.previousData),console.error(e)},onSettled:(e,n,r)=>{let{type:i}=r,a=i===`post`?pt:Dt;t.invalidateQueries({queryKey:a})}},e[0]=t,e[1]=n),xe(n)};async function gn(e){let{targetId:t,type:n,userId:r,hasLiked:i}=e,a=n===`post`?{user_id:r,post_id:t}:{user_id:r,reel_id:t};if(i){let{error:e}=await $.from(`likes`).delete().match(a);if(e)throw e}else{let{error:e}=await $.from(`likes`).insert(a);if(e)throw e}}var _n=u(),vn=e(Oe(),1);const yn=()=>{let e=(0,_n.c)(11),t=P(),{profile:n}=We(),r;e[0]!==n?.avatar_url||e[1]!==n?.username||e[2]!==t?(r=async e=>{let{targetId:r,type:i,text:a,userId:o,audioBlob:s,parentId:c}=e,l=[`comments`,i,r],u=i===`post`?pt:Dt;await t.cancelQueries({queryKey:l}),await t.cancelQueries({queryKey:u});let d=t.getQueryData(l),f=t.getQueryData(u),p={id:`temp-${(0,vn.default)().valueOf()}`,created_at:(0,vn.default)().toISOString(),text:a,user_id:o,post_id:i===`post`?r:void 0,reel_id:i===`reel`?r:void 0,audioUrl:s?URL.createObjectURL(s):void 0,parent_id:c,likes_count:0,hasLiked:!1,user:{username:n?.username||`You`,avatar_url:n?.avatar_url||``,isVerified:!1}};return t.setQueryData(l,e=>[p,...e===void 0?[]:e]),t.setQueryData(u,e=>{if(!e)return e;if(i===`post`&&e.pages){let t=e;return{...t,pages:t.pages.map(e=>e.map(e=>e.id===r?{...e,comments:Number(e.comments)+1}:e))}}return i===`reel`&&Array.isArray(e)?e.map(e=>e.id===r?{...e,comments:Number(e.comments)+1}:e):e}),{previousComments:d,previousFeed:f,commentsKey:l,feedKey:u}},e[0]=n?.avatar_url,e[1]=n?.username,e[2]=t,e[3]=r):r=e[3];let i,a;e[4]===t?(i=e[5],a=e[6]):(i=(e,n,r)=>{let i=r;i?.previousComments&&t.setQueryData(i.commentsKey,i.previousComments),i?.previousFeed&&t.setQueryData(i.feedKey,i.previousFeed)},a=(e,n)=>{let r=n.type===`post`?pt:Dt;t.invalidateQueries({queryKey:r}),t.invalidateQueries({queryKey:[`comments`,n.type,n.targetId]})},e[4]=t,e[5]=i,e[6]=a);let o;return e[7]!==r||e[8]!==i||e[9]!==a?(o={mutationFn:bn,onMutate:r,onError:i,onSuccess:a},e[7]=r,e[8]=i,e[9]=a,e[10]=o):o=e[10],xe(o)};async function bn(e){let{targetId:t,type:n,text:r,userId:i,audioBlob:a,parentId:o}=e,s=null;if(a){let e=`${i}/${Date.now()}.webm`,{error:t}=await $.storage.from(`audio-messages`).upload(e,a);if(t)throw t;let{data:n}=$.storage.from(`audio-messages`).getPublicUrl(e);s=n.publicUrl}let{data:c,error:l}=await $.from(`comments`).insert({user_id:i,post_id:n===`post`?t:null,reel_id:n===`reel`?t:null,text:r,audio_url:s,parent_id:o}).select(`
          *,
          user:profiles(username, avatar_url, is_verified)
        `).single();if(l)throw l;let u=c;return{id:u.id,created_at:u.created_at,text:u.text,user_id:u.user_id,post_id:u.post_id,reel_id:u.reel_id,parent_id:u.parent_id,likes_count:0,hasLiked:!1,audioUrl:u.audio_url,user:{username:u.user?.username,avatar_url:u.user?.avatar_url,isVerified:u.user?.is_verified}}}var xn=u();const Sn=()=>{let e=(0,xn.c)(2),t=P(),n;return e[0]===t?n=e[1]:(n={mutationFn:Cn,onSuccess:()=>{t.invalidateQueries({queryKey:pt}),t.invalidateQueries({queryKey:[`savedPosts`]})}},e[0]=t,e[1]=n),xe(n)};async function Cn(e){let{postId:t,userId:n,hasSaved:r}=e;if(r){let{error:e}=await $.from(`saves`).delete().match({user_id:n,post_id:t});if(e)throw e}else{let{error:e}=await $.from(`saves`).insert({user_id:n,post_id:t});if(e)throw e}}var wn=u();function Tn(e){let t=(0,wn.c)(12),n,r,i,a;t[0]===e?(n=t[1],r=t[2],i=t[3],a=t[4]):({className:n,orientation:i,decorative:a,...r}=e,t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a);let o=i===void 0?`horizontal`:i,s=a===void 0?!0:a,c;t[5]===n?c=t[6]:(c=Z(`bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px`,n),t[5]=n,t[6]=c);let l;return t[7]!==s||t[8]!==o||t[9]!==r||t[10]!==c?(l=(0,Q.jsx)(ge,{"data-slot":`separator`,decorative:s,orientation:o,className:c,...r}),t[7]=s,t[8]=o,t[9]=r,t[10]=c,t[11]=l):l=t[11],l}var En=u();function Dn(e){let t=(0,En.c)(14),n,r,i;t[0]===e?(n=t[1],r=t[2],i=t[3]):({className:r,children:n,...i}=e,t[0]=e,t[1]=n,t[2]=r,t[3]=i);let a;t[4]===r?a=t[5]:(a=Z(`relative`,r),t[4]=r,t[5]=a);let o;t[6]===n?o=t[7]:(o=(0,Q.jsx)(H,{"data-slot":`scroll-area-viewport`,className:`focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1`,children:n}),t[6]=n,t[7]=o);let s,c;t[8]===Symbol.for(`react.memo_cache_sentinel`)?(s=(0,Q.jsx)(On,{}),c=(0,Q.jsx)(K,{}),t[8]=s,t[9]=c):(s=t[8],c=t[9]);let l;return t[10]!==i||t[11]!==a||t[12]!==o?(l=(0,Q.jsxs)(B,{"data-slot":`scroll-area`,className:a,...i,children:[o,s,c]}),t[10]=i,t[11]=a,t[12]=o,t[13]=l):l=t[13],l}function On(e){let t=(0,En.c)(13),n,r,i;t[0]===e?(n=t[1],r=t[2],i=t[3]):({className:n,orientation:i,...r}=e,t[0]=e,t[1]=n,t[2]=r,t[3]=i);let a=i===void 0?`vertical`:i,o=a===`vertical`&&`h-full w-2.5 border-l border-l-transparent`,s=a===`horizontal`&&`h-2.5 flex-col border-t border-t-transparent`,c;t[4]!==n||t[5]!==o||t[6]!==s?(c=Z(`flex touch-none p-px transition-colors select-none`,o,s,n),t[4]=n,t[5]=o,t[6]=s,t[7]=c):c=t[7];let l;t[8]===Symbol.for(`react.memo_cache_sentinel`)?(l=(0,Q.jsx)(ve,{"data-slot":`scroll-area-thumb`,className:`bg-border relative flex-1 rounded-full`}),t[8]=l):l=t[8];let u;return t[9]!==a||t[10]!==r||t[11]!==c?(u=(0,Q.jsx)(me,{"data-slot":`scroll-area-scrollbar`,orientation:a,className:c,...r,children:l}),t[9]=a,t[10]=r,t[11]=c,t[12]=u):u=t[12],u}var kn=u(),An=e=>{let t=(0,kn.c)(27),{onRecordingComplete:n,onCancel:r}=e,[i,a]=(0,X.useState)(!1),[o,s]=(0,X.useState)(0),[c,l]=(0,X.useState)(null),[u,d]=(0,X.useState)(!1),[f,p]=(0,X.useState)(0),m=(0,X.useRef)(null),h;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(h=[],t[0]=h):h=t[0];let g=(0,X.useRef)(h),_=(0,X.useRef)(null),v=(0,X.useRef)(null),y;t[1]===Symbol.for(`react.memo_cache_sentinel`)?(y=()=>{_.current&&clearInterval(_.current),m.current&&m.current.stream.getTracks().forEach(jn)},t[1]=y):y=t[1];let b=y,ee;t[2]===r?ee=t[3]:(ee=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);m.current=t,g.current=[],t.ondataavailable=e=>{e.data.size>0&&g.current.push(e.data)},t.onstop=()=>{l(new Blob(g.current,{type:`audio/webm`})),b()},t.start(),a(!0),_.current=setInterval(()=>{s(Mn)},1e3)}catch(e){let t=e;console.error(`Error accessing microphone:`,t),r()}},t[2]=r,t[3]=ee);let S=ee,C,w;t[4]===S?(C=t[5],w=t[6]):(C=()=>{let e=setTimeout(()=>{S()},0);return()=>{clearTimeout(e),b()}},w=[S,b],t[4]=S,t[5]=C,t[6]=w),(0,X.useEffect)(C,w);let T;t[7]===i?T=t[8]:(T=()=>{m.current&&i&&(m.current.stop(),a(!1))},t[7]=i,t[8]=T);let E=T,D=Nn,O;t[9]!==c||t[10]!==u?(O=()=>{if(c){if(!v.current){let e=URL.createObjectURL(c);v.current=new Audio(e),v.current.onended=()=>d(!1),v.current.ontimeupdate=()=>{p(v.current?.currentTime||0)}}u?v.current.pause():v.current.play(),d(!u)}},t[9]=c,t[10]=u,t[11]=O):O=t[11];let k=O,A;t[12]!==c||t[13]!==n?(A=()=>{c&&n(c)},t[12]=c,t[13]=n,t[14]=A):A=t[14];let j=A,M,P,F;t[15]===Symbol.for(`react.memo_cache_sentinel`)?(F={opacity:0,y:10},M={opacity:1,y:0},P={opacity:0,y:10},t[15]=M,t[16]=P,t[17]=F):(M=t[15],P=t[16],F=t[17]);let I;return t[18]!==c||t[19]!==k||t[20]!==j||t[21]!==u||t[22]!==r||t[23]!==f||t[24]!==o||t[25]!==E?(I=(0,Q.jsx)(x.div,{initial:F,animate:M,exit:P,className:`flex items-center gap-2 w-full bg-zinc-100 dark:bg-zinc-800 p-2 rounded-full`,children:c?(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(Xe,{size:`icon`,variant:`ghost`,className:`h-8 w-8 text-zinc-500 hover:text-red-500`,onClick:r,children:(0,Q.jsx)(be,{size:18})}),(0,Q.jsxs)(`div`,{className:`flex-1 flex items-center gap-2`,children:[(0,Q.jsx)(Xe,{size:`icon`,variant:`ghost`,className:`h-8 w-8`,onClick:k,children:u?(0,Q.jsx)(z,{size:18}):(0,Q.jsx)(L,{size:18})}),(0,Q.jsx)(`div`,{className:`h-1 flex-1 bg-zinc-300 dark:bg-zinc-700 rounded-full overflow-hidden`,children:(0,Q.jsx)(`div`,{className:`h-full bg-blue-500 transition-all duration-100`,style:{width:`${f/o*100}%`}})}),(0,Q.jsx)(`span`,{className:`text-xs font-mono text-zinc-500 w-10`,children:D(o)})]}),(0,Q.jsx)(Xe,{size:`icon`,className:`h-8 w-8 bg-blue-500 hover:bg-blue-600 rounded-full`,onClick:j,children:(0,Q.jsx)(le,{size:16,className:`text-white`})})]}):(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsxs)(`div`,{className:`flex-1 flex items-center gap-2 px-3`,children:[(0,Q.jsx)(`div`,{className:`w-2 h-2 rounded-full bg-red-500 animate-pulse`}),(0,Q.jsx)(`span`,{className:`text-sm font-mono text-red-500`,children:D(o)}),(0,Q.jsx)(`span`,{className:`text-xs text-zinc-500`,children:`Recording...`})]}),(0,Q.jsx)(Xe,{size:`icon`,variant:`ghost`,className:`h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20`,onClick:E,children:(0,Q.jsx)(N,{size:16,fill:`currentColor`})})]})}),t[18]=c,t[19]=k,t[20]=j,t[21]=u,t[22]=r,t[23]=f,t[24]=o,t[25]=E,t[26]=I):I=t[26],I};function jn(e){return e.stop()}function Mn(e){return e+1}function Nn(e){return`${Math.floor(e/60)}:${(e%60).toString().padStart(2,`0`)}`}var Pn=u();const Fn=(e,t)=>{let n=(0,Pn.c)(12),{user:r}=We(),i=r?.id,a;n[0]!==i||n[1]!==e||n[2]!==t?(a=[`comments`,t,e,i],n[0]=i,n[1]=e,n[2]=t,n[3]=a):a=n[3];let s;n[4]!==e||n[5]!==t||n[6]!==r?(s=async()=>{let n=t===`post`?`post_id`:`reel_id`,{data:i,error:a}=await $.from(`comments`).select(`
          *,
          profiles:user_id (
            username,
            avatar_url,
            is_verified
          )
        `).eq(n,e).order(`created_at`,{ascending:!1});if(a)throw a;if(!i)return[];let o=i,s=new Set;if(r){let e=o.map(In);if(e.length>0){let{data:t}=await $.from(`comment_likes`).select(`comment_id`).eq(`user_id`,r.id).in(`comment_id`,e);t&&t.forEach(e=>s.add(e.comment_id))}}return o.map(e=>{let t=e.audio_url||void 0;return t&&t.includes(`/storage/v1/object/audio-messages/`)&&!t.includes(`/storage/v1/object/public/`)&&(t=t.replace(`/storage/v1/object/audio-messages/`,`/storage/v1/object/public/audio-messages/`)),{id:e.id,created_at:e.created_at,text:e.text,user_id:e.user_id,post_id:e.post_id||void 0,reel_id:e.reel_id||void 0,audioUrl:t,parent_id:e.parent_id,likes_count:e.likes_count||0,hasLiked:s.has(e.id),user:{username:e.profiles?.username||`Guest`,avatar_url:e.profiles?.avatar_url||`https://api.dicebear.com/9.x/avataaars/svg?seed=guest`,isVerified:e.profiles?.is_verified||!1}}})},n[4]=e,n[5]=t,n[6]=r,n[7]=s):s=n[7];let c=!!e,l;return n[8]!==a||n[9]!==s||n[10]!==c?(l={queryKey:a,queryFn:s,enabled:c},n[8]=a,n[9]=s,n[10]=c,n[11]=l):l=n[11],o(l)};function In(e){return e.id}var Ln=u();const Rn=()=>{let e=(0,Ln.c)(12),t=P(),{user:n}=We(),r;e[0]===n?r=e[1]:(r=async e=>{let{commentId:t,hasLiked:r}=e;if(!n)throw Error(`Not authenticated`);if(r){let{error:e}=await $.from(`comment_likes`).delete().match({user_id:n.id,comment_id:t});if(e)throw e}else{let{error:e}=await $.from(`comment_likes`).insert({user_id:n.id,comment_id:t});if(e)throw e}},e[0]=n,e[1]=r);let i,a,o;e[2]!==t||e[3]!==n?.id?(i=async e=>{let{commentId:r,hasLiked:i,targetId:a,type:o}=e;await t.cancelQueries({queryKey:[`comments`,o,a,n?.id]});let s=t.getQueryData([`comments`,o,a,n?.id]);return t.setQueryData([`comments`,o,a,n?.id],e=>e&&e.map(e=>e.id===r?{...e,hasLiked:!i,likes_count:i?e.likes_count-1:e.likes_count+1}:e)),{previousComments:s}},a=(e,r,i)=>{i?.previousComments&&t.setQueryData([`comments`,r.type,r.targetId,n?.id],i.previousComments)},o=(e,r,i)=>{t.invalidateQueries({queryKey:[`comments`,i.type,i.targetId,n?.id]})},e[2]=t,e[3]=n?.id,e[4]=i,e[5]=a,e[6]=o):(i=e[4],a=e[5],o=e[6]);let s;return e[7]!==r||e[8]!==i||e[9]!==a||e[10]!==o?(s={mutationFn:r,onMutate:i,onError:a,onSettled:o},e[7]=r,e[8]=i,e[9]=a,e[10]=o,e[11]=s):s=e[11],xe(s)};var zn=u(),Bn=e=>{let t=(0,zn.c)(14),{src:n,theme:r}=e,i=r===void 0?`dark`:r,[a,o]=(0,X.useState)(!1),s=X.useRef(null),[c,l]=(0,X.useState)(0),u;t[0]!==a||t[1]!==n?(u=()=>{s.current||(s.current=new Audio(n),s.current.onended=()=>{o(!1),l(0)},s.current.ontimeupdate=()=>{s.current&&l(s.current.currentTime/s.current.duration*100||0)}),a?s.current.pause():s.current.play(),o(!a)},t[0]=a,t[1]=n,t[2]=u):u=t[2];let d=u,f=`flex items-center gap-2 ${i===`dark`?`bg-zinc-800`:`bg-zinc-100`} rounded-full px-3 py-1 mt-1 w-fit min-w-[150px]`,p;t[3]===a?p=t[4]:(p=a?(0,Q.jsx)(z,{size:14}):(0,Q.jsx)(L,{size:14}),t[3]=a,t[4]=p);let m;t[5]!==p||t[6]!==d?(m=(0,Q.jsx)(Xe,{variant:`ghost`,size:`icon`,className:`h-6 w-6 shrink-0`,onClick:d,children:p}),t[5]=p,t[6]=d,t[7]=m):m=t[7];let h=`${c}%`,g;t[8]===h?g=t[9]:(g=(0,Q.jsx)(`div`,{className:`h-1 flex-grow bg-zinc-300 dark:bg-zinc-600 rounded-full overflow-hidden`,children:(0,Q.jsx)(`div`,{className:`h-full bg-blue-500 rounded-full transition-all duration-100`,style:{width:h}})}),t[8]=h,t[9]=g);let _;return t[10]!==f||t[11]!==m||t[12]!==g?(_=(0,Q.jsxs)(`div`,{className:f,children:[m,g]}),t[10]=f,t[11]=m,t[12]=g,t[13]=_):_=t[13],_},Vn=u(),Hn=e(Oe(),1);const Un=e=>{let t=(0,Vn.c)(77),{comment:n,replies:r,depth:i,onReply:a,targetId:o,type:s}=e,c=i===void 0?0:i,{showToast:l}=He(),{user:u}=We(),{mutate:d}=Rn(),[f,p]=(0,X.useState)(!1),m=c>0,h;t[0]!==n.hasLiked||t[1]!==n.id||t[2]!==l||t[3]!==o||t[4]!==d||t[5]!==s||t[6]!==u?(h=()=>{if(!u){l(`Log in to like comments`);return}d({commentId:n.id,hasLiked:n.hasLiked,targetId:o,type:s})},t[0]=n.hasLiked,t[1]=n.id,t[2]=l,t[3]=o,t[4]=d,t[5]=s,t[6]=u,t[7]=h):h=t[7];let g=h,_=m&&`ml-8 md:ml-12`,v;t[8]===_?v=t[9]:(v=Z(`flex gap-3 mb-4`,_),t[8]=_,t[9]=v);let y;t[10]===n.user.avatar_url?y=t[11]:(y=(0,Q.jsx)(Ke,{src:n.user.avatar_url}),t[10]=n.user.avatar_url,t[11]=y);let b;t[12]===n.user.username[0]?b=t[13]:(b=n.user.username[0]?.toUpperCase(),t[12]=n.user.username[0],t[13]=b);let ee;t[14]===b?ee=t[15]:(ee=(0,Q.jsx)(qe,{children:b}),t[14]=b,t[15]=ee);let x;t[16]!==y||t[17]!==ee?(x=(0,Q.jsxs)(Ge,{className:`w-8 h-8 shrink-0`,children:[y,ee]}),t[16]=y,t[17]=ee,t[18]=x):x=t[18];let S;t[19]===n.user.username?S=t[20]:(S=(0,Q.jsx)(`span`,{className:`font-semibold text-sm`,children:n.user.username}),t[19]=n.user.username,t[20]=S);let C;t[21]===n.user.isVerified?C=t[22]:(C=n.user.isVerified&&(0,Q.jsx)(sn,{}),t[21]=n.user.isVerified,t[22]=C);let w;t[23]===n.created_at?w=t[24]:(w=(0,Hn.default)(n.created_at).fromNow(!0),t[23]=n.created_at,t[24]=w);let T;t[25]===w?T=t[26]:(T=(0,Q.jsx)(`span`,{className:`text-xs text-muted-foreground ml-1`,children:w}),t[25]=w,t[26]=T);let E;t[27]!==C||t[28]!==T||t[29]!==S?(E=(0,Q.jsxs)(`div`,{className:`flex items-center gap-1`,children:[S,C,T]}),t[27]=C,t[28]=T,t[29]=S,t[30]=E):E=t[30];let D;t[31]!==n.audioUrl||t[32]!==n.text?(D=n.audioUrl?(0,Q.jsx)(`div`,{className:`mt-1`,children:(0,Q.jsx)(Bn,{src:n.audioUrl})}):(0,Q.jsx)(`p`,{className:`text-sm dark:text-gray-200 leading-normal whitespace-pre-wrap break-words`,children:n.text}),t[31]=n.audioUrl,t[32]=n.text,t[33]=D):D=t[33];let O;t[34]!==n||t[35]!==a?(O=(0,Q.jsx)(`button`,{onClick:()=>a(n),className:`text-xs font-semibold text-muted-foreground hover:text-foreground transition-colors`,children:`Reply`}),t[34]=n,t[35]=a,t[36]=O):O=t[36];let k;t[37]!==r.length||t[38]!==f?(k=r.length>0&&(0,Q.jsxs)(`button`,{onClick:()=>p(!f),className:`text-xs font-semibold text-muted-foreground hover:text-foreground transition-colors flex items-center gap-1`,children:[(0,Q.jsx)(`div`,{className:`w-6 h-[1px] bg-muted-foreground`}),f?`Hide replies`:`View ${r.length} replies`]}),t[37]=r.length,t[38]=f,t[39]=k):k=t[39];let A;t[40]!==O||t[41]!==k?(A=(0,Q.jsxs)(`div`,{className:`flex items-center gap-4 mt-1`,children:[O,k]}),t[40]=O,t[41]=k,t[42]=A):A=t[42];let j;t[43]!==E||t[44]!==D||t[45]!==A?(j=(0,Q.jsxs)(`div`,{className:`flex flex-col`,children:[E,D,A]}),t[43]=E,t[44]=D,t[45]=A,t[46]=j):j=t[46];let M;t[47]!==c||t[48]!==a||t[49]!==r||t[50]!==f||t[51]!==o||t[52]!==s?(M=f&&r.length>0&&(0,Q.jsx)(`div`,{className:`mt-4`,children:r.map(e=>(0,Q.jsx)(Un,{comment:e,replies:e.replies||[],depth:c+1,onReply:a,targetId:o,type:s},e.id))}),t[47]=c,t[48]=a,t[49]=r,t[50]=f,t[51]=o,t[52]=s,t[53]=M):M=t[53];let N;t[54]!==j||t[55]!==M?(N=(0,Q.jsxs)(`div`,{className:`flex-1 min-w-0`,children:[j,M]}),t[54]=j,t[55]=M,t[56]=N):N=t[56];let P=n.hasLiked?`text-red-500`:`text-muted-foreground hover:text-muted-foreground/80`,F;t[57]===P?F=t[58]:(F=Z(`transition-colors`,P),t[57]=P,t[58]=F);let I=n.hasLiked&&`fill-current`,L;t[59]===I?L=t[60]:(L=Z(`w-3 h-3`,I),t[59]=I,t[60]=L);let te;t[61]===L?te=t[62]:(te=(0,Q.jsx)(oe,{className:L}),t[61]=L,t[62]=te);let R;t[63]!==g||t[64]!==F||t[65]!==te?(R=(0,Q.jsx)(`button`,{onClick:g,className:F,children:te}),t[63]=g,t[64]=F,t[65]=te,t[66]=R):R=t[66];let z;t[67]===n.likes_count?z=t[68]:(z=n.likes_count>0&&(0,Q.jsx)(`span`,{className:`text-[10px] text-muted-foreground`,children:n.likes_count}),t[67]=n.likes_count,t[68]=z);let B;t[69]!==R||t[70]!==z?(B=(0,Q.jsxs)(`div`,{className:`flex flex-col items-center gap-0.5 pt-1`,children:[R,z]}),t[69]=R,t[70]=z,t[71]=B):B=t[71];let V;return t[72]!==N||t[73]!==B||t[74]!==v||t[75]!==x?(V=(0,Q.jsxs)(`div`,{className:v,children:[x,N,B]}),t[72]=N,t[73]=B,t[74]=v,t[75]=x,t[76]=V):V=t[76],V};var Wn=u();function Gn(e){let t=(0,Wn.c)(8),n,r;t[0]===e?(n=t[1],r=t[2]):({className:n,...r}=e,t[0]=e,t[1]=n,t[2]=r);let i;t[3]===n?i=t[4]:(i=Z(`bg-accent animate-pulse rounded-md`,n),t[3]=n,t[4]=i);let a;return t[5]!==r||t[6]!==i?(a=(0,Q.jsx)(`div`,{"data-slot":`skeleton`,className:i,...r}),t[5]=r,t[6]=i,t[7]=a):a=t[7],a}var Kn=u();const qn=e=>{let t=(0,Kn.c)(12),{targetId:n,type:r,onReply:i}=e,{data:a,isLoading:o}=Fn(n,r),s;t[0]===a?s=t[1]:(s=a===void 0?[]:a,t[0]=a,t[1]=s);let c=s,l;bb0:{if(!c){let e;t[2]===Symbol.for(`react.memo_cache_sentinel`)?(e=[],t[2]=e):e=t[2],l=e;break bb0}let e;if(t[3]!==c){let n=new Map;e=[],c.forEach(e=>{n.set(e.id,{...e,replies:[]})}),c.forEach(t=>{let r=n.get(t.id);t.parent_id&&n.has(t.parent_id)?n.get(t.parent_id).replies.push(r):e.push(r)}),t[3]=c,t[4]=e}else e=t[4];l=e}let u=l;if(o){let e;return t[5]===Symbol.for(`react.memo_cache_sentinel`)?(e=(0,Q.jsx)(`div`,{className:`p-4 space-y-4`,children:[1,2,3].map(Jn)}),t[5]=e):e=t[5],e}if(c.length===0){let e;return t[6]===Symbol.for(`react.memo_cache_sentinel`)?(e=(0,Q.jsxs)(`div`,{className:`flex flex-col items-center justify-center py-12 text-center`,children:[(0,Q.jsx)(`div`,{className:`text-2xl mb-2`,children:``}),(0,Q.jsx)(`h3`,{className:`font-semibold text-lg`,children:`No comments yet.`}),(0,Q.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Start the conversation.`})]}),t[6]=e):e=t[6],e}let d;return t[7]!==i||t[8]!==u||t[9]!==n||t[10]!==r?(d=(0,Q.jsx)(`div`,{className:`p-4 pb-20 md:pb-4`,children:u.map(e=>(0,Q.jsx)(Un,{comment:e,replies:e.replies||[],onReply:i,targetId:n,type:r},e.id))}),t[7]=i,t[8]=u,t[9]=n,t[10]=r,t[11]=d):d=t[11],d};function Jn(e){return(0,Q.jsxs)(`div`,{className:`flex gap-3`,children:[(0,Q.jsx)(Gn,{className:`w-8 h-8 rounded-full`}),(0,Q.jsxs)(`div`,{className:`flex-1 space-y-2`,children:[(0,Q.jsx)(Gn,{className:`h-4 w-32`}),(0,Q.jsx)(Gn,{className:`h-3 w-full`})]})]},e)}var Yn=u(),Xn=e(Oe(),1),Zn=e(Ce(),1);ke(),Xn.default.extend(Zn.default),Xn.default.locale(`en`);var Qn=()=>{let e=(0,Yn.c)(182),{viewingPost:t,viewingReel:n,theme:r,showToast:i,savedPostIds:a,setViewingPost:o,setViewingReel:c}=He(),{mutate:l}=Sn(),u=te(),{user:d}=We(),{mutate:f}=hn(),{mutate:p,isPending:m}=yn(),[h,g]=(0,X.useState)(``),[_,v]=(0,X.useState)(!1),[y,b]=(0,X.useState)(!1),[S,w]=(0,X.useState)(null),T=X.useRef(null),E=X.useRef(null),D=t||n,O,A;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(O=()=>{let e=e=>{T.current&&!T.current.contains(e.target)&&v(!1)};return document.addEventListener(`mousedown`,e),()=>document.removeEventListener(`mousedown`,e)},A=[],e[0]=O,e[1]=A):(O=e[0],A=e[1]),X.useEffect(O,A);let j;e[2]===Symbol.for(`react.memo_cache_sentinel`)?(j=e=>{g(t=>t+e.emoji)},e[2]=j):j=e[2];let M=j,N=!!n,P=N?`reel`:`post`,I=D?String(D.id):``;if(!D)return null;let L;e[3]!==D.id||e[4]!==a?(L=a.has(D.id),e[3]=D.id,e[4]=a,e[5]=L):L=e[5];let R=L,z=D.hasLiked||!1,B;e[6]!==D.id||e[7]!==z||e[8]!==i||e[9]!==f||e[10]!==P||e[11]!==d?(B=()=>{if(!d){i(`Log in to like`);return}f({targetId:String(D.id),type:P,userId:d.id,hasLiked:z})},e[6]=D.id,e[7]=z,e[8]=i,e[9]=f,e[10]=P,e[11]=d,e[12]=B):B=e[12];let H=B,U;e[13]===Symbol.for(`react.memo_cache_sentinel`)?(U=e=>{w(e),E.current?.focus()},e[13]=U):U=e[13];let W=U,G;e[14]!==D.id||e[15]!==p||e[16]!==h||e[17]!==S?.id||e[18]!==i||e[19]!==P||e[20]!==d?(G=(e,t)=>{if(e&&e.preventDefault(),!d){i(`Log in to comment`);return}!t&&!h.trim()||p({targetId:String(D.id),type:P,text:t?`Voice Message`:h,userId:d.id,audioBlob:t,parentId:S?.id},{onSuccess:()=>{i(`Comment added`),g(``),b(!1),w(null)},onError:()=>i(`Failed to add comment`)})},e[14]=D.id,e[15]=p,e[16]=h,e[17]=S?.id,e[18]=i,e[19]=P,e[20]=d,e[21]=G):G=e[21];let K=G,q;e[22]!==o||e[23]!==c||e[24]!==t||e[25]!==n?(q=()=>{t&&o(null),n&&c(null),w(null)},e[22]=o,e[23]=c,e[24]=t,e[25]=n,e[26]=q):q=e[26];let J=q,Y;e[27]!==u||e[28]!==J?(Y=e=>{J(),u(`/profile/${e.username}`)},e[27]=u,e[28]=J,e[29]=Y):Y=e[29];let re=Y,ie=r===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,se,ce,ue;e[30]===Symbol.for(`react.memo_cache_sentinel`)?(ue={opacity:0},se={opacity:1},ce={opacity:0},e[30]=se,e[31]=ce,e[32]=ue):(se=e[30],ce=e[31],ue=e[32]);let fe,pe,me,he;e[33]===Symbol.for(`react.memo_cache_sentinel`)?(fe={y:`100%`},pe={y:0},me={y:`100%`},he={type:`spring`,damping:25,stiffness:300},e[33]=fe,e[34]=pe,e[35]=me,e[36]=he):(fe=e[33],pe=e[34],me=e[35],he=e[36]);let ge=`w-full max-w-5xl h-[95vh] md:h-[650px] md:max-h-[90vh] rounded-t-[20px] md:rounded-lg overflow-hidden flex flex-col md:flex-row shadow-2xl ${ie} ${r===`dark`?`text-white`:`text-black`}`,_e;e[37]!==D||e[38]!==N?(_e=(0,Q.jsx)(`div`,{className:`hidden md:flex flex-1 bg-black items-center justify-center h-full border-r border-zinc-800 relative`,children:N?(0,Q.jsx)(`video`,{src:D.src,className:`max-h-full max-w-full`,controls:!0,autoPlay:!0,loop:!0}):(0,Q.jsx)(`img`,{src:D.content?.src||D.content?.poster||``,className:`max-h-full max-w-full object-contain`,alt:`post detail`,loading:`lazy`})}),e[37]=D,e[38]=N,e[39]=_e):_e=e[39];let ve;e[40]===Symbol.for(`react.memo_cache_sentinel`)?(ve=(0,Q.jsx)(`div`,{className:`md:hidden w-full text-center font-bold text-sm`,children:`Comments`}),e[40]=ve):ve=e[40];let ye;e[41]!==D.user||e[42]!==re?(ye=()=>re(D.user),e[41]=D.user,e[42]=re,e[43]=ye):ye=e[43];let be;e[44]===D.user.avatar?be=e[45]:(be=(0,Q.jsx)(Ke,{src:D.user.avatar}),e[44]=D.user.avatar,e[45]=be);let xe;e[46]===D.user.username[0]?xe=e[47]:(xe=D.user.username?.[0]?.toUpperCase()||`?`,e[46]=D.user.username[0],e[47]=xe);let Se;e[48]===xe?Se=e[49]:(Se=(0,Q.jsx)(qe,{children:xe}),e[48]=xe,e[49]=Se);let Ce;e[50]!==be||e[51]!==Se?(Ce=(0,Q.jsxs)(Ge,{className:`w-8 h-8 border border-zinc-700`,children:[be,Se]}),e[50]=be,e[51]=Se,e[52]=Ce):Ce=e[52];let we;e[53]===D.user.username?we=e[54]:(we=(0,Q.jsx)(`span`,{className:`font-semibold text-sm hover:opacity-70`,children:D.user.username}),e[53]=D.user.username,e[54]=we);let Te;e[55]===D.user.isVerified?Te=e[56]:(Te=D.user.isVerified&&(0,Q.jsx)(sn,{}),e[55]=D.user.isVerified,e[56]=Te);let Ee;e[57]!==we||e[58]!==Te?(Ee=(0,Q.jsxs)(`div`,{className:`flex items-center`,children:[we,Te]}),e[57]=we,e[58]=Te,e[59]=Ee):Ee=e[59];let De;e[60]!==ye||e[61]!==Ce||e[62]!==Ee?(De=(0,Q.jsxs)(`div`,{className:`hidden md:flex items-center gap-3 cursor-pointer`,onClick:ye,children:[Ce,Ee]}),e[60]=ye,e[61]=Ce,e[62]=Ee,e[63]=De):De=e[63];let Oe,ke;e[64]===Symbol.for(`react.memo_cache_sentinel`)?(Oe={scale:1.1},ke={scale:.9},e[64]=Oe,e[65]=ke):(Oe=e[64],ke=e[65]);let Ae;e[66]===Symbol.for(`react.memo_cache_sentinel`)?(Ae=(0,Q.jsx)(x.div,{whileHover:Oe,whileTap:ke,className:`hidden md:flex`,children:(0,Q.jsx)(V,{size:20,className:`cursor-pointer hover:opacity-70`})}),e[66]=Ae):Ae=e[66];let je;e[67]===Symbol.for(`react.memo_cache_sentinel`)?(je=(0,Q.jsx)(ee,{size:20}),e[67]=je):je=e[67];let Me;e[68]===J?Me=e[69]:(Me=(0,Q.jsx)(`div`,{className:`absolute right-4 top-4 md:hidden cursor-pointer`,onClick:J,children:je}),e[68]=J,e[69]=Me);let Ne;e[70]!==De||e[71]!==Me?(Ne=(0,Q.jsxs)(`div`,{className:`p-4 flex items-center justify-between shrink-0`,children:[ve,De,Ae,Me]}),e[70]=De,e[71]=Me,e[72]=Ne):Ne=e[72];let Pe;e[73]===Symbol.for(`react.memo_cache_sentinel`)?(Pe=(0,Q.jsx)(Tn,{}),e[73]=Pe):Pe=e[73];let Fe;e[74]!==D.user||e[75]!==re?(Fe=()=>re(D.user),e[74]=D.user,e[75]=re,e[76]=Fe):Fe=e[76];let Ie;e[77]===D.user.avatar?Ie=e[78]:(Ie=(0,Q.jsx)(Ke,{src:D.user.avatar}),e[77]=D.user.avatar,e[78]=Ie);let Le;e[79]===D.user.username[0]?Le=e[80]:(Le=D.user.username[0].toUpperCase(),e[79]=D.user.username[0],e[80]=Le);let Re;e[81]===Le?Re=e[82]:(Re=(0,Q.jsx)(qe,{children:Le}),e[81]=Le,e[82]=Re);let ze;e[83]!==Fe||e[84]!==Ie||e[85]!==Re?(ze=(0,Q.jsxs)(Ge,{className:`w-8 h-8 cursor-pointer flex-shrink-0`,onClick:Fe,children:[Ie,Re]}),e[83]=Fe,e[84]=Ie,e[85]=Re,e[86]=ze):ze=e[86];let Be;e[87]!==D.user||e[88]!==re?(Be=()=>re(D.user),e[87]=D.user,e[88]=re,e[89]=Be):Be=e[89];let Ve;e[90]!==D.user.username||e[91]!==Be?(Ve=(0,Q.jsx)(`span`,{className:`font-semibold mr-2 cursor-pointer`,onClick:Be,children:D.user.username}),e[90]=D.user.username,e[91]=Be,e[92]=Ve):Ve=e[92];let Ue;e[93]===D.user.isVerified?Ue=e[94]:(Ue=D.user.isVerified&&(0,Q.jsx)(sn,{}),e[93]=D.user.isVerified,e[94]=Ue);let Z;e[95]!==Ve||e[96]!==Ue?(Z=(0,Q.jsxs)(`div`,{className:`flex items-center`,children:[Ve,Ue]}),e[95]=Ve,e[96]=Ue,e[97]=Z):Z=e[97];let Je;e[98]===D.caption?Je=e[99]:(Je=(0,Q.jsx)(`span`,{className:`whitespace-pre-wrap`,children:D.caption}),e[98]=D.caption,e[99]=Je);let Ye;e[100]===D?Ye=e[101]:(Ye=`createdAt`in D&&D.createdAt?(0,Xn.default)(D.createdAt).fromNow():`time`in D?D.time:``,e[100]=D,e[101]=Ye);let Xe;e[102]===Ye?Xe=e[103]:(Xe=(0,Q.jsx)(`div`,{className:`text-xs text-zinc-500 mt-1`,children:Ye}),e[102]=Ye,e[103]=Xe);let Ze;e[104]!==Z||e[105]!==Je||e[106]!==Xe?(Ze=(0,Q.jsxs)(`div`,{className:`text-sm`,children:[Z,Je,Xe]}),e[104]=Z,e[105]=Je,e[106]=Xe,e[107]=Ze):Ze=e[107];let Qe;e[108]!==ze||e[109]!==Ze?(Qe=(0,Q.jsxs)(`div`,{className:`flex gap-3`,children:[ze,Ze]}),e[108]=ze,e[109]=Ze,e[110]=Qe):Qe=e[110];let $e;e[111]!==I||e[112]!==P?($e=(0,Q.jsx)(qn,{targetId:I,type:P,onReply:W}),e[111]=I,e[112]=P,e[113]=$e):$e=e[113];let et;e[114]!==Qe||e[115]!==$e?(et=(0,Q.jsx)(`div`,{className:`flex-1 min-h-0 overflow-hidden`,children:(0,Q.jsx)(Dn,{className:`h-full w-full`,children:(0,Q.jsxs)(`div`,{className:`p-4 space-y-4`,children:[Qe,$e]})})}),e[114]=Qe,e[115]=$e,e[116]=et):et=e[116];let tt;e[117]===Symbol.for(`react.memo_cache_sentinel`)?(tt=(0,Q.jsx)(Tn,{}),e[117]=tt):tt=e[117];let nt;e[118]!==_||e[119]!==r?(nt=_&&(0,Q.jsx)(`div`,{ref:T,className:`absolute bottom-full left-0 z-50 shadow-2xl mb-2`,children:(0,Q.jsx)(s,{theme:r===`dark`?k.DARK:k.LIGHT,onEmojiClick:M,lazyLoadEmojis:!0,skinTonesDisabled:!0,searchDisabled:!1,width:300,height:400})}),e[118]=_,e[119]=r,e[120]=nt):nt=e[120];let rt=`cursor-pointer hover:opacity-70 transition-transform active:scale-90 ${z?`fill-[#f42a41] text-[#f42a41]`:``}`,it;e[121]!==H||e[122]!==rt?(it=(0,Q.jsx)(oe,{size:24,className:rt,onClick:H}),e[121]=H,e[122]=rt,e[123]=it):it=e[123];let at;e[124]===Symbol.for(`react.memo_cache_sentinel`)?(at=(0,Q.jsx)(ne,{size:24,className:`-scale-x-100 cursor-pointer hover:opacity-70`,onClick:()=>E.current?.focus()}),e[124]=at):at=e[124];let ot;e[125]===i?ot=e[126]:(ot=(0,Q.jsx)(le,{size:24,className:`cursor-pointer hover:opacity-70`,onClick:()=>i(`Shared`)}),e[125]=i,e[126]=ot);let st;e[127]!==it||e[128]!==ot?(st=(0,Q.jsxs)(`div`,{className:`flex items-center gap-4`,children:[it,at,ot]}),e[127]=it,e[128]=ot,e[129]=st):st=e[129];let ct=`cursor-pointer hover:opacity-70 ${R?`fill-current`:``}`,$;e[130]!==D||e[131]!==R||e[132]!==l||e[133]!==d?($=()=>{d&&D&&l({postId:String(D.id),userId:d.id,hasSaved:R})},e[130]=D,e[131]=R,e[132]=l,e[133]=d,e[134]=$):$=e[134];let lt;e[135]!==ct||e[136]!==$?(lt=(0,Q.jsx)(C,{size:24,className:ct,onClick:$}),e[135]=ct,e[136]=$,e[137]=lt):lt=e[137];let ut;e[138]!==st||e[139]!==lt?(ut=(0,Q.jsxs)(`div`,{className:`flex items-center justify-between mb-2`,children:[st,lt]}),e[138]=st,e[139]=lt,e[140]=ut):ut=e[140];let dt=D.likes+` likes`,ft;e[141]===dt?ft=e[142]:(ft=(0,Q.jsx)(`span`,{className:`font-semibold text-sm`,children:dt}),e[141]=dt,e[142]=ft);let pt;e[143]===D?pt=e[144]:(pt=`createdAt`in D&&D.createdAt?(0,Xn.default)(D.createdAt).fromNow():`time`in D?D.time:``,e[143]=D,e[144]=pt);let mt;e[145]===pt?mt=e[146]:(mt=(0,Q.jsx)(`span`,{className:`text-[10px] text-zinc-500 uppercase`,children:pt}),e[145]=pt,e[146]=mt);let ht;e[147]!==ft||e[148]!==mt?(ht=(0,Q.jsxs)(`div`,{className:`flex flex-col mb-2`,children:[ft,mt]}),e[147]=ft,e[148]=mt,e[149]=ht):ht=e[149];let gt;e[150]===y?gt=e[151]:(gt=!y&&(0,Q.jsx)(`div`,{className:`flex gap-4 mt-2 mb-1 overflow-x-auto scrollbar-hide py-1`,children:[``,``,``,``,``,``,``,``].map(e=>(0,Q.jsx)(`span`,{className:`text-xl cursor-pointer hover:scale-125 transition-transform`,onClick:()=>g(t=>t+e),children:e},e))}),e[150]=y,e[151]=gt);let _t;e[152]===S?_t=e[153]:(_t=S&&(0,Q.jsxs)(`div`,{className:`flex items-center gap-2 mr-2 bg-blue-500/10 px-2 py-0.5 rounded text-xs text-blue-500 whitespace-nowrap`,children:[(0,Q.jsxs)(`span`,{children:[`@`,S.user.username]}),(0,Q.jsx)(`button`,{onClick:()=>w(null),children:(0,Q.jsx)(ee,{className:`w-3 h-3`})})]}),e[152]=S,e[153]=_t);let vt;e[154]!==K||e[155]!==m||e[156]!==h||e[157]!==S||e[158]!==_||e[159]!==y||e[160]!==r?(vt=y?(0,Q.jsx)(An,{onRecordingComplete:e=>K(void 0,e),onCancel:()=>b(!1)}):(0,Q.jsxs)(`form`,{onSubmit:e=>K(e),className:`flex items-center gap-2 w-full relative`,children:[(0,Q.jsx)(F,{size:20,className:`cursor-pointer transition-colors flex-shrink-0 ${_?`text-[#006a4e]`:`text-zinc-500 hover:text-zinc-300`}`,onClick:()=>v(!_)}),(0,Q.jsx)(`input`,{ref:E,type:`text`,placeholder:`Add a comment...`,className:`bg-transparent text-sm w-full outline-none ${r===`dark`?`text-white`:`text-black`}`,value:h,onChange:e=>g(e.target.value),onFocus:()=>v(!1),disabled:m}),!h&&(0,Q.jsx)(de,{size:20,className:`text-zinc-500 cursor-pointer hover:text-zinc-300 flex-shrink-0`,onClick:()=>b(!0)}),(0,Q.jsx)(`button`,{type:`submit`,className:`text-[#006a4e] text-sm font-semibold disabled:opacity-50 hover:text-[#004d39] flex-shrink-0`,disabled:!h||m,children:m?(0,Q.jsx)(ae,{className:`h-4 w-4 animate-spin`}):`Post`})]}),e[154]=K,e[155]=m,e[156]=h,e[157]=S,e[158]=_,e[159]=y,e[160]=r,e[161]=vt):vt=e[161];let yt;e[162]!==_t||e[163]!==vt?(yt=(0,Q.jsxs)(`div`,{className:`flex bg-zinc-100 dark:bg-zinc-800 rounded-full px-3 py-1.5 focus-within:ring-1 ring-blue-500/50 items-center justify-between border border-transparent transition-all`,children:[_t,vt]}),e[162]=_t,e[163]=vt,e[164]=yt):yt=e[164];let bt;e[165]!==nt||e[166]!==ut||e[167]!==ht||e[168]!==gt||e[169]!==yt?(bt=(0,Q.jsxs)(`div`,{className:`px-4 py-3 relative shrink-0 bg-inherit`,children:[nt,ut,ht,gt,yt]}),e[165]=nt,e[166]=ut,e[167]=ht,e[168]=gt,e[169]=yt,e[170]=bt):bt=e[170];let xt;e[171]!==Ne||e[172]!==et||e[173]!==bt?(xt=(0,Q.jsxs)(`div`,{className:`w-full md:w-[400px] flex flex-col h-full overflow-hidden bg-inherit`,children:[Ne,Pe,et,tt,bt]}),e[171]=Ne,e[172]=et,e[173]=bt,e[174]=xt):xt=e[174];let St;e[175]!==ge||e[176]!==_e||e[177]!==xt?(St=(0,Q.jsxs)(x.div,{initial:fe,animate:pe,exit:me,transition:he,className:ge,onClick:$n,children:[_e,xt]}),e[175]=ge,e[176]=_e,e[177]=xt,e[178]=St):St=e[178];let Ct;return e[179]!==J||e[180]!==St?(Ct=(0,Q.jsx)(x.div,{initial:ue,animate:se,exit:ce,className:`fixed inset-0 z-[100] bg-black/80 backdrop-blur-md flex items-end md:items-center justify-center p-0 md:p-8`,onClick:J,children:St}),e[179]=J,e[180]=St,e[181]=Ct):Ct=e[181],Ct};function $n(e){return e.stopPropagation()}var er=u(),tr=e=>{let t=(0,er.c)(6),{children:n}=e,r,i,a,o;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(r={opacity:0},i={opacity:1},a={opacity:0},o={duration:.15,ease:`easeOut`},t[0]=r,t[1]=i,t[2]=a,t[3]=o):(r=t[0],i=t[1],a=t[2],o=t[3]);let s;return t[4]===n?s=t[5]:(s=(0,Q.jsx)(x.div,{initial:r,animate:i,exit:a,transition:o,className:`w-full flex justify-center`,children:n}),t[4]=n,t[5]=s),s},nr=u();function rr(){let e=(0,nr.c)(4),t;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,Q.jsxs)(`div`,{className:`mb-8 mt-4 flex items-center gap-2 px-2`,children:[(0,Q.jsx)(Gn,{className:`w-8 h-8 rounded-md shrink-0`}),(0,Q.jsx)(Gn,{className:`h-6 w-32 hidden lg:block`})]}),e[0]=t):t=e[0];let n;e[1]===Symbol.for(`react.memo_cache_sentinel`)?(n=(0,Q.jsxs)(`div`,{className:`hidden md:flex flex-col w-[72px] lg:w-[245px] h-screen fixed border-r border-border p-4 gap-4 z-50 bg-background`,children:[t,(0,Q.jsx)(`div`,{className:`flex flex-col gap-2`,children:Array.from({length:6}).map(sr)})]}),e[1]=n):n=e[1];let r;e[2]===Symbol.for(`react.memo_cache_sentinel`)?(r=(0,Q.jsx)(`div`,{className:`md:hidden fixed bottom-0 left-0 right-0 h-16 border-t border-border bg-background flex justify-around items-center px-4 z-50`,children:Array.from({length:5}).map(or)}),e[2]=r):r=e[2];let i;return e[3]===Symbol.for(`react.memo_cache_sentinel`)?(i=(0,Q.jsxs)(`div`,{className:`min-h-screen flex flex-col md:flex-row bg-background`,children:[n,r,(0,Q.jsx)(`main`,{className:`flex-grow md:ml-[72px] lg:ml-[245px] flex justify-center pt-4 md:pt-8 pb-20 md:pb-0`,children:(0,Q.jsxs)(`div`,{className:`w-full max-w-[470px] flex flex-col gap-6 px-4 md:px-0`,children:[(0,Q.jsx)(`div`,{className:`flex gap-4 overflow-hidden`,children:Array.from({length:6}).map(ar)}),Array.from({length:2}).map(ir)]})})]}),e[3]=i):i=e[3],i}function ir(e,t){return(0,Q.jsxs)(`div`,{className:`w-full rounded-xl overflow-hidden border border-border bg-card shadow-sm`,children:[(0,Q.jsxs)(`div`,{className:`p-3 flex items-center gap-3`,children:[(0,Q.jsx)(Gn,{className:`w-8 h-8 rounded-full`}),(0,Q.jsxs)(`div`,{className:`space-y-2`,children:[(0,Q.jsx)(Gn,{className:`w-24 h-3`}),(0,Q.jsx)(Gn,{className:`w-16 h-2`})]})]}),(0,Q.jsx)(Gn,{className:`w-full aspect-square`}),(0,Q.jsxs)(`div`,{className:`p-3 space-y-3`,children:[(0,Q.jsx)(Gn,{className:`w-full h-4`}),(0,Q.jsx)(Gn,{className:`w-3/4 h-4`})]})]},t)}function ar(e,t){return(0,Q.jsxs)(`div`,{className:`flex flex-col items-center gap-2 shrink-0`,children:[(0,Q.jsx)(Gn,{className:`w-16 h-16 rounded-full border-2 border-background`}),(0,Q.jsx)(Gn,{className:`w-12 h-2`})]},t)}function or(e,t){return(0,Q.jsx)(Gn,{className:`w-6 h-6 rounded-full`},t)}function sr(e,t){return(0,Q.jsxs)(`div`,{className:`flex items-center gap-4 px-2 py-3`,children:[(0,Q.jsx)(Gn,{className:`w-6 h-6 rounded-md shrink-0`}),(0,Q.jsx)(Gn,{className:`h-4 w-24 hidden lg:block`})]},t)}var cr=u(),lr=e(Oe(),1);const ur=[`notifications`],dr=e=>{let t=(0,cr.c)(5),n=!!e,r;t[0]===e?r=t[1]:(r=async()=>{let{data:t,error:n}=await $.from(`notifications`).select(`
          id,
          created_at,
          type,
          post_id,
          reel_id,
          actor_id,
          actor:profiles!actor_id (username, avatar_url, is_verified)
        `).eq(`user_id`,e).order(`created_at`,{ascending:!1});if(n)throw n;return(t||[]).map(fr)},t[0]=e,t[1]=r);let i;return t[2]!==n||t[3]!==r?(i={queryKey:ur,enabled:n,queryFn:r},t[2]=n,t[3]=r,t[4]=i):i=t[4],o(i)};function fr(e){let t=`interacted with you.`;return e.type===`follow`?t=`started following you.`:e.type===`like`?t=`liked your `+(e.reel_id?`reel.`:`post.`):e.type===`comment`?t=`commented on your `+(e.reel_id?`reel.`:`post.`):e.type===`mention`&&(t=`mentioned you in a `+(e.reel_id?`reel.`:`post.`)),{id:e.id,created_at:e.created_at,type:e.type,user:{id:e.actor_id||``,username:e.actor?.username||`Unknown`,name:e.actor?.username||`Unknown`,avatar:e.actor?.avatar_url||``,isVerified:e.actor?.is_verified||!1},text:t,time:(0,lr.default)(e.created_at).fromNow(),isFollowing:!1,post_id:e.post_id||void 0,reel_id:e.reel_id||void 0}}var pr=u(),mr=e=>{let t=(0,pr.c)(7),n;t[0]===e?n=t[1]:({...n}=e,t[0]=e,t[1]=n);let{theme:i}=q(),a=i===void 0?`system`:i,o,s;t[2]===Symbol.for(`react.memo_cache_sentinel`)?(o={success:(0,Q.jsx)(U,{className:`size-4`}),info:(0,Q.jsx)(pe,{className:`size-4`}),warning:(0,Q.jsx)(D,{className:`size-4`}),error:(0,Q.jsx)(G,{className:`size-4`}),loading:(0,Q.jsx)(ae,{className:`size-4 animate-spin`})},s={"--normal-bg":`var(--popover)`,"--normal-text":`var(--popover-foreground)`,"--normal-border":`var(--border)`,"--border-radius":`var(--radius)`},t[2]=o,t[3]=s):(o=t[2],s=t[3]);let c;return t[4]!==n||t[5]!==a?(c=(0,Q.jsx)(r,{theme:a,className:`toaster group`,icons:o,style:s,...n}),t[4]=n,t[5]=a,t[6]=c):c=t[6],c},hr=u(),gr=e(Oe(),1),_r=(0,X.lazy)(()=>we(()=>import(`./HomeView-COILrELm.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),vr=(0,X.lazy)(()=>we(()=>import(`./ProfileView-Diwj920U.js`),__vite__mapDeps([10,1,2,3,4,5,9]))),yr=(0,X.lazy)(()=>we(()=>import(`./MessagesView-C9yCEpEn.js`),__vite__mapDeps([11,1,2,3,4,5]))),br=(0,X.lazy)(()=>we(()=>import(`./ReelsView-CWSTKDYz.js`),__vite__mapDeps([12,1,2,3,4,5,7,8,9]))),xr=(0,X.lazy)(()=>we(()=>import(`./NotificationsView-Bh7cPNy8.js`),__vite__mapDeps([13,1,2,3,4,5,9,8]))),Sr=(0,X.lazy)(()=>we(()=>import(`./ExploreView-DWISBh23.js`),__vite__mapDeps([14,1,2,3,4,5]))),Cr=(0,X.lazy)(()=>we(()=>import(`./AuthView-BqAUgQUO.js`),__vite__mapDeps([15,1,2,3,4]))),wr=(0,X.lazy)(()=>we(()=>import(`./PostView-C5xAmejt.js`),__vite__mapDeps([16,1,2,3,4,5,6,7,8])));function Tr(){let e=(0,hr.c)(56),{theme:t,isCreateModalOpen:n,isEditProfileOpen:r,viewingStory:i,viewingPost:a,viewingReel:o,setCurrentUser:s,setUnreadNotificationsCount:c,showToast:l}=He(),{user:u,profile:d,loading:f}=We(),p=R(),m=P(),{data:h}=dr(u?.id),g;e[0]===h?g=e[1]:(g=h===void 0?[]:h,e[0]=h,e[1]=g);let v=g,y=p.pathname.startsWith(`/reels/`)&&p.pathname.split(`/`).length===3||p.pathname.startsWith(`/post/`)&&p.pathname.split(`/`).length===3,b,ee;e[2]===t?(b=e[3],ee=e[4]):(b=()=>{t===`dark`?document.documentElement.classList.add(`dark`):document.documentElement.classList.remove(`dark`)},ee=[t],e[2]=t,e[3]=b,e[4]=ee),(0,X.useEffect)(b,ee);let x,S;e[5]!==m||e[6]!==l||e[7]!==u?(x=()=>{if(!u)return;let e=$.channel(`notifications_realtime_${u.id}`).on(`postgres_changes`,{event:`INSERT`,schema:`public`,table:`notifications`,filter:`user_id=eq.${u.id}`},e=>{console.log(`New notification:`,e),m.invalidateQueries({queryKey:ur}),l(`New notification received`)}).subscribe();return()=>{$.removeChannel(e)}},S=[u,m,l],e[5]=m,e[6]=l,e[7]=u,e[8]=x,e[9]=S):(x=e[8],S=e[9]),(0,X.useEffect)(x,S);let C,T;e[10]!==v||e[11]!==c?(C=()=>{let e=localStorage.getItem(`lastNotificationReadTime`),t=e?(0,gr.default)(e):(0,gr.default)(0);c(v.filter(e=>e.created_at&&(0,gr.default)(e.created_at).isAfter(t)).length)},T=[v,c],e[10]=v,e[11]=c,e[12]=C,e[13]=T):(C=e[12],T=e[13]),(0,X.useEffect)(C,T),ut();let E,D;if(e[14]!==d||e[15]!==s||e[16]!==u?(E=()=>{d&&u&&s({id:u.id,username:d.username,name:d.full_name||u.email||`User`,avatar:d.avatar_url||`https://api.dicebear.com/9.x/avataaars/svg?seed=default`,bio:d.bio||``,isVerified:d.is_verified||!1,stats:{posts:0,followers:0,following:0}})},D=[d,u,s],e[14]=d,e[15]=s,e[16]=u,e[17]=E,e[18]=D):(E=e[17],D=e[18]),(0,X.useEffect)(E,D),f){let t;return e[19]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,Q.jsx)(`div`,{className:`min-h-screen flex items-center justify-center bg-background`,children:(0,Q.jsx)(`img`,{src:`/icon.png`,className:`w-20 h-20 animate-pulse`,alt:`Loading`})}),e[19]=t):t=e[19],t}if(!u&&!y){let t;return e[20]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,Q.jsx)(X.Suspense,{fallback:(0,Q.jsx)(`div`,{className:`min-h-screen flex items-center justify-center bg-background`,children:(0,Q.jsx)(`img`,{src:`/icon.png`,className:`w-20 h-20 animate-pulse`,alt:`Loading`})}),children:(0,Q.jsx)(Cr,{})}),e[20]=t):t=e[20],t}let O;e[21]===Symbol.for(`react.memo_cache_sentinel`)?(O=(0,Q.jsx)(mr,{}),e[21]=O):O=e[21];let k;e[22]===n?k=e[23]:(k=n&&(0,Q.jsx)(qt,{}),e[22]=n,e[23]=k);let A;e[24]===k?A=e[25]:(A=(0,Q.jsx)(w,{children:k}),e[24]=k,e[25]=A);let j;e[26]===r?j=e[27]:(j=r&&(0,Q.jsx)(rn,{}),e[26]=r,e[27]=j);let M;e[28]===j?M=e[29]:(M=(0,Q.jsx)(w,{children:j}),e[28]=j,e[29]=M);let N;e[30]===i?N=e[31]:(N=i!==null&&(0,Q.jsx)(dn,{}),e[30]=i,e[31]=N);let F;e[32]===N?F=e[33]:(F=(0,Q.jsx)(w,{children:N}),e[32]=N,e[33]=F);let I;e[34]!==a||e[35]!==o?(I=(a!==null||o!==null)&&(0,Q.jsx)(Qn,{},a?.id||o?.id),e[34]=a,e[35]=o,e[36]=I):I=e[36];let L;e[37]===I?L=e[38]:(L=(0,Q.jsx)(w,{children:I}),e[37]=I,e[38]=L);let te;e[39]===Symbol.for(`react.memo_cache_sentinel`)?(te=(0,Q.jsx)(rr,{}),e[39]=te):te=e[39];let z;e[40]===Symbol.for(`react.memo_cache_sentinel`)?(z=(0,Q.jsx)(ct,{}),e[40]=z):z=e[40];let B;e[41]===Symbol.for(`react.memo_cache_sentinel`)?(B=(0,Q.jsx)(ue,{path:`/`,element:(0,Q.jsx)(tr,{children:(0,Q.jsx)(_r,{})})}),e[41]=B):B=e[41];let V;e[42]===Symbol.for(`react.memo_cache_sentinel`)?(V=(0,Q.jsx)(ue,{path:`/explore`,element:(0,Q.jsx)(tr,{children:(0,Q.jsx)(Sr,{})})}),e[42]=V):V=e[42];let H;e[43]===Symbol.for(`react.memo_cache_sentinel`)?(H=(0,Q.jsx)(ue,{path:`/post/:id`,element:(0,Q.jsx)(tr,{children:(0,Q.jsx)(wr,{})})}),e[43]=H):H=e[43];let U;e[44]===Symbol.for(`react.memo_cache_sentinel`)?(U=(0,Q.jsx)(ue,{path:`/reels/:id?`,element:(0,Q.jsx)(tr,{children:(0,Q.jsx)(br,{})})}),e[44]=U):U=e[44];let W;e[45]===Symbol.for(`react.memo_cache_sentinel`)?(W=(0,Q.jsx)(ue,{path:`/messages/:username?`,element:(0,Q.jsx)(tr,{children:(0,Q.jsx)(yr,{})})}),e[45]=W):W=e[45];let G;e[46]===Symbol.for(`react.memo_cache_sentinel`)?(G=(0,Q.jsx)(ue,{path:`/notifications`,element:(0,Q.jsx)(tr,{children:(0,Q.jsx)(xr,{})})}),e[46]=G):G=e[46];let K;e[47]===Symbol.for(`react.memo_cache_sentinel`)?(K=(0,Q.jsxs)(ue,{element:z,children:[B,V,H,U,W,G,(0,Q.jsx)(ue,{path:`/profile/:username`,element:(0,Q.jsx)(tr,{children:(0,Q.jsx)(vr,{})})})]}),e[47]=K):K=e[47];let q;e[48]===p?q=e[49]:(q=(0,Q.jsx)(w,{mode:`wait`,children:(0,Q.jsx)(X.Suspense,{fallback:te,children:(0,Q.jsx)(_,{location:p,children:K},p.pathname)})}),e[48]=p,e[49]=q);let J;return e[50]!==A||e[51]!==M||e[52]!==F||e[53]!==L||e[54]!==q?(J=(0,Q.jsxs)(Q.Fragment,{children:[O,A,M,F,L,q]}),e[50]=A,e[51]=M,e[52]=F,e[53]=L,e[54]=q,e[55]=J):J=e[55],J}const Er=({children:e})=>{let[t,n]=(0,X.useState)(null),[r,i]=(0,X.useState)(null),[a,o]=(0,X.useState)(null),[s,c]=(0,X.useState)(!0);(0,X.useEffect)(()=>{$.auth.getSession().then(({data:{session:e}})=>{n(e),i(e?.user??null),e?.user?l(e.user.id):c(!1)});let{data:{subscription:e}}=$.auth.onAuthStateChange((e,t)=>{n(t),i(t?.user??null),t?.user?l(t.user.id):(o(null),c(!1))});return()=>e.unsubscribe()},[]);let l=async e=>{try{let{data:t,error:n}=await $.from(`profiles`).select(`*`).eq(`id`,e).single();n?console.error(`Error fetching profile:`,n):o(t)}finally{c(!1)}};return(0,Q.jsx)(Ue.Provider,{value:{session:t,user:r,profile:a,loading:s,signIn:async(e,t)=>{let{data:n,error:r}=await $.auth.signInWithPassword({email:e,password:t});return{data:n,error:r}},signUp:async(e,t,n)=>{let{data:r,error:i}=await $.auth.signUp({email:e,password:t,options:{data:n}});return{data:r,error:i}},signOut:async()=>{await $.auth.signOut()},resetPassword:async e=>{let{data:t,error:n}=await $.auth.resetPasswordForEmail(e,{redirectTo:`${window.location.origin}/?reset=true`});return{data:t,error:n}},updatePassword:async e=>{let{data:t,error:n}=await $.auth.updateUser({password:e});return{data:t,error:n}}},children:!s&&e})};var Dr=new Me({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*60*24,retry:1}}}),Or=Ne({storage:window.localStorage});(0,Fe.createRoot)(document.getElementById(`root`)).render((0,Q.jsx)(X.StrictMode,{children:(0,Q.jsxs)(y,{client:Dr,persistOptions:{persister:Or},children:[(0,Q.jsx)(M,{children:(0,Q.jsx)(Er,{children:(0,Q.jsx)(Tr,{})})}),(0,Q.jsx)(h,{initialIsOpen:!1})]})}));export{We as C,Z as S,$ as _,Sn as a,qe as b,sn as c,Rt as d,Ot as f,mt as g,pt as h,An as i,tn as l,bt as m,Gn as n,yn as o,yt as p,Bn as r,hn as s,dr as t,$t as u,Xe as v,He as w,Ke as x,Ge as y};