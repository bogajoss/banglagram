import{a as e}from"./rolldown-runtime-DDUpfMIz.js";import{Bt as t,C as n,Ct as r,Ft as i,I as a,It as o,J as s,Lt as c,Qt as l,Rt as u,Y as d,Yt as f,Zt as p,dn as m,ht as ee,ln as te,mt as ne,nn as h,nt as re,pn as g,tn as _,un as ie,w as ae}from"./vendor-DIZRQ3UL.js";import{R as oe,Tr as v,wr as se}from"./libs-DzpOAMaM.js";import"./supabase-BWb0WEDP.js";import{S as y,T as ce,b,c as x,h as le,i as ue,r as de,u as fe,v as S,w as C,x as pe}from"./index-JMHvmuX4.js";var w=e(g(),1),T=f();const E=e=>[`messages`,e],me=(e,t)=>{let n=(0,T.c)(9),r=t||``,i;n[0]===r?i=n[1]:(i=E(r),n[0]=r,n[1]=i);let a=!!e&&!!t,o;n[2]!==e||n[3]!==t?(o=async n=>{let{pageParam:r}=n,i=r===void 0?0:r;if(!e||!t)throw Error(`IDs required`);let a=i*20,o=a+19,{data:s,error:c}=await S.from(`messages`).select(`*`).or(`and(sender_id.eq.${e},receiver_id.eq.${t}),and(sender_id.eq.${t},receiver_id.eq.${e})`).order(`created_at`,{ascending:!1}).range(a,o);if(c)throw c;return s},n[2]=e,n[3]=t,n[4]=o):o=n[4];let s;return n[5]!==i||n[6]!==a||n[7]!==o?(s={queryKey:i,enabled:a,initialPageParam:0,queryFn:o,getNextPageParam:D},n[5]=i,n[6]=a,n[7]=o,n[8]=s):s=n[8],p(s)};function D(e,t){return e.length===20?t.length:void 0}var O=f();const k=[`conversations`],he=e=>{let t=(0,O.c)(5),n=!!e,r;t[0]===e?r=t[1]:(r=async t=>{let{pageParam:n}=t,r=n===void 0?0:n;if(!e)return[];let i=r*100,a=i+99,{data:o,error:s}=await S.from(`messages`).select(`
                  sender_id,
                  receiver_id,
                  created_at,
                  sender:profiles!sender_id(id, username, full_name, avatar_url, is_verified),
                  receiver:profiles!receiver_id(id, username, full_name, avatar_url, is_verified)
                `).or(`sender_id.eq.${e},receiver_id.eq.${e}`).order(`created_at`,{ascending:!1}).range(i,a);if(s)throw console.error(`Error fetching conversations`,s),s;return o},t[0]=e,t[1]=r);let i;return t[2]!==n||t[3]!==r?(i={queryKey:k,enabled:n,initialPageParam:0,queryFn:r,getNextPageParam:A},t[2]=n,t[3]=r,t[4]=i):i=t[4],p(i)},ge=(e,t)=>{let n=new Map;return e.flat().forEach(e=>{let r=e.sender_id===t?e.receiver:e.sender;r&&!n.has(r.username)&&n.set(r.username,{id:r.id,username:r.username,name:r.full_name||r.username,avatar:r.avatar_url||``,isVerified:r.is_verified||!1,stats:{posts:0,followers:0,following:0}})}),Array.from(n.values())};function A(e,t){return e.length===100?t.length:void 0}var j=f(),M=e(v(),1);const _e=()=>{let e=(0,j.c)(2),t=_(),n;return e[0]===t?n=e[1]:(n={mutationFn:ve,onMutate:async e=>{let n=E(e.receiverId);await t.cancelQueries({queryKey:n});let r=t.getQueryData(n);if(r){let i={id:`optimistic-`+(0,M.default)().valueOf(),sender_id:e.senderId,receiver_id:e.receiverId,content:e.content||null,media_url:e.mediaUrl||null,is_read:!1,created_at:(0,M.default)().toISOString()};t.setQueryData(n,{...r,pages:r.pages.map((e,t)=>t===0?[i,...e]:e)})}return{previousMessages:r}},onError:(e,n,r)=>{r?.previousMessages&&t.setQueryData(E(n.receiverId),r.previousMessages),console.error(e)},onSettled:(e,n,r)=>{t.refetchQueries({queryKey:E(r.receiverId),type:`active`}),t.invalidateQueries({queryKey:[`conversations`]})}},e[0]=t,e[1]=n),l(n)};async function ve(e){let{content:t,senderId:n,receiverId:r,mediaUrl:i}=e,{data:a,error:o}=await S.from(`messages`).insert({sender_id:n,receiver_id:r,content:t||null,media_url:i||null}).select().single();if(o)throw o;return a}var N=f();const ye=()=>{let e=(0,N.c)(2),t=_(),n;return e[0]===t?n=e[1]:(n={mutationFn:P,onSuccess:(e,n)=>{let{senderId:r}=n;t.invalidateQueries({queryKey:E(r)}),t.invalidateQueries({queryKey:[`conversations`]})}},e[0]=t,e[1]=n),l(n)};async function P(e){let{senderId:t,receiverId:n}=e,{error:r}=await S.from(`messages`).update({is_read:!0}).eq(`sender_id`,t).eq(`receiver_id`,n).eq(`is_read`,!1);if(r)throw r}var F=f();const be=e=>{let t=(0,F.c)(12),{user:n,profile:r}=C(),i;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(i=[],t[0]=i):i=t[0];let[a,o]=(0,w.useState)(i),s=(0,w.useRef)(null),c;t[1]===Symbol.for(`react.memo_cache_sentinel`)?(c={},t[1]=c):c=t[1];let l=(0,w.useRef)(c),u,d;t[2]!==e||t[3]!==n?(u=()=>{if(!n||!e)return;let t=S.channel(`typing:${e}`,{config:{presence:{key:n.id}}});s.current=t;let r=()=>{let e=t.presenceState(),r=[];Object.keys(e).forEach(t=>{e[t].forEach(e=>{e.isTyping&&e.username&&e.userId!==n?.id&&r.push(e.username)})}),o([...new Set(r)])};return t.on(`presence`,{event:`sync`},r).on(`presence`,{event:`join`},()=>{r()}).on(`presence`,{event:`leave`},()=>{r()}).subscribe(),()=>{S.removeChannel(t),s.current=null,Object.values(l.current).forEach(clearTimeout)}},d=[e,n],t[2]=e,t[3]=n,t[4]=u,t[5]=d):(u=t[4],d=t[5]),(0,w.useEffect)(u,d);let f;t[6]!==r||t[7]!==n?(f=async e=>{if(s.current&&n&&r){let t={isTyping:e,username:r.username,userId:n.id};await s.current.track(t),e?(l.current[n.id]&&clearTimeout(l.current[n.id]),l.current[n.id]=setTimeout(async()=>{s.current&&await s.current.track({isTyping:!1,username:r.username,userId:n.id})},3e3)):l.current[n.id]&&clearTimeout(l.current[n.id])}},t[6]=r,t[7]=n,t[8]=f):f=t[8];let p=f,m;return t[9]!==p||t[10]!==a?(m={typingUsers:a,setTyping:p},t[9]=p,t[10]=a,t[11]=m):m=t[11],m};var I=f();const xe=e=>{let t=(0,I.c)(15),{user:n,profile:r}=C(),i;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(i={},t[0]=i):i=t[0];let[a,o]=(0,w.useState)(i),s=(0,w.useRef)(null),c,l;t[1]!==r||t[2]!==e||t[3]!==n?(c=()=>{if(!n||!e||!r)return;let t=S.channel(`presence:${e}`,{config:{presence:{key:n.id}}});return s.current=t,t.on(`presence`,{event:`sync`},()=>{let e=t.presenceState(),n={};Object.keys(e).forEach(t=>{let r=e[t];if(r&&r.length>0){let e=r[0];e.userId&&e.username&&(n[e.userId]={userId:e.userId,username:e.username,isOnline:e.isOnline??!1,lastSeen:e.lastSeen??null})}}),o(n)}).on(`presence`,{event:`join`},e=>{let{newPresences:t}=e;t.forEach(e=>{e.userId&&e.username&&o(t=>({...t,[e.userId]:{userId:e.userId,username:e.username,isOnline:e.isOnline??!0,lastSeen:e.lastSeen??null}}))})}).on(`presence`,{event:`leave`},e=>{let{leftPresences:t}=e;t.forEach(e=>{e.userId&&o(t=>{let n={...t};return delete n[e.userId],n})})}).subscribe(),()=>{S.removeChannel(t),s.current=null}},l=[e,n,r],t[1]=r,t[2]=e,t[3]=n,t[4]=c,t[5]=l):(c=t[4],l=t[5]),(0,w.useEffect)(c,l);let u;t[6]!==r||t[7]!==n?(u=async e=>{if(s.current&&n&&r){let t=new Date().toISOString(),i={userId:n.id,username:r.username,isOnline:e,lastSeen:e?null:t};await s.current.track(i),e?await S.from(`profiles`).update({is_online:!0}).eq(`id`,n.id):await S.from(`profiles`).update({is_online:!1,last_seen:t}).eq(`id`,n.id)}},t[6]=r,t[7]=n,t[8]=u):u=t[8];let d=u,f;t[9]===a?f=t[10]:(f=e=>a[e]||null,t[9]=a,t[10]=f);let p=f,m;return t[11]!==p||t[12]!==a||t[13]!==d?(m={presenceState:a,setOnlineStatus:d,getPresenceStatus:p},t[11]=p,t[12]=a,t[13]=d,t[14]=m):m=t[14],m};var L=f(),R=e(v(),1),Se=e(se(),1);oe();var z=e(h(),1);R.default.extend(Se.default),R.default.locale(`bn`);const Ce=e=>{let t=(0,L.c)(9),{isOnline:n,lastSeen:r,className:i}=e,a=i===void 0?``:i;if(n){let e=`text-green-500 text-xs font-medium ${a}`,n;return t[0]===e?n=t[1]:(n=(0,z.jsx)(`span`,{className:e,children:`অ্যাক্টিভ এখনই`}),t[0]=e,t[1]=n),n}if(r){let e;if(t[2]!==r){let n=(0,R.default)(r),i=(0,R.default)(),a=i.diff(n,`minute`),o=i.diff(n,`hour`),s=i.diff(n,`day`);e=a<1?`কয়েক সেকেন্ড আগে`:a<60?`${a} মিনিট আগে`:o<24?`${o} ঘণ্টা আগে`:s<7?`${s} দিন আগে`:n.format(`DD MMM`),t[2]=r,t[3]=e}else e=t[3];let n=`text-gray-500 text-xs font-medium ${a}`,i;return t[4]!==n||t[5]!==e?(i=(0,z.jsxs)(`span`,{className:n,children:[`শেষ সক্রিয়: `,e]}),t[4]=n,t[5]=e,t[6]=i):i=t[6],i}let o=`text-gray-500 text-xs font-medium ${a}`,s;return t[7]===o?s=t[8]:(s=(0,z.jsx)(`span`,{className:o,children:`অনলাইন অবস্থা জানা নেই`}),t[7]=o,t[8]=s),s};var B=f();const we=e=>{let t=(0,B.c)(8),{typingUsers:n,className:r}=e,i=r===void 0?``:r;if(n.length===0)return null;let a=n.length===1?`${n[0]} টাইপ করছে...`:`${n.length} জন টাইপ করছে...`,o;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(o={animation:`bounce 1.4s infinite`},t[0]=o):o=t[0];let s=o,c=`flex items-center gap-2 text-sm text-gray-500 ${i}`,l;t[1]===Symbol.for(`react.memo_cache_sentinel`)?(l=(0,z.jsx)(`style`,{children:`
        @keyframes bounce {
          0%, 80%, 100% {
            opacity: 0.3;
          }
          40% {
            opacity: 1;
          }
        }
        .dot-1 { animation-delay: 0ms; }
        .dot-2 { animation-delay: 160ms; }
        .dot-3 { animation-delay: 320ms; }
      `}),t[1]=l):l=t[1];let u;t[2]===Symbol.for(`react.memo_cache_sentinel`)?(u=(0,z.jsx)(`span`,{className:`w-2 h-2 bg-gray-400 rounded-full dot-1`,style:{...s}}),t[2]=u):u=t[2];let d;t[3]===Symbol.for(`react.memo_cache_sentinel`)?(d=(0,z.jsx)(`span`,{className:`w-2 h-2 bg-gray-400 rounded-full dot-2`,style:{...s}}),t[3]=d):d=t[3];let f;t[4]===Symbol.for(`react.memo_cache_sentinel`)?(f=(0,z.jsxs)(`div`,{className:`flex gap-1`,children:[u,d,(0,z.jsx)(`span`,{className:`w-2 h-2 bg-gray-400 rounded-full dot-3`,style:{...s}})]}),t[4]=f):f=t[4];let p;return t[5]!==c||t[6]!==a?(p=(0,z.jsxs)(`div`,{className:c,children:[l,f,a]}),t[5]=c,t[6]=a,t[7]=p):p=t[7],p};var V=()=>{let{theme:e,showToast:l}=ce(),{user:f,profile:p}=C(),h=_(),g=ie(),oe=te(),{username:v}=m(),{data:se}=le(v||``,f?.id),T=oe.state?.user||se?.user||null,[D,O]=(0,w.useState)(``),[k,A]=(0,w.useState)(``),[j,M]=(0,w.useState)([]),[ve,N]=(0,w.useState)(!1),[P,F]=(0,w.useState)(!1),[I,L]=(0,w.useState)(!1),[R,Se]=(0,w.useState)({isOnline:!1,lastSeen:null}),B=(0,w.useRef)(null),V=(0,w.useRef)(null),H=(0,w.useRef)(null),[Te,U]=(0,w.useState)(!1),W=e===`dark`?`border-zinc-800`:`border-zinc-200`,Ee=e===`dark`?`hover:bg-zinc-900`:`hover:bg-gray-100`;(0,w.useEffect)(()=>{let e=e=>{H.current&&!H.current.contains(e.target)&&L(!1)};return document.addEventListener(`mousedown`,e),()=>document.removeEventListener(`mousedown`,e)},[]),(0,w.useEffect)(()=>{let e=setTimeout(async()=>{if(k.trim().length>0){N(!0);let{data:e}=await S.from(`profiles`).select(`id, username, full_name, avatar_url, is_verified`).ilike(`username`,`%${k}%`).limit(10);e&&M(e.map(e=>({id:e.id,username:e.username,name:e.full_name||e.username,avatar:e.avatar_url||``,isVerified:e.is_verified||!1}))),N(!1)}else M([])},300);return()=>clearTimeout(e)},[k]);let{data:G,fetchNextPage:De,hasNextPage:Oe}=he(f?.id),ke=w.useMemo(()=>!G||!f?.id?[]:ge(G.pages,f.id),[G,f?.id]),K=T?.id||ke.find(e=>e.username===T?.username)?.id,{data:q,fetchNextPage:Ae,hasNextPage:je,isFetchingNextPage:Me}=me(f?.id,K),J=w.useMemo(()=>q?[...q.pages.flat()].reverse():[],[q]),{mutate:Y}=_e(),{mutate:Ne}=ye(),{typingUsers:X,setTyping:Z}=be(K?[f?.id,K].sort().join(`-`):``);(0,w.useEffect)(()=>{f?.id&&K&&J.length>0&&J.some(e=>e.sender_id===K&&!e.is_read)&&Ne({senderId:K,receiverId:f.id})},[J,K,f?.id,Ne]);let{presenceState:Q,setOnlineStatus:$}=xe(K?[f?.id,K].sort().join(`-`):``);(0,w.useEffect)(()=>{if(K&&Q[K]){let e=Q[K];Se({isOnline:e.isOnline,lastSeen:e.lastSeen})}},[K,Q]),(0,w.useEffect)(()=>(K&&f&&$(!0),()=>{K&&f&&$(!1)}),[K,f,$]),(0,w.useEffect)(()=>{K&&(D.length>0?Z(!0):Z(!1))},[D,K,Z]),(0,w.useEffect)(()=>{if(!f)return;let e=`chat_messages_tracking_${f.id}_${Date.now()}`,t=S.channel(e).on(`postgres_changes`,{event:`*`,schema:`public`,table:`messages`},e=>{if(!e.new)return;let t=e.new;h.invalidateQueries({queryKey:[`conversations`]}),K&&(t.sender_id===K&&t.receiver_id===f.id||t.sender_id===f.id&&t.receiver_id===K)&&(t.sender_id===K&&h.setQueryData(E(K),e=>{if(!e||!e.pages||e.pages.some(e=>e.some(e=>e.id===t.id)))return e;let n=[...e.pages];return n[0]=[t,...n[0]],{...e,pages:n}}),h.refetchQueries({queryKey:E(K),type:`active`}))}).subscribe(t=>{console.log(`Realtime Subscription Status [${e}]:`,t),t===`CHANNEL_ERROR`&&console.error(`Realtime connection failed. Check your network or project status.`)});return()=>{S.removeChannel(t)}},[f,K,h]);let Pe=e=>{O(t=>t+e.emoji)},Fe=()=>{!D.trim()||!K||!f||(Y({content:D,senderId:f.id,receiverId:K}),O(``),Z(!1),L(!1))},Ie=async e=>{if(!(!f||!K)){F(!0);try{let t=`${`${f.id}-${Date.now()}.webm`}`,{error:n}=await S.storage.from(`messages`).upload(t,e);if(n)throw n;let{data:{publicUrl:r}}=S.storage.from(`messages`).getPublicUrl(t);Y({senderId:f.id,receiverId:K,mediaUrl:r}),U(!1)}catch(e){l(`ভয়েস মেসেজ পাঠাতে সমস্যা হয়েছে`),console.error(e)}finally{F(!1)}}},Le=async e=>{let t=e.target.files?.[0];if(!(!t||!f||!K)){F(!0);try{let e=t.name.split(`.`).pop(),n=`${`${f.id}-${Date.now()}.${e}`}`,{error:r}=await S.storage.from(`messages`).upload(n,t);if(r)throw r;let{data:{publicUrl:i}}=S.storage.from(`messages`).getPublicUrl(n);Y({senderId:f.id,receiverId:K,mediaUrl:i})}catch(e){l(`ছবি পাঠাতে সমস্যা হয়েছে`),console.error(e)}finally{F(!1),V.current&&(V.current.value=``)}}};(0,w.useEffect)(()=>{B.current?.scrollIntoView({behavior:`smooth`})},[J,X]);let Re=e=>{g(`/messages/${e.username}`,{state:{user:e}})};return(0,z.jsx)(`div`,{className:`w-full flex h-full md:h-[calc(100vh-2rem)] md:pt-4 md:pb-4 md:px-4 flex-col md:flex-row`,children:(0,z.jsxs)(`div`,{className:`w-full h-full md:border ${W} rounded-lg flex overflow-hidden relative shadow-lg`,children:[(0,z.jsxs)(`div`,{className:`w-full md:w-[397px] border-r ${W} flex flex-col absolute md:relative inset-0 z-10 ${e===`dark`?`bg-black`:`bg-white`} ${T?`hidden md:flex`:`flex`}`,children:[(0,z.jsxs)(`div`,{className:`h-[75px] px-5 flex items-center justify-between border-b ${W} shrink-0`,children:[(0,z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,z.jsx)(`div`,{className:`md:hidden cursor-pointer -ml-2 p-1`,onClick:()=>g(`/`),children:(0,z.jsx)(i,{size:28})}),(0,z.jsxs)(`div`,{className:`flex items-center gap-2 cursor-pointer`,children:[(0,z.jsx)(`span`,{className:`font-bold text-xl`,children:p?.username}),(0,z.jsx)(o,{size:20})]})]}),(0,z.jsx)(s,{size:24,className:`cursor-pointer`})]}),(0,z.jsx)(`div`,{className:`px-5 py-4 shrink-0`,children:(0,z.jsxs)(`div`,{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${e===`dark`?`bg-[#262626]`:`bg-gray-100`}`,children:[(0,z.jsx)(re,{size:16,className:`text-[#8e8e8e]`}),(0,z.jsx)(`input`,{type:`text`,placeholder:`অনুসন্ধান`,value:k,onChange:e=>A(e.target.value),className:`bg-transparent border-none outline-none text-sm w-full placeholder-[#8e8e8e]`}),k&&(0,z.jsx)(a,{size:16,className:`cursor-pointer text-[#8e8e8e]`,onClick:()=>A(``)})]})}),(0,z.jsxs)(`div`,{className:`flex-grow overflow-y-auto`,children:[k?(0,z.jsx)(z.Fragment,{children:ve?(0,z.jsx)(`div`,{className:`p-4 text-center text-sm text-gray-500`,children:`অনুসন্ধান করা হচ্ছে...`}):j.length===0?(0,z.jsx)(`div`,{className:`p-4 text-center text-sm text-gray-500`,children:`কোনো ফলাফল পাওয়া যায়নি`}):j.map(t=>(0,z.jsxs)(`div`,{onClick:()=>{Re(t),A(``)},className:`flex items-center gap-3 px-5 py-3 cursor-pointer transition-colors ${Ee}`,children:[(0,z.jsxs)(b,{className:`relative flex-shrink-0 w-14 h-14`,children:[(0,z.jsx)(y,{src:t.avatar}),(0,z.jsx)(pe,{children:t.username?.[0]?.toUpperCase()||`?`})]}),(0,z.jsxs)(`div`,{className:`flex-grow min-w-0`,children:[(0,z.jsxs)(`div`,{className:`text-sm truncate font-bold flex items-center gap-1`,children:[t.username,t.isVerified&&(0,z.jsx)(x,{})]}),(0,z.jsx)(`div`,{className:`text-xs truncate ${e===`dark`?`text-[#a8a8a8]`:`text-gray-500`}`,children:t.name})]})]},t.username))}):ke.map(t=>(0,z.jsxs)(`div`,{onClick:()=>Re(t),className:`flex items-center gap-3 px-5 py-3 cursor-pointer transition-colors ${Ee} ${T?.username===t.username?e===`dark`?`bg-zinc-900`:`bg-gray-100`:``}`,children:[(0,z.jsxs)(b,{className:`relative flex-shrink-0 w-14 h-14`,children:[(0,z.jsx)(y,{src:t.avatar}),(0,z.jsx)(pe,{children:t.username?.[0]?.toUpperCase()||`?`})]}),(0,z.jsxs)(`div`,{className:`flex-grow min-w-0`,children:[(0,z.jsxs)(`div`,{className:`text-sm truncate font-bold flex items-center gap-1`,children:[t.username,t.isVerified&&(0,z.jsx)(x,{})]}),(0,z.jsx)(`div`,{className:`text-xs truncate ${e===`dark`?`text-[#a8a8a8]`:`text-gray-500`}`,children:`মেসেজ...`})]})]},t.username)),Oe&&(0,z.jsx)(`div`,{className:`p-4 text-center`,children:(0,z.jsx)(`button`,{onClick:()=>De(),className:`text-xs text-[#006a4e] font-bold hover:underline`,children:`পুরানো চ্যাট লোড করুন`})})]})]}),(0,z.jsx)(`div`,{className:`w-full flex-grow flex flex-col absolute md:relative inset-0 z-20 ${e===`dark`?`bg-black`:`bg-white`} ${T?`flex`:`hidden md:flex`}`,children:T?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(`div`,{className:`h-[75px] px-4 flex items-center justify-between border-b ${W} shrink-0`,children:[(0,z.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,z.jsx)(`div`,{className:`md:hidden cursor-pointer -ml-2 p-2`,onClick:()=>g(`/messages`),children:(0,z.jsx)(i,{size:28})}),(0,z.jsxs)(b,{className:`w-8 h-8 cursor-pointer relative`,onClick:()=>g(`/profile/${T.username}`),children:[(0,z.jsx)(y,{src:T.avatar}),(0,z.jsx)(pe,{children:T.username[0].toUpperCase()}),R.isOnline&&(0,z.jsx)(`div`,{className:`absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white`})]}),(0,z.jsxs)(`div`,{className:`flex flex-col`,children:[(0,z.jsxs)(`div`,{className:`font-semibold text-base truncate max-w-[150px] cursor-pointer hover:underline flex items-center gap-1`,onClick:()=>g(`/profile/${T.username}`),children:[T.username,T.isVerified&&(0,z.jsx)(x,{})]}),(0,z.jsx)(Ce,{isOnline:R.isOnline,lastSeen:R.lastSeen,className:`text-xs`})]})]}),(0,z.jsx)(`div`,{className:`flex items-center gap-4`,children:(0,z.jsx)(r,{size:24,className:`cursor-pointer`})})]}),(0,z.jsxs)(`div`,{className:`flex-grow flex flex-col p-4 gap-4 overflow-y-auto`,children:[je&&(0,z.jsx)(`div`,{className:`flex justify-center py-2`,children:(0,z.jsx)(`button`,{onClick:()=>Ae(),disabled:Me,className:`text-xs text-[#006a4e] font-bold py-1 px-3 rounded-full bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors`,children:Me?`লোড হচ্ছে...`:`পুরানো মেসেজ দেখুন`})}),J.map((t,n)=>(0,z.jsxs)(`div`,{className:`flex flex-col gap-1 max-w-[85%] ${t.sender_id===f?.id?`self-end items-end`:`self-start items-start`}`,children:[t.media_url&&(0,z.jsx)(`div`,{className:`rounded-2xl overflow-hidden mb-1 border border-zinc-800`,children:t.media_url.endsWith(`.webm`)?(0,z.jsx)(de,{src:t.media_url.includes(`/storage/v1/object/messages/`)&&!t.media_url.includes(`/storage/v1/object/public/`)?t.media_url.replace(`/storage/v1/object/messages/`,`/storage/v1/object/public/messages/`):t.media_url,theme:e}):(0,z.jsx)(fe,{src:t.media_url.includes(`/storage/v1/object/messages/`)&&!t.media_url.includes(`/storage/v1/object/public/`)?t.media_url.replace(`/storage/v1/object/messages/`,`/storage/v1/object/public/messages/`):t.media_url,width:300,className:`max-w-full h-auto max-h-[300px] object-cover`,alt:`Shared image`})}),t.content&&(0,z.jsx)(`div`,{className:`rounded-2xl px-4 py-2 text-sm ${t.sender_id===f?.id?`bg-[#006a4e] text-white`:e===`dark`?`bg-[#262626] text-white`:`bg-gray-200 text-black`}`,children:t.content}),t.sender_id===f?.id&&(0,z.jsx)(`div`,{className:`text-[10px] text-gray-500 flex items-center gap-1`,children:t.is_read?(0,z.jsx)(u,{size:12,className:`text-blue-500`}):(0,z.jsx)(c,{size:12})})]},t.id||n)),(0,z.jsx)(`div`,{ref:B})]}),(0,z.jsxs)(`div`,{className:`p-4 shrink-0 relative`,children:[I&&(0,z.jsx)(`div`,{ref:H,className:`absolute bottom-20 left-4 z-50 shadow-2xl`,children:(0,z.jsx)(ae,{theme:e===`dark`?n.DARK:n.LIGHT,onEmojiClick:Pe,lazyLoadEmojis:!0,skinTonesDisabled:!0,searchDisabled:!1})}),X.length>0&&(0,z.jsx)(`div`,{className:`px-4 py-2`,children:(0,z.jsx)(we,{typingUsers:X})}),Te?(0,z.jsx)(`div`,{className:`p-2 border ${W} rounded-[24px] ${e===`dark`?`bg-black`:`bg-white`}`,children:(0,z.jsx)(ue,{onRecordingComplete:Ie,onCancel:()=>U(!1)})}):(0,z.jsxs)(`form`,{className:`border ${W} rounded-[24px] min-h-[44px] flex items-end gap-1 p-1 ${e===`dark`?`bg-black`:`bg-white`}`,onSubmit:e=>{e.preventDefault(),Fe()},children:[(0,z.jsx)(`div`,{className:`p-2 shrink-0 cursor-pointer transition-colors rounded-full ${e===`dark`?`hover:bg-zinc-800 text-zinc-400`:`hover:bg-gray-100 text-zinc-500`}`,onClick:()=>L(!I),children:(0,z.jsx)(d,{size:24})}),!D.trim()&&(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(`div`,{className:`p-2 shrink-0 cursor-pointer transition-colors rounded-full relative overflow-hidden ${e===`dark`?`hover:bg-zinc-800 text-zinc-400`:`hover:bg-gray-100 text-zinc-500`}`,children:[(0,z.jsx)(t,{size:24}),(0,z.jsx)(`input`,{type:`file`,ref:V,accept:`image/*`,className:`absolute inset-0 opacity-0 cursor-pointer`,onChange:Le,disabled:P})]}),(0,z.jsx)(`div`,{className:`p-2 shrink-0 cursor-pointer transition-colors rounded-full ${e===`dark`?`hover:bg-zinc-800 text-zinc-400`:`hover:bg-gray-100 text-zinc-500`}`,onClick:()=>U(!0),children:(0,z.jsx)(ne,{size:24})})]}),(0,z.jsx)(`div`,{className:`flex-grow flex items-center min-w-0 h-full py-1`,children:(0,z.jsx)(`input`,{type:`text`,placeholder:`মেসেজ...`,value:D,onChange:e=>O(e.target.value),onFocus:()=>L(!1),className:`bg-transparent border-none outline-none text-sm w-full px-2 py-1 ${e===`dark`?`text-white placeholder-[#a8a8a8]`:`text-black placeholder-gray-500`}`})}),D.trim()||P?(0,z.jsx)(`button`,{type:`submit`,className:`text-blue-500 font-bold px-3 py-2 shrink-0 cursor-pointer hover:text-blue-600 disabled:opacity-50 transition-colors`,disabled:!D.trim()&&!P||P,children:P?`...`:`পাঠান`}):null]})]})]}):(0,z.jsxs)(`div`,{className:`flex flex-col items-center justify-center h-full gap-4 text-center p-8`,children:[(0,z.jsx)(`div`,{className:`w-24 h-24 rounded-full border-2 flex items-center justify-center mb-2 ${e===`dark`?`border-white`:`border-black`}`,children:(0,z.jsx)(ee,{size:48,strokeWidth:1})}),(0,z.jsxs)(`div`,{children:[(0,z.jsx)(`h2`,{className:`text-xl font-normal mb-1`,children:`আপনার মেসেজ`}),(0,z.jsx)(`button`,{className:`bg-[#006a4e] hover:bg-[#00523c] text-white px-4 py-1.5 rounded-lg text-sm font-semibold`,onClick:()=>l(`বাম পাশ থেকে চ্যাট শুরু করুন`),children:`মেসেজ পাঠান`})]})]})})]})})};export{V as default};