import{n as e,t}from"./ShareModal-myKpmWPo.js";import{A as n,D as r,E as i,F as a,I as o,L as s,M as c,P as l,S as ee,T as u,a as d,b as f,d as te,f as ne,g as re,i as ie,p as ae,r as oe,u as p,v as se,w as m,x as ce}from"./index-ih4mhM6H.js";import"./useGetSuggestedUsers-C_PpqYzG.js";import{t as h}from"./useFollowUser-BfmQokCv.js";var le=m(`music-2`,[[`circle`,{cx:`8`,cy:`18`,r:`4`,key:`1fc0mg`}],[`path`,{d:`M12 18V2l7 4`,key:`g04rme`}]]),g=m(`play`,[[`path`,{d:`M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z`,key:`10ikf1`}]]),_=m(`volume-2`,[[`path`,{d:`M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z`,key:`uqj9uw`}],[`path`,{d:`M16 9a5 5 0 0 1 0 6`,key:`1q6k2b`}],[`path`,{d:`M19.364 18.364a9 9 0 0 0 0-12.728`,key:`ijwkga`}]]),v=m(`volume-x`,[[`path`,{d:`M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z`,key:`uqj9uw`}],[`line`,{x1:`22`,x2:`16`,y1:`9`,y2:`15`,key:`1ewh16`}],[`line`,{x1:`16`,x2:`22`,y1:`9`,y2:`15`,key:`5ykzw1`}]]),ue=r(),y=s(o(),1),b=c(),de=n=>{let r=(0,ue.c)(132),{reel:a,showToast:o,theme:s,onUserClick:c,glassModal:l}=n,{setViewingReel:ee}=ae(),{user:d}=ne(),{mutate:p}=oe(),{mutate:m}=h(),[de,pe]=(0,y.useState)(!1),[x,me]=(0,y.useState)(!0),[S,he]=(0,y.useState)(!0),[ge,_e]=(0,y.useState)(!1),[ve,ye]=(0,y.useState)(!1),be=(0,y.useRef)(null),C=(0,y.useRef)(null),w=`${window.location.origin}/reels/${a.id}`,xe=a.hasLiked||!1,Se;r[0]!==xe||r[1]!==a.id||r[2]!==o||r[3]!==p||r[4]!==d?(Se=()=>{if(!d){o(`লাইক করতে লগ ইন করুন`);return}p({targetId:a.id,type:`reel`,userId:d.id,hasLiked:xe})},r[0]=xe,r[1]=a.id,r[2]=o,r[3]=p,r[4]=d,r[5]=Se):Se=r[5];let T=Se,Ce;r[6]!==m||r[7]!==a.user.isFollowing||r[8]!==a.user.username||r[9]!==a.userId||r[10]!==o||r[11]!==d?(Ce=()=>{if(!d){o(`ফলো করতে লগ ইন করুন`);return}a.userId&&m({targetUserId:a.userId,currentUserId:d.id,isFollowing:a.user.isFollowing||!1,targetUsername:a.user.username},{onSuccess:()=>o(`ফলো করা হয়েছে`),onError:()=>o(`ফলো করতে সমস্যা হয়েছে`)})},r[6]=m,r[7]=a.user.isFollowing,r[8]=a.user.username,r[9]=a.userId,r[10]=o,r[11]=d,r[12]=Ce):Ce=r[12];let we=Ce,Te;r[13]===S?Te=r[14]:(Te=()=>{C.current&&(S?(C.current.pause(),he(!1)):(C.current.play(),he(!0)))},r[13]=S,r[14]=Te);let Ee=Te,De,Oe;r[15]===Symbol.for(`react.memo_cache_sentinel`)?(De=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(C.current?.play().catch(fe),he(!0),me(!1)):(C.current?.pause(),he(!1),me(!0))},{threshold:.6});return be.current&&e.observe(be.current),()=>e.disconnect()},Oe=[],r[15]=De,r[16]=Oe):(De=r[15],Oe=r[16]),(0,y.useEffect)(De,Oe);let ke;r[17]===T?ke=r[18]:(ke=()=>{T(),pe(!0),setTimeout(()=>pe(!1),1e3)},r[17]=T,r[18]=ke);let Ae=ke,je,Me,Ne,Pe;r[19]===Symbol.for(`react.memo_cache_sentinel`)?(Me={opacity:0,scale:.95},Ne={opacity:1,scale:1},Pe={once:!0},je={duration:.5},r[19]=je,r[20]=Me,r[21]=Ne,r[22]=Pe):(je=r[19],Me=r[20],Ne=r[21],Pe=r[22]);let E;r[23]!==l||r[24]!==ge||r[25]!==w||r[26]!==o||r[27]!==s?(E=ge&&(0,b.jsx)(e,{onClose:()=>_e(!1),showToast:o,theme:s,glassModal:l,shareUrl:w}),r[23]=l,r[24]=ge,r[25]=w,r[26]=o,r[27]=s,r[28]=E):E=r[28];let D;r[29]!==l||r[30]!==ve||r[31]!==w||r[32]!==o||r[33]!==s?(D=ve&&(0,b.jsx)(t,{onClose:()=>ye(!1),theme:s,showToast:o,glassModal:l,shareUrl:w}),r[29]=l,r[30]=ve,r[31]=w,r[32]=o,r[33]=s,r[34]=D):D=r[34];let O;r[35]!==x||r[36]!==a.poster||r[37]!==a.src||r[38]!==Ee?(O=a.src?(0,b.jsx)(`video`,{ref:C,src:a.src,poster:a.poster,preload:`metadata`,className:`w-full h-full object-cover`,loop:!0,muted:x,onClick:Ee}):(0,b.jsx)(te,{src:a.src,width:400,className:`w-full h-full`,onClick:()=>me(!x),alt:`reel`}),r[35]=x,r[36]=a.poster,r[37]=a.src,r[38]=Ee,r[39]=O):O=r[39];let k;r[40]===S?k=r[41]:(k=!S&&(0,b.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,b.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,b.jsx)(g,{className:`text-white w-10 h-10 fill-white`})})}),r[40]=S,r[41]=k);let A;r[42]===x?A=r[43]:(A=(0,b.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),me(!x)},children:x?(0,b.jsx)(v,{className:`text-white w-5 h-5`}):(0,b.jsx)(_,{className:`text-white w-5 h-5`})}),r[42]=x,r[43]=A);let j;r[44]===de?j=r[45]:(j=de&&(0,b.jsx)(u.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,b.jsx)(f,{size:100,className:`text-white fill-white drop-shadow-lg`})}),r[44]=de,r[45]=j);let M;r[46]===j?M=r[47]:(M=(0,b.jsx)(i,{children:j}),r[46]=j,r[47]=M);let N;r[48]!==c||r[49]!==a.user?(N=()=>c(a.user),r[48]=c,r[49]=a.user,r[50]=N):N=r[50];let P;r[51]===a.user.avatar?P=r[52]:(P=(0,b.jsx)(`div`,{className:`w-8 h-8 rounded-full border border-white/50 overflow-hidden cursor-pointer`,children:(0,b.jsx)(te,{src:a.user.avatar,width:100,className:`w-full h-full`,alt:`reel user`})}),r[51]=a.user.avatar,r[52]=P);let F;r[53]===a.user.username?F=r[54]:(F=(0,b.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:a.user.username}),r[53]=a.user.username,r[54]=F);let I;r[55]===a.user.isVerified?I=r[56]:(I=a.user.isVerified&&(0,b.jsx)(ie,{}),r[55]=a.user.isVerified,r[56]=I);let Fe,Ie;r[57]===Symbol.for(`react.memo_cache_sentinel`)?(Fe={scale:1.05},Ie={scale:.95},r[57]=Fe,r[58]=Ie):(Fe=r[57],Ie=r[58]);let Le=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${a.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,L;r[59]===we?L=r[60]:(L=e=>{e.stopPropagation(),we()},r[59]=we,r[60]=L);let Re=a.user.isFollowing?`ফলো করছেন`:`ফলো`,R;r[61]!==Le||r[62]!==L||r[63]!==Re?(R=(0,b.jsx)(u.button,{whileHover:Fe,whileTap:Ie,className:Le,onClick:L,children:Re}),r[61]=Le,r[62]=L,r[63]=Re,r[64]=R):R=r[64];let z;r[65]!==N||r[66]!==P||r[67]!==F||r[68]!==I||r[69]!==R?(z=(0,b.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:N,children:[P,F,I,R]}),r[65]=N,r[66]=P,r[67]=F,r[68]=I,r[69]=R,r[70]=z):z=r[70];let ze;r[71]===Symbol.for(`react.memo_cache_sentinel`)?(ze=(0,b.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`আরও`}),r[71]=ze):ze=r[71];let B;r[72]===a.caption?B=r[73]:(B=(0,b.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[a.caption,` `,ze]}),r[72]=a.caption,r[73]=B);let Be;r[74]===Symbol.for(`react.memo_cache_sentinel`)?(Be=(0,b.jsx)(le,{size:12}),r[74]=Be):Be=r[74];let V;r[75]===a.audio?V=r[76]:(V=(0,b.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[Be,(0,b.jsx)(`div`,{className:`truncate w-40`,children:a.audio})]}),r[75]=a.audio,r[76]=V);let H;r[77]!==z||r[78]!==B||r[79]!==V?(H=(0,b.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[z,B,V]}),r[77]=z,r[78]=B,r[79]=V,r[80]=H):H=r[80];let Ve,He;r[81]===Symbol.for(`react.memo_cache_sentinel`)?(Ve={scale:1.1},He={scale:.9},r[81]=Ve,r[82]=He):(Ve=r[81],He=r[82]);let Ue=`cursor-pointer transition-colors ${xe?`fill-[#f42a41] text-[#f42a41]`:``}`,U;r[83]!==T||r[84]!==Ue?(U=(0,b.jsx)(u.div,{whileHover:Ve,whileTap:He,children:(0,b.jsx)(f,{size:28,strokeWidth:1.5,className:Ue,onClick:T})}),r[83]=T,r[84]=Ue,r[85]=U):U=r[85];let W;r[86]===a.likes?W=r[87]:(W=(0,b.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:a.likes}),r[86]=a.likes,r[87]=W);let G;r[88]!==U||r[89]!==W?(G=(0,b.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[U,W]}),r[88]=U,r[89]=W,r[90]=G):G=r[90];let We,Ge;r[91]===Symbol.for(`react.memo_cache_sentinel`)?(We={scale:1.1},Ge={scale:.9},r[91]=We,r[92]=Ge):(We=r[91],Ge=r[92]);let K;r[93]!==a||r[94]!==ee?(K=(0,b.jsx)(u.div,{whileHover:We,whileTap:Ge,children:(0,b.jsx)(se,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>ee(a)})}),r[93]=a,r[94]=ee,r[95]=K):K=r[95];let q;r[96]===a.comments?q=r[97]:(q=(0,b.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:a.comments}),r[96]=a.comments,r[97]=q);let J;r[98]!==K||r[99]!==q?(J=(0,b.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[K,q]}),r[98]=K,r[99]=q,r[100]=J):J=r[100];let Ke,qe;r[101]===Symbol.for(`react.memo_cache_sentinel`)?(Ke={scale:1.1},qe={scale:.9},r[101]=Ke,r[102]=qe):(Ke=r[101],qe=r[102]);let Je;r[103]===Symbol.for(`react.memo_cache_sentinel`)?(Je=(0,b.jsx)(u.div,{whileHover:Ke,whileTap:qe,children:(0,b.jsx)(re,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ye(!0)})}),r[103]=Je):Je=r[103];let Ye,Xe;r[104]===Symbol.for(`react.memo_cache_sentinel`)?(Ye={scale:1.1},Xe={scale:.9},r[104]=Ye,r[105]=Xe):(Ye=r[104],Xe=r[105]);let Ze;r[106]===Symbol.for(`react.memo_cache_sentinel`)?(Ze=(0,b.jsx)(u.div,{whileHover:Ye,whileTap:Xe,children:(0,b.jsx)(ce,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>_e(!0)})}),r[106]=Ze):Ze=r[106];let Qe;r[107]===Symbol.for(`react.memo_cache_sentinel`)?(Qe={scale:1.1},r[107]=Qe):Qe=r[107];let Y;r[108]!==c||r[109]!==a.user?(Y=()=>c(a.user),r[108]=c,r[109]=a.user,r[110]=Y):Y=r[110];let X;r[111]===a.user.avatar?X=r[112]:(X=(0,b.jsx)(te,{src:a.user.avatar,width:100,className:`w-full h-full`,alt:`user thumb`}),r[111]=a.user.avatar,r[112]=X);let Z;r[113]!==Y||r[114]!==X?(Z=(0,b.jsx)(u.div,{whileHover:Qe,className:`w-6 h-6 border-2 border-white rounded-md overflow-hidden mt-2 cursor-pointer`,onClick:Y,children:X}),r[113]=Y,r[114]=X,r[115]=Z):Z=r[115];let Q;r[116]!==G||r[117]!==J||r[118]!==Z?(Q=(0,b.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[G,J,Je,Ze,Z]}),r[116]=G,r[117]=J,r[118]=Z,r[119]=Q):Q=r[119];let $;r[120]!==Ae||r[121]!==O||r[122]!==k||r[123]!==A||r[124]!==M||r[125]!==H||r[126]!==Q?($=(0,b.jsxs)(`div`,{ref:be,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-zinc-900 md:rounded-lg overflow-hidden border-zinc-800 md:border group shadow-2xl`,onDoubleClick:Ae,children:[O,k,A,M,H,Q]}),r[120]=Ae,r[121]=O,r[122]=k,r[123]=A,r[124]=M,r[125]=H,r[126]=Q,r[127]=$):$=r[127];let $e;return r[128]!==E||r[129]!==D||r[130]!==$?($e=(0,b.jsxs)(u.div,{initial:Me,whileInView:Ne,viewport:Pe,transition:je,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[E,D,$]}),r[128]=E,r[129]=D,r[130]=$,r[131]=$e):$e=r[131],$e};function fe(){}var pe=r();const x=e=>[`reel`,e],me=(e,t)=>{let r=(0,pe.c)(9),i=e||``,a;r[0]===i?a=r[1]:(a=x(i),r[0]=i,r[1]=a);let o=!!e,s;r[2]!==t||r[3]!==e?(s=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await p.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await p.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await p.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},r[2]=t,r[3]=e,r[4]=s):s=r[4];let c;return r[5]!==a||r[6]!==o||r[7]!==s?(c={queryKey:a,enabled:o,queryFn:s},r[5]=a,r[6]=o,r[7]=s,r[8]=c):c=r[8],n(c)};var S=r(),he=()=>{let e=(0,S.c)(32),{theme:t,showToast:n}=ae(),{user:r}=ne(),i=l(),{id:o}=a(),s=t===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,{data:c,isLoading:u}=me(o,r?.id),{data:f,isLoading:te}=d(r?.id),re;e[0]===f?re=e[1]:(re=f===void 0?[]:f,e[0]=f,e[1]=re);let ie=re,oe;e[2]===i?oe=e[3]:(oe=e=>{i(`/profile/${e.username}`)},e[2]=i,e[3]=oe);let p=oe,se=o?u:te,m;e[4]!==ie||e[5]!==o||e[6]!==c?(m=o?c?[c]:[]:ie,e[4]=ie,e[5]=o,e[6]=c,e[7]=m):m=e[7];let ce=m;if(se){let t;return e[8]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,b.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:`Loading reel...`}),e[8]=t):t=e[8],t}if(ce.length===0){let t=o?`Reel not found`:`No reels yet`,n;return e[9]===t?n=e[10]:(n=(0,b.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:t}),e[9]=t,e[10]=n),n}let h;e[11]===i?h=e[12]:(h=()=>i(`/`),e[11]=i,e[12]=h);let le;e[13]===Symbol.for(`react.memo_cache_sentinel`)?(le=(0,b.jsx)(ee,{size:28}),e[13]=le):le=e[13];let g;e[14]===h?g=e[15]:(g=(0,b.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:h,children:le}),e[14]=h,e[15]=g);let _;if(e[16]!==ce||e[17]!==s||e[18]!==p||e[19]!==n||e[20]!==t){let r;e[22]!==s||e[23]!==p||e[24]!==n||e[25]!==t?(r=e=>(0,b.jsx)(de,{reel:e,showToast:n,theme:t,onUserClick:p,glassModal:s},e.id),e[22]=s,e[23]=p,e[24]=n,e[25]=t,e[26]=r):r=e[26],_=ce.map(r),e[16]=ce,e[17]=s,e[18]=p,e[19]=n,e[20]=t,e[21]=_}else _=e[21];let v;e[27]===_?v=e[28]:(v=(0,b.jsx)(`div`,{className:`w-full md:w-[400px] h-full`,children:_}),e[27]=_,e[28]=v);let ue;return e[29]!==g||e[30]!==v?(ue=(0,b.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[g,v]}),e[29]=g,e[30]=v,e[31]=ue):ue=e[31],ue};export{he as default};