import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{$t as t,G as n,Gt as r,I as i,Rt as a,Z as o,m as s,rn as c,xt as l}from"./vendor-CYhgnaJV.js";import{F as u,I as d,M as f,N as p,S as ee,b as te,j as m,k as h,x as g,y as _}from"./index-ywtYYkZ-.js";import{t as ne}from"./useGetSuggestedUsers-DQP3QTN5.js";var v=a(),y=e(c(),1),b=r(),x=e=>{let t=(0,v.c)(32),{onClose:n,showToast:r,shareUrl:i,isOwner:a,onEdit:o}=e,s;t[0]===n?s=t[1]:(s=e=>!e&&n(),t[0]=n,t[1]=s);let c;t[2]===Symbol.for(`react.memo_cache_sentinel`)?(c=(0,b.jsx)(ee,{className:`sr-only`,children:`Post Options`}),t[2]=c):c=t[2];let l;t[3]!==a||t[4]!==n||t[5]!==o?(l=a&&(0,b.jsx)(`button`,{className:`py-3.5 border-b border-border hover:bg-muted transition-colors`,onClick:()=>{o?.(),n()},children:`Edit`}),t[3]=a,t[4]=n,t[5]=o,t[6]=l):l=t[6];let u;t[7]!==n||t[8]!==r?(u=(0,b.jsx)(`button`,{className:`py-3.5 text-[#f42a41] border-b border-border hover:bg-muted transition-colors`,onClick:()=>{r(`Reported`),n()},children:`Report`}),t[7]=n,t[8]=r,t[9]=u):u=t[9];let d;t[10]!==n||t[11]!==r?(d=(0,b.jsx)(`button`,{className:`py-3.5 text-[#f42a41] border-b border-border hover:bg-muted transition-colors`,onClick:()=>{r(`Unfollowed`),n()},children:`Unfollow`}),t[10]=n,t[11]=r,t[12]=d):d=t[12];let f;t[13]!==n||t[14]!==r?(f=(0,b.jsx)(`button`,{className:`py-3.5 border-b border-border hover:bg-muted transition-colors`,onClick:()=>{r(`Added to favorites`),n()},children:`Add to favorites`}),t[13]=n,t[14]=r,t[15]=f):f=t[15];let p;t[16]!==n||t[17]!==i||t[18]!==r?(p=(0,b.jsx)(`button`,{className:`py-3.5 border-b border-border hover:bg-muted transition-colors`,onClick:()=>{let e=i||window.location.href;navigator.clipboard.writeText(e),r(`Link copied`),n()},children:`Copy link`}),t[16]=n,t[17]=i,t[18]=r,t[19]=p):p=t[19];let m;t[20]===n?m=t[21]:(m=(0,b.jsx)(`button`,{className:`py-3.5 hover:bg-muted transition-colors`,onClick:n,children:`Cancel`}),t[20]=n,t[21]=m);let h;t[22]!==l||t[23]!==u||t[24]!==d||t[25]!==f||t[26]!==p||t[27]!==m?(h=(0,b.jsxs)(te,{className:`max-w-[300px] p-0 overflow-hidden border-none rounded-xl`,children:[c,(0,b.jsxs)(`div`,{className:`flex flex-col text-sm font-semibold bg-background`,children:[l,u,d,f,p,m]})]}),t[22]=l,t[23]=u,t[24]=d,t[25]=f,t[26]=p,t[27]=m,t[28]=h):h=t[28];let g;return t[29]!==s||t[30]!==h?(g=(0,b.jsx)(_,{open:!0,onOpenChange:s,children:h}),t[29]=s,t[30]=h,t[31]=g):g=t[31],g},re=a(),S=e=>{let r=(0,re.c)(54),{onClose:a,shareUrl:s}=e,{showToast:c}=d(),v=t(),{user:x}=u(),{data:S}=ne(x?.id),C;r[0]===S?C=r[1]:(C=S===void 0?[]:S,r[0]=S,r[1]=C);let w=C,[T,ae]=(0,y.useState)(``),E;r[2]===Symbol.for(`react.memo_cache_sentinel`)?(E=[],r[2]=E):E=r[2];let[D,oe]=(0,y.useState)(E),[O,k]=(0,y.useState)(!1),A,j;r[3]===T?(A=r[4],j=r[5]):(A=()=>{let e=setTimeout(async()=>{if(T.trim().length>0){k(!0);let{data:e}=await h.from(`profiles`).select(`id, username, full_name, avatar_url, is_verified`).ilike(`username`,`%${T}%`).limit(10);e&&oe(e.map(ie)),k(!1)}else oe([])},300);return()=>clearTimeout(e)},j=[T],r[3]=T,r[4]=A,r[5]=j),(0,y.useEffect)(A,j);let M;r[6]!==T||r[7]!==D||r[8]!==w?(M=T.trim()?D:w.slice(0,8),r[6]=T,r[7]=D,r[8]=w,r[9]=M):M=r[9];let N=M,P;r[10]===a?P=r[11]:(P=e=>!e&&a(),r[10]=a,r[11]=P);let F;r[12]===Symbol.for(`react.memo_cache_sentinel`)?(F=(0,b.jsx)(g,{className:`p-3 border-b text-center relative`,children:(0,b.jsx)(ee,{className:`text-center font-bold`,children:`Share`})}),r[12]=F):F=r[12];let I;r[13]===Symbol.for(`react.memo_cache_sentinel`)?(I=(0,b.jsx)(o,{size:18,className:`text-muted-foreground`}),r[13]=I):I=r[13];let L;r[14]===Symbol.for(`react.memo_cache_sentinel`)?(L=e=>ae(e.target.value),r[14]=L):L=r[14];let R,z;r[15]===T?(R=r[16],z=r[17]):(R=(0,b.jsx)(`input`,{type:`text`,placeholder:`Search`,value:T,onChange:L,className:`bg-transparent border-none outline-none text-sm w-full`}),z=T&&(0,b.jsx)(i,{size:18,className:`cursor-pointer text-muted-foreground`,onClick:()=>ae(``)}),r[15]=T,r[16]=R,r[17]=z);let B;r[18]!==R||r[19]!==z?(B=(0,b.jsx)(`div`,{className:`p-4 border-b border-border`,children:(0,b.jsxs)(`div`,{className:`flex items-center gap-2 px-3 py-2 rounded-lg bg-muted`,children:[I,R,z]})}),r[18]=R,r[19]=z,r[20]=B):B=r[20];let V;r[21]!==O||r[22]!==v||r[23]!==a||r[24]!==c||r[25]!==N?(V=O?(0,b.jsx)(`div`,{className:`p-4 text-center text-sm text-muted-foreground`,children:`Searching...`}):N.length===0?(0,b.jsx)(`div`,{className:`p-4 text-center text-sm text-muted-foreground`,children:`No results found`}):N.map((e,t)=>(0,b.jsxs)(`div`,{className:`flex items-center justify-between p-2 rounded-lg hover:bg-muted cursor-pointer transition-colors`,children:[(0,b.jsxs)(`div`,{className:`flex items-center gap-3 flex-grow`,onClick:()=>{a(),v(`/profile/${e.username}`)},children:[(0,b.jsxs)(m,{className:`w-10 h-10`,children:[(0,b.jsx)(p,{src:e.avatar}),(0,b.jsx)(f,{children:e.username?.[0]?.toUpperCase()||`?`})]}),(0,b.jsxs)(`div`,{className:`flex flex-col`,children:[(0,b.jsx)(`span`,{className:`text-sm font-semibold`,children:e.username}),(0,b.jsx)(`span`,{className:`text-xs opacity-70`,children:e.name||e.username})]})]}),(0,b.jsx)(`button`,{className:`px-4 py-1.5 rounded-lg text-sm font-semibold bg-[#006a4e] text-white hover:bg-[#00523c] transition-colors`,onClick:t=>{t.stopPropagation(),c(`Sent to ${e.username}`),a()},children:`Send`})]},t)),r[21]=O,r[22]=v,r[23]=a,r[24]=c,r[25]=N,r[26]=V):V=r[26];let H;r[27]===V?H=r[28]:(H=(0,b.jsx)(`div`,{className:`h-64 overflow-y-auto p-2`,children:V}),r[27]=V,r[28]=H);let U;r[29]!==a||r[30]!==s||r[31]!==c?(U=()=>{let e=s||window.location.href;navigator.clipboard.writeText(e),c(`Link copied`),a()},r[29]=a,r[30]=s,r[31]=c,r[32]=U):U=r[32];let W,G;r[33]===Symbol.for(`react.memo_cache_sentinel`)?(W=(0,b.jsx)(`div`,{className:`w-12 h-12 rounded-full border border-border flex items-center justify-center bg-background`,children:(0,b.jsx)(l,{size:20})}),G=(0,b.jsx)(`span`,{className:`text-xs`,children:`Copy Link`}),r[33]=W,r[34]=G):(W=r[33],G=r[34]);let K;r[35]===U?K=r[36]:(K=(0,b.jsxs)(`div`,{className:`flex flex-col items-center gap-1 cursor-pointer min-w-[60px]`,onClick:U,children:[W,G]}),r[35]=U,r[36]=K);let q;r[37]!==a||r[38]!==c?(q=()=>{c(`Added to your story`),a()},r[37]=a,r[38]=c,r[39]=q):q=r[39];let J,Y;r[40]===Symbol.for(`react.memo_cache_sentinel`)?(J=(0,b.jsx)(`div`,{className:`w-12 h-12 rounded-full border border-border flex items-center justify-center bg-background`,children:(0,b.jsx)(n,{size:20})}),Y=(0,b.jsx)(`span`,{className:`text-xs`,children:`Add to story`}),r[40]=J,r[41]=Y):(J=r[40],Y=r[41]);let X;r[42]===q?X=r[43]:(X=(0,b.jsxs)(`div`,{className:`flex flex-col items-center gap-1 cursor-pointer min-w-[60px]`,onClick:q,children:[J,Y]}),r[42]=q,r[43]=X);let Z;r[44]!==K||r[45]!==X?(Z=(0,b.jsxs)(`div`,{className:`p-4 border-t border-border flex gap-4 overflow-x-auto`,children:[K,X]}),r[44]=K,r[45]=X,r[46]=Z):Z=r[46];let Q;r[47]!==B||r[48]!==H||r[49]!==Z?(Q=(0,b.jsx)(te,{className:`max-w-md p-0 overflow-hidden border-none rounded-xl`,children:(0,b.jsxs)(`div`,{className:`bg-background text-foreground`,children:[F,B,H,Z]})}),r[47]=B,r[48]=H,r[49]=Z,r[50]=Q):Q=r[50];let $;return r[51]!==Q||r[52]!==P?($=(0,b.jsx)(_,{open:!0,onOpenChange:P,children:Q}),r[51]=Q,r[52]=P,r[53]=$):$=r[53],$};function ie(e){return{id:e.id,username:e.username,name:e.full_name||e.username,avatar:e.avatar_url||``,isVerified:e.is_verified||!1}}var C=a();const w=(e,t,n)=>{let r=(0,C.c)(10),i=n===void 0?3e3:n,a;r[0]===Symbol.for(`react.memo_cache_sentinel`)?(a={threshold:.6,triggerOnce:!0},r[0]=a):a=r[0];let{ref:o,inView:c}=s(a),[l,u]=(0,y.useState)(!1),d,f;r[1]!==l||r[2]!==e||r[3]!==c||r[4]!==i||r[5]!==t?(d=()=>{let n;return c&&!l&&(n=setTimeout(async()=>{try{await h.rpc(`increment_view_count`,{target_id:e,type:t}),u(!0)}catch(e){let t=e;console.error(`Failed to track view`,t)}},i)),()=>clearTimeout(n)},f=[c,l,e,t,i],r[1]=l,r[2]=e,r[3]=c,r[4]=i,r[5]=t,r[6]=d,r[7]=f):(d=r[6],f=r[7]),(0,y.useEffect)(d,f);let p;return r[8]===o?p=r[9]:(p={ref:o},r[8]=o,r[9]=p),p};export{S as n,x as r,w as t};