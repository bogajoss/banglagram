import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{At as t,Ft as n,Lt as r,Pt as i,Rt as a,Yt as o,ft as s,jt as c,kt as l,mt as ee,nt as te,q as ne,wt as re}from"./vendor-B3WL4crc.js";import{R as u,nn as d,rn as f}from"./libs-DPUVS-gH.js";import{_ as ie,a as ae,f as p,i as oe,m,n as h,r as se,v as ce,y as le}from"./index-BgMfxo34.js";import{n as ue,t as de}from"./ShareModal-mg-DVRH4.js";var g=c(),_=e(f(),1);const v=e=>[`post`,e],y=(e,t)=>{let r=(0,g.c)(9),i=e||``,a;r[0]===i?a=r[1]:(a=v(i),r[0]=i,r[1]=a);let o=!!e,s;r[2]!==t||r[3]!==e?(s=async()=>{if(!e)throw Error(`Post ID required`);let{data:n,error:r}=await m.from(`posts`).select(`
          id,
          created_at,
          caption,
          image_url,
          user_id,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await m.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`post_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await m.from(`saves`).select(`*`,{count:`exact`,head:!0}).eq(`post_id`,e).eq(`user_id`,t);o=!!r&&r>0}return{id:i.id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1},content:{type:`image`,src:i.image_url},likes:i.likes[0]?.count||0,caption:i.caption||``,comments:i.comments[0]?.count||0,time:(0,_.default)(i.created_at).fromNow(),hasLiked:a,hasSaved:o}},r[2]=t,r[3]=e,r[4]=s):s=r[4];let c;return r[5]!==a||r[6]!==o||r[7]!==s?(c={queryKey:a,enabled:o,queryFn:s},r[5]=a,r[6]=o,r[7]=s,r[8]=c):c=r[8],n(c)};var b=c();const fe=()=>{let e=(0,b.c)(2),t=r(),n;return e[0]===t?n=e[1]:(n={mutationFn:x,onSuccess:(e,n)=>{t.invalidateQueries({queryKey:p}),t.invalidateQueries({queryKey:v(n.postId)}),t.invalidateQueries({queryKey:[`profile`]})}},e[0]=t,e[1]=n),i(n)};async function x(e){let{postId:t,caption:n,location:r}=e,{data:i,error:a}=await m.from(`posts`).update({caption:n,location:r}).eq(`id`,t).select().single();if(a)throw a;return i}var pe=c(),S=e(o(),1),C=a(),me=e=>{let t=(0,pe.c)(51),{post:n,onClose:r,theme:i,glassModal:a}=e,{showToast:o}=le(),[s,c]=(0,S.useState)(n.caption||``),{mutate:ee,isPending:te}=fe(),ne;t[0]!==s||t[1]!==r||t[2]!==n.id||t[3]!==o||t[4]!==ee?(ne=()=>{if(!s.trim()){o(`ক্যাপশন খালি রাখা যাবে না`);return}ee({postId:n.id,caption:s},{onSuccess:()=>{o(`পোস্ট আপডেট করা হয়েছে`),r()},onError:()=>o(`আপডেট করতে সমস্যা হয়েছে`)})},t[0]=s,t[1]=r,t[2]=n.id,t[3]=o,t[4]=ee,t[5]=ne):ne=t[5];let re=ne,u,d,f;t[6]===Symbol.for(`react.memo_cache_sentinel`)?(u={opacity:0},d={opacity:1},f={opacity:0},t[6]=u,t[7]=d,t[8]=f):(u=t[6],d=t[7],f=t[8]);let ae,p,oe;t[9]===Symbol.for(`react.memo_cache_sentinel`)?(ae={scale:.95,opacity:0},p={scale:1,opacity:1},oe={scale:.95,opacity:0},t[9]=ae,t[10]=p,t[11]=oe):(ae=t[9],p=t[10],oe=t[11]);let m=`w-full max-w-2xl rounded-xl overflow-hidden shadow-2xl flex flex-col md:flex-row ${a} ${i===`dark`?`text-white`:`text-black`}`,h;t[12]!==n.content.poster||t[13]!==n.content.src||t[14]!==n.content.type?(h=(0,C.jsx)(`div`,{className:`md:w-1/2 bg-black flex items-center justify-center relative aspect-square md:aspect-auto`,children:n.content.type===`video`?(0,C.jsx)(`video`,{src:n.content.src,className:`max-h-full max-w-full`}):(0,C.jsx)(ie,{src:n.content.src||n.content.poster,className:`max-h-full max-w-full`,imgClassName:`object-contain`,alt:`preview`})}),t[12]=n.content.poster,t[13]=n.content.src,t[14]=n.content.type,t[15]=h):h=t[15];let se=`md:w-1/2 flex flex-col ${i===`dark`?`bg-zinc-900`:`bg-white`}`,ce=`p-3 border-b flex justify-between items-center ${i===`dark`?`border-zinc-800`:`border-zinc-200`}`,ue;t[16]===Symbol.for(`react.memo_cache_sentinel`)?(ue=(0,C.jsx)(`span`,{className:`font-semibold text-sm`,children:`এডিট ইনফো`}),t[16]=ue):ue=t[16];let de=te?`সেভ হচ্ছে...`:`সম্পন্ন`,g;t[17]!==re||t[18]!==te||t[19]!==de?(g=(0,C.jsx)(`button`,{onClick:re,disabled:te,className:`text-[#0095f6] font-bold text-sm hover:text-white disabled:opacity-50`,children:de}),t[17]=re,t[18]=te,t[19]=de,t[20]=g):g=t[20];let _;t[21]!==ce||t[22]!==g?(_=(0,C.jsxs)(`div`,{className:ce,children:[ue,g]}),t[21]=ce,t[22]=g,t[23]=_):_=t[23];let v;t[24]!==n.user.avatar||t[25]!==n.user.username?(v=(0,C.jsx)(`div`,{className:`w-8 h-8 rounded-full overflow-hidden`,children:(0,C.jsx)(ie,{src:n.user.avatar,className:`w-full h-full`,alt:n.user.username})}),t[24]=n.user.avatar,t[25]=n.user.username,t[26]=v):v=t[26];let y;t[27]===n.user.username?y=t[28]:(y=(0,C.jsx)(`span`,{className:`font-semibold text-sm`,children:n.user.username}),t[27]=n.user.username,t[28]=y);let b;t[29]!==v||t[30]!==y?(b=(0,C.jsxs)(`div`,{className:`p-4 flex items-center gap-3`,children:[v,y]}),t[29]=v,t[30]=y,t[31]=b):b=t[31];let x=`flex-grow p-4 bg-transparent outline-none resize-none text-sm ${i===`dark`?`placeholder-zinc-500`:`placeholder-zinc-400`}`,me;t[32]===Symbol.for(`react.memo_cache_sentinel`)?(me=e=>c(e.target.value),t[32]=me):me=t[32];let w;t[33]!==s||t[34]!==x?(w=(0,C.jsx)(`textarea`,{className:x,placeholder:`ক্যাপশন লিখুন...`,value:s,onChange:me,rows:6}),t[33]=s,t[34]=x,t[35]=w):w=t[35];let T;t[36]===r?T=t[37]:(T=(0,C.jsx)(`div`,{className:`p-4 flex justify-end`,children:(0,C.jsx)(`button`,{onClick:r,className:`text-sm font-semibold hover:opacity-70`,children:`বাতিল করুন`})}),t[36]=r,t[37]=T);let E;t[38]!==se||t[39]!==_||t[40]!==b||t[41]!==w||t[42]!==T?(E=(0,C.jsxs)(`div`,{className:se,children:[_,b,w,T]}),t[38]=se,t[39]=_,t[40]=b,t[41]=w,t[42]=T,t[43]=E):E=t[43];let D;t[44]!==E||t[45]!==m||t[46]!==h?(D=(0,C.jsxs)(l.div,{initial:ae,animate:p,exit:oe,className:m,onClick:he,children:[h,E]}),t[44]=E,t[45]=m,t[46]=h,t[47]=D):D=t[47];let O;return t[48]!==r||t[49]!==D?(O=(0,C.jsx)(l.div,{initial:u,animate:d,exit:f,className:`fixed inset-0 z-[110] bg-black/60 flex items-center justify-center p-4`,onClick:r,children:D}),t[48]=r,t[49]=D,t[50]=O):O=t[50],O};function he(e){return e.stopPropagation()}var w=c(),T=e(f(),1),E=e(d(),1);u(),T.default.extend(E.default),T.default.locale(`bn`);var D=(0,S.memo)(e=>{let n=(0,w.c)(153),{post:r,isSaved:i,onToggleSave:a,onUserClick:o,onPostClick:c}=e,{theme:u,showToast:d}=le(),{user:f}=ce(),{mutate:p}=oe(),{mutate:m,isPending:g}=se(),[_,v]=(0,S.useState)(!1),[y,b]=(0,S.useState)(``),[fe,x]=(0,S.useState)(!1),[pe,he]=(0,S.useState)(!1),[E,D]=(0,S.useState)(!1),O=r.hasLiked||!1,k=`${window.location.origin}/post/${r.id}`,ge=f?.id===r.user.id,_e;n[0]!==O||n[1]!==r.id||n[2]!==d||n[3]!==p||n[4]!==f?(_e=()=>{if(!f){d(`লাইক করতে লগ ইন করুন`);return}p({targetId:String(r.id),type:`post`,userId:f.id,hasLiked:O})},n[0]=O,n[1]=r.id,n[2]=d,n[3]=p,n[4]=f,n[5]=_e):_e=n[5];let A=_e,ve;n[6]===A?ve=n[7]:(ve=()=>{A(),v(!0),setTimeout(()=>v(!1),1e3)},n[6]=A,n[7]=ve);let ye=ve,be;n[8]!==m||n[9]!==y||n[10]!==r.id||n[11]!==d||n[12]!==f?(be=e=>{e.preventDefault(),!(!y.trim()||!f)&&m({targetId:String(r.id),type:`post`,text:y,userId:f.id},{onSuccess:()=>{d(`কমেন্ট যোগ করা হয়েছে`),b(``)},onError:()=>d(`কমেন্ট যোগ করতে সমস্যা হয়েছে`)})},n[8]=m,n[9]=y,n[10]=r.id,n[11]=d,n[12]=f,n[13]=be):be=n[13];let xe=be,Se=u===`dark`?`border-zinc-800`:`border-zinc-200`,j=u===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,Ce,we,Te,Ee;n[14]===Symbol.for(`react.memo_cache_sentinel`)?(Ce={opacity:0,y:20},we={opacity:1,y:0},Te={once:!0,margin:`-50px`},Ee={duration:.4},n[14]=Ce,n[15]=we,n[16]=Te,n[17]=Ee):(Ce=n[14],we=n[15],Te=n[16],Ee=n[17]);let De=`border-b pb-5 mb-4 ${Se}`,M;n[18]!==j||n[19]!==fe||n[20]!==ge||n[21]!==k||n[22]!==d||n[23]!==u?(M=fe&&(0,C.jsx)(ue,{onClose:()=>x(!1),showToast:d,theme:u,glassModal:j,shareUrl:k,isOwner:ge,onEdit:()=>D(!0)}),n[18]=j,n[19]=fe,n[20]=ge,n[21]=k,n[22]=d,n[23]=u,n[24]=M):M=n[24];let N;n[25]!==j||n[26]!==pe||n[27]!==k||n[28]!==d||n[29]!==u?(N=pe&&(0,C.jsx)(de,{onClose:()=>he(!1),theme:u,showToast:d,glassModal:j,shareUrl:k}),n[25]=j,n[26]=pe,n[27]=k,n[28]=d,n[29]=u,n[30]=N):N=n[30];let P;n[31]!==j||n[32]!==E||n[33]!==r||n[34]!==u?(P=E&&(0,C.jsx)(me,{post:r,onClose:()=>D(!1),theme:u,glassModal:j}),n[31]=j,n[32]=E,n[33]=r,n[34]=u,n[35]=P):P=n[35];let F;n[36]!==o||n[37]!==r.user?(F=()=>o(r.user),n[36]=o,n[37]=r.user,n[38]=F):F=n[38];let Oe=`w-8 h-8 rounded-full overflow-hidden ${u===`dark`?`bg-zinc-800`:`bg-gray-200`} group-hover:scale-105 transition-transform`,I;n[39]!==r.user.avatar||n[40]!==r.user.username?(I=(0,C.jsx)(ie,{src:r.user.avatar,width:100,className:`w-full h-full`,alt:r.user.username}),n[39]=r.user.avatar,n[40]=r.user.username,n[41]=I):I=n[41];let L;n[42]!==Oe||n[43]!==I?(L=(0,C.jsx)(`div`,{className:Oe,children:I}),n[42]=Oe,n[43]=I,n[44]=L):L=n[44];let R;n[45]===r.user.username?R=n[46]:(R=(0,C.jsx)(`span`,{className:`group-hover:opacity-70 transition-opacity`,children:r.user.username}),n[45]=r.user.username,n[46]=R);let z;n[47]===r.user.isVerified?z=n[48]:(z=r.user.isVerified&&(0,C.jsx)(ae,{}),n[47]=r.user.isVerified,n[48]=z);let ke=`${u===`dark`?`text-zinc-500`:`text-zinc-400`} font-normal`,Ae;n[49]!==r.createdAt||n[50]!==r.time?(Ae=r.createdAt?(0,T.default)(r.createdAt).fromNow(!0):r.time,n[49]=r.createdAt,n[50]=r.time,n[51]=Ae):Ae=n[51];let B;n[52]!==ke||n[53]!==Ae?(B=(0,C.jsxs)(`span`,{className:ke,children:[`• `,Ae]}),n[52]=ke,n[53]=Ae,n[54]=B):B=n[54];let V;n[55]!==R||n[56]!==z||n[57]!==B?(V=(0,C.jsxs)(`div`,{className:`flex items-center gap-1 text-sm font-semibold`,children:[R,z,B]}),n[55]=R,n[56]=z,n[57]=B,n[58]=V):V=n[58];let H;n[59]!==F||n[60]!==L||n[61]!==V?(H=(0,C.jsxs)(`div`,{className:`flex items-center gap-2 cursor-pointer group`,onClick:F,children:[L,V]}),n[59]=F,n[60]=L,n[61]=V,n[62]=H):H=n[62];let je,Me;n[63]===Symbol.for(`react.memo_cache_sentinel`)?(je={scale:1.1},Me={scale:.9},n[63]=je,n[64]=Me):(je=n[63],Me=n[64]);let Ne;n[65]===Symbol.for(`react.memo_cache_sentinel`)?(Ne=(0,C.jsx)(l.div,{whileHover:je,whileTap:Me,children:(0,C.jsx)(ee,{size:20,className:`cursor-pointer hover:opacity-70`,onClick:()=>x(!0)})}),n[65]=Ne):Ne=n[65];let U;n[66]===H?U=n[67]:(U=(0,C.jsxs)(`div`,{className:`flex items-center justify-between mb-3 px-3 md:px-0`,children:[H,Ne]}),n[66]=H,n[67]=U);let Pe=`w-full ${u===`dark`?`bg-zinc-900`:`bg-gray-100`} md:rounded-[4px] md:border ${Se} overflow-hidden mb-3 aspect-square md:aspect-auto relative cursor-pointer`,Fe=r.content.src||r.content.poster,W;n[68]===Fe?W=n[69]:(W=(0,C.jsx)(ie,{src:Fe,width:800,className:`w-full h-full`,alt:`Post content`}),n[68]=Fe,n[69]=W);let G;n[70]===_?G=n[71]:(G=_&&(0,C.jsx)(l.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,C.jsx)(s,{size:100,className:`text-white fill-white drop-shadow-lg`})}),n[70]=_,n[71]=G);let K;n[72]===G?K=n[73]:(K=(0,C.jsx)(t,{children:G}),n[72]=G,n[73]=K);let q;n[74]!==ye||n[75]!==Pe||n[76]!==W||n[77]!==K?(q=(0,C.jsxs)(`div`,{className:Pe,onDoubleClick:ye,children:[W,K]}),n[74]=ye,n[75]=Pe,n[76]=W,n[77]=K,n[78]=q):q=n[78];let Ie,Le;n[79]===Symbol.for(`react.memo_cache_sentinel`)?(Ie={scale:1.1},Le={scale:.9},n[79]=Ie,n[80]=Le):(Ie=n[79],Le=n[80]);let Re=`cursor-pointer transition-colors ${O?`fill-[#f42a41] text-[#f42a41]`:``}`,J;n[81]!==A||n[82]!==Re?(J=(0,C.jsx)(l.div,{whileHover:Ie,whileTap:Le,children:(0,C.jsx)(s,{size:24,className:Re,onClick:A})}),n[81]=A,n[82]=Re,n[83]=J):J=n[83];let ze,Be;n[84]===Symbol.for(`react.memo_cache_sentinel`)?(ze={scale:1.1},Be={scale:.9},n[84]=ze,n[85]=Be):(ze=n[84],Be=n[85]);let Y;n[86]!==c||n[87]!==r?(Y=(0,C.jsx)(l.div,{whileHover:ze,whileTap:Be,children:(0,C.jsx)(te,{size:24,className:`-scale-x-100 cursor-pointer hover:opacity-70 transition-opacity`,onClick:()=>c(r)})}),n[86]=c,n[87]=r,n[88]=Y):Y=n[88];let Ve,He;n[89]===Symbol.for(`react.memo_cache_sentinel`)?(Ve={scale:1.1},He={scale:.9},n[89]=Ve,n[90]=He):(Ve=n[89],He=n[90]);let Ue;n[91]===Symbol.for(`react.memo_cache_sentinel`)?(Ue=(0,C.jsx)(l.div,{whileHover:Ve,whileTap:He,children:(0,C.jsx)(ne,{size:24,className:`cursor-pointer hover:opacity-70 transition-opacity`,onClick:()=>he(!0)})}),n[91]=Ue):Ue=n[91];let X;n[92]!==J||n[93]!==Y?(X=(0,C.jsxs)(`div`,{className:`flex items-center gap-4`,children:[J,Y,Ue]}),n[92]=J,n[93]=Y,n[94]=X):X=n[94];let We,Ge;n[95]===Symbol.for(`react.memo_cache_sentinel`)?(We={scale:1.1},Ge={scale:.9},n[95]=We,n[96]=Ge):(We=n[95],Ge=n[96]);let Ke=`cursor-pointer hover:opacity-70 transition-all ${i?`fill-current`:``}`,Z;n[97]!==a||n[98]!==Ke?(Z=(0,C.jsx)(l.div,{whileHover:We,whileTap:Ge,children:(0,C.jsx)(re,{size:24,className:Ke,onClick:a})}),n[97]=a,n[98]=Ke,n[99]=Z):Z=n[99];let qe;n[100]!==X||n[101]!==Z?(qe=(0,C.jsxs)(`div`,{className:`flex items-center justify-between mb-2 px-3 md:px-0`,children:[X,Z]}),n[100]=X,n[101]=Z,n[102]=qe):qe=n[102];let Je;n[103]===r.likes?Je=n[104]:(Je=(0,C.jsxs)(`div`,{className:`font-semibold mb-1`,children:[r.likes,` লাইক`]}),n[103]=r.likes,n[104]=Je);let Ye;n[105]!==o||n[106]!==r.user?(Ye=()=>o(r.user),n[105]=o,n[106]=r.user,n[107]=Ye):Ye=n[107];let Q;n[108]!==r.user.username||n[109]!==Ye?(Q=(0,C.jsx)(`span`,{className:`font-semibold mr-2 cursor-pointer hover:opacity-70`,onClick:Ye,children:r.user.username}),n[108]=r.user.username,n[109]=Ye,n[110]=Q):Q=n[110];let Xe;n[111]===r.caption?Xe=n[112]:(Xe=(0,C.jsx)(h,{text:r.caption,truncateLength:150}),n[111]=r.caption,n[112]=Xe);let Ze;n[113]!==Q||n[114]!==Xe?(Ze=(0,C.jsxs)(`div`,{className:`mb-1`,children:[Q,Xe]}),n[113]=Q,n[114]=Xe,n[115]=Ze):Ze=n[115];let Qe;n[116]!==c||n[117]!==r?(Qe=()=>c(r),n[116]=c,n[117]=r,n[118]=Qe):Qe=n[118];let $e;n[119]!==r.comments||n[120]!==Qe?($e=(0,C.jsxs)(`div`,{className:`text-zinc-500 cursor-pointer hover:underline`,onClick:Qe,children:[`সব `,r.comments,` কমেন্ট দেখুন`]}),n[119]=r.comments,n[120]=Qe,n[121]=$e):$e=n[121];let et;n[122]!==r.createdAt||n[123]!==r.time?(et=r.createdAt?(0,T.default)(r.createdAt).fromNow():r.time,n[122]=r.createdAt,n[123]=r.time,n[124]=et):et=n[124];let tt;n[125]===et?tt=n[126]:(tt=(0,C.jsx)(`div`,{className:`text-[10px] text-zinc-500 uppercase mt-1`,children:et}),n[125]=et,n[126]=tt);let nt=`bg-transparent text-sm w-full outline-none ${u===`dark`?`text-white`:`text-black`}`,rt;n[127]===Symbol.for(`react.memo_cache_sentinel`)?(rt=e=>b(e.target.value),n[127]=rt):rt=n[127];let it;n[128]!==g||n[129]!==y||n[130]!==nt?(it=(0,C.jsx)(`input`,{type:`text`,placeholder:`কমেন্ট যোগ করুন...`,className:nt,value:y,onChange:rt,disabled:g}),n[128]=g,n[129]=y,n[130]=nt,n[131]=it):it=n[131];let at=!y||g,ot;n[132]===at?ot=n[133]:(ot=(0,C.jsx)(`button`,{type:`submit`,className:`text-[#006a4e] text-sm font-semibold disabled:opacity-50 hover:text-[#004d39]`,disabled:at,children:`পোস্ট`}),n[132]=at,n[133]=ot);let st;n[134]!==xe||n[135]!==it||n[136]!==ot?(st=(0,C.jsxs)(`form`,{onSubmit:xe,className:`flex gap-2 mt-2`,children:[it,ot]}),n[134]=xe,n[135]=it,n[136]=ot,n[137]=st):st=n[137];let $;n[138]!==Je||n[139]!==Ze||n[140]!==$e||n[141]!==tt||n[142]!==st?($=(0,C.jsxs)(`div`,{className:`text-sm px-3 md:px-0`,children:[Je,Ze,$e,tt,st]}),n[138]=Je,n[139]=Ze,n[140]=$e,n[141]=tt,n[142]=st,n[143]=$):$=n[143];let ct;return n[144]!==N||n[145]!==P||n[146]!==U||n[147]!==q||n[148]!==qe||n[149]!==$||n[150]!==De||n[151]!==M?(ct=(0,C.jsxs)(l.div,{initial:Ce,whileInView:we,viewport:Te,transition:Ee,className:De,children:[M,N,P,U,q,qe,$]}),n[144]=N,n[145]=P,n[146]=U,n[147]=q,n[148]=qe,n[149]=$,n[150]=De,n[151]=M,n[152]=ct):ct=n[152],ct});export{y as n,D as t};