import{a as e}from"./rolldown-runtime-DDUpfMIz.js";import{$t as t,Ct as n,Ft as r,Ht as i,I as a,L as o,Nt as s,Pt as ee,Q as te,Xt as c,Y as ne,Zt as l,gt as re,ot as ie,rt as ae,t as u,vt as d,zt as f}from"./vendor-BGsbkvy4.js";import"./libs-D8PgcjEw.js";import"./supabase-DrdZ3Qvc.js";import{_ as p,a as oe,i as m,l as se,m as h,v as ce,y as le}from"./index-DLjypg6f.js";import{n as g,t as _}from"./ShareModal-DuZp-2rA.js";import"./useGetSuggestedUsers-ZbETnJB6.js";import{t as v}from"./useFollowUser-Z8R_89uL.js";var y=r(),b=e(t(),1),x=e(i(),1),ue=u,de=(0,b.memo)(e=>{let t=(0,y.c)(132),{reel:n,showToast:r,theme:i,onUserClick:c,glassModal:l}=e,{setViewingReel:u}=le(),{user:f}=ce(),{mutate:se}=m(),{mutate:h}=v(),[de,fe]=(0,b.useState)(!1),[S,pe]=(0,b.useState)(!0),[C,me]=(0,b.useState)(!0),[he,ge]=(0,b.useState)(!1),[_e,ve]=(0,b.useState)(!1),ye=(0,b.useRef)(null),be=(0,b.useRef)(null),w=`${window.location.origin}/reels/${n.id}`,xe=n.hasLiked||!1,Se;t[0]!==xe||t[1]!==n.id||t[2]!==r||t[3]!==se||t[4]!==f?(Se=()=>{if(!f){r(`লাইক করতে লগ ইন করুন`);return}se({targetId:n.id,type:`reel`,userId:f.id,hasLiked:xe})},t[0]=xe,t[1]=n.id,t[2]=r,t[3]=se,t[4]=f,t[5]=Se):Se=t[5];let T=Se,Ce;t[6]!==h||t[7]!==n.user.isFollowing||t[8]!==n.user.username||t[9]!==n.userId||t[10]!==r||t[11]!==f?(Ce=()=>{if(!f){r(`ফলো করতে লগ ইন করুন`);return}n.userId&&h({targetUserId:n.userId,currentUserId:f.id,isFollowing:n.user.isFollowing||!1,targetUsername:n.user.username},{onSuccess:()=>r(`ফলো করা হয়েছে`),onError:()=>r(`ফলো করতে সমস্যা হয়েছে`)})},t[6]=h,t[7]=n.user.isFollowing,t[8]=n.user.username,t[9]=n.userId,t[10]=r,t[11]=f,t[12]=Ce):Ce=t[12];let we=Ce,Te;t[13]===C?Te=t[14]:(Te=()=>{be.current&&me(!C)},t[13]=C,t[14]=Te);let Ee=Te,De,Oe;t[15]===Symbol.for(`react.memo_cache_sentinel`)?(De=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(me(!0),pe(!1)):(me(!1),pe(!0))},{threshold:.6});return ye.current&&e.observe(ye.current),()=>e.disconnect()},Oe=[],t[15]=De,t[16]=Oe):(De=t[15],Oe=t[16]),(0,b.useEffect)(De,Oe);let ke;t[17]===T?ke=t[18]:(ke=()=>{T(),fe(!0),setTimeout(()=>fe(!1),1e3)},t[17]=T,t[18]=ke);let Ae=ke,je,Me,Ne,Pe;t[19]===Symbol.for(`react.memo_cache_sentinel`)?(Me={opacity:0,scale:.95},Ne={opacity:1,scale:1},Pe={once:!0},je={duration:.5},t[19]=je,t[20]=Me,t[21]=Ne,t[22]=Pe):(je=t[19],Me=t[20],Ne=t[21],Pe=t[22]);let E;t[23]!==l||t[24]!==he||t[25]!==w||t[26]!==r||t[27]!==i?(E=he&&(0,x.jsx)(g,{onClose:()=>ge(!1),showToast:r,theme:i,glassModal:l,shareUrl:w}),t[23]=l,t[24]=he,t[25]=w,t[26]=r,t[27]=i,t[28]=E):E=t[28];let D;t[29]!==l||t[30]!==_e||t[31]!==w||t[32]!==r||t[33]!==i?(D=_e&&(0,x.jsx)(_,{onClose:()=>ve(!1),theme:i,showToast:r,glassModal:l,shareUrl:w}),t[29]=l,t[30]=_e,t[31]=w,t[32]=r,t[33]=i,t[34]=D):D=t[34];let O;t[35]!==S||t[36]!==C||t[37]!==n.src||t[38]!==Ee?(O=n.src?(0,x.jsx)(`div`,{className:`w-full h-full cursor-pointer`,onClick:Ee,children:(0,x.jsx)(ue,{ref:be,url:n.src,width:`100%`,height:`100%`,playing:C,muted:S,loop:!0,playsinline:!0,style:{objectFit:`cover`},className:`react-player pointer-events-none`})}):(0,x.jsx)(p,{src:n.src,width:400,className:`w-full h-full`,onClick:()=>pe(!S),alt:`reel`}),t[35]=S,t[36]=C,t[37]=n.src,t[38]=Ee,t[39]=O):O=t[39];let k;t[40]===C?k=t[41]:(k=!C&&(0,x.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,x.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,x.jsx)(te,{className:`text-white w-10 h-10 fill-white`})})}),t[40]=C,t[41]=k);let A;t[42]===S?A=t[43]:(A=(0,x.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),pe(!S)},children:S?(0,x.jsx)(a,{className:`text-white w-5 h-5`}):(0,x.jsx)(o,{className:`text-white w-5 h-5`})}),t[42]=S,t[43]=A);let j;t[44]===de?j=t[45]:(j=de&&(0,x.jsx)(s.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,x.jsx)(re,{size:100,className:`text-white fill-white drop-shadow-lg`})}),t[44]=de,t[45]=j);let M;t[46]===j?M=t[47]:(M=(0,x.jsx)(ee,{children:j}),t[46]=j,t[47]=M);let N;t[48]!==c||t[49]!==n.user?(N=()=>c(n.user),t[48]=c,t[49]=n.user,t[50]=N):N=t[50];let P;t[51]===n.user.avatar?P=t[52]:(P=(0,x.jsx)(`div`,{className:`w-8 h-8 rounded-full border border-white/50 overflow-hidden cursor-pointer`,children:(0,x.jsx)(p,{src:n.user.avatar,width:100,className:`w-full h-full`,alt:`reel user`})}),t[51]=n.user.avatar,t[52]=P);let F;t[53]===n.user.username?F=t[54]:(F=(0,x.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:n.user.username}),t[53]=n.user.username,t[54]=F);let I;t[55]===n.user.isVerified?I=t[56]:(I=n.user.isVerified&&(0,x.jsx)(oe,{}),t[55]=n.user.isVerified,t[56]=I);let Fe,Ie;t[57]===Symbol.for(`react.memo_cache_sentinel`)?(Fe={scale:1.05},Ie={scale:.95},t[57]=Fe,t[58]=Ie):(Fe=t[57],Ie=t[58]);let Le=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${n.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,L;t[59]===we?L=t[60]:(L=e=>{e.stopPropagation(),we()},t[59]=we,t[60]=L);let Re=n.user.isFollowing?`ফলো করছেন`:`ফলো`,R;t[61]!==Le||t[62]!==L||t[63]!==Re?(R=(0,x.jsx)(s.button,{whileHover:Fe,whileTap:Ie,className:Le,onClick:L,children:Re}),t[61]=Le,t[62]=L,t[63]=Re,t[64]=R):R=t[64];let z;t[65]!==N||t[66]!==P||t[67]!==F||t[68]!==I||t[69]!==R?(z=(0,x.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:N,children:[P,F,I,R]}),t[65]=N,t[66]=P,t[67]=F,t[68]=I,t[69]=R,t[70]=z):z=t[70];let ze;t[71]===Symbol.for(`react.memo_cache_sentinel`)?(ze=(0,x.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`আরও`}),t[71]=ze):ze=t[71];let B;t[72]===n.caption?B=t[73]:(B=(0,x.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[n.caption,` `,ze]}),t[72]=n.caption,t[73]=B);let Be;t[74]===Symbol.for(`react.memo_cache_sentinel`)?(Be=(0,x.jsx)(ae,{size:12}),t[74]=Be):Be=t[74];let V;t[75]===n.audio?V=t[76]:(V=(0,x.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[Be,(0,x.jsx)(`div`,{className:`truncate w-40`,children:n.audio})]}),t[75]=n.audio,t[76]=V);let H;t[77]!==z||t[78]!==B||t[79]!==V?(H=(0,x.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[z,B,V]}),t[77]=z,t[78]=B,t[79]=V,t[80]=H):H=t[80];let Ve,He;t[81]===Symbol.for(`react.memo_cache_sentinel`)?(Ve={scale:1.1},He={scale:.9},t[81]=Ve,t[82]=He):(Ve=t[81],He=t[82]);let Ue=`cursor-pointer transition-colors ${xe?`fill-[#f42a41] text-[#f42a41]`:``}`,U;t[83]!==T||t[84]!==Ue?(U=(0,x.jsx)(s.div,{whileHover:Ve,whileTap:He,children:(0,x.jsx)(re,{size:28,strokeWidth:1.5,className:Ue,onClick:T})}),t[83]=T,t[84]=Ue,t[85]=U):U=t[85];let W;t[86]===n.likes?W=t[87]:(W=(0,x.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:n.likes}),t[86]=n.likes,t[87]=W);let G;t[88]!==U||t[89]!==W?(G=(0,x.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[U,W]}),t[88]=U,t[89]=W,t[90]=G):G=t[90];let We,Ge;t[91]===Symbol.for(`react.memo_cache_sentinel`)?(We={scale:1.1},Ge={scale:.9},t[91]=We,t[92]=Ge):(We=t[91],Ge=t[92]);let K;t[93]!==n||t[94]!==u?(K=(0,x.jsx)(s.div,{whileHover:We,whileTap:Ge,children:(0,x.jsx)(ie,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>u(n)})}),t[93]=n,t[94]=u,t[95]=K):K=t[95];let q;t[96]===n.comments?q=t[97]:(q=(0,x.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:n.comments}),t[96]=n.comments,t[97]=q);let J;t[98]!==K||t[99]!==q?(J=(0,x.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[K,q]}),t[98]=K,t[99]=q,t[100]=J):J=t[100];let Ke,qe;t[101]===Symbol.for(`react.memo_cache_sentinel`)?(Ke={scale:1.1},qe={scale:.9},t[101]=Ke,t[102]=qe):(Ke=t[101],qe=t[102]);let Je;t[103]===Symbol.for(`react.memo_cache_sentinel`)?(Je=(0,x.jsx)(s.div,{whileHover:Ke,whileTap:qe,children:(0,x.jsx)(ne,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ve(!0)})}),t[103]=Je):Je=t[103];let Ye,Xe;t[104]===Symbol.for(`react.memo_cache_sentinel`)?(Ye={scale:1.1},Xe={scale:.9},t[104]=Ye,t[105]=Xe):(Ye=t[104],Xe=t[105]);let Ze;t[106]===Symbol.for(`react.memo_cache_sentinel`)?(Ze=(0,x.jsx)(s.div,{whileHover:Ye,whileTap:Xe,children:(0,x.jsx)(d,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ge(!0)})}),t[106]=Ze):Ze=t[106];let Qe;t[107]===Symbol.for(`react.memo_cache_sentinel`)?(Qe={scale:1.1},t[107]=Qe):Qe=t[107];let Y;t[108]!==c||t[109]!==n.user?(Y=()=>c(n.user),t[108]=c,t[109]=n.user,t[110]=Y):Y=t[110];let X;t[111]===n.user.avatar?X=t[112]:(X=(0,x.jsx)(p,{src:n.user.avatar,width:100,className:`w-full h-full`,alt:`user thumb`}),t[111]=n.user.avatar,t[112]=X);let Z;t[113]!==Y||t[114]!==X?(Z=(0,x.jsx)(s.div,{whileHover:Qe,className:`w-6 h-6 border-2 border-white rounded-md overflow-hidden mt-2 cursor-pointer`,onClick:Y,children:X}),t[113]=Y,t[114]=X,t[115]=Z):Z=t[115];let Q;t[116]!==G||t[117]!==J||t[118]!==Z?(Q=(0,x.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[G,J,Je,Ze,Z]}),t[116]=G,t[117]=J,t[118]=Z,t[119]=Q):Q=t[119];let $;t[120]!==Ae||t[121]!==O||t[122]!==k||t[123]!==A||t[124]!==M||t[125]!==H||t[126]!==Q?($=(0,x.jsxs)(`div`,{ref:ye,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-zinc-900 md:rounded-lg overflow-hidden border-zinc-800 md:border group shadow-2xl`,onDoubleClick:Ae,children:[O,k,A,M,H,Q]}),t[120]=Ae,t[121]=O,t[122]=k,t[123]=A,t[124]=M,t[125]=H,t[126]=Q,t[127]=$):$=t[127];let $e;return t[128]!==E||t[129]!==D||t[130]!==$?($e=(0,x.jsxs)(s.div,{initial:Me,whileInView:Ne,viewport:Pe,transition:je,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[E,D,$]}),t[128]=E,t[129]=D,t[130]=$,t[131]=$e):$e=t[131],$e}),fe=r();const S=e=>[`reel`,e],pe=(e,t)=>{let n=(0,fe.c)(9),r=e||``,i;n[0]===r?i=n[1]:(i=S(r),n[0]=r,n[1]=i);let a=!!e,o;n[2]!==t||n[3]!==e?(o=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await h.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await h.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await h.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},n[2]=t,n[3]=e,n[4]=o):o=n[4];let s;return n[5]!==i||n[6]!==a||n[7]!==o?(s={queryKey:i,enabled:a,queryFn:o},n[5]=i,n[6]=a,n[7]=o,n[8]=s):s=n[8],f(s)};var C=r(),me=()=>{let e=(0,C.c)(32),{theme:t,showToast:r}=le(),{user:i}=ce(),a=c(),{id:o}=l(),s=t===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,{data:ee,isLoading:te}=pe(o,i?.id),{data:ne,isLoading:re}=se(i?.id),ie;e[0]===ne?ie=e[1]:(ie=ne===void 0?[]:ne,e[0]=ne,e[1]=ie);let ae=ie,u;e[2]===a?u=e[3]:(u=e=>{a(`/profile/${e.username}`)},e[2]=a,e[3]=u);let d=u,f=o?te:re,p;e[4]!==ae||e[5]!==o||e[6]!==ee?(p=o?ee?[ee]:[]:ae,e[4]=ae,e[5]=o,e[6]=ee,e[7]=p):p=e[7];let oe=p;if(f){let t;return e[8]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,x.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:`Loading reel...`}),e[8]=t):t=e[8],t}if(oe.length===0){let t=o?`Reel not found`:`No reels yet`,n;return e[9]===t?n=e[10]:(n=(0,x.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:t}),e[9]=t,e[10]=n),n}let m;e[11]===a?m=e[12]:(m=()=>a(`/`),e[11]=a,e[12]=m);let h;e[13]===Symbol.for(`react.memo_cache_sentinel`)?(h=(0,x.jsx)(n,{size:28}),e[13]=h):h=e[13];let g;e[14]===m?g=e[15]:(g=(0,x.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:m,children:h}),e[14]=m,e[15]=g);let _;if(e[16]!==oe||e[17]!==s||e[18]!==d||e[19]!==r||e[20]!==t){let n;e[22]!==s||e[23]!==d||e[24]!==r||e[25]!==t?(n=e=>(0,x.jsx)(de,{reel:e,showToast:r,theme:t,onUserClick:d,glassModal:s},e.id),e[22]=s,e[23]=d,e[24]=r,e[25]=t,e[26]=n):n=e[26],_=oe.map(n),e[16]=oe,e[17]=s,e[18]=d,e[19]=r,e[20]=t,e[21]=_}else _=e[21];let v;e[27]===_?v=e[28]:(v=(0,x.jsx)(`div`,{className:`w-full md:w-[400px] h-full`,children:_}),e[27]=_,e[28]=v);let y;return e[29]!==g||e[30]!==v?(y=(0,x.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[g,v]}),e[29]=g,e[30]=v,e[31]=y):y=e[31],y};export{me as default};