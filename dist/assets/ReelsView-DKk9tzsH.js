import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{$t as t,Bt as n,Et as r,F as i,Ft as a,Ht as o,Nt as s,P as c,Pt as ee,St as l,X as te,Xt as u,Zt as ne,_t as re,it as ie,mt as d,q as ae,t as f,tt as oe}from"./vendor-BGrLWuzF.js";import"./libs-eJHw-jrC.js";import"./tanstack-CjdblyHw.js";import"./supabase-CBM4FLKd.js";import{C as se,_ as p,b as ce,c as le,f as ue,s as de,w as fe,x as m,y as h}from"./index-qR2YstvC.js";import{n as g,r as _,t as v}from"./useViewTracker-D4u-iMqX.js";import"./useGetSuggestedUsers-BL8VlLqm.js";import{t as y}from"./useFollowUser-DiX0t8fG.js";var pe=a(),b=e(t(),1),x=o(),me=f,he=(0,b.memo)(e=>{let t=(0,pe.c)(150),{reel:n,showToast:a,theme:o,onUserClick:l,glassModal:u}=e,{setViewingReel:ne}=fe(),{user:f}=se(),{mutate:p}=de(),{mutate:ue}=y(),{ref:he}=v(n.id,`reel`),[ge,_e]=(0,b.useState)(!1),[S,ve]=(0,b.useState)(!0),[C,ye]=(0,b.useState)(!0),[be,xe]=(0,b.useState)(!1),[Se,Ce]=(0,b.useState)(!1),we=(0,b.useRef)(null),Te=(0,b.useRef)(null),w=`${window.location.origin}/reels/${n.id}`,Ee=n.hasLiked||!1,De;t[0]!==Ee||t[1]!==n.id||t[2]!==a||t[3]!==p||t[4]!==f?(De=()=>{if(!f){a(`Log in to like`);return}p({targetId:n.id,type:`reel`,userId:f.id,hasLiked:Ee})},t[0]=Ee,t[1]=n.id,t[2]=a,t[3]=p,t[4]=f,t[5]=De):De=t[5];let T=De,Oe;t[6]!==ue||t[7]!==n.user.isFollowing||t[8]!==n.user.username||t[9]!==n.userId||t[10]!==a||t[11]!==f?(Oe=()=>{if(!f){a(`Log in to follow`);return}n.userId&&ue({targetUserId:n.userId,currentUserId:f.id,isFollowing:n.user.isFollowing||!1,targetUsername:n.user.username},{onSuccess:()=>a(`Followed`),onError:()=>a(`Failed to follow`)})},t[6]=ue,t[7]=n.user.isFollowing,t[8]=n.user.username,t[9]=n.userId,t[10]=a,t[11]=f,t[12]=Oe):Oe=t[12];let ke=Oe,Ae;t[13]===C?Ae=t[14]:(Ae=()=>{Te.current&&ye(!C)},t[13]=C,t[14]=Ae);let je=Ae,Me,Ne;t[15]===Symbol.for(`react.memo_cache_sentinel`)?(Me=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(ye(!0),ve(!1)):(ye(!1),ve(!0))},{threshold:.6});return we.current&&e.observe(we.current),()=>e.disconnect()},Ne=[],t[15]=Me,t[16]=Ne):(Me=t[15],Ne=t[16]),(0,b.useEffect)(Me,Ne);let Pe;t[17]===T?Pe=t[18]:(Pe=()=>{T(),_e(!0),setTimeout(()=>_e(!1),1e3)},t[17]=T,t[18]=Pe);let Fe=Pe,Ie,Le,Re,ze;t[19]===Symbol.for(`react.memo_cache_sentinel`)?(Le={opacity:0,scale:.95},Re={opacity:1,scale:1},ze={once:!0},Ie={duration:.5},t[19]=Ie,t[20]=Le,t[21]=Re,t[22]=ze):(Ie=t[19],Le=t[20],Re=t[21],ze=t[22]);let E;t[23]!==u||t[24]!==be||t[25]!==w||t[26]!==a||t[27]!==o?(E=be&&(0,x.jsx)(_,{onClose:()=>xe(!1),showToast:a,theme:o,glassModal:u,shareUrl:w}),t[23]=u,t[24]=be,t[25]=w,t[26]=a,t[27]=o,t[28]=E):E=t[28];let D;t[29]!==u||t[30]!==Se||t[31]!==w||t[32]!==a||t[33]!==o?(D=Se&&(0,x.jsx)(g,{onClose:()=>Ce(!1),theme:o,showToast:a,glassModal:u,shareUrl:w}),t[29]=u,t[30]=Se,t[31]=w,t[32]=a,t[33]=o,t[34]=D):D=t[34];let O;t[35]!==S||t[36]!==C||t[37]!==n.src||t[38]!==je?(O=n.src?(0,x.jsx)(`div`,{className:`w-full h-full cursor-pointer`,onClick:je,children:(0,x.jsx)(me,{ref:Te,url:n.src,width:`100%`,height:`100%`,playing:C,muted:S,loop:!0,playsinline:!0,style:{objectFit:`cover`},className:`react-player pointer-events-none`})}):(0,x.jsx)(`img`,{src:n.src,className:`w-full h-full object-cover`,onClick:()=>ve(!S),alt:`reel`,loading:`lazy`}),t[35]=S,t[36]=C,t[37]=n.src,t[38]=je,t[39]=O):O=t[39];let k;t[40]===C?k=t[41]:(k=!C&&(0,x.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,x.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,x.jsx)(te,{className:`text-white w-10 h-10 fill-white`})})}),t[40]=C,t[41]=k);let A;t[42]===S?A=t[43]:(A=(0,x.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),ve(!S)},children:S?(0,x.jsx)(c,{className:`text-white w-5 h-5`}):(0,x.jsx)(i,{className:`text-white w-5 h-5`})}),t[42]=S,t[43]=A);let j;t[44]===ge?j=t[45]:(j=ge&&(0,x.jsx)(s.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,x.jsx)(d,{size:100,className:`text-white fill-white drop-shadow-lg`})}),t[44]=ge,t[45]=j);let M;t[46]===j?M=t[47]:(M=(0,x.jsx)(ee,{children:j}),t[46]=j,t[47]=M);let N;t[48]!==l||t[49]!==n.user?(N=()=>l(n.user),t[48]=l,t[49]=n.user,t[50]=N):N=t[50];let P;t[51]===n.user.avatar?P=t[52]:(P=(0,x.jsx)(m,{src:n.user.avatar}),t[51]=n.user.avatar,t[52]=P);let F;t[53]===n.user.username[0]?F=t[54]:(F=n.user.username[0].toUpperCase(),t[53]=n.user.username[0],t[54]=F);let I;t[55]===F?I=t[56]:(I=(0,x.jsx)(ce,{children:F}),t[55]=F,t[56]=I);let Be;t[57]!==P||t[58]!==I?(Be=(0,x.jsxs)(h,{className:`w-8 h-8 border border-white/50 cursor-pointer`,children:[P,I]}),t[57]=P,t[58]=I,t[59]=Be):Be=t[59];let L;t[60]===n.user.username?L=t[61]:(L=(0,x.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:n.user.username}),t[60]=n.user.username,t[61]=L);let R;t[62]===n.user.isVerified?R=t[63]:(R=n.user.isVerified&&(0,x.jsx)(le,{}),t[62]=n.user.isVerified,t[63]=R);let Ve,He;t[64]===Symbol.for(`react.memo_cache_sentinel`)?(Ve={scale:1.05},He={scale:.95},t[64]=Ve,t[65]=He):(Ve=t[64],He=t[65]);let Ue=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${n.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,z;t[66]===ke?z=t[67]:(z=e=>{e.stopPropagation(),ke()},t[66]=ke,t[67]=z);let We=n.user.isFollowing?`Following`:`Follow`,B;t[68]!==Ue||t[69]!==z||t[70]!==We?(B=(0,x.jsx)(s.button,{whileHover:Ve,whileTap:He,className:Ue,onClick:z,children:We}),t[68]=Ue,t[69]=z,t[70]=We,t[71]=B):B=t[71];let V;t[72]!==N||t[73]!==Be||t[74]!==L||t[75]!==R||t[76]!==B?(V=(0,x.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:N,children:[Be,L,R,B]}),t[72]=N,t[73]=Be,t[74]=L,t[75]=R,t[76]=B,t[77]=V):V=t[77];let Ge;t[78]===Symbol.for(`react.memo_cache_sentinel`)?(Ge=(0,x.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`More`}),t[78]=Ge):Ge=t[78];let H;t[79]===n.caption?H=t[80]:(H=(0,x.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[n.caption,` `,Ge]}),t[79]=n.caption,t[80]=H);let Ke;t[81]===Symbol.for(`react.memo_cache_sentinel`)?(Ke=(0,x.jsx)(oe,{size:12}),t[81]=Ke):Ke=t[81];let U;t[82]===n.audio?U=t[83]:(U=(0,x.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[Ke,(0,x.jsx)(`div`,{className:`truncate w-40`,children:n.audio})]}),t[82]=n.audio,t[83]=U);let W;t[84]!==V||t[85]!==H||t[86]!==U?(W=(0,x.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[V,H,U]}),t[84]=V,t[85]=H,t[86]=U,t[87]=W):W=t[87];let qe,Je;t[88]===Symbol.for(`react.memo_cache_sentinel`)?(qe={scale:1.1},Je={scale:.9},t[88]=qe,t[89]=Je):(qe=t[88],Je=t[89]);let Ye=`cursor-pointer transition-colors ${Ee?`fill-[#f42a41] text-[#f42a41]`:``}`,G;t[90]!==T||t[91]!==Ye?(G=(0,x.jsx)(s.div,{whileHover:qe,whileTap:Je,children:(0,x.jsx)(d,{size:28,strokeWidth:1.5,className:Ye,onClick:T})}),t[90]=T,t[91]=Ye,t[92]=G):G=t[92];let K;t[93]===n.likes?K=t[94]:(K=(0,x.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:n.likes}),t[93]=n.likes,t[94]=K);let q;t[95]!==G||t[96]!==K?(q=(0,x.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[G,K]}),t[95]=G,t[96]=K,t[97]=q):q=t[97];let Xe,Ze;t[98]===Symbol.for(`react.memo_cache_sentinel`)?(Xe={scale:1.1},Ze={scale:.9},t[98]=Xe,t[99]=Ze):(Xe=t[98],Ze=t[99]);let J;t[100]!==n||t[101]!==ne?(J=(0,x.jsx)(s.div,{whileHover:Xe,whileTap:Ze,children:(0,x.jsx)(ie,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>ne(n)})}),t[100]=n,t[101]=ne,t[102]=J):J=t[102];let Y;t[103]===n.comments?Y=t[104]:(Y=(0,x.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:n.comments}),t[103]=n.comments,t[104]=Y);let X;t[105]!==J||t[106]!==Y?(X=(0,x.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[J,Y]}),t[105]=J,t[106]=Y,t[107]=X):X=t[107];let Qe,$e;t[108]===Symbol.for(`react.memo_cache_sentinel`)?(Qe={scale:1.1},$e={scale:.9},t[108]=Qe,t[109]=$e):(Qe=t[108],$e=t[109]);let et;t[110]===Symbol.for(`react.memo_cache_sentinel`)?(et=(0,x.jsx)(s.div,{whileHover:Qe,whileTap:$e,children:(0,x.jsx)(ae,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>Ce(!0)})}),t[110]=et):et=t[110];let tt;t[111]===Symbol.for(`react.memo_cache_sentinel`)?(tt=(0,x.jsx)(r,{size:28,strokeWidth:1.5,className:`text-white drop-shadow-md`}),t[111]=tt):tt=t[111];let Z;t[112]===n.views?Z=t[113]:(Z=Intl.NumberFormat(`en-US`,{notation:`compact`,maximumFractionDigits:1}).format(n.views||0),t[112]=n.views,t[113]=Z);let nt;t[114]===Z?nt=t[115]:(nt=(0,x.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[tt,(0,x.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:Z})]}),t[114]=Z,t[115]=nt);let rt,it;t[116]===Symbol.for(`react.memo_cache_sentinel`)?(rt={scale:1.1},it={scale:.9},t[116]=rt,t[117]=it):(rt=t[116],it=t[117]);let at;t[118]===Symbol.for(`react.memo_cache_sentinel`)?(at=(0,x.jsx)(s.div,{whileHover:rt,whileTap:it,children:(0,x.jsx)(re,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>xe(!0)})}),t[118]=at):at=t[118];let Q;t[119]!==l||t[120]!==n.user?(Q=()=>l(n.user),t[119]=l,t[120]=n.user,t[121]=Q):Q=t[121];let ot;t[122]===n.user.avatar?ot=t[123]:(ot=(0,x.jsx)(m,{src:n.user.avatar}),t[122]=n.user.avatar,t[123]=ot);let st;t[124]===n.user.username[0]?st=t[125]:(st=n.user.username[0].toUpperCase(),t[124]=n.user.username[0],t[125]=st);let ct;t[126]===st?ct=t[127]:(ct=(0,x.jsx)(ce,{children:st}),t[126]=st,t[127]=ct);let lt;t[128]!==Q||t[129]!==ot||t[130]!==ct?(lt=(0,x.jsxs)(h,{className:`w-6 h-6 border-2 border-white cursor-pointer mt-2`,onClick:Q,children:[ot,ct]}),t[128]=Q,t[129]=ot,t[130]=ct,t[131]=lt):lt=t[131];let ut;t[132]!==q||t[133]!==X||t[134]!==nt||t[135]!==lt?(ut=(0,x.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[q,X,et,nt,at,lt]}),t[132]=q,t[133]=X,t[134]=nt,t[135]=lt,t[136]=ut):ut=t[136];let $;t[137]!==Fe||t[138]!==O||t[139]!==k||t[140]!==A||t[141]!==M||t[142]!==W||t[143]!==ut?($=(0,x.jsxs)(`div`,{ref:we,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-zinc-900 md:rounded-lg overflow-hidden border-zinc-800 md:border group shadow-2xl`,onDoubleClick:Fe,children:[O,k,A,M,W,ut]}),t[137]=Fe,t[138]=O,t[139]=k,t[140]=A,t[141]=M,t[142]=W,t[143]=ut,t[144]=$):$=t[144];let dt;return t[145]!==E||t[146]!==D||t[147]!==$||t[148]!==he?(dt=(0,x.jsxs)(s.div,{ref:he,initial:Le,whileInView:Re,viewport:ze,transition:Ie,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[E,D,$]}),t[145]=E,t[146]=D,t[147]=$,t[148]=he,t[149]=dt):dt=t[149],dt}),ge=a();const _e=e=>[`reel`,e],S=(e,t)=>{let r=(0,ge.c)(9),i=e||``,a;r[0]===i?a=r[1]:(a=_e(i),r[0]=i,r[1]=a);let o=!!e,s;r[2]!==t||r[3]!==e?(s=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await p.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await p.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await p.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,views:i.view_count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},r[2]=t,r[3]=e,r[4]=s):s=r[4];let c;return r[5]!==a||r[6]!==o||r[7]!==s?(c={queryKey:a,enabled:o,queryFn:s},r[5]=a,r[6]=o,r[7]=s,r[8]=c):c=r[8],n(c)};var ve=a(),C=()=>{let e=(0,ve.c)(39),{theme:t,showToast:n}=fe(),{user:r}=se(),i=u(),{id:a}=ne(),o=t===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,{data:s,isLoading:c}=S(a,r?.id),{data:ee,isLoading:te,fetchNextPage:re,hasNextPage:ie,isFetchingNextPage:d}=ue(r?.id),ae;bb0:{if(!ee){let t;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t=[],e[0]=t):t=e[0],ae=t;break bb0}let t;e[1]===ee.pages?t=e[2]:(t=ee.pages.flat(),e[1]=ee.pages,e[2]=t),ae=t}let f=ae,oe;e[3]===i?oe=e[4]:(oe=e=>{i(`/profile/${e.username}`)},e[3]=i,e[4]=oe);let p=oe,ce=a?c:te,le;e[5]!==f||e[6]!==a||e[7]!==s?(le=a?s?[s]:[]:f,e[5]=f,e[6]=a,e[7]=s,e[8]=le):le=e[8];let de=le;if(ce){let t;return e[9]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,x.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:`Loading reel...`}),e[9]=t):t=e[9],t}if(de.length===0){let t=a?`Reel not found`:`No reels yet`,n;return e[10]===t?n=e[11]:(n=(0,x.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:t}),e[10]=t,e[11]=n),n}let m;e[12]===i?m=e[13]:(m=()=>i(`/`),e[12]=i,e[13]=m);let h;e[14]===Symbol.for(`react.memo_cache_sentinel`)?(h=(0,x.jsx)(l,{size:28}),e[14]=h):h=e[14];let g;e[15]===m?g=e[16]:(g=(0,x.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:m,children:h}),e[15]=m,e[16]=g);let _;if(e[17]!==de||e[18]!==o||e[19]!==p||e[20]!==n||e[21]!==t){let r;e[23]!==o||e[24]!==p||e[25]!==n||e[26]!==t?(r=e=>(0,x.jsx)(he,{reel:e,showToast:n,theme:t,onUserClick:p,glassModal:o},e.id),e[23]=o,e[24]=p,e[25]=n,e[26]=t,e[27]=r):r=e[27],_=de.map(r),e[17]=de,e[18]=o,e[19]=p,e[20]=n,e[21]=t,e[22]=_}else _=e[22];let v;e[28]!==re||e[29]!==ie||e[30]!==a||e[31]!==d?(v=ie&&!a&&(0,x.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center snap-start bg-black`,children:(0,x.jsx)(`button`,{onClick:()=>re(),disabled:d,className:`bg-white/10 hover:bg-white/20 text-white px-6 py-2 rounded-full border border-white/20 transition-colors`,children:d?`Loading...`:`See more videos`})}),e[28]=re,e[29]=ie,e[30]=a,e[31]=d,e[32]=v):v=e[32];let y;e[33]!==_||e[34]!==v?(y=(0,x.jsxs)(`div`,{className:`w-full md:w-[400px] h-full`,children:[_,v]}),e[33]=_,e[34]=v,e[35]=y):y=e[35];let pe;return e[36]!==g||e[37]!==y?(pe=(0,x.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[g,y]}),e[36]=g,e[37]=y,e[38]=pe):pe=e[38],pe};export{C as default};