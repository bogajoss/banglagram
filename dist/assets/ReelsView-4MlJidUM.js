import{n as e,t}from"./ShareModal-QfzK6s-D.js";import{D as n,E as r,F as i,I as a,N as o,P as s,S as c,T as l,a as u,b as d,d as ee,f as te,g as ne,i as re,j as f,k as p,p as ie,r as ae,u as m,v as oe,w as h,x as se}from"./index-CrDnitAs.js";import"./useGetSuggestedUsers-CGrzbuN_.js";import{t as g}from"./useFollowUser-cFAcaZ2H.js";var ce=h(`music-2`,[[`circle`,{cx:`8`,cy:`18`,r:`4`,key:`1fc0mg`}],[`path`,{d:`M12 18V2l7 4`,key:`g04rme`}]]),_=h(`play`,[[`path`,{d:`M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z`,key:`10ikf1`}]]),v=h(`volume-2`,[[`path`,{d:`M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z`,key:`uqj9uw`}],[`path`,{d:`M16 9a5 5 0 0 1 0 6`,key:`1q6k2b`}],[`path`,{d:`M19.364 18.364a9 9 0 0 0 0-12.728`,key:`ijwkga`}]]),y=h(`volume-x`,[[`path`,{d:`M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z`,key:`uqj9uw`}],[`line`,{x1:`22`,x2:`16`,y1:`9`,y2:`15`,key:`1ewh16`}],[`line`,{x1:`16`,x2:`22`,y1:`9`,y2:`15`,key:`5ykzw1`}]]),le=n(),b=a(i(),1),x=f(),ue=n=>{let i=(0,le.c)(131),{reel:a,showToast:o,theme:s,onUserClick:c,glassModal:u}=n,{setViewingReel:f}=ie(),{user:p}=te(),{mutate:m}=ae(),{mutate:h}=g(),[ue,fe]=(0,b.useState)(!1),[S,pe]=(0,b.useState)(!0),[C,me]=(0,b.useState)(!0),[he,ge]=(0,b.useState)(!1),[_e,ve]=(0,b.useState)(!1),ye=(0,b.useRef)(null),w=(0,b.useRef)(null),T=`${window.location.origin}/reels/${a.id}`,be=a.hasLiked||!1,xe;i[0]!==be||i[1]!==a.id||i[2]!==o||i[3]!==m||i[4]!==p?(xe=()=>{if(!p){o(`লাইক করতে লগ ইন করুন`);return}m({targetId:a.id,type:`reel`,userId:p.id,hasLiked:be})},i[0]=be,i[1]=a.id,i[2]=o,i[3]=m,i[4]=p,i[5]=xe):xe=i[5];let E=xe,Se;i[6]!==h||i[7]!==a.user.isFollowing||i[8]!==a.user.username||i[9]!==a.userId||i[10]!==o||i[11]!==p?(Se=()=>{if(!p){o(`ফলো করতে লগ ইন করুন`);return}a.userId&&h({targetUserId:a.userId,currentUserId:p.id,isFollowing:a.user.isFollowing||!1,targetUsername:a.user.username},{onSuccess:()=>o(`ফলো করা হয়েছে`),onError:()=>o(`ফলো করতে সমস্যা হয়েছে`)})},i[6]=h,i[7]=a.user.isFollowing,i[8]=a.user.username,i[9]=a.userId,i[10]=o,i[11]=p,i[12]=Se):Se=i[12];let Ce=Se,we;i[13]===C?we=i[14]:(we=()=>{w.current&&(C?(w.current.pause(),me(!1)):(w.current.play(),me(!0)))},i[13]=C,i[14]=we);let Te=we,Ee,De;i[15]===Symbol.for(`react.memo_cache_sentinel`)?(Ee=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(w.current?.play().catch(de),me(!0),pe(!1)):(w.current?.pause(),me(!1),pe(!0))},{threshold:.6});return ye.current&&e.observe(ye.current),()=>e.disconnect()},De=[],i[15]=Ee,i[16]=De):(Ee=i[15],De=i[16]),(0,b.useEffect)(Ee,De);let Oe;i[17]===E?Oe=i[18]:(Oe=()=>{E(),fe(!0),setTimeout(()=>fe(!1),1e3)},i[17]=E,i[18]=Oe);let ke=Oe,Ae,je,Me,Ne;i[19]===Symbol.for(`react.memo_cache_sentinel`)?(je={opacity:0,scale:.95},Me={opacity:1,scale:1},Ne={once:!0},Ae={duration:.5},i[19]=Ae,i[20]=je,i[21]=Me,i[22]=Ne):(Ae=i[19],je=i[20],Me=i[21],Ne=i[22]);let D;i[23]!==u||i[24]!==he||i[25]!==T||i[26]!==o||i[27]!==s?(D=he&&(0,x.jsx)(e,{onClose:()=>ge(!1),showToast:o,theme:s,glassModal:u,shareUrl:T}),i[23]=u,i[24]=he,i[25]=T,i[26]=o,i[27]=s,i[28]=D):D=i[28];let O;i[29]!==u||i[30]!==_e||i[31]!==T||i[32]!==o||i[33]!==s?(O=_e&&(0,x.jsx)(t,{onClose:()=>ve(!1),theme:s,showToast:o,glassModal:u,shareUrl:T}),i[29]=u,i[30]=_e,i[31]=T,i[32]=o,i[33]=s,i[34]=O):O=i[34];let k;i[35]!==S||i[36]!==a.src||i[37]!==Te?(k=a.src?(0,x.jsx)(`video`,{ref:w,src:a.src,className:`w-full h-full object-cover`,loop:!0,muted:S,onClick:Te}):(0,x.jsx)(ee,{src:a.src,className:`w-full h-full`,onClick:()=>pe(!S),alt:`reel`}),i[35]=S,i[36]=a.src,i[37]=Te,i[38]=k):k=i[38];let A;i[39]===C?A=i[40]:(A=!C&&(0,x.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,x.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,x.jsx)(_,{className:`text-white w-10 h-10 fill-white`})})}),i[39]=C,i[40]=A);let j;i[41]===S?j=i[42]:(j=(0,x.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),pe(!S)},children:S?(0,x.jsx)(y,{className:`text-white w-5 h-5`}):(0,x.jsx)(v,{className:`text-white w-5 h-5`})}),i[41]=S,i[42]=j);let M;i[43]===ue?M=i[44]:(M=ue&&(0,x.jsx)(l.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,x.jsx)(d,{size:100,className:`text-white fill-white drop-shadow-lg`})}),i[43]=ue,i[44]=M);let N;i[45]===M?N=i[46]:(N=(0,x.jsx)(r,{children:M}),i[45]=M,i[46]=N);let Pe;i[47]!==c||i[48]!==a.user?(Pe=()=>c(a.user),i[47]=c,i[48]=a.user,i[49]=Pe):Pe=i[49];let P;i[50]===a.user.avatar?P=i[51]:(P=(0,x.jsx)(`div`,{className:`w-8 h-8 rounded-full border border-white/50 overflow-hidden cursor-pointer`,children:(0,x.jsx)(ee,{src:a.user.avatar,className:`w-full h-full`,alt:`reel user`})}),i[50]=a.user.avatar,i[51]=P);let F;i[52]===a.user.username?F=i[53]:(F=(0,x.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:a.user.username}),i[52]=a.user.username,i[53]=F);let I;i[54]===a.user.isVerified?I=i[55]:(I=a.user.isVerified&&(0,x.jsx)(re,{}),i[54]=a.user.isVerified,i[55]=I);let Fe,Ie;i[56]===Symbol.for(`react.memo_cache_sentinel`)?(Fe={scale:1.05},Ie={scale:.95},i[56]=Fe,i[57]=Ie):(Fe=i[56],Ie=i[57]);let Le=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${a.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,L;i[58]===Ce?L=i[59]:(L=e=>{e.stopPropagation(),Ce()},i[58]=Ce,i[59]=L);let Re=a.user.isFollowing?`ফলো করছেন`:`ফলো`,R;i[60]!==Le||i[61]!==L||i[62]!==Re?(R=(0,x.jsx)(l.button,{whileHover:Fe,whileTap:Ie,className:Le,onClick:L,children:Re}),i[60]=Le,i[61]=L,i[62]=Re,i[63]=R):R=i[63];let z;i[64]!==Pe||i[65]!==P||i[66]!==F||i[67]!==I||i[68]!==R?(z=(0,x.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:Pe,children:[P,F,I,R]}),i[64]=Pe,i[65]=P,i[66]=F,i[67]=I,i[68]=R,i[69]=z):z=i[69];let ze;i[70]===Symbol.for(`react.memo_cache_sentinel`)?(ze=(0,x.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`আরও`}),i[70]=ze):ze=i[70];let B;i[71]===a.caption?B=i[72]:(B=(0,x.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[a.caption,` `,ze]}),i[71]=a.caption,i[72]=B);let Be;i[73]===Symbol.for(`react.memo_cache_sentinel`)?(Be=(0,x.jsx)(ce,{size:12}),i[73]=Be):Be=i[73];let V;i[74]===a.audio?V=i[75]:(V=(0,x.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[Be,(0,x.jsx)(`div`,{className:`truncate w-40`,children:a.audio})]}),i[74]=a.audio,i[75]=V);let H;i[76]!==z||i[77]!==B||i[78]!==V?(H=(0,x.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[z,B,V]}),i[76]=z,i[77]=B,i[78]=V,i[79]=H):H=i[79];let Ve,He;i[80]===Symbol.for(`react.memo_cache_sentinel`)?(Ve={scale:1.1},He={scale:.9},i[80]=Ve,i[81]=He):(Ve=i[80],He=i[81]);let Ue=`cursor-pointer transition-colors ${be?`fill-[#f42a41] text-[#f42a41]`:``}`,U;i[82]!==E||i[83]!==Ue?(U=(0,x.jsx)(l.div,{whileHover:Ve,whileTap:He,children:(0,x.jsx)(d,{size:28,strokeWidth:1.5,className:Ue,onClick:E})}),i[82]=E,i[83]=Ue,i[84]=U):U=i[84];let W;i[85]===a.likes?W=i[86]:(W=(0,x.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:a.likes}),i[85]=a.likes,i[86]=W);let G;i[87]!==U||i[88]!==W?(G=(0,x.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[U,W]}),i[87]=U,i[88]=W,i[89]=G):G=i[89];let We,Ge;i[90]===Symbol.for(`react.memo_cache_sentinel`)?(We={scale:1.1},Ge={scale:.9},i[90]=We,i[91]=Ge):(We=i[90],Ge=i[91]);let K;i[92]!==a||i[93]!==f?(K=(0,x.jsx)(l.div,{whileHover:We,whileTap:Ge,children:(0,x.jsx)(oe,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>f(a)})}),i[92]=a,i[93]=f,i[94]=K):K=i[94];let q;i[95]===a.comments?q=i[96]:(q=(0,x.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:a.comments}),i[95]=a.comments,i[96]=q);let J;i[97]!==K||i[98]!==q?(J=(0,x.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[K,q]}),i[97]=K,i[98]=q,i[99]=J):J=i[99];let Ke,qe;i[100]===Symbol.for(`react.memo_cache_sentinel`)?(Ke={scale:1.1},qe={scale:.9},i[100]=Ke,i[101]=qe):(Ke=i[100],qe=i[101]);let Je;i[102]===Symbol.for(`react.memo_cache_sentinel`)?(Je=(0,x.jsx)(l.div,{whileHover:Ke,whileTap:qe,children:(0,x.jsx)(ne,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ve(!0)})}),i[102]=Je):Je=i[102];let Ye,Xe;i[103]===Symbol.for(`react.memo_cache_sentinel`)?(Ye={scale:1.1},Xe={scale:.9},i[103]=Ye,i[104]=Xe):(Ye=i[103],Xe=i[104]);let Ze;i[105]===Symbol.for(`react.memo_cache_sentinel`)?(Ze=(0,x.jsx)(l.div,{whileHover:Ye,whileTap:Xe,children:(0,x.jsx)(se,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ge(!0)})}),i[105]=Ze):Ze=i[105];let Qe;i[106]===Symbol.for(`react.memo_cache_sentinel`)?(Qe={scale:1.1},i[106]=Qe):Qe=i[106];let Y;i[107]!==c||i[108]!==a.user?(Y=()=>c(a.user),i[107]=c,i[108]=a.user,i[109]=Y):Y=i[109];let X;i[110]===a.user.avatar?X=i[111]:(X=(0,x.jsx)(ee,{src:a.user.avatar,className:`w-full h-full`,alt:`user thumb`}),i[110]=a.user.avatar,i[111]=X);let Z;i[112]!==Y||i[113]!==X?(Z=(0,x.jsx)(l.div,{whileHover:Qe,className:`w-6 h-6 border-2 border-white rounded-md overflow-hidden mt-2 cursor-pointer`,onClick:Y,children:X}),i[112]=Y,i[113]=X,i[114]=Z):Z=i[114];let Q;i[115]!==G||i[116]!==J||i[117]!==Z?(Q=(0,x.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[G,J,Je,Ze,Z]}),i[115]=G,i[116]=J,i[117]=Z,i[118]=Q):Q=i[118];let $;i[119]!==ke||i[120]!==k||i[121]!==A||i[122]!==j||i[123]!==N||i[124]!==H||i[125]!==Q?($=(0,x.jsxs)(`div`,{ref:ye,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-zinc-900 md:rounded-lg overflow-hidden border-zinc-800 md:border group shadow-2xl`,onDoubleClick:ke,children:[k,A,j,N,H,Q]}),i[119]=ke,i[120]=k,i[121]=A,i[122]=j,i[123]=N,i[124]=H,i[125]=Q,i[126]=$):$=i[126];let $e;return i[127]!==D||i[128]!==O||i[129]!==$?($e=(0,x.jsxs)(l.div,{initial:je,whileInView:Me,viewport:Ne,transition:Ae,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[D,O,$]}),i[127]=D,i[128]=O,i[129]=$,i[130]=$e):$e=i[130],$e};function de(){}var fe=n();const S=e=>[`reel`,e],pe=(e,t)=>{let n=(0,fe.c)(9),r=e||``,i;n[0]===r?i=n[1]:(i=S(r),n[0]=r,n[1]=i);let a=!!e,o;n[2]!==t||n[3]!==e?(o=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await m.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await m.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await m.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},n[2]=t,n[3]=e,n[4]=o):o=n[4];let s;return n[5]!==i||n[6]!==a||n[7]!==o?(s={queryKey:i,enabled:a,queryFn:o},n[5]=i,n[6]=a,n[7]=o,n[8]=s):s=n[8],p(s)};var C=n(),me=()=>{let e=(0,C.c)(32),{theme:t,showToast:n}=ie(),{user:r}=te(),i=o(),{id:a}=s(),l=t===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,{data:d,isLoading:ee}=pe(a,r?.id),{data:ne,isLoading:re}=u(r?.id),f;e[0]===ne?f=e[1]:(f=ne===void 0?[]:ne,e[0]=ne,e[1]=f);let p=f,ae;e[2]===i?ae=e[3]:(ae=e=>{i(`/profile/${e.username}`)},e[2]=i,e[3]=ae);let m=ae,oe=a?ee:re,h;e[4]!==p||e[5]!==a||e[6]!==d?(h=a?d?[d]:[]:p,e[4]=p,e[5]=a,e[6]=d,e[7]=h):h=e[7];let se=h;if(oe){let t;return e[8]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,x.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:`Loading reel...`}),e[8]=t):t=e[8],t}if(se.length===0){let t=a?`Reel not found`:`No reels yet`,n;return e[9]===t?n=e[10]:(n=(0,x.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:t}),e[9]=t,e[10]=n),n}let g;e[11]===i?g=e[12]:(g=()=>i(`/`),e[11]=i,e[12]=g);let ce;e[13]===Symbol.for(`react.memo_cache_sentinel`)?(ce=(0,x.jsx)(c,{size:28}),e[13]=ce):ce=e[13];let _;e[14]===g?_=e[15]:(_=(0,x.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:g,children:ce}),e[14]=g,e[15]=_);let v;if(e[16]!==se||e[17]!==l||e[18]!==m||e[19]!==n||e[20]!==t){let r;e[22]!==l||e[23]!==m||e[24]!==n||e[25]!==t?(r=e=>(0,x.jsx)(ue,{reel:e,showToast:n,theme:t,onUserClick:m,glassModal:l},e.id),e[22]=l,e[23]=m,e[24]=n,e[25]=t,e[26]=r):r=e[26],v=se.map(r),e[16]=se,e[17]=l,e[18]=m,e[19]=n,e[20]=t,e[21]=v}else v=e[21];let y;e[27]===v?y=e[28]:(y=(0,x.jsx)(`div`,{className:`w-full md:w-[400px] h-full`,children:v}),e[27]=v,e[28]=y);let le;return e[29]!==_||e[30]!==y?(le=(0,x.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[_,y]}),e[29]=_,e[30]=y,e[31]=le):le=e[31],le};export{me as default};