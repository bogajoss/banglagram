import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{$t as t,Bt as n,Ft as r,Ht as i,J as a,N as o,Nt as s,Rt as c,Xt as ee,it as l,mt as u,n as te}from"./vendor-BGrLWuzF.js";import{Vt as d}from"./libs-eJHw-jrC.js";import"./tanstack-CjdblyHw.js";import"./supabase-CBM4FLKd.js";import{_ as f,b as ne,c as re,w as ie,x as ae,y as oe}from"./index-qR2YstvC.js";var p=e(t(),1),m=r();const h=[`explorePosts`],se=()=>{let e=(0,m.c)(1),t;return e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t={queryKey:h,queryFn:_,initialPageParam:0,getNextPageParam:v},e[0]=t):t=e[0],c(t)};function g(e){let t=e.profiles;return{id:e.id,user:{id:e.user_id,username:t?.username||`Unknown`,name:t?.full_name||`Unknown`,avatar:t?.avatar_url||``,isVerified:t?.is_verified||!1},content:{type:`image`,src:e.image_url},likes:e.likes[0]?.count||0,comments:e.comments[0]?.count||0,caption:e.caption||``,time:``}}async function _(e){let{pageParam:t}=e,n=(t===void 0?0:t)*15,r=n+14,{data:i,error:a}=await f.from(`posts`).select(`
          id,
          image_url,
          user_id,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).order(`created_at`,{ascending:!1}).range(n,r);if(a)throw a;return i.map(g)}function v(e,t){return e.length===15?t.length:void 0}var y=r(),b=e(d(),1);const x=e=>[`searchPosts`,e],ce=e=>{let t=(0,y.c)(8),r;t[0]===e?r=t[1]:(r=x(e),t[0]=e,t[1]=r);let i=!!e&&e.length>0,a;t[2]===e?a=t[3]:(a=async()=>{let{data:t,error:n}=await f.from(`posts`).select(`
          id,
          created_at,
          caption,
          image_url,
          user_id,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).ilike(`caption`,`%${e}%`).order(`created_at`,{ascending:!1}).limit(20);if(n)throw n;return(t||[]).map(S)},t[2]=e,t[3]=a);let o;return t[4]!==r||t[5]!==i||t[6]!==a?(o={queryKey:r,enabled:i,queryFn:a},t[4]=r,t[5]=i,t[6]=a,t[7]=o):o=t[7],n(o)};function S(e){let t=e.profiles;return{id:e.id,user:{id:e.user_id,username:t?.username||`Unknown`,name:t?.full_name||`Unknown`,avatar:t?.avatar_url||``,isVerified:t?.is_verified||!1},content:{type:`image`,src:e.image_url},likes:e.likes[0]?.count||0,caption:e.caption||``,comments:e.comments[0]?.count||0,time:(0,b.default)(e.created_at).fromNow(),createdAt:e.created_at,isVerified:t?.is_verified||!1}}var le=r(),C=i(),w=()=>{let e=(0,le.c)(56),{theme:t,setViewingPost:n}=ie(),r=ee(),[i,c]=(0,p.useState)(``),[d,m]=(0,p.useState)(`accounts`),h;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(h=[],e[0]=h):h=e[0];let[g,_]=(0,p.useState)(h),[v,y]=(0,p.useState)(!1),b;e[1]===Symbol.for(`react.memo_cache_sentinel`)?(b={rootMargin:`1200px`},e[1]=b):b=e[1];let{ref:x,inView:S}=te(b),{data:w,isLoading:T,fetchNextPage:E,hasNextPage:D,isFetchingNextPage:O}=se(),{data:k,isLoading:A}=ce(d===`posts`?i:``),j;e[2]===k?j=e[3]:(j=k===void 0?[]:k,e[2]=k,e[3]=j);let M=j,N,P;e[4]!==E||e[5]!==D||e[6]!==S||e[7]!==i?(N=()=>{S&&D&&!i&&E()},P=[S,D,E,i],e[4]=E,e[5]=D,e[6]=S,e[7]=i,e[8]=N,e[9]=P):(N=e[8],P=e[9]),(0,p.useEffect)(N,P);let F,I;e[10]!==i||e[11]!==d?(F=()=>{let e=setTimeout(async()=>{if(i.trim().length>0){if(d===`accounts`){y(!0);let{data:e}=await f.from(`profiles`).select(`id, username, full_name, avatar_url, is_verified`).ilike(`username`,`%${i}%`).limit(10);e&&_(e.map(ue)),y(!1)}}else _([])},300);return()=>clearTimeout(e)},I=[i,d],e[10]=i,e[11]=d,e[12]=F,e[13]=I):(F=e[12],I=e[13]),(0,p.useEffect)(F,I);let L;e[14]===Symbol.for(`react.memo_cache_sentinel`)?(L={opacity:0},e[14]=L):L=e[14];let R;e[15]===Symbol.for(`react.memo_cache_sentinel`)?(R={hidden:L,visible:{opacity:1,transition:{staggerChildren:.05}}},e[15]=R):R=e[15];let de=R,z;e[16]===Symbol.for(`react.memo_cache_sentinel`)?(z={hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},e[16]=z):z=e[16];let B=z,V=`mb-4 sticky top-0 z-30 py-2 ${t===`dark`?`bg-black`:`bg-white`}`,H=`flex items-center gap-2 px-3 py-2 rounded-lg ${t===`dark`?`bg-[#262626]`:`bg-gray-100`}`,U=t===`dark`?`text-[#8e8e8e]`:`text-gray-500`,W;e[17]===U?W=e[18]:(W=(0,C.jsx)(a,{size:18,className:U}),e[17]=U,e[18]=W);let G;e[19]===Symbol.for(`react.memo_cache_sentinel`)?(G=e=>c(e.target.value),e[19]=G):G=e[19];let K=`bg-transparent border-none outline-none text-sm w-full p-0 h-auto ${t===`dark`?`text-white`:`text-black`}`,q;e[20]!==i||e[21]!==K?(q=(0,C.jsx)(`input`,{type:`text`,placeholder:`Search`,value:i,onChange:G,className:K}),e[20]=i,e[21]=K,e[22]=q):q=e[22];let J;e[23]===i?J=e[24]:(J=i&&(0,C.jsx)(o,{size:18,className:`cursor-pointer`,onClick:()=>c(``)}),e[23]=i,e[24]=J);let Y;e[25]!==H||e[26]!==W||e[27]!==q||e[28]!==J?(Y=(0,C.jsxs)(`div`,{className:H,children:[W,q,J]}),e[25]=H,e[26]=W,e[27]=q,e[28]=J,e[29]=Y):Y=e[29];let X;e[30]!==i||e[31]!==d||e[32]!==t?(X=i&&(0,C.jsxs)(`div`,{className:`flex mt-2 border-b border-zinc-700`,children:[(0,C.jsx)(`button`,{className:`flex-1 py-2 text-sm font-semibold ${d===`accounts`?t===`dark`?`text-white border-b-2 border-white`:`text-black border-b-2 border-black`:`text-zinc-500`}`,onClick:()=>m(`accounts`),children:`Accounts`}),(0,C.jsx)(`button`,{className:`flex-1 py-2 text-sm font-semibold ${d===`posts`?t===`dark`?`text-white border-b-2 border-white`:`text-black border-b-2 border-black`:`text-zinc-500`}`,onClick:()=>m(`posts`),children:`Posts`})]}),e[30]=i,e[31]=d,e[32]=t,e[33]=X):X=e[33];let Z;e[34]!==V||e[35]!==Y||e[36]!==X?(Z=(0,C.jsxs)(`div`,{className:V,children:[Y,X]}),e[34]=V,e[35]=Y,e[36]=X,e[37]=Z):Z=e[37];let Q;e[38]!==w?.pages||e[39]!==D||e[40]!==T||e[41]!==O||e[42]!==A||e[43]!==v||e[44]!==r||e[45]!==M||e[46]!==x||e[47]!==i||e[48]!==d||e[49]!==n||e[50]!==t||e[51]!==g?(Q=i?(0,C.jsxs)(`div`,{className:`flex flex-col gap-2`,children:[d===`accounts`&&(0,C.jsxs)(C.Fragment,{children:[v&&(0,C.jsx)(`div`,{className:`p-4 text-center`,children:`Searching...`}),!v&&g.length===0&&(0,C.jsx)(`div`,{className:`p-4 text-center text-gray-500`,children:`No accounts found`}),g.map(e=>(0,C.jsxs)(`div`,{onClick:()=>r(`/profile/${e.username}`),className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer ${t===`dark`?`hover:bg-white/10`:`hover:bg-gray-100`}`,children:[(0,C.jsxs)(oe,{className:`w-10 h-10`,children:[(0,C.jsx)(ae,{src:e.avatar}),(0,C.jsx)(ne,{children:e.username?.[0]?.toUpperCase()||`?`})]}),(0,C.jsxs)(`div`,{className:`flex flex-col`,children:[(0,C.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,C.jsx)(`span`,{className:`font-semibold text-sm`,children:e.username}),e.isVerified&&(0,C.jsx)(re,{})]}),(0,C.jsx)(`span`,{className:`text-xs text-gray-500`,children:e.name})]})]},e.username))]}),d===`posts`&&(0,C.jsxs)(C.Fragment,{children:[A&&(0,C.jsx)(`div`,{className:`p-4 text-center`,children:`Searching posts...`}),!A&&M.length===0&&(0,C.jsx)(`div`,{className:`p-4 text-center text-gray-500`,children:`No posts found`}),(0,C.jsx)(`div`,{className:`grid grid-cols-3 gap-1 md:gap-4`,children:M.map(e=>(0,C.jsxs)(s.div,{variants:B,whileHover:{scale:.98},className:`relative aspect-square group cursor-pointer overflow-hidden`,onClick:()=>n(e),children:[(0,C.jsx)(`img`,{src:e.content.src||e.content.poster,className:`w-full h-full transition-transform duration-300 group-hover:scale-110 object-cover`,alt:`search result`,loading:`lazy`}),(0,C.jsxs)(`div`,{className:`absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-4 text-white font-bold transition-opacity duration-200 z-20`,children:[(0,C.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,C.jsx)(u,{fill:`white`,size:16}),` `,e.likes]}),(0,C.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,C.jsx)(l,{fill:`white`,size:16,className:`-scale-x-100`}),` `,e.comments]})]})]},e.id))})]})]}):(0,C.jsxs)(C.Fragment,{children:[T?(0,C.jsx)(`div`,{className:`p-10 text-center`,children:`Loading explore...`}):(0,C.jsx)(s.div,{variants:de,initial:`hidden`,animate:`visible`,className:`grid grid-cols-3 gap-1 md:gap-4`,children:w?.pages.map((e,t)=>(0,C.jsx)(p.Fragment,{children:e.map(e=>(0,C.jsxs)(s.div,{variants:B,whileHover:{scale:.98},className:`relative aspect-square group cursor-pointer overflow-hidden`,onClick:()=>n(e),children:[(0,C.jsx)(`img`,{src:e.content.src||e.content.poster,className:`w-full h-full transition-transform duration-300 group-hover:scale-110 object-cover`,alt:`explore`,loading:`lazy`}),(0,C.jsxs)(`div`,{className:`absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-4 text-white font-bold transition-opacity duration-200 z-20`,children:[(0,C.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,C.jsx)(u,{fill:`white`,size:16}),` `,e.likes]}),(0,C.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,C.jsx)(l,{fill:`white`,size:16,className:`-scale-x-100`}),` `,e.comments]})]})]},e.id))},t))}),(0,C.jsx)(`div`,{ref:x,className:`h-10 text-center py-4 text-gray-500`,children:O?`Loading more...`:D?`See below`:``})]}),e[38]=w?.pages,e[39]=D,e[40]=T,e[41]=O,e[42]=A,e[43]=v,e[44]=r,e[45]=M,e[46]=x,e[47]=i,e[48]=d,e[49]=n,e[50]=t,e[51]=g,e[52]=Q):Q=e[52];let $;return e[53]!==Z||e[54]!==Q?($=(0,C.jsxs)(`div`,{className:`w-full max-w-[935px] py-4 px-2`,children:[Z,Q]}),e[53]=Z,e[54]=Q,e[55]=$):$=e[55],$};function ue(e){return{id:e.id,username:e.username,name:e.full_name||e.username,avatar:e.avatar_url||``,isVerified:e.is_verified||!1}}export{w as default};