import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{$t as t,Gt as n,I as r,It as i,Rt as a,Ut as o,Vt as s,Z as c,_t as l,m as u,rn as d,st as f}from"./vendor-CYhgnaJV.js";import{wt as p}from"./libs-BZRZkBIg.js";import"./tanstack-CjdblyHw.js";import"./supabase-CVUXu_xj.js";import{I as m,M as h,N as g,c as _,j as v,k as y,v as b}from"./index-Cc3xPmN8.js";var x=e(d(),1),S=a();const C=[`explorePosts`],w=()=>{let e=(0,S.c)(1),t;return e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t={queryKey:C,queryFn:E,initialPageParam:0,getNextPageParam:D},e[0]=t):t=e[0],s(t)};function T(e){let t=e.profiles;return{id:e.id,user:{id:e.user_id,username:t?.username||`Unknown`,name:t?.full_name||`Unknown`,avatar:t?.avatar_url||``,isVerified:t?.is_verified||!1},content:{type:`image`,src:e.image_url},likes:e.likes[0]?.count||0,comments:e.comments[0]?.count||0,caption:e.caption||``,time:``}}async function E(e){let{pageParam:t}=e,n=(t===void 0?0:t)*15,r=n+14,{data:i,error:a}=await y.from(`posts`).select(`
          id,
          image_url,
          user_id,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).order(`created_at`,{ascending:!1}).range(n,r);if(a)throw a;return i.map(T)}function D(e,t){return e.length===15?t.length:void 0}var O=a(),k=e(p(),1);const A=e=>[`searchPosts`,e],j=e=>{let t=(0,O.c)(8),n;t[0]===e?n=t[1]:(n=A(e),t[0]=e,t[1]=n);let r=!!e&&e.length>0,i;t[2]===e?i=t[3]:(i=async()=>{let{data:t,error:n}=await y.from(`posts`).select(`
          id,
          created_at,
          caption,
          image_url,
          user_id,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).ilike(`caption`,`%${e}%`).order(`created_at`,{ascending:!1}).limit(20);if(n)throw n;return(t||[]).map(M)},t[2]=e,t[3]=i);let a;return t[4]!==n||t[5]!==r||t[6]!==i?(a={queryKey:n,enabled:r,queryFn:i},t[4]=n,t[5]=r,t[6]=i,t[7]=a):a=t[7],o(a)};function M(e){let t=e.profiles;return{id:e.id,user:{id:e.user_id,username:t?.username||`Unknown`,name:t?.full_name||`Unknown`,avatar:t?.avatar_url||``,isVerified:t?.is_verified||!1},content:{type:`image`,src:e.image_url},likes:e.likes[0]?.count||0,caption:e.caption||``,comments:e.comments[0]?.count||0,time:(0,k.default)(e.created_at).fromNow(),createdAt:e.created_at,isVerified:t?.is_verified||!1}}var N=n(),P=()=>{let{setViewingPost:e}=m(),n=t(),[a,o]=(0,x.useState)(``),[s,d]=(0,x.useState)(`accounts`),[p,S]=(0,x.useState)([]),[C,T]=(0,x.useState)(!1),{ref:E,inView:D}=u({rootMargin:`1200px`}),{data:O,isLoading:k,fetchNextPage:A,hasNextPage:M,isFetchingNextPage:P}=w(),{data:F=[],isLoading:I}=j(s===`posts`?a:``);(0,x.useEffect)(()=>{D&&M&&!a&&A()},[D,M,A,a]),(0,x.useEffect)(()=>{let e=setTimeout(async()=>{if(a.trim().length>0){if(s===`accounts`){T(!0);let{data:e}=await y.from(`profiles`).select(`id, username, full_name, avatar_url, is_verified`).ilike(`username`,`%${a}%`).limit(10);e&&S(e.map(e=>({id:e.id,username:e.username,name:e.full_name||e.username,avatar:e.avatar_url||``,isVerified:e.is_verified||!1}))),T(!1)}}else S([])},300);return()=>clearTimeout(e)},[a,s]);let L={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},R={hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}};return(0,N.jsxs)(`div`,{className:`w-full max-w-[935px] py-4 px-2`,children:[(0,N.jsxs)(`div`,{className:`mb-4 sticky top-0 z-30 py-2 bg-background`,children:[(0,N.jsxs)(`div`,{className:`flex items-center gap-2 px-3 py-2 rounded-lg bg-muted`,children:[(0,N.jsx)(c,{size:18,className:`text-muted-foreground`}),(0,N.jsx)(`input`,{type:`text`,placeholder:`Search`,value:a,onChange:e=>o(e.target.value),className:`bg-transparent border-none outline-none text-sm w-full p-0 h-auto text-foreground`}),a&&(0,N.jsx)(r,{size:18,className:`cursor-pointer text-muted-foreground`,onClick:()=>o(``)})]}),a&&(0,N.jsxs)(`div`,{className:`flex mt-2 border-b border-border`,children:[(0,N.jsx)(`button`,{className:`flex-1 py-2 text-sm font-semibold transition-colors ${s===`accounts`?`text-foreground border-b-2 border-foreground`:`text-muted-foreground hover:text-foreground`}`,onClick:()=>d(`accounts`),children:`Accounts`}),(0,N.jsx)(`button`,{className:`flex-1 py-2 text-sm font-semibold transition-colors ${s===`posts`?`text-foreground border-b-2 border-foreground`:`text-muted-foreground hover:text-foreground`}`,onClick:()=>d(`posts`),children:`Posts`})]})]}),a?(0,N.jsxs)(`div`,{className:`flex flex-col gap-2`,children:[s===`accounts`&&(0,N.jsxs)(N.Fragment,{children:[C&&(0,N.jsx)(`div`,{className:`space-y-2`,children:[1,2,3].map(e=>(0,N.jsxs)(`div`,{className:`flex items-center gap-3 p-2`,children:[(0,N.jsx)(b,{className:`h-10 w-10 rounded-full`}),(0,N.jsxs)(`div`,{className:`space-y-2`,children:[(0,N.jsx)(b,{className:`h-4 w-32`}),(0,N.jsx)(b,{className:`h-3 w-24`})]})]},e))}),!C&&p.length===0&&(0,N.jsx)(`div`,{className:`p-4 text-center text-muted-foreground`,children:`No accounts found`}),p.map(e=>(0,N.jsxs)(`div`,{onClick:()=>n(`/profile/${e.username}`),className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer hover:bg-muted transition-colors`,children:[(0,N.jsxs)(v,{className:`w-10 h-10`,children:[(0,N.jsx)(g,{src:e.avatar}),(0,N.jsx)(h,{children:e.username?.[0]?.toUpperCase()||`?`})]}),(0,N.jsxs)(`div`,{className:`flex flex-col`,children:[(0,N.jsxs)(`div`,{className:`flex items-center gap-1 text-foreground`,children:[(0,N.jsx)(`span`,{className:`font-semibold text-sm`,children:e.username}),e.isVerified&&(0,N.jsx)(_,{})]}),(0,N.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.name})]})]},e.username))]}),s===`posts`&&(0,N.jsxs)(N.Fragment,{children:[I&&(0,N.jsx)(`div`,{className:`grid grid-cols-3 gap-1 md:gap-4`,children:[1,2,3,4,5,6].map(e=>(0,N.jsx)(b,{className:`aspect-square`},e))}),!I&&F.length===0&&(0,N.jsx)(`div`,{className:`p-4 text-center text-muted-foreground`,children:`No posts found`}),(0,N.jsx)(`div`,{className:`grid grid-cols-3 gap-1 md:gap-4`,children:F.map(t=>{let n=t.content.src||t.content.poster;try{n&&n.startsWith(`[`)&&(n=JSON.parse(n)[0])}catch{}return(0,N.jsxs)(i.div,{variants:R,whileHover:{scale:.98},className:`relative aspect-square group cursor-pointer overflow-hidden`,onClick:()=>e(t),children:[(0,N.jsx)(`img`,{src:n,className:`w-full h-full transition-transform duration-300 group-hover:scale-110 object-cover`,alt:`search result`,loading:`lazy`}),(0,N.jsxs)(`div`,{className:`absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-4 text-white font-bold transition-opacity duration-200 z-20`,children:[(0,N.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,N.jsx)(l,{fill:`white`,size:16}),` `,t.likes]}),(0,N.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,N.jsx)(f,{fill:`white`,size:16,className:`-scale-x-100`}),` `,t.comments]})]})]},t.id)})})]})]}):(0,N.jsxs)(N.Fragment,{children:[k?(0,N.jsx)(`div`,{className:`grid grid-cols-3 gap-1 md:gap-4`,children:[1,2,3,4,5,6,7,8,9].map(e=>(0,N.jsx)(b,{className:`aspect-square`},e))}):(0,N.jsx)(i.div,{variants:L,initial:`hidden`,animate:`visible`,className:`grid grid-cols-3 gap-1 md:gap-4`,children:O?.pages.map((t,n)=>(0,N.jsx)(x.Fragment,{children:t.map(t=>{let n=t.content.src||t.content.poster;try{n&&n.startsWith(`[`)&&(n=JSON.parse(n)[0])}catch{}return(0,N.jsxs)(i.div,{variants:R,whileHover:{scale:.98},className:`relative aspect-square group cursor-pointer overflow-hidden`,onClick:()=>e(t),children:[(0,N.jsx)(`img`,{src:n,className:`w-full h-full transition-transform duration-300 group-hover:scale-110 object-cover`,alt:`explore`,loading:`lazy`}),(0,N.jsxs)(`div`,{className:`absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-4 text-white font-bold transition-opacity duration-200 z-20`,children:[(0,N.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,N.jsx)(l,{fill:`white`,size:16}),` `,t.likes]}),(0,N.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,N.jsx)(f,{fill:`white`,size:16,className:`-scale-x-100`}),` `,t.comments]})]})]},t.id)})},n))}),`          `,(0,N.jsx)(`div`,{ref:E,className:`h-10 text-center py-4 text-muted-foreground`,children:P?`Loading more...`:M?`See below`:``})]})]})};export{P as default};