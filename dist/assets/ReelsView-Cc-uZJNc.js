import{a as e}from"./rolldown-runtime-DDUpfMIz.js";import{B as t,Ct as n,Ht as r,Tt as i,Ut as a,V as o,Vt as s,Xt as c,an as l,at as ee,in as u,jt as d,nt as te,pt as ne,qt as f,sn as p,t as m,ut as re}from"./vendor-B3HL14pl.js";import"./libs-v5ruOQjS.js";import"./supabase-DoaD7gz2.js";import{S as ie,T as ae,b as h,c as oe,p as se,s as ce,u as le,v as g,w as ue,x as de}from"./index-AqHGfiHH.js";import{n as _,t as v}from"./ShareModal-DpsMhTZD.js";import"./useGetSuggestedUsers-B6VHM3Gp.js";import{t as y}from"./useFollowUser-DQJnDu7e.js";var b=a(),x=e(p(),1),S=e(c(),1),fe=m,pe=(0,x.memo)(e=>{let a=(0,b.c)(143),{reel:c,showToast:l,theme:u,onUserClick:d,glassModal:f}=e,{setViewingReel:p}=ae(),{user:m}=ue(),{mutate:se}=ce(),{mutate:g}=y(),[pe,me]=(0,x.useState)(!1),[C,he]=(0,x.useState)(!0),[w,ge]=(0,x.useState)(!0),[_e,ve]=(0,x.useState)(!1),[ye,be]=(0,x.useState)(!1),xe=(0,x.useRef)(null),Se=(0,x.useRef)(null),T=`${window.location.origin}/reels/${c.id}`,Ce=c.hasLiked||!1,we;a[0]!==Ce||a[1]!==c.id||a[2]!==l||a[3]!==se||a[4]!==m?(we=()=>{if(!m){l(`লাইক করতে লগ ইন করুন`);return}se({targetId:c.id,type:`reel`,userId:m.id,hasLiked:Ce})},a[0]=Ce,a[1]=c.id,a[2]=l,a[3]=se,a[4]=m,a[5]=we):we=a[5];let E=we,Te;a[6]!==g||a[7]!==c.user.isFollowing||a[8]!==c.user.username||a[9]!==c.userId||a[10]!==l||a[11]!==m?(Te=()=>{if(!m){l(`ফলো করতে লগ ইন করুন`);return}c.userId&&g({targetUserId:c.userId,currentUserId:m.id,isFollowing:c.user.isFollowing||!1,targetUsername:c.user.username},{onSuccess:()=>l(`ফলো করা হয়েছে`),onError:()=>l(`ফলো করতে সমস্যা হয়েছে`)})},a[6]=g,a[7]=c.user.isFollowing,a[8]=c.user.username,a[9]=c.userId,a[10]=l,a[11]=m,a[12]=Te):Te=a[12];let Ee=Te,De;a[13]===w?De=a[14]:(De=()=>{Se.current&&ge(!w)},a[13]=w,a[14]=De);let Oe=De,ke,Ae;a[15]===Symbol.for(`react.memo_cache_sentinel`)?(ke=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(ge(!0),he(!1)):(ge(!1),he(!0))},{threshold:.6});return xe.current&&e.observe(xe.current),()=>e.disconnect()},Ae=[],a[15]=ke,a[16]=Ae):(ke=a[15],Ae=a[16]),(0,x.useEffect)(ke,Ae);let je;a[17]===E?je=a[18]:(je=()=>{E(),me(!0),setTimeout(()=>me(!1),1e3)},a[17]=E,a[18]=je);let Me=je,Ne,Pe,Fe,Ie;a[19]===Symbol.for(`react.memo_cache_sentinel`)?(Pe={opacity:0,scale:.95},Fe={opacity:1,scale:1},Ie={once:!0},Ne={duration:.5},a[19]=Ne,a[20]=Pe,a[21]=Fe,a[22]=Ie):(Ne=a[19],Pe=a[20],Fe=a[21],Ie=a[22]);let D;a[23]!==f||a[24]!==_e||a[25]!==T||a[26]!==l||a[27]!==u?(D=_e&&(0,S.jsx)(_,{onClose:()=>ve(!1),showToast:l,theme:u,glassModal:f,shareUrl:T}),a[23]=f,a[24]=_e,a[25]=T,a[26]=l,a[27]=u,a[28]=D):D=a[28];let O;a[29]!==f||a[30]!==ye||a[31]!==T||a[32]!==l||a[33]!==u?(O=ye&&(0,S.jsx)(v,{onClose:()=>be(!1),theme:u,showToast:l,glassModal:f,shareUrl:T}),a[29]=f,a[30]=ye,a[31]=T,a[32]=l,a[33]=u,a[34]=O):O=a[34];let k;a[35]!==C||a[36]!==w||a[37]!==c.src||a[38]!==Oe?(k=c.src?(0,S.jsx)(`div`,{className:`w-full h-full cursor-pointer`,onClick:Oe,children:(0,S.jsx)(fe,{ref:Se,url:c.src,width:`100%`,height:`100%`,playing:w,muted:C,loop:!0,playsinline:!0,style:{objectFit:`cover`},className:`react-player pointer-events-none`})}):(0,S.jsx)(le,{src:c.src,width:400,className:`w-full h-full`,onClick:()=>he(!C),alt:`reel`}),a[35]=C,a[36]=w,a[37]=c.src,a[38]=Oe,a[39]=k):k=a[39];let A;a[40]===w?A=a[41]:(A=!w&&(0,S.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,S.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,S.jsx)(ee,{className:`text-white w-10 h-10 fill-white`})})}),a[40]=w,a[41]=A);let j;a[42]===C?j=a[43]:(j=(0,S.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),he(!C)},children:C?(0,S.jsx)(t,{className:`text-white w-5 h-5`}):(0,S.jsx)(o,{className:`text-white w-5 h-5`})}),a[42]=C,a[43]=j);let M;a[44]===pe?M=a[45]:(M=pe&&(0,S.jsx)(s.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,S.jsx)(n,{size:100,className:`text-white fill-white drop-shadow-lg`})}),a[44]=pe,a[45]=M);let N;a[46]===M?N=a[47]:(N=(0,S.jsx)(r,{children:M}),a[46]=M,a[47]=N);let P;a[48]!==d||a[49]!==c.user?(P=()=>d(c.user),a[48]=d,a[49]=c.user,a[50]=P):P=a[50];let F;a[51]===c.user.avatar?F=a[52]:(F=(0,S.jsx)(ie,{src:c.user.avatar}),a[51]=c.user.avatar,a[52]=F);let I;a[53]===c.user.username[0]?I=a[54]:(I=c.user.username[0].toUpperCase(),a[53]=c.user.username[0],a[54]=I);let L;a[55]===I?L=a[56]:(L=(0,S.jsx)(de,{children:I}),a[55]=I,a[56]=L);let R;a[57]!==F||a[58]!==L?(R=(0,S.jsxs)(h,{className:`w-8 h-8 border border-white/50 cursor-pointer`,children:[F,L]}),a[57]=F,a[58]=L,a[59]=R):R=a[59];let z;a[60]===c.user.username?z=a[61]:(z=(0,S.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:c.user.username}),a[60]=c.user.username,a[61]=z);let B;a[62]===c.user.isVerified?B=a[63]:(B=c.user.isVerified&&(0,S.jsx)(oe,{}),a[62]=c.user.isVerified,a[63]=B);let Le,Re;a[64]===Symbol.for(`react.memo_cache_sentinel`)?(Le={scale:1.05},Re={scale:.95},a[64]=Le,a[65]=Re):(Le=a[64],Re=a[65]);let ze=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${c.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,Be;a[66]===Ee?Be=a[67]:(Be=e=>{e.stopPropagation(),Ee()},a[66]=Ee,a[67]=Be);let Ve=c.user.isFollowing?`ফলো করছেন`:`ফলো`,V;a[68]!==ze||a[69]!==Be||a[70]!==Ve?(V=(0,S.jsx)(s.button,{whileHover:Le,whileTap:Re,className:ze,onClick:Be,children:Ve}),a[68]=ze,a[69]=Be,a[70]=Ve,a[71]=V):V=a[71];let H;a[72]!==P||a[73]!==R||a[74]!==z||a[75]!==B||a[76]!==V?(H=(0,S.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:P,children:[R,z,B,V]}),a[72]=P,a[73]=R,a[74]=z,a[75]=B,a[76]=V,a[77]=H):H=a[77];let He;a[78]===Symbol.for(`react.memo_cache_sentinel`)?(He=(0,S.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`আরও`}),a[78]=He):He=a[78];let U;a[79]===c.caption?U=a[80]:(U=(0,S.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[c.caption,` `,He]}),a[79]=c.caption,a[80]=U);let Ue;a[81]===Symbol.for(`react.memo_cache_sentinel`)?(Ue=(0,S.jsx)(re,{size:12}),a[81]=Ue):Ue=a[81];let W;a[82]===c.audio?W=a[83]:(W=(0,S.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[Ue,(0,S.jsx)(`div`,{className:`truncate w-40`,children:c.audio})]}),a[82]=c.audio,a[83]=W);let G;a[84]!==H||a[85]!==U||a[86]!==W?(G=(0,S.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[H,U,W]}),a[84]=H,a[85]=U,a[86]=W,a[87]=G):G=a[87];let We,Ge;a[88]===Symbol.for(`react.memo_cache_sentinel`)?(We={scale:1.1},Ge={scale:.9},a[88]=We,a[89]=Ge):(We=a[88],Ge=a[89]);let Ke=`cursor-pointer transition-colors ${Ce?`fill-[#f42a41] text-[#f42a41]`:``}`,K;a[90]!==E||a[91]!==Ke?(K=(0,S.jsx)(s.div,{whileHover:We,whileTap:Ge,children:(0,S.jsx)(n,{size:28,strokeWidth:1.5,className:Ke,onClick:E})}),a[90]=E,a[91]=Ke,a[92]=K):K=a[92];let q;a[93]===c.likes?q=a[94]:(q=(0,S.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:c.likes}),a[93]=c.likes,a[94]=q);let J;a[95]!==K||a[96]!==q?(J=(0,S.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[K,q]}),a[95]=K,a[96]=q,a[97]=J):J=a[97];let qe,Je;a[98]===Symbol.for(`react.memo_cache_sentinel`)?(qe={scale:1.1},Je={scale:.9},a[98]=qe,a[99]=Je):(qe=a[98],Je=a[99]);let Y;a[100]!==c||a[101]!==p?(Y=(0,S.jsx)(s.div,{whileHover:qe,whileTap:Je,children:(0,S.jsx)(ne,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>p(c)})}),a[100]=c,a[101]=p,a[102]=Y):Y=a[102];let X;a[103]===c.comments?X=a[104]:(X=(0,S.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:c.comments}),a[103]=c.comments,a[104]=X);let Z;a[105]!==Y||a[106]!==X?(Z=(0,S.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[Y,X]}),a[105]=Y,a[106]=X,a[107]=Z):Z=a[107];let Ye,Xe;a[108]===Symbol.for(`react.memo_cache_sentinel`)?(Ye={scale:1.1},Xe={scale:.9},a[108]=Ye,a[109]=Xe):(Ye=a[108],Xe=a[109]);let Ze;a[110]===Symbol.for(`react.memo_cache_sentinel`)?(Ze=(0,S.jsx)(s.div,{whileHover:Ye,whileTap:Xe,children:(0,S.jsx)(te,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>be(!0)})}),a[110]=Ze):Ze=a[110];let Qe,$e;a[111]===Symbol.for(`react.memo_cache_sentinel`)?(Qe={scale:1.1},$e={scale:.9},a[111]=Qe,a[112]=$e):(Qe=a[111],$e=a[112]);let et;a[113]===Symbol.for(`react.memo_cache_sentinel`)?(et=(0,S.jsx)(s.div,{whileHover:Qe,whileTap:$e,children:(0,S.jsx)(i,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ve(!0)})}),a[113]=et):et=a[113];let tt;a[114]!==d||a[115]!==c.user?(tt=()=>d(c.user),a[114]=d,a[115]=c.user,a[116]=tt):tt=a[116];let Q;a[117]===c.user.avatar?Q=a[118]:(Q=(0,S.jsx)(ie,{src:c.user.avatar}),a[117]=c.user.avatar,a[118]=Q);let nt;a[119]===c.user.username[0]?nt=a[120]:(nt=c.user.username[0].toUpperCase(),a[119]=c.user.username[0],a[120]=nt);let rt;a[121]===nt?rt=a[122]:(rt=(0,S.jsx)(de,{children:nt}),a[121]=nt,a[122]=rt);let it;a[123]!==tt||a[124]!==Q||a[125]!==rt?(it=(0,S.jsxs)(h,{className:`w-6 h-6 border-2 border-white cursor-pointer mt-2`,onClick:tt,children:[Q,rt]}),a[123]=tt,a[124]=Q,a[125]=rt,a[126]=it):it=a[126];let at;a[127]!==J||a[128]!==Z||a[129]!==it?(at=(0,S.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[J,Z,Ze,et,it]}),a[127]=J,a[128]=Z,a[129]=it,a[130]=at):at=a[130];let $;a[131]!==Me||a[132]!==k||a[133]!==A||a[134]!==j||a[135]!==N||a[136]!==G||a[137]!==at?($=(0,S.jsxs)(`div`,{ref:xe,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-zinc-900 md:rounded-lg overflow-hidden border-zinc-800 md:border group shadow-2xl`,onDoubleClick:Me,children:[k,A,j,N,G,at]}),a[131]=Me,a[132]=k,a[133]=A,a[134]=j,a[135]=N,a[136]=G,a[137]=at,a[138]=$):$=a[138];let ot;return a[139]!==D||a[140]!==O||a[141]!==$?(ot=(0,S.jsxs)(s.div,{initial:Pe,whileInView:Fe,viewport:Ie,transition:Ne,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[D,O,$]}),a[139]=D,a[140]=O,a[141]=$,a[142]=ot):ot=a[142],ot}),me=a();const C=e=>[`reel`,e],he=(e,t)=>{let n=(0,me.c)(9),r=e||``,i;n[0]===r?i=n[1]:(i=C(r),n[0]=r,n[1]=i);let a=!!e,o;n[2]!==t||n[3]!==e?(o=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await g.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await g.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await g.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},n[2]=t,n[3]=e,n[4]=o):o=n[4];let s;return n[5]!==i||n[6]!==a||n[7]!==o?(s={queryKey:i,enabled:a,queryFn:o},n[5]=i,n[6]=a,n[7]=o,n[8]=s):s=n[8],f(s)};var w=a(),ge=()=>{let e=(0,w.c)(39),{theme:t,showToast:n}=ae(),{user:r}=ue(),i=u(),{id:a}=l(),o=t===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,{data:s,isLoading:c}=he(a,r?.id),{data:ee,isLoading:te,fetchNextPage:ne,hasNextPage:f,isFetchingNextPage:p}=se(r?.id),m;bb0:{if(!ee){let t;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t=[],e[0]=t):t=e[0],m=t;break bb0}let t;e[1]===ee.pages?t=e[2]:(t=ee.pages.flat(),e[1]=ee.pages,e[2]=t),m=t}let re=m,ie;e[3]===i?ie=e[4]:(ie=e=>{i(`/profile/${e.username}`)},e[3]=i,e[4]=ie);let h=ie,oe=a?c:te,ce;e[5]!==re||e[6]!==a||e[7]!==s?(ce=a?s?[s]:[]:re,e[5]=re,e[6]=a,e[7]=s,e[8]=ce):ce=e[8];let le=ce;if(oe){let t;return e[9]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,S.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:`Loading reel...`}),e[9]=t):t=e[9],t}if(le.length===0){let t=a?`Reel not found`:`No reels yet`,n;return e[10]===t?n=e[11]:(n=(0,S.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:t}),e[10]=t,e[11]=n),n}let g;e[12]===i?g=e[13]:(g=()=>i(`/`),e[12]=i,e[13]=g);let de;e[14]===Symbol.for(`react.memo_cache_sentinel`)?(de=(0,S.jsx)(d,{size:28}),e[14]=de):de=e[14];let _;e[15]===g?_=e[16]:(_=(0,S.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:g,children:de}),e[15]=g,e[16]=_);let v;if(e[17]!==le||e[18]!==o||e[19]!==h||e[20]!==n||e[21]!==t){let r;e[23]!==o||e[24]!==h||e[25]!==n||e[26]!==t?(r=e=>(0,S.jsx)(pe,{reel:e,showToast:n,theme:t,onUserClick:h,glassModal:o},e.id),e[23]=o,e[24]=h,e[25]=n,e[26]=t,e[27]=r):r=e[27],v=le.map(r),e[17]=le,e[18]=o,e[19]=h,e[20]=n,e[21]=t,e[22]=v}else v=e[22];let y;e[28]!==ne||e[29]!==f||e[30]!==a||e[31]!==p?(y=f&&!a&&(0,S.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center snap-start bg-black`,children:(0,S.jsx)(`button`,{onClick:()=>ne(),disabled:p,className:`bg-white/10 hover:bg-white/20 text-white px-6 py-2 rounded-full border border-white/20 transition-colors`,children:p?`লোড হচ্ছে...`:`আরও ভিডিও দেখুন`})}),e[28]=ne,e[29]=f,e[30]=a,e[31]=p,e[32]=y):y=e[32];let b;e[33]!==v||e[34]!==y?(b=(0,S.jsxs)(`div`,{className:`w-full md:w-[400px] h-full`,children:[v,y]}),e[33]=v,e[34]=y,e[35]=b):b=e[35];let x;return e[36]!==_||e[37]!==b?(x=(0,S.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[_,b]}),e[36]=_,e[37]=b,e[38]=x):x=e[38],x};export{ge as default};