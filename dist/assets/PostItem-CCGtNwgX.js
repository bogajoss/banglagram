import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{At as t,Dt as n,Et as r,G as i,Gt as a,Nt as o,Pt as s,Tt as c,bt as ee,et as te,ft as ne,jt as l,ut as re}from"./vendor-j4eAkL9f.js";import{I as u,en as d,tn as f}from"./libs-Bghk4o3g.js";import{_ as ie,a as ae,f as p,i as oe,m,n as h,r as se,v as ce,y as le}from"./index-DtPkH1l5.js";import{n as ue,t as de}from"./ShareModal-C0AiNfZB.js";var g=n(),_=e(f(),1);const v=e=>[`post`,e],y=(e,t)=>{let n=(0,g.c)(9),r=e||``,i;n[0]===r?i=n[1]:(i=v(r),n[0]=r,n[1]=i);let a=!!e,o;n[2]!==t||n[3]!==e?(o=async()=>{if(!e)throw Error(`Post ID required`);let{data:n,error:r}=await m.from(`posts`).select(`
          id,
          created_at,
          caption,
          image_url,
          user_id,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await m.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`post_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await m.from(`saves`).select(`*`,{count:`exact`,head:!0}).eq(`post_id`,e).eq(`user_id`,t);o=!!r&&r>0}return{id:i.id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1},content:{type:`image`,src:i.image_url},likes:i.likes[0]?.count||0,caption:i.caption||``,comments:i.comments[0]?.count||0,time:(0,_.default)(i.created_at).fromNow(),hasLiked:a,hasSaved:o}},n[2]=t,n[3]=e,n[4]=o):o=n[4];let s;return n[5]!==i||n[6]!==a||n[7]!==o?(s={queryKey:i,enabled:a,queryFn:o},n[5]=i,n[6]=a,n[7]=o,n[8]=s):s=n[8],l(s)};var b=n();const fe=()=>{let e=(0,b.c)(2),n=o(),r;return e[0]===n?r=e[1]:(r={mutationFn:x,onSuccess:(e,t)=>{n.invalidateQueries({queryKey:p}),n.invalidateQueries({queryKey:v(t.postId)}),n.invalidateQueries({queryKey:[`profile`]})}},e[0]=n,e[1]=r),t(r)};async function x(e){let{postId:t,caption:n,location:r}=e,{data:i,error:a}=await m.from(`posts`).update({caption:n,location:r}).eq(`id`,t).select().single();if(a)throw a;return i}var pe=n(),S=e(a(),1),C=s(),me=e=>{let t=(0,pe.c)(51),{post:n,onClose:r,theme:i,glassModal:a}=e,{showToast:o}=le(),[s,ee]=(0,S.useState)(n.caption||``),{mutate:te,isPending:ne}=fe(),l;t[0]!==s||t[1]!==r||t[2]!==n.id||t[3]!==o||t[4]!==te?(l=()=>{if(!s.trim()){o(`ক্যাপশন খালি রাখা যাবে না`);return}te({postId:n.id,caption:s},{onSuccess:()=>{o(`পোস্ট আপডেট করা হয়েছে`),r()},onError:()=>o(`আপডেট করতে সমস্যা হয়েছে`)})},t[0]=s,t[1]=r,t[2]=n.id,t[3]=o,t[4]=te,t[5]=l):l=t[5];let re=l,u,d,f;t[6]===Symbol.for(`react.memo_cache_sentinel`)?(u={opacity:0},d={opacity:1},f={opacity:0},t[6]=u,t[7]=d,t[8]=f):(u=t[6],d=t[7],f=t[8]);let ae,p,oe;t[9]===Symbol.for(`react.memo_cache_sentinel`)?(ae={scale:.95,opacity:0},p={scale:1,opacity:1},oe={scale:.95,opacity:0},t[9]=ae,t[10]=p,t[11]=oe):(ae=t[9],p=t[10],oe=t[11]);let m=`w-full max-w-2xl rounded-xl overflow-hidden shadow-2xl flex flex-col md:flex-row ${a} ${i===`dark`?`text-white`:`text-black`}`,h;t[12]!==n.content.poster||t[13]!==n.content.src||t[14]!==n.content.type?(h=(0,C.jsx)(`div`,{className:`md:w-1/2 bg-black flex items-center justify-center relative aspect-square md:aspect-auto`,children:n.content.type===`video`?(0,C.jsx)(`video`,{src:n.content.src,className:`max-h-full max-w-full`}):(0,C.jsx)(ie,{src:n.content.src||n.content.poster,className:`max-h-full max-w-full`,imgClassName:`object-contain`,alt:`preview`})}),t[12]=n.content.poster,t[13]=n.content.src,t[14]=n.content.type,t[15]=h):h=t[15];let se=`md:w-1/2 flex flex-col ${i===`dark`?`bg-zinc-900`:`bg-white`}`,ce=`p-3 border-b flex justify-between items-center ${i===`dark`?`border-zinc-800`:`border-zinc-200`}`,ue;t[16]===Symbol.for(`react.memo_cache_sentinel`)?(ue=(0,C.jsx)(`span`,{className:`font-semibold text-sm`,children:`এডিট ইনফো`}),t[16]=ue):ue=t[16];let de=ne?`সেভ হচ্ছে...`:`সম্পন্ন`,g;t[17]!==re||t[18]!==ne||t[19]!==de?(g=(0,C.jsx)(`button`,{onClick:re,disabled:ne,className:`text-[#0095f6] font-bold text-sm hover:text-white disabled:opacity-50`,children:de}),t[17]=re,t[18]=ne,t[19]=de,t[20]=g):g=t[20];let _;t[21]!==ce||t[22]!==g?(_=(0,C.jsxs)(`div`,{className:ce,children:[ue,g]}),t[21]=ce,t[22]=g,t[23]=_):_=t[23];let v;t[24]!==n.user.avatar||t[25]!==n.user.username?(v=(0,C.jsx)(`div`,{className:`w-8 h-8 rounded-full overflow-hidden`,children:(0,C.jsx)(ie,{src:n.user.avatar,className:`w-full h-full`,alt:n.user.username})}),t[24]=n.user.avatar,t[25]=n.user.username,t[26]=v):v=t[26];let y;t[27]===n.user.username?y=t[28]:(y=(0,C.jsx)(`span`,{className:`font-semibold text-sm`,children:n.user.username}),t[27]=n.user.username,t[28]=y);let b;t[29]!==v||t[30]!==y?(b=(0,C.jsxs)(`div`,{className:`p-4 flex items-center gap-3`,children:[v,y]}),t[29]=v,t[30]=y,t[31]=b):b=t[31];let x=`flex-grow p-4 bg-transparent outline-none resize-none text-sm ${i===`dark`?`placeholder-zinc-500`:`placeholder-zinc-400`}`,me;t[32]===Symbol.for(`react.memo_cache_sentinel`)?(me=e=>ee(e.target.value),t[32]=me):me=t[32];let w;t[33]!==s||t[34]!==x?(w=(0,C.jsx)(`textarea`,{className:x,placeholder:`ক্যাপশন লিখুন...`,value:s,onChange:me,rows:6}),t[33]=s,t[34]=x,t[35]=w):w=t[35];let T;t[36]===r?T=t[37]:(T=(0,C.jsx)(`div`,{className:`p-4 flex justify-end`,children:(0,C.jsx)(`button`,{onClick:r,className:`text-sm font-semibold hover:opacity-70`,children:`বাতিল করুন`})}),t[36]=r,t[37]=T);let E;t[38]!==se||t[39]!==_||t[40]!==b||t[41]!==w||t[42]!==T?(E=(0,C.jsxs)(`div`,{className:se,children:[_,b,w,T]}),t[38]=se,t[39]=_,t[40]=b,t[41]=w,t[42]=T,t[43]=E):E=t[43];let D;t[44]!==E||t[45]!==m||t[46]!==h?(D=(0,C.jsxs)(c.div,{initial:ae,animate:p,exit:oe,className:m,onClick:he,children:[h,E]}),t[44]=E,t[45]=m,t[46]=h,t[47]=D):D=t[47];let O;return t[48]!==r||t[49]!==D?(O=(0,C.jsx)(c.div,{initial:u,animate:d,exit:f,className:`fixed inset-0 z-[110] bg-black/60 flex items-center justify-center p-4`,onClick:r,children:D}),t[48]=r,t[49]=D,t[50]=O):O=t[50],O};function he(e){return e.stopPropagation()}var w=n(),T=e(f(),1),E=e(d(),1);u(),T.default.extend(E.default),T.default.locale(`bn`);var D=(0,S.memo)(e=>{let t=(0,w.c)(153),{post:n,isSaved:a,onToggleSave:o,onUserClick:s,onPostClick:l}=e,{theme:u,showToast:d}=le(),{user:f}=ce(),{mutate:p}=oe(),{mutate:m,isPending:g}=se(),[_,v]=(0,S.useState)(!1),[y,b]=(0,S.useState)(``),[fe,x]=(0,S.useState)(!1),[pe,he]=(0,S.useState)(!1),[E,D]=(0,S.useState)(!1),O=n.hasLiked||!1,k=`${window.location.origin}/post/${n.id}`,ge=f?.id===n.user.id,_e;t[0]!==O||t[1]!==n.id||t[2]!==d||t[3]!==p||t[4]!==f?(_e=()=>{if(!f){d(`লাইক করতে লগ ইন করুন`);return}p({targetId:String(n.id),type:`post`,userId:f.id,hasLiked:O})},t[0]=O,t[1]=n.id,t[2]=d,t[3]=p,t[4]=f,t[5]=_e):_e=t[5];let A=_e,ve;t[6]===A?ve=t[7]:(ve=()=>{A(),v(!0),setTimeout(()=>v(!1),1e3)},t[6]=A,t[7]=ve);let ye=ve,be;t[8]!==m||t[9]!==y||t[10]!==n.id||t[11]!==d||t[12]!==f?(be=e=>{e.preventDefault(),!(!y.trim()||!f)&&m({targetId:String(n.id),type:`post`,text:y,userId:f.id},{onSuccess:()=>{d(`কমেন্ট যোগ করা হয়েছে`),b(``)},onError:()=>d(`কমেন্ট যোগ করতে সমস্যা হয়েছে`)})},t[8]=m,t[9]=y,t[10]=n.id,t[11]=d,t[12]=f,t[13]=be):be=t[13];let xe=be,Se=u===`dark`?`border-zinc-800`:`border-zinc-200`,j=u===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,Ce,we,Te,Ee;t[14]===Symbol.for(`react.memo_cache_sentinel`)?(Ce={opacity:0,y:20},we={opacity:1,y:0},Te={once:!0,margin:`-50px`},Ee={duration:.4},t[14]=Ce,t[15]=we,t[16]=Te,t[17]=Ee):(Ce=t[14],we=t[15],Te=t[16],Ee=t[17]);let De=`border-b pb-5 mb-4 ${Se}`,M;t[18]!==j||t[19]!==fe||t[20]!==ge||t[21]!==k||t[22]!==d||t[23]!==u?(M=fe&&(0,C.jsx)(ue,{onClose:()=>x(!1),showToast:d,theme:u,glassModal:j,shareUrl:k,isOwner:ge,onEdit:()=>D(!0)}),t[18]=j,t[19]=fe,t[20]=ge,t[21]=k,t[22]=d,t[23]=u,t[24]=M):M=t[24];let N;t[25]!==j||t[26]!==pe||t[27]!==k||t[28]!==d||t[29]!==u?(N=pe&&(0,C.jsx)(de,{onClose:()=>he(!1),theme:u,showToast:d,glassModal:j,shareUrl:k}),t[25]=j,t[26]=pe,t[27]=k,t[28]=d,t[29]=u,t[30]=N):N=t[30];let P;t[31]!==j||t[32]!==E||t[33]!==n||t[34]!==u?(P=E&&(0,C.jsx)(me,{post:n,onClose:()=>D(!1),theme:u,glassModal:j}),t[31]=j,t[32]=E,t[33]=n,t[34]=u,t[35]=P):P=t[35];let F;t[36]!==s||t[37]!==n.user?(F=()=>s(n.user),t[36]=s,t[37]=n.user,t[38]=F):F=t[38];let Oe=`w-8 h-8 rounded-full overflow-hidden ${u===`dark`?`bg-zinc-800`:`bg-gray-200`} group-hover:scale-105 transition-transform`,I;t[39]!==n.user.avatar||t[40]!==n.user.username?(I=(0,C.jsx)(ie,{src:n.user.avatar,width:100,className:`w-full h-full`,alt:n.user.username}),t[39]=n.user.avatar,t[40]=n.user.username,t[41]=I):I=t[41];let L;t[42]!==Oe||t[43]!==I?(L=(0,C.jsx)(`div`,{className:Oe,children:I}),t[42]=Oe,t[43]=I,t[44]=L):L=t[44];let R;t[45]===n.user.username?R=t[46]:(R=(0,C.jsx)(`span`,{className:`group-hover:opacity-70 transition-opacity`,children:n.user.username}),t[45]=n.user.username,t[46]=R);let z;t[47]===n.user.isVerified?z=t[48]:(z=n.user.isVerified&&(0,C.jsx)(ae,{}),t[47]=n.user.isVerified,t[48]=z);let ke=`${u===`dark`?`text-zinc-500`:`text-zinc-400`} font-normal`,Ae;t[49]!==n.createdAt||t[50]!==n.time?(Ae=n.createdAt?(0,T.default)(n.createdAt).fromNow(!0):n.time,t[49]=n.createdAt,t[50]=n.time,t[51]=Ae):Ae=t[51];let B;t[52]!==ke||t[53]!==Ae?(B=(0,C.jsxs)(`span`,{className:ke,children:[`• `,Ae]}),t[52]=ke,t[53]=Ae,t[54]=B):B=t[54];let V;t[55]!==R||t[56]!==z||t[57]!==B?(V=(0,C.jsxs)(`div`,{className:`flex items-center gap-1 text-sm font-semibold`,children:[R,z,B]}),t[55]=R,t[56]=z,t[57]=B,t[58]=V):V=t[58];let H;t[59]!==F||t[60]!==L||t[61]!==V?(H=(0,C.jsxs)(`div`,{className:`flex items-center gap-2 cursor-pointer group`,onClick:F,children:[L,V]}),t[59]=F,t[60]=L,t[61]=V,t[62]=H):H=t[62];let je,Me;t[63]===Symbol.for(`react.memo_cache_sentinel`)?(je={scale:1.1},Me={scale:.9},t[63]=je,t[64]=Me):(je=t[63],Me=t[64]);let Ne;t[65]===Symbol.for(`react.memo_cache_sentinel`)?(Ne=(0,C.jsx)(c.div,{whileHover:je,whileTap:Me,children:(0,C.jsx)(ne,{size:20,className:`cursor-pointer hover:opacity-70`,onClick:()=>x(!0)})}),t[65]=Ne):Ne=t[65];let U;t[66]===H?U=t[67]:(U=(0,C.jsxs)(`div`,{className:`flex items-center justify-between mb-3 px-3 md:px-0`,children:[H,Ne]}),t[66]=H,t[67]=U);let Pe=`w-full ${u===`dark`?`bg-zinc-900`:`bg-gray-100`} md:rounded-[4px] md:border ${Se} overflow-hidden mb-3 aspect-square md:aspect-auto relative cursor-pointer`,Fe=n.content.src||n.content.poster,W;t[68]===Fe?W=t[69]:(W=(0,C.jsx)(ie,{src:Fe,width:800,className:`w-full h-full`,alt:`Post content`}),t[68]=Fe,t[69]=W);let G;t[70]===_?G=t[71]:(G=_&&(0,C.jsx)(c.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,C.jsx)(re,{size:100,className:`text-white fill-white drop-shadow-lg`})}),t[70]=_,t[71]=G);let K;t[72]===G?K=t[73]:(K=(0,C.jsx)(r,{children:G}),t[72]=G,t[73]=K);let q;t[74]!==ye||t[75]!==Pe||t[76]!==W||t[77]!==K?(q=(0,C.jsxs)(`div`,{className:Pe,onDoubleClick:ye,children:[W,K]}),t[74]=ye,t[75]=Pe,t[76]=W,t[77]=K,t[78]=q):q=t[78];let Ie,Le;t[79]===Symbol.for(`react.memo_cache_sentinel`)?(Ie={scale:1.1},Le={scale:.9},t[79]=Ie,t[80]=Le):(Ie=t[79],Le=t[80]);let Re=`cursor-pointer transition-colors ${O?`fill-[#f42a41] text-[#f42a41]`:``}`,J;t[81]!==A||t[82]!==Re?(J=(0,C.jsx)(c.div,{whileHover:Ie,whileTap:Le,children:(0,C.jsx)(re,{size:24,className:Re,onClick:A})}),t[81]=A,t[82]=Re,t[83]=J):J=t[83];let ze,Be;t[84]===Symbol.for(`react.memo_cache_sentinel`)?(ze={scale:1.1},Be={scale:.9},t[84]=ze,t[85]=Be):(ze=t[84],Be=t[85]);let Y;t[86]!==l||t[87]!==n?(Y=(0,C.jsx)(c.div,{whileHover:ze,whileTap:Be,children:(0,C.jsx)(te,{size:24,className:`-scale-x-100 cursor-pointer hover:opacity-70 transition-opacity`,onClick:()=>l(n)})}),t[86]=l,t[87]=n,t[88]=Y):Y=t[88];let Ve,He;t[89]===Symbol.for(`react.memo_cache_sentinel`)?(Ve={scale:1.1},He={scale:.9},t[89]=Ve,t[90]=He):(Ve=t[89],He=t[90]);let Ue;t[91]===Symbol.for(`react.memo_cache_sentinel`)?(Ue=(0,C.jsx)(c.div,{whileHover:Ve,whileTap:He,children:(0,C.jsx)(i,{size:24,className:`cursor-pointer hover:opacity-70 transition-opacity`,onClick:()=>he(!0)})}),t[91]=Ue):Ue=t[91];let X;t[92]!==J||t[93]!==Y?(X=(0,C.jsxs)(`div`,{className:`flex items-center gap-4`,children:[J,Y,Ue]}),t[92]=J,t[93]=Y,t[94]=X):X=t[94];let We,Ge;t[95]===Symbol.for(`react.memo_cache_sentinel`)?(We={scale:1.1},Ge={scale:.9},t[95]=We,t[96]=Ge):(We=t[95],Ge=t[96]);let Ke=`cursor-pointer hover:opacity-70 transition-all ${a?`fill-current`:``}`,Z;t[97]!==o||t[98]!==Ke?(Z=(0,C.jsx)(c.div,{whileHover:We,whileTap:Ge,children:(0,C.jsx)(ee,{size:24,className:Ke,onClick:o})}),t[97]=o,t[98]=Ke,t[99]=Z):Z=t[99];let qe;t[100]!==X||t[101]!==Z?(qe=(0,C.jsxs)(`div`,{className:`flex items-center justify-between mb-2 px-3 md:px-0`,children:[X,Z]}),t[100]=X,t[101]=Z,t[102]=qe):qe=t[102];let Je;t[103]===n.likes?Je=t[104]:(Je=(0,C.jsxs)(`div`,{className:`font-semibold mb-1`,children:[n.likes,` লাইক`]}),t[103]=n.likes,t[104]=Je);let Ye;t[105]!==s||t[106]!==n.user?(Ye=()=>s(n.user),t[105]=s,t[106]=n.user,t[107]=Ye):Ye=t[107];let Q;t[108]!==n.user.username||t[109]!==Ye?(Q=(0,C.jsx)(`span`,{className:`font-semibold mr-2 cursor-pointer hover:opacity-70`,onClick:Ye,children:n.user.username}),t[108]=n.user.username,t[109]=Ye,t[110]=Q):Q=t[110];let Xe;t[111]===n.caption?Xe=t[112]:(Xe=(0,C.jsx)(h,{text:n.caption,truncateLength:150}),t[111]=n.caption,t[112]=Xe);let Ze;t[113]!==Q||t[114]!==Xe?(Ze=(0,C.jsxs)(`div`,{className:`mb-1`,children:[Q,Xe]}),t[113]=Q,t[114]=Xe,t[115]=Ze):Ze=t[115];let Qe;t[116]!==l||t[117]!==n?(Qe=()=>l(n),t[116]=l,t[117]=n,t[118]=Qe):Qe=t[118];let $e;t[119]!==n.comments||t[120]!==Qe?($e=(0,C.jsxs)(`div`,{className:`text-zinc-500 cursor-pointer hover:underline`,onClick:Qe,children:[`সব `,n.comments,` কমেন্ট দেখুন`]}),t[119]=n.comments,t[120]=Qe,t[121]=$e):$e=t[121];let et;t[122]!==n.createdAt||t[123]!==n.time?(et=n.createdAt?(0,T.default)(n.createdAt).fromNow():n.time,t[122]=n.createdAt,t[123]=n.time,t[124]=et):et=t[124];let tt;t[125]===et?tt=t[126]:(tt=(0,C.jsx)(`div`,{className:`text-[10px] text-zinc-500 uppercase mt-1`,children:et}),t[125]=et,t[126]=tt);let nt=`bg-transparent text-sm w-full outline-none ${u===`dark`?`text-white`:`text-black`}`,rt;t[127]===Symbol.for(`react.memo_cache_sentinel`)?(rt=e=>b(e.target.value),t[127]=rt):rt=t[127];let it;t[128]!==g||t[129]!==y||t[130]!==nt?(it=(0,C.jsx)(`input`,{type:`text`,placeholder:`কমেন্ট যোগ করুন...`,className:nt,value:y,onChange:rt,disabled:g}),t[128]=g,t[129]=y,t[130]=nt,t[131]=it):it=t[131];let at=!y||g,ot;t[132]===at?ot=t[133]:(ot=(0,C.jsx)(`button`,{type:`submit`,className:`text-[#006a4e] text-sm font-semibold disabled:opacity-50 hover:text-[#004d39]`,disabled:at,children:`পোস্ট`}),t[132]=at,t[133]=ot);let st;t[134]!==xe||t[135]!==it||t[136]!==ot?(st=(0,C.jsxs)(`form`,{onSubmit:xe,className:`flex gap-2 mt-2`,children:[it,ot]}),t[134]=xe,t[135]=it,t[136]=ot,t[137]=st):st=t[137];let $;t[138]!==Je||t[139]!==Ze||t[140]!==$e||t[141]!==tt||t[142]!==st?($=(0,C.jsxs)(`div`,{className:`text-sm px-3 md:px-0`,children:[Je,Ze,$e,tt,st]}),t[138]=Je,t[139]=Ze,t[140]=$e,t[141]=tt,t[142]=st,t[143]=$):$=t[143];let ct;return t[144]!==N||t[145]!==P||t[146]!==U||t[147]!==q||t[148]!==qe||t[149]!==$||t[150]!==De||t[151]!==M?(ct=(0,C.jsxs)(c.div,{initial:Ce,whileInView:we,viewport:Te,transition:Ee,className:De,children:[M,N,P,U,q,qe,$]}),t[144]=N,t[145]=P,t[146]=U,t[147]=q,t[148]=qe,t[149]=$,t[150]=De,t[151]=M,t[152]=ct):ct=t[152],ct});export{y as n,D as t};