import{a as e}from"./rolldown-runtime-DDUpfMIz.js";import{nn as t,pn as n,un as r}from"./vendor-Cr02haVJ.js";import{gr as i}from"./libs-CiQH4q1H.js";import"./supabase-CCh8m61e.js";import{S as a,T as o,b as s,c,t as l,u,v as d,w as f,x as p}from"./index-BxH8m7es.js";import{t as m}from"./useGetSuggestedUsers-BSgGmmKw.js";import{t as h}from"./useFollowUser-RHdLoW7-.js";var g=e(n(),1),_=e(i(),1),v=e(t(),1),y=()=>{let{theme:e,setUnreadNotificationsCount:t}=o(),{mutate:n}=h(),i=r(),{user:y}=f(),b=`bg-[#006a4e] hover:bg-[#00523c]`,x=e===`dark`?`border-zinc-800`:`border-zinc-200`,S=e===`dark`?`text-[#a8a8a8]`:`text-zinc-500`,{data:C=[],isLoading:w}=l(y?.id),{data:T=[]}=m(y?.id),{setViewingPost:E,setViewingReel:D}=o();(0,g.useEffect)(()=>{t(0),localStorage.setItem(`lastNotificationReadTime`,(0,_.default)().toISOString())},[t]);let O=e=>{i(`/profile/${e.username}`)},k=async e=>{if(e.type===`follow`){e.user&&O(e.user);return}try{if(e.postId){let{data:t,error:n}=await d.from(`posts`).select(`
                    *,
                    user:profiles(*),
                    likes(count),
                    comments(count)
                `).eq(`id`,e.postId).single();if(n||!t)throw n;let r=t,{count:i}=await d.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`post_id`,e.postId).eq(`user_id`,y?.id||``);E({id:r.id,user:{username:r.user.username,name:r.user.full_name,avatar:r.user.avatar_url},content:{type:`image`,src:r.image_url,poster:r.image_url},likes:r.likes[0].count,comments:r.comments[0].count,caption:r.caption,time:(0,_.default)(r.created_at).fromNow(),hasLiked:i?i>0:!1,commentList:[]})}else if(e.reelId){let{data:t,error:n}=await d.from(`reels`).select(`
                    *,
                    user:profiles(*),
                    likes(count),
                    comments(count)
                `).eq(`id`,e.reelId).single();if(n||!t)throw n;let r=t,{count:i}=await d.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e.reelId).eq(`user_id`,y?.id||``);D({id:r.id,src:r.video_url,user:{username:r.user.username,name:r.user.full_name,avatar:r.user.avatar_url},likes:r.likes[0].count,comments:r.comments[0].count,caption:r.caption||``,audio:r.audio_track_name||``,hasLiked:i?i>0:!1})}}catch(e){console.error(`Failed to load content`,e)}};return(0,v.jsxs)(`div`,{className:`w-full max-w-[600px] flex flex-col gap-6`,children:[(0,v.jsx)(`div`,{className:`md:hidden sticky top-0 z-10 border-b ${x} p-4 flex items-center ${e===`dark`?`bg-black/95 backdrop-blur-md`:`bg-white/95 backdrop-blur-md`}`,children:(0,v.jsx)(`h1`,{className:`text-xl font-bold`,children:`নোটিফিকেশন`})}),(0,v.jsxs)(`div`,{className:`px-4 md:px-2 py-2 md:py-8 flex flex-col gap-6`,children:[(0,v.jsx)(`h1`,{className:`text-2xl font-bold px-2 hidden md:block`,children:`নোটিফিকেশন`}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`h2`,{className:`text-base font-bold mb-4 px-2`,children:`আগের`}),(0,v.jsxs)(`div`,{className:`flex flex-col gap-4`,children:[w&&(0,v.jsx)(`div`,{className:`p-4 text-center`,children:`Loading notifications...`}),!w&&C.length===0&&(0,v.jsx)(`div`,{className:`p-4 text-center text-gray-500`,children:`কোনো নোটিফিকেশন নেই`}),C.map(t=>(0,v.jsxs)(`div`,{className:`flex items-center justify-between px-2`,children:[(0,v.jsxs)(`div`,{className:`flex items-center gap-3`,children:[t.type!==`system`&&t.user&&(0,v.jsx)(`div`,{className:`relative flex-shrink-0 cursor-pointer`,onClick:()=>O(t.user),children:(0,v.jsxs)(s,{className:`w-11 h-11`,children:[(0,v.jsx)(a,{src:t.user.avatar}),(0,v.jsx)(p,{children:t.user.username?.[0]?.toUpperCase()||`?`})]})}),t.type===`system`&&(0,v.jsx)(`div`,{className:`w-11 h-11 rounded-full border ${x} flex items-center justify-center flex-shrink-0 overflow-hidden`,children:(0,v.jsx)(u,{src:`https://www.instagram.com/static/images/activity/meta-logo-pano-manual-padding-notif@2x.png/c2173431433e.png`,className:`w-6 h-6 object-contain`,alt:`Meta`})}),(0,v.jsxs)(`div`,{className:`text-sm`,children:[t.user&&(0,v.jsxs)(`div`,{className:`inline-flex items-center`,children:[(0,v.jsx)(`span`,{className:`font-semibold cursor-pointer ${e===`dark`?`hover:text-zinc-300`:`hover:text-zinc-600`}`,onClick:()=>k(t),children:t.user.username}),t.user.isVerified&&(0,v.jsx)(c,{})]}),(0,v.jsx)(`span`,{className:`ml-1 cursor-pointer hover:opacity-80`,onClick:()=>k(t),children:t.text}),(0,v.jsx)(`span`,{className:`${S} ml-1`,children:t.time})]})]}),t.isFollowing?(0,v.jsx)(`button`,{className:`${e===`dark`?`bg-[#363636]`:`bg-gray-200 text-black`} px-4 py-1.5 rounded-lg text-sm font-semibold`,children:`ফলো করছেন`}):t.type===`follow`?(0,v.jsx)(`button`,{className:`${b} text-white px-4 py-1.5 rounded-lg text-sm font-semibold`,children:`ফলো`}):null]},t.id))]})]}),(0,v.jsxs)(`div`,{className:`border-t ${x} pt-4`,children:[(0,v.jsx)(`h2`,{className:`text-base font-bold mb-4 px-2`,children:`আপনার জন্য প্রস্তাবিত`}),(0,v.jsx)(`div`,{className:`flex flex-col gap-4`,children:T.map((t,r)=>{let i=t,o=t;return(0,v.jsxs)(`div`,{className:`flex items-center justify-between px-2 hover:bg-white/5 p-2 rounded-lg transition-colors cursor-pointer`,onClick:()=>O(i),children:[(0,v.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,v.jsxs)(s,{className:`w-11 h-11 flex-shrink-0`,children:[(0,v.jsx)(a,{src:i.avatar}),(0,v.jsx)(p,{children:i.username?.[0]?.toUpperCase()||`?`})]}),(0,v.jsxs)(`div`,{className:`flex flex-col text-sm overflow-hidden`,children:[(0,v.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,v.jsx)(`span`,{className:`font-semibold cursor-pointer truncate ${e===`dark`?`hover:text-zinc-300`:`hover:text-zinc-600`}`,children:i.username}),i.isVerified&&(0,v.jsx)(c,{})]}),(0,v.jsx)(`span`,{className:`${S} truncate`,children:i.name}),(0,v.jsx)(`span`,{className:`${S} text-xs truncate`,children:o.subtitle})]})]}),(0,v.jsx)(`button`,{className:`${b} text-white px-4 py-1.5 rounded-lg text-sm font-semibold transition-colors whitespace-nowrap active:scale-95`,onClick:e=>{e.stopPropagation(),t&&i.id&&n({targetUserId:i.id,currentUserId:t.id,isFollowing:!1,targetUsername:i.username})},children:`ফলো`})]},r)})})]})]})]})};export{y as default};