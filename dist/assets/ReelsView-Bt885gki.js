import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{$t as t,Gt as n,It as r,Lt as i,Rt as a,St as o,Tt as s,Ut as c,X as ee,_t as l,bt as te,en as ne,it as re,kt as ie,rn as u,st as ae}from"./vendor-CYhgnaJV.js";import"./libs-BZRZkBIg.js";import"./tanstack-CjdblyHw.js";import"./supabase-CVUXu_xj.js";import{F as oe,I as se,M as ce,N as d,c as f,j as le,k as p,o as ue,s as m,v as de,w as fe}from"./index-ywtYYkZ-.js";import{n as pe,r as h,t as g}from"./useViewTracker-Zlm6_4eG.js";import"./useGetSuggestedUsers-DQP3QTN5.js";import{t as _}from"./useFollowUser-Dc9NDPhU.js";var v=a(),y=e(u(),1),b=n(),me=(0,y.memo)(e=>{let t=(0,v.c)(133),{reel:n,showToast:a,onUserClick:o}=e,{setViewingReel:s}=se(),{user:c}=oe(),{mutate:ne}=ue(),{mutate:u}=_(),{ref:p}=g(n.id,`reel`),[de,fe]=(0,y.useState)(!1),[me,he]=(0,y.useState)(!1),[ge,_e]=(0,y.useState)(!1),x=`${window.location.origin}/reels/${n.id}`,ve=n.hasLiked||!1,ye;t[0]!==ve||t[1]!==n.id||t[2]!==a||t[3]!==ne||t[4]!==c?(ye=()=>{if(!c){a(`Log in to like`);return}ne({targetId:n.id,type:`reel`,userId:c.id,hasLiked:ve})},t[0]=ve,t[1]=n.id,t[2]=a,t[3]=ne,t[4]=c,t[5]=ye):ye=t[5];let S=ye,be;t[6]!==u||t[7]!==n.user.isFollowing||t[8]!==n.user.username||t[9]!==n.userId||t[10]!==a||t[11]!==c?(be=()=>{if(!c){a(`Log in to follow`);return}n.userId&&u({targetUserId:n.userId,currentUserId:c.id,isFollowing:n.user.isFollowing||!1,targetUsername:n.user.username},{onSuccess:()=>a(`Followed`),onError:()=>a(`Failed to follow`)})},t[6]=u,t[7]=n.user.isFollowing,t[8]=n.user.username,t[9]=n.userId,t[10]=a,t[11]=c,t[12]=be):be=t[12];let xe=be,Se;t[13]===S?Se=t[14]:(Se=()=>{S(),fe(!0),setTimeout(()=>fe(!1),1e3)},t[13]=S,t[14]=Se);let Ce=Se,we,Te,Ee,De;t[15]===Symbol.for(`react.memo_cache_sentinel`)?(we={opacity:0,scale:.95},Te={opacity:1,scale:1},Ee={once:!0},De={duration:.5},t[15]=we,t[16]=Te,t[17]=Ee,t[18]=De):(we=t[15],Te=t[16],Ee=t[17],De=t[18]);let C;t[19]!==me||t[20]!==x||t[21]!==a?(C=me&&(0,b.jsx)(h,{onClose:()=>he(!1),showToast:a,shareUrl:x}),t[19]=me,t[20]=x,t[21]=a,t[22]=C):C=t[22];let w;t[23]!==ge||t[24]!==x?(w=ge&&(0,b.jsx)(pe,{onClose:()=>_e(!1),shareUrl:x}),t[23]=ge,t[24]=x,t[25]=w):w=t[25];let T;t[26]!==n.poster||t[27]!==n.src?(T=n.src?(0,b.jsx)(`div`,{className:`w-full h-full`,children:(0,b.jsx)(m,{src:n.src,className:`w-full h-full object-cover`,autoPlay:!0,controls:!0,loop:!0,muted:!0})}):(0,b.jsx)(`img`,{src:n.poster||``,className:`w-full h-full object-cover`,alt:`reel`,loading:`lazy`}),t[26]=n.poster,t[27]=n.src,t[28]=T):T=t[28];let E;t[29]===de?E=t[30]:(E=de&&(0,b.jsx)(r.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,b.jsx)(l,{size:100,className:`text-white fill-white drop-shadow-lg`})}),t[29]=de,t[30]=E);let D;t[31]===E?D=t[32]:(D=(0,b.jsx)(i,{children:E}),t[31]=E,t[32]=D);let O;t[33]!==o||t[34]!==n.user?(O=()=>o(n.user),t[33]=o,t[34]=n.user,t[35]=O):O=t[35];let k;t[36]===n.user.avatar?k=t[37]:(k=(0,b.jsx)(d,{src:n.user.avatar}),t[36]=n.user.avatar,t[37]=k);let A;t[38]===n.user.username[0]?A=t[39]:(A=n.user.username[0].toUpperCase(),t[38]=n.user.username[0],t[39]=A);let j;t[40]===A?j=t[41]:(j=(0,b.jsx)(ce,{children:A}),t[40]=A,t[41]=j);let M;t[42]!==k||t[43]!==j?(M=(0,b.jsxs)(le,{className:`w-8 h-8 border border-white/50 cursor-pointer`,children:[k,j]}),t[42]=k,t[43]=j,t[44]=M):M=t[44];let N;t[45]===n.user.username?N=t[46]:(N=(0,b.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:n.user.username}),t[45]=n.user.username,t[46]=N);let P;t[47]===n.user.isVerified?P=t[48]:(P=n.user.isVerified&&(0,b.jsx)(f,{}),t[47]=n.user.isVerified,t[48]=P);let Oe,ke;t[49]===Symbol.for(`react.memo_cache_sentinel`)?(Oe={scale:1.05},ke={scale:.95},t[49]=Oe,t[50]=ke):(Oe=t[49],ke=t[50]);let Ae=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${n.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,je;t[51]===xe?je=t[52]:(je=e=>{e.stopPropagation(),xe()},t[51]=xe,t[52]=je);let Me=n.user.isFollowing?`Following`:`Follow`,F;t[53]!==Ae||t[54]!==je||t[55]!==Me?(F=(0,b.jsx)(r.button,{whileHover:Oe,whileTap:ke,className:Ae,onClick:je,children:Me}),t[53]=Ae,t[54]=je,t[55]=Me,t[56]=F):F=t[56];let I;t[57]!==O||t[58]!==M||t[59]!==N||t[60]!==P||t[61]!==F?(I=(0,b.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:O,children:[M,N,P,F]}),t[57]=O,t[58]=M,t[59]=N,t[60]=P,t[61]=F,t[62]=I):I=t[62];let Ne;t[63]===Symbol.for(`react.memo_cache_sentinel`)?(Ne=(0,b.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`More`}),t[63]=Ne):Ne=t[63];let L;t[64]===n.caption?L=t[65]:(L=(0,b.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[n.caption,` `,Ne]}),t[64]=n.caption,t[65]=L);let Pe;t[66]===Symbol.for(`react.memo_cache_sentinel`)?(Pe=(0,b.jsx)(re,{size:12}),t[66]=Pe):Pe=t[66];let R;t[67]===n.audio?R=t[68]:(R=(0,b.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[Pe,(0,b.jsx)(`div`,{className:`truncate w-40`,children:n.audio})]}),t[67]=n.audio,t[68]=R);let z;t[69]!==I||t[70]!==L||t[71]!==R?(z=(0,b.jsx)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4 pointer-events-none`,children:(0,b.jsxs)(`div`,{className:`pointer-events-auto`,children:[I,L,R]})}),t[69]=I,t[70]=L,t[71]=R,t[72]=z):z=t[72];let Fe,Ie;t[73]===Symbol.for(`react.memo_cache_sentinel`)?(Fe={scale:1.1},Ie={scale:.9},t[73]=Fe,t[74]=Ie):(Fe=t[73],Ie=t[74]);let Le=`cursor-pointer transition-colors ${ve?`fill-[#f42a41] text-[#f42a41]`:``}`,B;t[75]!==S||t[76]!==Le?(B=(0,b.jsx)(r.div,{whileHover:Fe,whileTap:Ie,children:(0,b.jsx)(l,{size:28,strokeWidth:1.5,className:Le,onClick:S})}),t[75]=S,t[76]=Le,t[77]=B):B=t[77];let V;t[78]===n.likes?V=t[79]:(V=(0,b.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:n.likes}),t[78]=n.likes,t[79]=V);let H;t[80]!==B||t[81]!==V?(H=(0,b.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[B,V]}),t[80]=B,t[81]=V,t[82]=H):H=t[82];let Re,ze;t[83]===Symbol.for(`react.memo_cache_sentinel`)?(Re={scale:1.1},ze={scale:.9},t[83]=Re,t[84]=ze):(Re=t[83],ze=t[84]);let U;t[85]!==n||t[86]!==s?(U=(0,b.jsx)(r.div,{whileHover:Re,whileTap:ze,children:(0,b.jsx)(ae,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>s(n)})}),t[85]=n,t[86]=s,t[87]=U):U=t[87];let W;t[88]===n.comments?W=t[89]:(W=(0,b.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:n.comments}),t[88]=n.comments,t[89]=W);let G;t[90]!==U||t[91]!==W?(G=(0,b.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[U,W]}),t[90]=U,t[91]=W,t[92]=G):G=t[92];let Be,Ve;t[93]===Symbol.for(`react.memo_cache_sentinel`)?(Be={scale:1.1},Ve={scale:.9},t[93]=Be,t[94]=Ve):(Be=t[93],Ve=t[94]);let He;t[95]===Symbol.for(`react.memo_cache_sentinel`)?(He=(0,b.jsx)(r.div,{whileHover:Be,whileTap:Ve,children:(0,b.jsx)(ee,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>_e(!0)})}),t[95]=He):He=t[95];let Ue;t[96]===Symbol.for(`react.memo_cache_sentinel`)?(Ue=(0,b.jsx)(ie,{size:28,strokeWidth:1.5,className:`text-white drop-shadow-md`}),t[96]=Ue):Ue=t[96];let K;t[97]===n.views?K=t[98]:(K=Intl.NumberFormat(`en-US`,{notation:`compact`,maximumFractionDigits:1}).format(n.views||0),t[97]=n.views,t[98]=K);let q;t[99]===K?q=t[100]:(q=(0,b.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[Ue,(0,b.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:K})]}),t[99]=K,t[100]=q);let We,Ge;t[101]===Symbol.for(`react.memo_cache_sentinel`)?(We={scale:1.1},Ge={scale:.9},t[101]=We,t[102]=Ge):(We=t[101],Ge=t[102]);let Ke;t[103]===Symbol.for(`react.memo_cache_sentinel`)?(Ke=(0,b.jsx)(r.div,{whileHover:We,whileTap:Ge,children:(0,b.jsx)(te,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>he(!0)})}),t[103]=Ke):Ke=t[103];let J;t[104]!==o||t[105]!==n.user?(J=()=>o(n.user),t[104]=o,t[105]=n.user,t[106]=J):J=t[106];let Y;t[107]===n.user.avatar?Y=t[108]:(Y=(0,b.jsx)(d,{src:n.user.avatar}),t[107]=n.user.avatar,t[108]=Y);let X;t[109]===n.user.username[0]?X=t[110]:(X=n.user.username[0].toUpperCase(),t[109]=n.user.username[0],t[110]=X);let Z;t[111]===X?Z=t[112]:(Z=(0,b.jsx)(ce,{children:X}),t[111]=X,t[112]=Z);let Q;t[113]!==J||t[114]!==Y||t[115]!==Z?(Q=(0,b.jsxs)(le,{className:`w-6 h-6 border-2 border-white cursor-pointer mt-2`,onClick:J,children:[Y,Z]}),t[113]=J,t[114]=Y,t[115]=Z,t[116]=Q):Q=t[116];let $;t[117]!==H||t[118]!==G||t[119]!==q||t[120]!==Q?($=(0,b.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe pointer-events-auto`,children:[H,G,He,q,Ke,Q]}),t[117]=H,t[118]=G,t[119]=q,t[120]=Q,t[121]=$):$=t[121];let qe;t[122]!==Ce||t[123]!==T||t[124]!==D||t[125]!==z||t[126]!==$?(qe=(0,b.jsxs)(`div`,{className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-black md:rounded-lg overflow-hidden border-border md:border group shadow-2xl`,onDoubleClick:Ce,children:[T,D,z,$]}),t[122]=Ce,t[123]=T,t[124]=D,t[125]=z,t[126]=$,t[127]=qe):qe=t[127];let Je;return t[128]!==qe||t[129]!==C||t[130]!==w||t[131]!==p?(Je=(0,b.jsxs)(r.div,{ref:p,initial:we,whileInView:Te,viewport:Ee,transition:De,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[C,w,qe]}),t[128]=qe,t[129]=C,t[130]=w,t[131]=p,t[132]=Je):Je=t[132],Je}),he=a();const ge=e=>[`reel`,e],_e=(e,t)=>{let n=(0,he.c)(9),r=e||``,i;n[0]===r?i=n[1]:(i=ge(r),n[0]=r,n[1]=i);let a=!!e,o;n[2]!==t||n[3]!==e?(o=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await p.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await p.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await p.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,views:i.view_count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},n[2]=t,n[3]=e,n[4]=o):o=n[4];let s;return n[5]!==i||n[6]!==a||n[7]!==o?(s={queryKey:i,enabled:a,queryFn:o},n[5]=i,n[6]=a,n[7]=o,n[8]=s):s=n[8],c(s)};var x=a(),ve=()=>{let e=(0,x.c)(41),{showToast:n}=se(),{user:r}=oe(),i=t(),{id:a}=ne(),{data:c,isLoading:ee}=_e(a,r?.id),{data:l,isLoading:te,fetchNextPage:re,hasNextPage:ie,isFetchingNextPage:u}=fe(r?.id),ae;bb0:{if(!l){let t;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t=[],e[0]=t):t=e[0],ae=t;break bb0}let t;e[1]===l.pages?t=e[2]:(t=l.pages.flat(),e[1]=l.pages,e[2]=t),ae=t}let ce=ae,d;e[3]===i?d=e[4]:(d=e=>{i(`/profile/${e.username}`)},e[3]=i,e[4]=d);let f=d,le=a?ee:te,p;e[5]!==ce||e[6]!==a||e[7]!==c?(p=a?c?[c]:[]:ce,e[5]=ce,e[6]=a,e[7]=c,e[8]=p):p=e[8];let ue=p;if(le){let t;return e[9]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,b.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black`,children:(0,b.jsx)(de,{className:`w-full md:w-[400px] h-full rounded-none bg-zinc-900`})}),e[9]=t):t=e[9],t}if(ue.length===0){let t;e[10]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,b.jsx)(`div`,{className:`w-20 h-20 bg-zinc-900 rounded-full flex items-center justify-center`,children:(0,b.jsx)(o,{size:40,className:`text-zinc-500`})}),e[10]=t):t=e[10];let n=a?`Reel not found`:`No reels yet`,r;e[11]===n?r=e[12]:(r=(0,b.jsx)(`p`,{className:`text-zinc-400 font-medium`,children:n}),e[11]=n,e[12]=r);let s;e[13]===i?s=e[14]:(s=(0,b.jsx)(`button`,{onClick:()=>i(`/`),className:`text-sm font-bold hover:underline`,children:`Go back home`}),e[13]=i,e[14]=s);let c;return e[15]!==r||e[16]!==s?(c=(0,b.jsxs)(`div`,{className:`h-screen w-full flex flex-col items-center justify-center bg-black text-white gap-4`,children:[t,r,s]}),e[15]=r,e[16]=s,e[17]=c):c=e[17],c}let m;e[18]===i?m=e[19]:(m=()=>i(`/`),e[18]=i,e[19]=m);let pe;e[20]===Symbol.for(`react.memo_cache_sentinel`)?(pe=(0,b.jsx)(s,{size:28}),e[20]=pe):pe=e[20];let h;e[21]===m?h=e[22]:(h=(0,b.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:m,children:pe}),e[21]=m,e[22]=h);let g;if(e[23]!==ue||e[24]!==f||e[25]!==n){let t;e[27]!==f||e[28]!==n?(t=e=>(0,b.jsx)(me,{reel:e,showToast:n,onUserClick:f},e.id),e[27]=f,e[28]=n,e[29]=t):t=e[29],g=ue.map(t),e[23]=ue,e[24]=f,e[25]=n,e[26]=g}else g=e[26];let _;e[30]!==re||e[31]!==ie||e[32]!==a||e[33]!==u?(_=ie&&!a&&(0,b.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center snap-start bg-black`,children:(0,b.jsx)(`button`,{onClick:()=>re(),disabled:u,className:`bg-white/10 hover:bg-white/20 text-white px-6 py-2 rounded-full border border-white/20 transition-colors`,children:u?`Loading...`:`See more videos`})}),e[30]=re,e[31]=ie,e[32]=a,e[33]=u,e[34]=_):_=e[34];let v;e[35]!==g||e[36]!==_?(v=(0,b.jsxs)(`div`,{className:`w-full md:w-[400px] h-full`,children:[g,_]}),e[35]=g,e[36]=_,e[37]=v):v=e[37];let y;return e[38]!==h||e[39]!==v?(y=(0,b.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[h,v]}),e[38]=h,e[39]=v,e[40]=y):y=e[40],y};export{ve as default};