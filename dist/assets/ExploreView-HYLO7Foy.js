import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{Dt as t,Gt as n,Ht as r,K as i,N as a,Pt as o,Tt as s,et as c,kt as l,n as u,ut as d}from"./vendor-j4eAkL9f.js";import"./libs-Bghk4o3g.js";import"./tanstack-DEYdLxKO.js";import"./supabase-nYr-R5G6.js";import{g as f,i as p,o as ee,p as m,v as te}from"./index-BnmHHGy6.js";var h=e(n(),1),g=t();const _=[`explorePosts`],v=()=>{let e=(0,g.c)(1),t;return e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t={queryKey:_,queryFn:b,initialPageParam:0,getNextPageParam:x},e[0]=t):t=e[0],l(t)};function y(e){let t=e.profiles;return{id:e.id,user:{id:e.user_id,username:t?.username||`Unknown`,name:t?.full_name||`Unknown`,avatar:t?.avatar_url||``,isVerified:t?.is_verified||!1},content:{type:`image`,src:e.image_url},likes:e.likes[0]?.count||0,comments:e.comments[0]?.count||0,caption:e.caption||``,time:``}}async function b(e){let{pageParam:t}=e,n=(t===void 0?0:t)*15,r=n+14,{data:i,error:a}=await m.from(`posts`).select(`
          id,
          image_url,
          user_id,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).order(`created_at`,{ascending:!1}).range(n,r);if(a)throw a;return i.map(y)}function x(e,t){return e.length===15?t.length:void 0}var ne=t(),S=o(),C=()=>{let e=(0,ne.c)(44),{theme:t,setViewingPost:n}=te(),o=r(),[l,g]=(0,h.useState)(``),_;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(_=[],e[0]=_):_=e[0];let[y,b]=(0,h.useState)(_),[x,C]=(0,h.useState)(!1),T;e[1]===Symbol.for(`react.memo_cache_sentinel`)?(T={rootMargin:`1200px`},e[1]=T):T=e[1];let{ref:E,inView:D}=u(T),{data:O,isLoading:k,fetchNextPage:A,hasNextPage:j,isFetchingNextPage:M}=v(),N,P;e[2]!==A||e[3]!==j||e[4]!==D?(N=()=>{D&&j&&A()},P=[D,j,A],e[2]=A,e[3]=j,e[4]=D,e[5]=N,e[6]=P):(N=e[5],P=e[6]),(0,h.useEffect)(N,P);let F,I;e[7]===l?(F=e[8],I=e[9]):(F=()=>{let e=setTimeout(async()=>{if(l.trim().length>0){C(!0);let{data:e}=await m.from(`profiles`).select(`id, username, full_name, avatar_url, is_verified`).ilike(`username`,`%${l}%`).limit(10);e&&b(e.map(w)),C(!1)}else b([])},300);return()=>clearTimeout(e)},I=[l],e[7]=l,e[8]=F,e[9]=I),(0,h.useEffect)(F,I);let L;e[10]===Symbol.for(`react.memo_cache_sentinel`)?(L={opacity:0},e[10]=L):L=e[10];let R;e[11]===Symbol.for(`react.memo_cache_sentinel`)?(R={hidden:L,visible:{opacity:1,transition:{staggerChildren:.05}}},e[11]=R):R=e[11];let z=R,B;e[12]===Symbol.for(`react.memo_cache_sentinel`)?(B={hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},e[12]=B):B=e[12];let V=B,H=`mb-4 sticky top-0 z-30 py-2 ${t===`dark`?`bg-black`:`bg-white`}`,U=`flex items-center gap-2 px-3 py-2 rounded-lg ${t===`dark`?`bg-[#262626]`:`bg-gray-100`}`,W=t===`dark`?`text-[#8e8e8e]`:`text-gray-500`,G;e[13]===W?G=e[14]:(G=(0,S.jsx)(i,{size:18,className:W}),e[13]=W,e[14]=G);let K;e[15]===Symbol.for(`react.memo_cache_sentinel`)?(K=e=>g(e.target.value),e[15]=K):K=e[15];let q=`bg-transparent border-none outline-none text-sm w-full focus-visible:ring-0 p-0 h-auto ${t===`dark`?`text-white`:`text-black`}`,J;e[16]!==l||e[17]!==q?(J=(0,S.jsx)(ee,{type:`text`,placeholder:`অনুসন্ধান`,value:l,onChange:K,className:q}),e[16]=l,e[17]=q,e[18]=J):J=e[18];let Y;e[19]===l?Y=e[20]:(Y=l&&(0,S.jsx)(a,{size:18,className:`cursor-pointer`,onClick:()=>g(``)}),e[19]=l,e[20]=Y);let X;e[21]!==U||e[22]!==G||e[23]!==J||e[24]!==Y?(X=(0,S.jsxs)(`div`,{className:U,children:[G,J,Y]}),e[21]=U,e[22]=G,e[23]=J,e[24]=Y,e[25]=X):X=e[25];let Z;e[26]!==X||e[27]!==H?(Z=(0,S.jsx)(`div`,{className:H,children:X}),e[26]=X,e[27]=H,e[28]=Z):Z=e[28];let Q;e[29]!==O?.pages||e[30]!==j||e[31]!==M||e[32]!==k||e[33]!==x||e[34]!==o||e[35]!==E||e[36]!==l||e[37]!==y||e[38]!==n||e[39]!==t?(Q=l?(0,S.jsxs)(`div`,{className:`flex flex-col gap-2`,children:[x&&(0,S.jsx)(`div`,{className:`p-4 text-center`,children:`Searching...`}),!x&&y.length===0&&(0,S.jsx)(`div`,{className:`p-4 text-center text-gray-500`,children:`কোনো ফলাফল পাওয়া যায়নি`}),y.map(e=>(0,S.jsxs)(`div`,{onClick:()=>o(`/profile/${e.username}`),className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer ${t===`dark`?`hover:bg-white/10`:`hover:bg-gray-100`}`,children:[(0,S.jsx)(f,{src:e.avatar,width:100,className:`w-10 h-10 rounded-full`,alt:e.username}),(0,S.jsxs)(`div`,{className:`flex flex-col`,children:[(0,S.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,S.jsx)(`span`,{className:`font-semibold text-sm`,children:e.username}),e.isVerified&&(0,S.jsx)(p,{})]}),(0,S.jsx)(`span`,{className:`text-xs text-gray-500`,children:e.name})]})]},e.username))]}):(0,S.jsxs)(S.Fragment,{children:[k?(0,S.jsx)(`div`,{className:`p-10 text-center`,children:`Loading explore...`}):(0,S.jsx)(s.div,{variants:z,initial:`hidden`,animate:`visible`,className:`grid grid-cols-3 gap-1 md:gap-4`,children:O?.pages.map((e,t)=>(0,S.jsx)(h.Fragment,{children:e.map(e=>(0,S.jsxs)(s.div,{variants:V,whileHover:{scale:.98},className:`relative aspect-square group cursor-pointer overflow-hidden`,onClick:()=>n(e),children:[(0,S.jsx)(f,{src:e.content.src||e.content.poster,width:400,className:`w-full h-full transition-transform duration-300 group-hover:scale-110`,alt:`explore`}),(0,S.jsxs)(`div`,{className:`absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-4 text-white font-bold transition-opacity duration-200 z-20`,children:[(0,S.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,S.jsx)(d,{fill:`white`,size:16}),` `,e.likes]}),(0,S.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,S.jsx)(c,{fill:`white`,size:16,className:`-scale-x-100`}),` `,e.comments]})]})]},e.id))},t))}),(0,S.jsx)(`div`,{ref:E,className:`h-10 text-center py-4 text-gray-500`,children:M?`আরও লোড হচ্ছে...`:j?`নিচে দেখুন`:``})]}),e[29]=O?.pages,e[30]=j,e[31]=M,e[32]=k,e[33]=x,e[34]=o,e[35]=E,e[36]=l,e[37]=y,e[38]=n,e[39]=t,e[40]=Q):Q=e[40];let $;return e[41]!==Z||e[42]!==Q?($=(0,S.jsxs)(`div`,{className:`w-full max-w-[935px] py-4 px-2`,children:[Z,Q]}),e[41]=Z,e[42]=Q,e[43]=$):$=e[43],$};function w(e){return{username:e.username,name:e.full_name||e.username,avatar:e.avatar_url||``,isVerified:e.is_verified||!1,id:e.id}}export{C as default};