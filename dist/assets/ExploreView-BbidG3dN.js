import{a as e}from"./rolldown-runtime-DDUpfMIz.js";import{Ct as t,Gt as n,Ut as r,Vt as i,Xt as a,in as ee,n as te,pt as o,qt as s,rt as ne,sn as c,z as re}from"./vendor-B3HL14pl.js";import{en as l}from"./libs-v5ruOQjS.js";import"./supabase-DoaD7gz2.js";import{S as ie,T as ae,b as oe,c as se,u,v as d,x as ce}from"./index-AqHGfiHH.js";var f=e(c(),1),p=r();const m=[`explorePosts`],le=()=>{let e=(0,p.c)(1),t;return e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t={queryKey:m,queryFn:g,initialPageParam:0,getNextPageParam:_},e[0]=t):t=e[0],n(t)};function h(e){let t=e.profiles;return{id:e.id,user:{id:e.user_id,username:t?.username||`Unknown`,name:t?.full_name||`Unknown`,avatar:t?.avatar_url||``,isVerified:t?.is_verified||!1},content:{type:`image`,src:e.image_url},likes:e.likes[0]?.count||0,comments:e.comments[0]?.count||0,caption:e.caption||``,time:``}}async function g(e){let{pageParam:t}=e,n=(t===void 0?0:t)*15,r=n+14,{data:i,error:a}=await d.from(`posts`).select(`
          id,
          image_url,
          user_id,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).order(`created_at`,{ascending:!1}).range(n,r);if(a)throw a;return i.map(h)}function _(e,t){return e.length===15?t.length:void 0}var v=r(),y=e(l(),1);const b=e=>[`searchPosts`,e],ue=e=>{let t=(0,v.c)(8),n;t[0]===e?n=t[1]:(n=b(e),t[0]=e,t[1]=n);let r=!!e&&e.length>0,i;t[2]===e?i=t[3]:(i=async()=>{let{data:t,error:n}=await d.from(`posts`).select(`
          id,
          created_at,
          caption,
          image_url,
          user_id,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).ilike(`caption`,`%${e}%`).order(`created_at`,{ascending:!1}).limit(20);if(n)throw n;return(t||[]).map(x)},t[2]=e,t[3]=i);let a;return t[4]!==n||t[5]!==r||t[6]!==i?(a={queryKey:n,enabled:r,queryFn:i},t[4]=n,t[5]=r,t[6]=i,t[7]=a):a=t[7],s(a)};function x(e){let t=e.profiles;return{id:e.id,user:{id:e.user_id,username:t?.username||`Unknown`,name:t?.full_name||`Unknown`,avatar:t?.avatar_url||``,isVerified:t?.is_verified||!1},content:{type:`image`,src:e.image_url},likes:e.likes[0]?.count||0,caption:e.caption||``,comments:e.comments[0]?.count||0,time:(0,y.default)(e.created_at).fromNow(),createdAt:e.created_at,isVerified:t?.is_verified||!1}}var de=r(),S=e(a(),1),C=()=>{let e=(0,de.c)(56),{theme:n,setViewingPost:r}=ae(),a=ee(),[s,c]=(0,f.useState)(``),[l,p]=(0,f.useState)(`accounts`),m;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(m=[],e[0]=m):m=e[0];let[h,g]=(0,f.useState)(m),[_,v]=(0,f.useState)(!1),y;e[1]===Symbol.for(`react.memo_cache_sentinel`)?(y={rootMargin:`1200px`},e[1]=y):y=e[1];let{ref:b,inView:x}=te(y),{data:C,isLoading:T,fetchNextPage:E,hasNextPage:D,isFetchingNextPage:O}=le(),{data:k,isLoading:A}=ue(l===`posts`?s:``),j;e[2]===k?j=e[3]:(j=k===void 0?[]:k,e[2]=k,e[3]=j);let M=j,N,P;e[4]!==E||e[5]!==D||e[6]!==x||e[7]!==s?(N=()=>{x&&D&&!s&&E()},P=[x,D,E,s],e[4]=E,e[5]=D,e[6]=x,e[7]=s,e[8]=N,e[9]=P):(N=e[8],P=e[9]),(0,f.useEffect)(N,P);let F,I;e[10]!==s||e[11]!==l?(F=()=>{let e=setTimeout(async()=>{if(s.trim().length>0){if(l===`accounts`){v(!0);let{data:e}=await d.from(`profiles`).select(`id, username, full_name, avatar_url, is_verified`).ilike(`username`,`%${s}%`).limit(10);e&&g(e.map(w)),v(!1)}}else g([])},300);return()=>clearTimeout(e)},I=[s,l],e[10]=s,e[11]=l,e[12]=F,e[13]=I):(F=e[12],I=e[13]),(0,f.useEffect)(F,I);let L;e[14]===Symbol.for(`react.memo_cache_sentinel`)?(L={opacity:0},e[14]=L):L=e[14];let R;e[15]===Symbol.for(`react.memo_cache_sentinel`)?(R={hidden:L,visible:{opacity:1,transition:{staggerChildren:.05}}},e[15]=R):R=e[15];let fe=R,z;e[16]===Symbol.for(`react.memo_cache_sentinel`)?(z={hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},e[16]=z):z=e[16];let B=z,V=`mb-4 sticky top-0 z-30 py-2 ${n===`dark`?`bg-black`:`bg-white`}`,H=`flex items-center gap-2 px-3 py-2 rounded-lg ${n===`dark`?`bg-[#262626]`:`bg-gray-100`}`,U=n===`dark`?`text-[#8e8e8e]`:`text-gray-500`,W;e[17]===U?W=e[18]:(W=(0,S.jsx)(ne,{size:18,className:U}),e[17]=U,e[18]=W);let G;e[19]===Symbol.for(`react.memo_cache_sentinel`)?(G=e=>c(e.target.value),e[19]=G):G=e[19];let K=`bg-transparent border-none outline-none text-sm w-full p-0 h-auto ${n===`dark`?`text-white`:`text-black`}`,q;e[20]!==s||e[21]!==K?(q=(0,S.jsx)(`input`,{type:`text`,placeholder:`অনুসন্ধান`,value:s,onChange:G,className:K}),e[20]=s,e[21]=K,e[22]=q):q=e[22];let J;e[23]===s?J=e[24]:(J=s&&(0,S.jsx)(re,{size:18,className:`cursor-pointer`,onClick:()=>c(``)}),e[23]=s,e[24]=J);let Y;e[25]!==H||e[26]!==W||e[27]!==q||e[28]!==J?(Y=(0,S.jsxs)(`div`,{className:H,children:[W,q,J]}),e[25]=H,e[26]=W,e[27]=q,e[28]=J,e[29]=Y):Y=e[29];let X;e[30]!==s||e[31]!==l||e[32]!==n?(X=s&&(0,S.jsxs)(`div`,{className:`flex mt-2 border-b border-zinc-700`,children:[(0,S.jsx)(`button`,{className:`flex-1 py-2 text-sm font-semibold ${l===`accounts`?n===`dark`?`text-white border-b-2 border-white`:`text-black border-b-2 border-black`:`text-zinc-500`}`,onClick:()=>p(`accounts`),children:`অ্যাকাউন্ট`}),(0,S.jsx)(`button`,{className:`flex-1 py-2 text-sm font-semibold ${l===`posts`?n===`dark`?`text-white border-b-2 border-white`:`text-black border-b-2 border-black`:`text-zinc-500`}`,onClick:()=>p(`posts`),children:`পোস্ট`})]}),e[30]=s,e[31]=l,e[32]=n,e[33]=X):X=e[33];let Z;e[34]!==V||e[35]!==Y||e[36]!==X?(Z=(0,S.jsxs)(`div`,{className:V,children:[Y,X]}),e[34]=V,e[35]=Y,e[36]=X,e[37]=Z):Z=e[37];let Q;e[38]!==C?.pages||e[39]!==D||e[40]!==T||e[41]!==O||e[42]!==A||e[43]!==_||e[44]!==a||e[45]!==M||e[46]!==b||e[47]!==s||e[48]!==l||e[49]!==r||e[50]!==n||e[51]!==h?(Q=s?(0,S.jsxs)(`div`,{className:`flex flex-col gap-2`,children:[l===`accounts`&&(0,S.jsxs)(S.Fragment,{children:[_&&(0,S.jsx)(`div`,{className:`p-4 text-center`,children:`Searching...`}),!_&&h.length===0&&(0,S.jsx)(`div`,{className:`p-4 text-center text-gray-500`,children:`কোনো অ্যাকাউন্ট পাওয়া যায়নি`}),h.map(e=>(0,S.jsxs)(`div`,{onClick:()=>a(`/profile/${e.username}`),className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer ${n===`dark`?`hover:bg-white/10`:`hover:bg-gray-100`}`,children:[(0,S.jsxs)(oe,{className:`w-10 h-10`,children:[(0,S.jsx)(ie,{src:e.avatar}),(0,S.jsx)(ce,{children:e.username[0].toUpperCase()})]}),(0,S.jsxs)(`div`,{className:`flex flex-col`,children:[(0,S.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,S.jsx)(`span`,{className:`font-semibold text-sm`,children:e.username}),e.isVerified&&(0,S.jsx)(se,{})]}),(0,S.jsx)(`span`,{className:`text-xs text-gray-500`,children:e.name})]})]},e.username))]}),l===`posts`&&(0,S.jsxs)(S.Fragment,{children:[A&&(0,S.jsx)(`div`,{className:`p-4 text-center`,children:`Searching posts...`}),!A&&M.length===0&&(0,S.jsx)(`div`,{className:`p-4 text-center text-gray-500`,children:`কোনো পোস্ট পাওয়া যায়নি`}),(0,S.jsx)(`div`,{className:`grid grid-cols-3 gap-1 md:gap-4`,children:M.map(e=>(0,S.jsxs)(i.div,{variants:B,whileHover:{scale:.98},className:`relative aspect-square group cursor-pointer overflow-hidden`,onClick:()=>r(e),children:[(0,S.jsx)(u,{src:e.content.src||e.content.poster,width:400,className:`w-full h-full transition-transform duration-300 group-hover:scale-110`,alt:`search result`}),(0,S.jsxs)(`div`,{className:`absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-4 text-white font-bold transition-opacity duration-200 z-20`,children:[(0,S.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,S.jsx)(t,{fill:`white`,size:16}),` `,e.likes]}),(0,S.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,S.jsx)(o,{fill:`white`,size:16,className:`-scale-x-100`}),` `,e.comments]})]})]},e.id))})]})]}):(0,S.jsxs)(S.Fragment,{children:[T?(0,S.jsx)(`div`,{className:`p-10 text-center`,children:`Loading explore...`}):(0,S.jsx)(i.div,{variants:fe,initial:`hidden`,animate:`visible`,className:`grid grid-cols-3 gap-1 md:gap-4`,children:C?.pages.map((e,n)=>(0,S.jsx)(f.Fragment,{children:e.map(e=>(0,S.jsxs)(i.div,{variants:B,whileHover:{scale:.98},className:`relative aspect-square group cursor-pointer overflow-hidden`,onClick:()=>r(e),children:[(0,S.jsx)(u,{src:e.content.src||e.content.poster,width:400,className:`w-full h-full transition-transform duration-300 group-hover:scale-110`,alt:`explore`}),(0,S.jsxs)(`div`,{className:`absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-4 text-white font-bold transition-opacity duration-200 z-20`,children:[(0,S.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,S.jsx)(t,{fill:`white`,size:16}),` `,e.likes]}),(0,S.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,S.jsx)(o,{fill:`white`,size:16,className:`-scale-x-100`}),` `,e.comments]})]})]},e.id))},n))}),(0,S.jsx)(`div`,{ref:b,className:`h-10 text-center py-4 text-gray-500`,children:O?`আরও লোড হচ্ছে...`:D?`নিচে দেখুন`:``})]}),e[38]=C?.pages,e[39]=D,e[40]=T,e[41]=O,e[42]=A,e[43]=_,e[44]=a,e[45]=M,e[46]=b,e[47]=s,e[48]=l,e[49]=r,e[50]=n,e[51]=h,e[52]=Q):Q=e[52];let $;return e[53]!==Z||e[54]!==Q?($=(0,S.jsxs)(`div`,{className:`w-full max-w-[935px] py-4 px-2`,children:[Z,Q]}),e[53]=Z,e[54]=Q,e[55]=$):$=e[55],$};function w(e){return{id:e.id,username:e.username,name:e.full_name||e.username,avatar:e.avatar_url||``,isVerified:e.is_verified||!1}}export{C as default};