import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{At as t,Ft as n,Ht as r,Nt as i,Rt as a,X as o,Xt as s,Yt as c,Z as ee,Zt as l,_t as te,bt as ne,fn as u,ft as re,hn as d,in as f,lt as ie,nn as p,pn as ae,t as oe}from"./vendor-CF4zx1nW.js";import"./libs-CDFYUT-j.js";import"./tanstack-CjdblyHw.js";import"./supabase-CW8wD_q0.js";import{A as m,C as se,F as ce,M as le,O as h,P as ue,_ as g,j as _,o as v,s as y}from"./index-DNIAENp9.js";import{n as b,r as x,t as de}from"./useViewTracker-CtC3KOky.js";import"./useGetSuggestedUsers-yf6QhQht.js";import{t as fe}from"./useFollowUser-B2pEa2Yj.js";var pe=l(),S=e(d(),1),C=f(),me=oe,he=(0,S.memo)(e=>{let n=(0,pe.c)(145),{reel:a,showToast:l,onUserClick:u}=e,{setViewingReel:d}=ce(),{user:f}=ue(),{mutate:p}=v(),{mutate:ae}=fe(),{ref:oe}=de(a.id,`reel`),[se,h]=(0,S.useState)(!1),[g,he]=(0,S.useState)(!0),[w,ge]=(0,S.useState)(!0),[_e,ve]=(0,S.useState)(!1),[ye,be]=(0,S.useState)(!1),xe=(0,S.useRef)(null),Se=(0,S.useRef)(null),T=`${window.location.origin}/reels/${a.id}`,Ce=a.hasLiked||!1,we;n[0]!==Ce||n[1]!==a.id||n[2]!==l||n[3]!==p||n[4]!==f?(we=()=>{if(!f){l(`Log in to like`);return}p({targetId:a.id,type:`reel`,userId:f.id,hasLiked:Ce})},n[0]=Ce,n[1]=a.id,n[2]=l,n[3]=p,n[4]=f,n[5]=we):we=n[5];let E=we,Te;n[6]!==ae||n[7]!==a.user.isFollowing||n[8]!==a.user.username||n[9]!==a.userId||n[10]!==l||n[11]!==f?(Te=()=>{if(!f){l(`Log in to follow`);return}a.userId&&ae({targetUserId:a.userId,currentUserId:f.id,isFollowing:a.user.isFollowing||!1,targetUsername:a.user.username},{onSuccess:()=>l(`Followed`),onError:()=>l(`Failed to follow`)})},n[6]=ae,n[7]=a.user.isFollowing,n[8]=a.user.username,n[9]=a.userId,n[10]=l,n[11]=f,n[12]=Te):Te=n[12];let Ee=Te,De;n[13]===w?De=n[14]:(De=()=>{Se.current&&ge(!w)},n[13]=w,n[14]=De);let Oe=De,ke,Ae;n[15]===Symbol.for(`react.memo_cache_sentinel`)?(ke=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(ge(!0),he(!1)):(ge(!1),he(!0))},{threshold:.6});return xe.current&&e.observe(xe.current),()=>e.disconnect()},Ae=[],n[15]=ke,n[16]=Ae):(ke=n[15],Ae=n[16]),(0,S.useEffect)(ke,Ae);let je;n[17]===E?je=n[18]:(je=()=>{E(),h(!0),setTimeout(()=>h(!1),1e3)},n[17]=E,n[18]=je);let Me=je,Ne,Pe,Fe,Ie;n[19]===Symbol.for(`react.memo_cache_sentinel`)?(Pe={opacity:0,scale:.95},Fe={opacity:1,scale:1},Ie={once:!0},Ne={duration:.5},n[19]=Ne,n[20]=Pe,n[21]=Fe,n[22]=Ie):(Ne=n[19],Pe=n[20],Fe=n[21],Ie=n[22]);let D;n[23]!==_e||n[24]!==T||n[25]!==l?(D=_e&&(0,C.jsx)(x,{onClose:()=>ve(!1),showToast:l,shareUrl:T}),n[23]=_e,n[24]=T,n[25]=l,n[26]=D):D=n[26];let O;n[27]!==ye||n[28]!==T?(O=ye&&(0,C.jsx)(b,{onClose:()=>be(!1),shareUrl:T}),n[27]=ye,n[28]=T,n[29]=O):O=n[29];let k;n[30]!==g||n[31]!==w||n[32]!==a.src||n[33]!==Oe?(k=a.src?(0,C.jsx)(`div`,{className:`w-full h-full cursor-pointer`,onClick:Oe,children:(0,C.jsx)(me,{ref:Se,url:a.src,width:`100%`,height:`100%`,playing:w,muted:g,loop:!0,playsinline:!0,style:{objectFit:`cover`},className:`react-player pointer-events-none`})}):(0,C.jsx)(`img`,{src:a.src,className:`w-full h-full object-cover`,onClick:()=>he(!g),alt:`reel`,loading:`lazy`}),n[30]=g,n[31]=w,n[32]=a.src,n[33]=Oe,n[34]=k):k=n[34];let A;n[35]===w?A=n[36]:(A=!w&&(0,C.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,C.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,C.jsx)(re,{className:`text-white w-10 h-10 fill-white`})})}),n[35]=w,n[36]=A);let j;n[37]===g?j=n[38]:(j=(0,C.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),he(!g)},children:g?(0,C.jsx)(o,{className:`text-white w-5 h-5`}):(0,C.jsx)(ee,{className:`text-white w-5 h-5`})}),n[37]=g,n[38]=j);let M;n[39]===se?M=n[40]:(M=se&&(0,C.jsx)(c.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,C.jsx)(t,{size:100,className:`text-white fill-white drop-shadow-lg`})}),n[39]=se,n[40]=M);let N;n[41]===M?N=n[42]:(N=(0,C.jsx)(s,{children:M}),n[41]=M,n[42]=N);let P;n[43]!==u||n[44]!==a.user?(P=()=>u(a.user),n[43]=u,n[44]=a.user,n[45]=P):P=n[45];let F;n[46]===a.user.avatar?F=n[47]:(F=(0,C.jsx)(le,{src:a.user.avatar}),n[46]=a.user.avatar,n[47]=F);let I;n[48]===a.user.username[0]?I=n[49]:(I=a.user.username[0].toUpperCase(),n[48]=a.user.username[0],n[49]=I);let L;n[50]===I?L=n[51]:(L=(0,C.jsx)(_,{children:I}),n[50]=I,n[51]=L);let R;n[52]!==F||n[53]!==L?(R=(0,C.jsxs)(m,{className:`w-8 h-8 border border-white/50 cursor-pointer`,children:[F,L]}),n[52]=F,n[53]=L,n[54]=R):R=n[54];let z;n[55]===a.user.username?z=n[56]:(z=(0,C.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:a.user.username}),n[55]=a.user.username,n[56]=z);let B;n[57]===a.user.isVerified?B=n[58]:(B=a.user.isVerified&&(0,C.jsx)(y,{}),n[57]=a.user.isVerified,n[58]=B);let Le,Re;n[59]===Symbol.for(`react.memo_cache_sentinel`)?(Le={scale:1.05},Re={scale:.95},n[59]=Le,n[60]=Re):(Le=n[59],Re=n[60]);let ze=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${a.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,V;n[61]===Ee?V=n[62]:(V=e=>{e.stopPropagation(),Ee()},n[61]=Ee,n[62]=V);let Be=a.user.isFollowing?`Following`:`Follow`,H;n[63]!==ze||n[64]!==V||n[65]!==Be?(H=(0,C.jsx)(c.button,{whileHover:Le,whileTap:Re,className:ze,onClick:V,children:Be}),n[63]=ze,n[64]=V,n[65]=Be,n[66]=H):H=n[66];let U;n[67]!==P||n[68]!==R||n[69]!==z||n[70]!==B||n[71]!==H?(U=(0,C.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:P,children:[R,z,B,H]}),n[67]=P,n[68]=R,n[69]=z,n[70]=B,n[71]=H,n[72]=U):U=n[72];let Ve;n[73]===Symbol.for(`react.memo_cache_sentinel`)?(Ve=(0,C.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`More`}),n[73]=Ve):Ve=n[73];let W;n[74]===a.caption?W=n[75]:(W=(0,C.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[a.caption,` `,Ve]}),n[74]=a.caption,n[75]=W);let He;n[76]===Symbol.for(`react.memo_cache_sentinel`)?(He=(0,C.jsx)(te,{size:12}),n[76]=He):He=n[76];let G;n[77]===a.audio?G=n[78]:(G=(0,C.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[He,(0,C.jsx)(`div`,{className:`truncate w-40`,children:a.audio})]}),n[77]=a.audio,n[78]=G);let K;n[79]!==U||n[80]!==W||n[81]!==G?(K=(0,C.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[U,W,G]}),n[79]=U,n[80]=W,n[81]=G,n[82]=K):K=n[82];let Ue,We;n[83]===Symbol.for(`react.memo_cache_sentinel`)?(Ue={scale:1.1},We={scale:.9},n[83]=Ue,n[84]=We):(Ue=n[83],We=n[84]);let Ge=`cursor-pointer transition-colors ${Ce?`fill-[#f42a41] text-[#f42a41]`:``}`,q;n[85]!==E||n[86]!==Ge?(q=(0,C.jsx)(c.div,{whileHover:Ue,whileTap:We,children:(0,C.jsx)(t,{size:28,strokeWidth:1.5,className:Ge,onClick:E})}),n[85]=E,n[86]=Ge,n[87]=q):q=n[87];let J;n[88]===a.likes?J=n[89]:(J=(0,C.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:a.likes}),n[88]=a.likes,n[89]=J);let Y;n[90]!==q||n[91]!==J?(Y=(0,C.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[q,J]}),n[90]=q,n[91]=J,n[92]=Y):Y=n[92];let Ke,qe;n[93]===Symbol.for(`react.memo_cache_sentinel`)?(Ke={scale:1.1},qe={scale:.9},n[93]=Ke,n[94]=qe):(Ke=n[93],qe=n[94]);let X;n[95]!==a||n[96]!==d?(X=(0,C.jsx)(c.div,{whileHover:Ke,whileTap:qe,children:(0,C.jsx)(ne,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>d(a)})}),n[95]=a,n[96]=d,n[97]=X):X=n[97];let Z;n[98]===a.comments?Z=n[99]:(Z=(0,C.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:a.comments}),n[98]=a.comments,n[99]=Z);let Q;n[100]!==X||n[101]!==Z?(Q=(0,C.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[X,Z]}),n[100]=X,n[101]=Z,n[102]=Q):Q=n[102];let Je,Ye;n[103]===Symbol.for(`react.memo_cache_sentinel`)?(Je={scale:1.1},Ye={scale:.9},n[103]=Je,n[104]=Ye):(Je=n[103],Ye=n[104]);let Xe;n[105]===Symbol.for(`react.memo_cache_sentinel`)?(Xe=(0,C.jsx)(c.div,{whileHover:Je,whileTap:Ye,children:(0,C.jsx)(ie,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>be(!0)})}),n[105]=Xe):Xe=n[105];let Ze;n[106]===Symbol.for(`react.memo_cache_sentinel`)?(Ze=(0,C.jsx)(r,{size:28,strokeWidth:1.5,className:`text-white drop-shadow-md`}),n[106]=Ze):Ze=n[106];let Qe;n[107]===a.views?Qe=n[108]:(Qe=Intl.NumberFormat(`en-US`,{notation:`compact`,maximumFractionDigits:1}).format(a.views||0),n[107]=a.views,n[108]=Qe);let $e;n[109]===Qe?$e=n[110]:($e=(0,C.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[Ze,(0,C.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:Qe})]}),n[109]=Qe,n[110]=$e);let et,tt;n[111]===Symbol.for(`react.memo_cache_sentinel`)?(et={scale:1.1},tt={scale:.9},n[111]=et,n[112]=tt):(et=n[111],tt=n[112]);let nt;n[113]===Symbol.for(`react.memo_cache_sentinel`)?(nt=(0,C.jsx)(c.div,{whileHover:et,whileTap:tt,children:(0,C.jsx)(i,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ve(!0)})}),n[113]=nt):nt=n[113];let rt;n[114]!==u||n[115]!==a.user?(rt=()=>u(a.user),n[114]=u,n[115]=a.user,n[116]=rt):rt=n[116];let it;n[117]===a.user.avatar?it=n[118]:(it=(0,C.jsx)(le,{src:a.user.avatar}),n[117]=a.user.avatar,n[118]=it);let at;n[119]===a.user.username[0]?at=n[120]:(at=a.user.username[0].toUpperCase(),n[119]=a.user.username[0],n[120]=at);let ot;n[121]===at?ot=n[122]:(ot=(0,C.jsx)(_,{children:at}),n[121]=at,n[122]=ot);let st;n[123]!==rt||n[124]!==it||n[125]!==ot?(st=(0,C.jsxs)(m,{className:`w-6 h-6 border-2 border-white cursor-pointer mt-2`,onClick:rt,children:[it,ot]}),n[123]=rt,n[124]=it,n[125]=ot,n[126]=st):st=n[126];let ct;n[127]!==Y||n[128]!==Q||n[129]!==$e||n[130]!==st?(ct=(0,C.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[Y,Q,Xe,$e,nt,st]}),n[127]=Y,n[128]=Q,n[129]=$e,n[130]=st,n[131]=ct):ct=n[131];let $;n[132]!==Me||n[133]!==k||n[134]!==A||n[135]!==j||n[136]!==N||n[137]!==K||n[138]!==ct?($=(0,C.jsxs)(`div`,{ref:xe,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-black md:rounded-lg overflow-hidden border-border md:border group shadow-2xl`,onDoubleClick:Me,children:[k,A,j,N,K,ct]}),n[132]=Me,n[133]=k,n[134]=A,n[135]=j,n[136]=N,n[137]=K,n[138]=ct,n[139]=$):$=n[139];let lt;return n[140]!==D||n[141]!==O||n[142]!==$||n[143]!==oe?(lt=(0,C.jsxs)(c.div,{ref:oe,initial:Pe,whileInView:Fe,viewport:Ie,transition:Ne,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[D,O,$]}),n[140]=D,n[141]=O,n[142]=$,n[143]=oe,n[144]=lt):lt=n[144],lt}),w=l();const ge=e=>[`reel`,e],_e=(e,t)=>{let n=(0,w.c)(9),r=e||``,i;n[0]===r?i=n[1]:(i=ge(r),n[0]=r,n[1]=i);let a=!!e,o;n[2]!==t||n[3]!==e?(o=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await h.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await h.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await h.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,views:i.view_count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},n[2]=t,n[3]=e,n[4]=o):o=n[4];let s;return n[5]!==i||n[6]!==a||n[7]!==o?(s={queryKey:i,enabled:a,queryFn:o},n[5]=i,n[6]=a,n[7]=o,n[8]=s):s=n[8],p(s)};var ve=l(),ye=()=>{let e=(0,ve.c)(41),{showToast:t}=ce(),{user:r}=ue(),i=u(),{id:o}=ae(),{data:s,isLoading:c}=_e(o,r?.id),{data:ee,isLoading:l,fetchNextPage:te,hasNextPage:ne,isFetchingNextPage:re}=se(r?.id),d;bb0:{if(!ee){let t;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t=[],e[0]=t):t=e[0],d=t;break bb0}let t;e[1]===ee.pages?t=e[2]:(t=ee.pages.flat(),e[1]=ee.pages,e[2]=t),d=t}let f=d,ie;e[3]===i?ie=e[4]:(ie=e=>{i(`/profile/${e.username}`)},e[3]=i,e[4]=ie);let p=ie,oe=o?c:l,m;e[5]!==f||e[6]!==o||e[7]!==s?(m=o?s?[s]:[]:f,e[5]=f,e[6]=o,e[7]=s,e[8]=m):m=e[8];let le=m;if(oe){let t;return e[9]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,C.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black`,children:(0,C.jsx)(g,{className:`w-full md:w-[400px] h-full rounded-none bg-zinc-900`})}),e[9]=t):t=e[9],t}if(le.length===0){let t;e[10]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,C.jsx)(`div`,{className:`w-20 h-20 bg-zinc-900 rounded-full flex items-center justify-center`,children:(0,C.jsx)(n,{size:40,className:`text-zinc-500`})}),e[10]=t):t=e[10];let r=o?`Reel not found`:`No reels yet`,a;e[11]===r?a=e[12]:(a=(0,C.jsx)(`p`,{className:`text-zinc-400 font-medium`,children:r}),e[11]=r,e[12]=a);let s;e[13]===i?s=e[14]:(s=(0,C.jsx)(`button`,{onClick:()=>i(`/`),className:`text-sm font-bold hover:underline`,children:`Go back home`}),e[13]=i,e[14]=s);let c;return e[15]!==a||e[16]!==s?(c=(0,C.jsxs)(`div`,{className:`h-screen w-full flex flex-col items-center justify-center bg-black text-white gap-4`,children:[t,a,s]}),e[15]=a,e[16]=s,e[17]=c):c=e[17],c}let h;e[18]===i?h=e[19]:(h=()=>i(`/`),e[18]=i,e[19]=h);let _;e[20]===Symbol.for(`react.memo_cache_sentinel`)?(_=(0,C.jsx)(a,{size:28}),e[20]=_):_=e[20];let v;e[21]===h?v=e[22]:(v=(0,C.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:h,children:_}),e[21]=h,e[22]=v);let y;if(e[23]!==le||e[24]!==p||e[25]!==t){let n;e[27]!==p||e[28]!==t?(n=e=>(0,C.jsx)(he,{reel:e,showToast:t,onUserClick:p},e.id),e[27]=p,e[28]=t,e[29]=n):n=e[29],y=le.map(n),e[23]=le,e[24]=p,e[25]=t,e[26]=y}else y=e[26];let b;e[30]!==te||e[31]!==ne||e[32]!==o||e[33]!==re?(b=ne&&!o&&(0,C.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center snap-start bg-black`,children:(0,C.jsx)(`button`,{onClick:()=>te(),disabled:re,className:`bg-white/10 hover:bg-white/20 text-white px-6 py-2 rounded-full border border-white/20 transition-colors`,children:re?`Loading...`:`See more videos`})}),e[30]=te,e[31]=ne,e[32]=o,e[33]=re,e[34]=b):b=e[34];let x;e[35]!==y||e[36]!==b?(x=(0,C.jsxs)(`div`,{className:`w-full md:w-[400px] h-full`,children:[y,b]}),e[35]=y,e[36]=b,e[37]=x):x=e[37];let de;return e[38]!==v||e[39]!==x?(de=(0,C.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[v,x]}),e[38]=v,e[39]=x,e[40]=de):de=e[40],de};export{ye as default};