import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{Dt as t,Ft as n,G as r,It as i,Mt as a,Nt as o,Ot as s,St as c,et as ee,ft as te,kt as l,qt as u,ut as ne}from"./vendor-B5OVd975.js";import{I as d,en as f,tn as p}from"./libs-Bghk4o3g.js";import{_ as re,a as ie,f as m,i as ae,m as h,n as g,r as oe,v as se,y as ce}from"./index-DLt9WKqV.js";import{n as le,t as ue}from"./ShareModal-BPQNb7F1.js";var _=l(),v=e(p(),1);const y=e=>[`post`,e],b=(e,t)=>{let n=(0,_.c)(9),r=e||``,i;n[0]===r?i=n[1]:(i=y(r),n[0]=r,n[1]=i);let a=!!e,s;n[2]!==t||n[3]!==e?(s=async()=>{if(!e)throw Error(`Post ID required`);let{data:n,error:r}=await h.from(`posts`).select(`
          id,
          created_at,
          caption,
          image_url,
          user_id,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await h.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`post_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await h.from(`saves`).select(`*`,{count:`exact`,head:!0}).eq(`post_id`,e).eq(`user_id`,t);o=!!r&&r>0}return{id:i.id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1},content:{type:`image`,src:i.image_url},likes:i.likes[0]?.count||0,caption:i.caption||``,comments:i.comments[0]?.count||0,time:(0,v.default)(i.created_at).fromNow(),hasLiked:a,hasSaved:o}},n[2]=t,n[3]=e,n[4]=s):s=n[4];let c;return n[5]!==i||n[6]!==a||n[7]!==s?(c={queryKey:i,enabled:a,queryFn:s},n[5]=i,n[6]=a,n[7]=s,n[8]=c):c=n[8],o(c)};var x=l();const de=()=>{let e=(0,x.c)(2),t=n(),r;return e[0]===t?r=e[1]:(r={mutationFn:S,onSuccess:(e,n)=>{t.invalidateQueries({queryKey:m}),t.invalidateQueries({queryKey:y(n.postId)}),t.invalidateQueries({queryKey:[`profile`]})}},e[0]=t,e[1]=r),a(r)};async function S(e){let{postId:t,caption:n,location:r}=e,{data:i,error:a}=await h.from(`posts`).update({caption:n,location:r}).eq(`id`,t).select().single();if(a)throw a;return i}var fe=l(),C=e(u(),1),w=i(),pe=e=>{let n=(0,fe.c)(51),{post:r,onClose:i,theme:a,glassModal:o}=e,{showToast:s}=ce(),[c,ee]=(0,C.useState)(r.caption||``),{mutate:te,isPending:l}=de(),u;n[0]!==c||n[1]!==i||n[2]!==r.id||n[3]!==s||n[4]!==te?(u=()=>{if(!c.trim()){s(`ক্যাপশন খালি রাখা যাবে না`);return}te({postId:r.id,caption:c},{onSuccess:()=>{s(`পোস্ট আপডেট করা হয়েছে`),i()},onError:()=>s(`আপডেট করতে সমস্যা হয়েছে`)})},n[0]=c,n[1]=i,n[2]=r.id,n[3]=s,n[4]=te,n[5]=u):u=n[5];let ne=u,d,f,p;n[6]===Symbol.for(`react.memo_cache_sentinel`)?(d={opacity:0},f={opacity:1},p={opacity:0},n[6]=d,n[7]=f,n[8]=p):(d=n[6],f=n[7],p=n[8]);let ie,m,ae;n[9]===Symbol.for(`react.memo_cache_sentinel`)?(ie={scale:.95,opacity:0},m={scale:1,opacity:1},ae={scale:.95,opacity:0},n[9]=ie,n[10]=m,n[11]=ae):(ie=n[9],m=n[10],ae=n[11]);let h=`w-full max-w-2xl rounded-xl overflow-hidden shadow-2xl flex flex-col md:flex-row ${o} ${a===`dark`?`text-white`:`text-black`}`,g;n[12]!==r.content.poster||n[13]!==r.content.src||n[14]!==r.content.type?(g=(0,w.jsx)(`div`,{className:`md:w-1/2 bg-black flex items-center justify-center relative aspect-square md:aspect-auto`,children:r.content.type===`video`?(0,w.jsx)(`video`,{src:r.content.src,className:`max-h-full max-w-full`}):(0,w.jsx)(re,{src:r.content.src||r.content.poster,className:`max-h-full max-w-full`,imgClassName:`object-contain`,alt:`preview`})}),n[12]=r.content.poster,n[13]=r.content.src,n[14]=r.content.type,n[15]=g):g=n[15];let oe=`md:w-1/2 flex flex-col ${a===`dark`?`bg-zinc-900`:`bg-white`}`,se=`p-3 border-b flex justify-between items-center ${a===`dark`?`border-zinc-800`:`border-zinc-200`}`,le;n[16]===Symbol.for(`react.memo_cache_sentinel`)?(le=(0,w.jsx)(`span`,{className:`font-semibold text-sm`,children:`এডিট ইনফো`}),n[16]=le):le=n[16];let ue=l?`সেভ হচ্ছে...`:`সম্পন্ন`,_;n[17]!==ne||n[18]!==l||n[19]!==ue?(_=(0,w.jsx)(`button`,{onClick:ne,disabled:l,className:`text-[#0095f6] font-bold text-sm hover:text-white disabled:opacity-50`,children:ue}),n[17]=ne,n[18]=l,n[19]=ue,n[20]=_):_=n[20];let v;n[21]!==se||n[22]!==_?(v=(0,w.jsxs)(`div`,{className:se,children:[le,_]}),n[21]=se,n[22]=_,n[23]=v):v=n[23];let y;n[24]!==r.user.avatar||n[25]!==r.user.username?(y=(0,w.jsx)(`div`,{className:`w-8 h-8 rounded-full overflow-hidden`,children:(0,w.jsx)(re,{src:r.user.avatar,className:`w-full h-full`,alt:r.user.username})}),n[24]=r.user.avatar,n[25]=r.user.username,n[26]=y):y=n[26];let b;n[27]===r.user.username?b=n[28]:(b=(0,w.jsx)(`span`,{className:`font-semibold text-sm`,children:r.user.username}),n[27]=r.user.username,n[28]=b);let x;n[29]!==y||n[30]!==b?(x=(0,w.jsxs)(`div`,{className:`p-4 flex items-center gap-3`,children:[y,b]}),n[29]=y,n[30]=b,n[31]=x):x=n[31];let S=`flex-grow p-4 bg-transparent outline-none resize-none text-sm ${a===`dark`?`placeholder-zinc-500`:`placeholder-zinc-400`}`,pe;n[32]===Symbol.for(`react.memo_cache_sentinel`)?(pe=e=>ee(e.target.value),n[32]=pe):pe=n[32];let T;n[33]!==c||n[34]!==S?(T=(0,w.jsx)(`textarea`,{className:S,placeholder:`ক্যাপশন লিখুন...`,value:c,onChange:pe,rows:6}),n[33]=c,n[34]=S,n[35]=T):T=n[35];let E;n[36]===i?E=n[37]:(E=(0,w.jsx)(`div`,{className:`p-4 flex justify-end`,children:(0,w.jsx)(`button`,{onClick:i,className:`text-sm font-semibold hover:opacity-70`,children:`বাতিল করুন`})}),n[36]=i,n[37]=E);let D;n[38]!==oe||n[39]!==v||n[40]!==x||n[41]!==T||n[42]!==E?(D=(0,w.jsxs)(`div`,{className:oe,children:[v,x,T,E]}),n[38]=oe,n[39]=v,n[40]=x,n[41]=T,n[42]=E,n[43]=D):D=n[43];let O;n[44]!==D||n[45]!==h||n[46]!==g?(O=(0,w.jsxs)(t.div,{initial:ie,animate:m,exit:ae,className:h,onClick:me,children:[g,D]}),n[44]=D,n[45]=h,n[46]=g,n[47]=O):O=n[47];let k;return n[48]!==i||n[49]!==O?(k=(0,w.jsx)(t.div,{initial:d,animate:f,exit:p,className:`fixed inset-0 z-[110] bg-black/60 flex items-center justify-center p-4`,onClick:i,children:O}),n[48]=i,n[49]=O,n[50]=k):k=n[50],k};function me(e){return e.stopPropagation()}var T=l(),E=e(p(),1),D=e(f(),1);d(),E.default.extend(D.default),E.default.locale(`bn`);var O=(0,C.memo)(e=>{let n=(0,T.c)(153),{post:i,isSaved:a,onToggleSave:o,onUserClick:l,onPostClick:u}=e,{theme:d,showToast:f}=ce(),{user:p}=se(),{mutate:m}=ae(),{mutate:h,isPending:_}=oe(),[v,y]=(0,C.useState)(!1),[b,x]=(0,C.useState)(``),[de,S]=(0,C.useState)(!1),[fe,me]=(0,C.useState)(!1),[D,O]=(0,C.useState)(!1),k=i.hasLiked||!1,A=`${window.location.origin}/post/${i.id}`,he=p?.id===i.user.id,ge;n[0]!==k||n[1]!==i.id||n[2]!==f||n[3]!==m||n[4]!==p?(ge=()=>{if(!p){f(`লাইক করতে লগ ইন করুন`);return}m({targetId:String(i.id),type:`post`,userId:p.id,hasLiked:k})},n[0]=k,n[1]=i.id,n[2]=f,n[3]=m,n[4]=p,n[5]=ge):ge=n[5];let j=ge,_e;n[6]===j?_e=n[7]:(_e=()=>{j(),y(!0),setTimeout(()=>y(!1),1e3)},n[6]=j,n[7]=_e);let ve=_e,ye;n[8]!==h||n[9]!==b||n[10]!==i.id||n[11]!==f||n[12]!==p?(ye=e=>{e.preventDefault(),!(!b.trim()||!p)&&h({targetId:String(i.id),type:`post`,text:b,userId:p.id},{onSuccess:()=>{f(`কমেন্ট যোগ করা হয়েছে`),x(``)},onError:()=>f(`কমেন্ট যোগ করতে সমস্যা হয়েছে`)})},n[8]=h,n[9]=b,n[10]=i.id,n[11]=f,n[12]=p,n[13]=ye):ye=n[13];let be=ye,xe=d===`dark`?`border-zinc-800`:`border-zinc-200`,M=d===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,Se,Ce,we,Te;n[14]===Symbol.for(`react.memo_cache_sentinel`)?(Se={opacity:0,y:20},Ce={opacity:1,y:0},we={once:!0,margin:`-50px`},Te={duration:.4},n[14]=Se,n[15]=Ce,n[16]=we,n[17]=Te):(Se=n[14],Ce=n[15],we=n[16],Te=n[17]);let Ee=`border-b pb-5 mb-4 ${xe}`,N;n[18]!==M||n[19]!==de||n[20]!==he||n[21]!==A||n[22]!==f||n[23]!==d?(N=de&&(0,w.jsx)(le,{onClose:()=>S(!1),showToast:f,theme:d,glassModal:M,shareUrl:A,isOwner:he,onEdit:()=>O(!0)}),n[18]=M,n[19]=de,n[20]=he,n[21]=A,n[22]=f,n[23]=d,n[24]=N):N=n[24];let P;n[25]!==M||n[26]!==fe||n[27]!==A||n[28]!==f||n[29]!==d?(P=fe&&(0,w.jsx)(ue,{onClose:()=>me(!1),theme:d,showToast:f,glassModal:M,shareUrl:A}),n[25]=M,n[26]=fe,n[27]=A,n[28]=f,n[29]=d,n[30]=P):P=n[30];let F;n[31]!==M||n[32]!==D||n[33]!==i||n[34]!==d?(F=D&&(0,w.jsx)(pe,{post:i,onClose:()=>O(!1),theme:d,glassModal:M}),n[31]=M,n[32]=D,n[33]=i,n[34]=d,n[35]=F):F=n[35];let I;n[36]!==l||n[37]!==i.user?(I=()=>l(i.user),n[36]=l,n[37]=i.user,n[38]=I):I=n[38];let De=`w-8 h-8 rounded-full overflow-hidden ${d===`dark`?`bg-zinc-800`:`bg-gray-200`} group-hover:scale-105 transition-transform`,L;n[39]!==i.user.avatar||n[40]!==i.user.username?(L=(0,w.jsx)(re,{src:i.user.avatar,width:100,className:`w-full h-full`,alt:i.user.username}),n[39]=i.user.avatar,n[40]=i.user.username,n[41]=L):L=n[41];let R;n[42]!==De||n[43]!==L?(R=(0,w.jsx)(`div`,{className:De,children:L}),n[42]=De,n[43]=L,n[44]=R):R=n[44];let z;n[45]===i.user.username?z=n[46]:(z=(0,w.jsx)(`span`,{className:`group-hover:opacity-70 transition-opacity`,children:i.user.username}),n[45]=i.user.username,n[46]=z);let B;n[47]===i.user.isVerified?B=n[48]:(B=i.user.isVerified&&(0,w.jsx)(ie,{}),n[47]=i.user.isVerified,n[48]=B);let Oe=`${d===`dark`?`text-zinc-500`:`text-zinc-400`} font-normal`,V;n[49]!==i.createdAt||n[50]!==i.time?(V=i.createdAt?(0,E.default)(i.createdAt).fromNow(!0):i.time,n[49]=i.createdAt,n[50]=i.time,n[51]=V):V=n[51];let H;n[52]!==Oe||n[53]!==V?(H=(0,w.jsxs)(`span`,{className:Oe,children:[`• `,V]}),n[52]=Oe,n[53]=V,n[54]=H):H=n[54];let U;n[55]!==z||n[56]!==B||n[57]!==H?(U=(0,w.jsxs)(`div`,{className:`flex items-center gap-1 text-sm font-semibold`,children:[z,B,H]}),n[55]=z,n[56]=B,n[57]=H,n[58]=U):U=n[58];let W;n[59]!==I||n[60]!==R||n[61]!==U?(W=(0,w.jsxs)(`div`,{className:`flex items-center gap-2 cursor-pointer group`,onClick:I,children:[R,U]}),n[59]=I,n[60]=R,n[61]=U,n[62]=W):W=n[62];let ke,Ae;n[63]===Symbol.for(`react.memo_cache_sentinel`)?(ke={scale:1.1},Ae={scale:.9},n[63]=ke,n[64]=Ae):(ke=n[63],Ae=n[64]);let je;n[65]===Symbol.for(`react.memo_cache_sentinel`)?(je=(0,w.jsx)(t.div,{whileHover:ke,whileTap:Ae,children:(0,w.jsx)(te,{size:20,className:`cursor-pointer hover:opacity-70`,onClick:()=>S(!0)})}),n[65]=je):je=n[65];let Me;n[66]===W?Me=n[67]:(Me=(0,w.jsxs)(`div`,{className:`flex items-center justify-between mb-3 px-3 md:px-0`,children:[W,je]}),n[66]=W,n[67]=Me);let Ne=`w-full ${d===`dark`?`bg-zinc-900`:`bg-gray-100`} md:rounded-[4px] md:border ${xe} overflow-hidden mb-3 aspect-square md:aspect-auto relative cursor-pointer`,Pe=i.content.src||i.content.poster,G;n[68]===Pe?G=n[69]:(G=(0,w.jsx)(re,{src:Pe,width:800,className:`w-full h-full`,alt:`Post content`}),n[68]=Pe,n[69]=G);let K;n[70]===v?K=n[71]:(K=v&&(0,w.jsx)(t.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,w.jsx)(ne,{size:100,className:`text-white fill-white drop-shadow-lg`})}),n[70]=v,n[71]=K);let q;n[72]===K?q=n[73]:(q=(0,w.jsx)(s,{children:K}),n[72]=K,n[73]=q);let J;n[74]!==ve||n[75]!==Ne||n[76]!==G||n[77]!==q?(J=(0,w.jsxs)(`div`,{className:Ne,onDoubleClick:ve,children:[G,q]}),n[74]=ve,n[75]=Ne,n[76]=G,n[77]=q,n[78]=J):J=n[78];let Fe,Ie;n[79]===Symbol.for(`react.memo_cache_sentinel`)?(Fe={scale:1.1},Ie={scale:.9},n[79]=Fe,n[80]=Ie):(Fe=n[79],Ie=n[80]);let Le=`cursor-pointer transition-colors ${k?`fill-[#f42a41] text-[#f42a41]`:``}`,Y;n[81]!==j||n[82]!==Le?(Y=(0,w.jsx)(t.div,{whileHover:Fe,whileTap:Ie,children:(0,w.jsx)(ne,{size:24,className:Le,onClick:j})}),n[81]=j,n[82]=Le,n[83]=Y):Y=n[83];let Re,ze;n[84]===Symbol.for(`react.memo_cache_sentinel`)?(Re={scale:1.1},ze={scale:.9},n[84]=Re,n[85]=ze):(Re=n[84],ze=n[85]);let X;n[86]!==u||n[87]!==i?(X=(0,w.jsx)(t.div,{whileHover:Re,whileTap:ze,children:(0,w.jsx)(ee,{size:24,className:`-scale-x-100 cursor-pointer hover:opacity-70 transition-opacity`,onClick:()=>u(i)})}),n[86]=u,n[87]=i,n[88]=X):X=n[88];let Be,Ve;n[89]===Symbol.for(`react.memo_cache_sentinel`)?(Be={scale:1.1},Ve={scale:.9},n[89]=Be,n[90]=Ve):(Be=n[89],Ve=n[90]);let He;n[91]===Symbol.for(`react.memo_cache_sentinel`)?(He=(0,w.jsx)(t.div,{whileHover:Be,whileTap:Ve,children:(0,w.jsx)(r,{size:24,className:`cursor-pointer hover:opacity-70 transition-opacity`,onClick:()=>me(!0)})}),n[91]=He):He=n[91];let Z;n[92]!==Y||n[93]!==X?(Z=(0,w.jsxs)(`div`,{className:`flex items-center gap-4`,children:[Y,X,He]}),n[92]=Y,n[93]=X,n[94]=Z):Z=n[94];let Ue,We;n[95]===Symbol.for(`react.memo_cache_sentinel`)?(Ue={scale:1.1},We={scale:.9},n[95]=Ue,n[96]=We):(Ue=n[95],We=n[96]);let Ge=`cursor-pointer hover:opacity-70 transition-all ${a?`fill-current`:``}`,Ke;n[97]!==o||n[98]!==Ge?(Ke=(0,w.jsx)(t.div,{whileHover:Ue,whileTap:We,children:(0,w.jsx)(c,{size:24,className:Ge,onClick:o})}),n[97]=o,n[98]=Ge,n[99]=Ke):Ke=n[99];let qe;n[100]!==Z||n[101]!==Ke?(qe=(0,w.jsxs)(`div`,{className:`flex items-center justify-between mb-2 px-3 md:px-0`,children:[Z,Ke]}),n[100]=Z,n[101]=Ke,n[102]=qe):qe=n[102];let Je;n[103]===i.likes?Je=n[104]:(Je=(0,w.jsxs)(`div`,{className:`font-semibold mb-1`,children:[i.likes,` লাইক`]}),n[103]=i.likes,n[104]=Je);let Ye;n[105]!==l||n[106]!==i.user?(Ye=()=>l(i.user),n[105]=l,n[106]=i.user,n[107]=Ye):Ye=n[107];let Q;n[108]!==i.user.username||n[109]!==Ye?(Q=(0,w.jsx)(`span`,{className:`font-semibold mr-2 cursor-pointer hover:opacity-70`,onClick:Ye,children:i.user.username}),n[108]=i.user.username,n[109]=Ye,n[110]=Q):Q=n[110];let Xe;n[111]===i.caption?Xe=n[112]:(Xe=(0,w.jsx)(g,{text:i.caption,truncateLength:150}),n[111]=i.caption,n[112]=Xe);let Ze;n[113]!==Q||n[114]!==Xe?(Ze=(0,w.jsxs)(`div`,{className:`mb-1`,children:[Q,Xe]}),n[113]=Q,n[114]=Xe,n[115]=Ze):Ze=n[115];let Qe;n[116]!==u||n[117]!==i?(Qe=()=>u(i),n[116]=u,n[117]=i,n[118]=Qe):Qe=n[118];let $e;n[119]!==i.comments||n[120]!==Qe?($e=(0,w.jsxs)(`div`,{className:`text-zinc-500 cursor-pointer hover:underline`,onClick:Qe,children:[`সব `,i.comments,` কমেন্ট দেখুন`]}),n[119]=i.comments,n[120]=Qe,n[121]=$e):$e=n[121];let et;n[122]!==i.createdAt||n[123]!==i.time?(et=i.createdAt?(0,E.default)(i.createdAt).fromNow():i.time,n[122]=i.createdAt,n[123]=i.time,n[124]=et):et=n[124];let tt;n[125]===et?tt=n[126]:(tt=(0,w.jsx)(`div`,{className:`text-[10px] text-zinc-500 uppercase mt-1`,children:et}),n[125]=et,n[126]=tt);let nt=`bg-transparent text-sm w-full outline-none ${d===`dark`?`text-white`:`text-black`}`,rt;n[127]===Symbol.for(`react.memo_cache_sentinel`)?(rt=e=>x(e.target.value),n[127]=rt):rt=n[127];let it;n[128]!==_||n[129]!==b||n[130]!==nt?(it=(0,w.jsx)(`input`,{type:`text`,placeholder:`কমেন্ট যোগ করুন...`,className:nt,value:b,onChange:rt,disabled:_}),n[128]=_,n[129]=b,n[130]=nt,n[131]=it):it=n[131];let at=!b||_,ot;n[132]===at?ot=n[133]:(ot=(0,w.jsx)(`button`,{type:`submit`,className:`text-[#006a4e] text-sm font-semibold disabled:opacity-50 hover:text-[#004d39]`,disabled:at,children:`পোস্ট`}),n[132]=at,n[133]=ot);let st;n[134]!==be||n[135]!==it||n[136]!==ot?(st=(0,w.jsxs)(`form`,{onSubmit:be,className:`flex gap-2 mt-2`,children:[it,ot]}),n[134]=be,n[135]=it,n[136]=ot,n[137]=st):st=n[137];let $;n[138]!==Je||n[139]!==Ze||n[140]!==$e||n[141]!==tt||n[142]!==st?($=(0,w.jsxs)(`div`,{className:`text-sm px-3 md:px-0`,children:[Je,Ze,$e,tt,st]}),n[138]=Je,n[139]=Ze,n[140]=$e,n[141]=tt,n[142]=st,n[143]=$):$=n[143];let ct;return n[144]!==P||n[145]!==F||n[146]!==Me||n[147]!==J||n[148]!==qe||n[149]!==$||n[150]!==Ee||n[151]!==N?(ct=(0,w.jsxs)(t.div,{initial:Se,whileInView:Ce,viewport:we,transition:Te,className:Ee,children:[N,P,F,Me,J,qe,$]}),n[144]=P,n[145]=F,n[146]=Me,n[147]=J,n[148]=qe,n[149]=$,n[150]=Ee,n[151]=N,n[152]=ct):ct=n[152],ct});export{b as n,O as t};