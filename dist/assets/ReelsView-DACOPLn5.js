import{a as e}from"./rolldown-runtime-DDUpfMIz.js";import{$t as t,Et as n,Ft as r,Jt as i,L as a,Ot as o,R as s,Yt as c,at as ee,dn as l,dt as te,ht as ne,nn as u,p as d,pn as f,qt as p,tt as re,un as m}from"./vendor-Cr02haVJ.js";import"./libs-CiQH4q1H.js";import"./supabase-CCh8m61e.js";import{S as ie,T as ae,b as h,c as oe,p as se,s as ce,u as le,v as g,w as ue,x as de}from"./index-BxH8m7es.js";import{n as _,t as v}from"./ShareModal-CUFzieEs.js";import"./useGetSuggestedUsers-BSgGmmKw.js";import{t as y}from"./useFollowUser-RHdLoW7-.js";var b=c(),x=e(f(),1),S=e(u(),1),fe=d,pe=(0,x.memo)(e=>{let t=(0,b.c)(143),{reel:r,showToast:c,theme:l,onUserClick:u,glassModal:d}=e,{setViewingReel:f}=ae(),{user:m}=ue(),{mutate:se}=ce(),{mutate:g}=y(),[pe,me]=(0,x.useState)(!1),[C,he]=(0,x.useState)(!0),[w,ge]=(0,x.useState)(!0),[_e,ve]=(0,x.useState)(!1),[ye,be]=(0,x.useState)(!1),xe=(0,x.useRef)(null),Se=(0,x.useRef)(null),T=`${window.location.origin}/reels/${r.id}`,Ce=r.hasLiked||!1,we;t[0]!==Ce||t[1]!==r.id||t[2]!==c||t[3]!==se||t[4]!==m?(we=()=>{if(!m){c(`লাইক করতে লগ ইন করুন`);return}se({targetId:r.id,type:`reel`,userId:m.id,hasLiked:Ce})},t[0]=Ce,t[1]=r.id,t[2]=c,t[3]=se,t[4]=m,t[5]=we):we=t[5];let E=we,Te;t[6]!==g||t[7]!==r.user.isFollowing||t[8]!==r.user.username||t[9]!==r.userId||t[10]!==c||t[11]!==m?(Te=()=>{if(!m){c(`ফলো করতে লগ ইন করুন`);return}r.userId&&g({targetUserId:r.userId,currentUserId:m.id,isFollowing:r.user.isFollowing||!1,targetUsername:r.user.username},{onSuccess:()=>c(`ফলো করা হয়েছে`),onError:()=>c(`ফলো করতে সমস্যা হয়েছে`)})},t[6]=g,t[7]=r.user.isFollowing,t[8]=r.user.username,t[9]=r.userId,t[10]=c,t[11]=m,t[12]=Te):Te=t[12];let Ee=Te,De;t[13]===w?De=t[14]:(De=()=>{Se.current&&ge(!w)},t[13]=w,t[14]=De);let Oe=De,ke,Ae;t[15]===Symbol.for(`react.memo_cache_sentinel`)?(ke=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(ge(!0),he(!1)):(ge(!1),he(!0))},{threshold:.6});return xe.current&&e.observe(xe.current),()=>e.disconnect()},Ae=[],t[15]=ke,t[16]=Ae):(ke=t[15],Ae=t[16]),(0,x.useEffect)(ke,Ae);let je;t[17]===E?je=t[18]:(je=()=>{E(),me(!0),setTimeout(()=>me(!1),1e3)},t[17]=E,t[18]=je);let Me=je,Ne,Pe,Fe,Ie;t[19]===Symbol.for(`react.memo_cache_sentinel`)?(Pe={opacity:0,scale:.95},Fe={opacity:1,scale:1},Ie={once:!0},Ne={duration:.5},t[19]=Ne,t[20]=Pe,t[21]=Fe,t[22]=Ie):(Ne=t[19],Pe=t[20],Fe=t[21],Ie=t[22]);let D;t[23]!==d||t[24]!==_e||t[25]!==T||t[26]!==c||t[27]!==l?(D=_e&&(0,S.jsx)(_,{onClose:()=>ve(!1),showToast:c,theme:l,glassModal:d,shareUrl:T}),t[23]=d,t[24]=_e,t[25]=T,t[26]=c,t[27]=l,t[28]=D):D=t[28];let O;t[29]!==d||t[30]!==ye||t[31]!==T||t[32]!==c||t[33]!==l?(O=ye&&(0,S.jsx)(v,{onClose:()=>be(!1),theme:l,showToast:c,glassModal:d,shareUrl:T}),t[29]=d,t[30]=ye,t[31]=T,t[32]=c,t[33]=l,t[34]=O):O=t[34];let k;t[35]!==C||t[36]!==w||t[37]!==r.src||t[38]!==Oe?(k=r.src?(0,S.jsx)(`div`,{className:`w-full h-full cursor-pointer`,onClick:Oe,children:(0,S.jsx)(fe,{ref:Se,url:r.src,width:`100%`,height:`100%`,playing:w,muted:C,loop:!0,playsinline:!0,style:{objectFit:`cover`},className:`react-player pointer-events-none`})}):(0,S.jsx)(le,{src:r.src,width:400,className:`w-full h-full`,onClick:()=>he(!C),alt:`reel`}),t[35]=C,t[36]=w,t[37]=r.src,t[38]=Oe,t[39]=k):k=t[39];let A;t[40]===w?A=t[41]:(A=!w&&(0,S.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,S.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,S.jsx)(ee,{className:`text-white w-10 h-10 fill-white`})})}),t[40]=w,t[41]=A);let j;t[42]===C?j=t[43]:(j=(0,S.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),he(!C)},children:C?(0,S.jsx)(a,{className:`text-white w-5 h-5`}):(0,S.jsx)(s,{className:`text-white w-5 h-5`})}),t[42]=C,t[43]=j);let M;t[44]===pe?M=t[45]:(M=pe&&(0,S.jsx)(p.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,S.jsx)(n,{size:100,className:`text-white fill-white drop-shadow-lg`})}),t[44]=pe,t[45]=M);let N;t[46]===M?N=t[47]:(N=(0,S.jsx)(i,{children:M}),t[46]=M,t[47]=N);let P;t[48]!==u||t[49]!==r.user?(P=()=>u(r.user),t[48]=u,t[49]=r.user,t[50]=P):P=t[50];let F;t[51]===r.user.avatar?F=t[52]:(F=(0,S.jsx)(ie,{src:r.user.avatar}),t[51]=r.user.avatar,t[52]=F);let I;t[53]===r.user.username[0]?I=t[54]:(I=r.user.username[0].toUpperCase(),t[53]=r.user.username[0],t[54]=I);let L;t[55]===I?L=t[56]:(L=(0,S.jsx)(de,{children:I}),t[55]=I,t[56]=L);let R;t[57]!==F||t[58]!==L?(R=(0,S.jsxs)(h,{className:`w-8 h-8 border border-white/50 cursor-pointer`,children:[F,L]}),t[57]=F,t[58]=L,t[59]=R):R=t[59];let z;t[60]===r.user.username?z=t[61]:(z=(0,S.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:r.user.username}),t[60]=r.user.username,t[61]=z);let B;t[62]===r.user.isVerified?B=t[63]:(B=r.user.isVerified&&(0,S.jsx)(oe,{}),t[62]=r.user.isVerified,t[63]=B);let Le,Re;t[64]===Symbol.for(`react.memo_cache_sentinel`)?(Le={scale:1.05},Re={scale:.95},t[64]=Le,t[65]=Re):(Le=t[64],Re=t[65]);let ze=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${r.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,Be;t[66]===Ee?Be=t[67]:(Be=e=>{e.stopPropagation(),Ee()},t[66]=Ee,t[67]=Be);let Ve=r.user.isFollowing?`ফলো করছেন`:`ফলো`,V;t[68]!==ze||t[69]!==Be||t[70]!==Ve?(V=(0,S.jsx)(p.button,{whileHover:Le,whileTap:Re,className:ze,onClick:Be,children:Ve}),t[68]=ze,t[69]=Be,t[70]=Ve,t[71]=V):V=t[71];let H;t[72]!==P||t[73]!==R||t[74]!==z||t[75]!==B||t[76]!==V?(H=(0,S.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:P,children:[R,z,B,V]}),t[72]=P,t[73]=R,t[74]=z,t[75]=B,t[76]=V,t[77]=H):H=t[77];let He;t[78]===Symbol.for(`react.memo_cache_sentinel`)?(He=(0,S.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`আরও`}),t[78]=He):He=t[78];let U;t[79]===r.caption?U=t[80]:(U=(0,S.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[r.caption,` `,He]}),t[79]=r.caption,t[80]=U);let Ue;t[81]===Symbol.for(`react.memo_cache_sentinel`)?(Ue=(0,S.jsx)(te,{size:12}),t[81]=Ue):Ue=t[81];let W;t[82]===r.audio?W=t[83]:(W=(0,S.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[Ue,(0,S.jsx)(`div`,{className:`truncate w-40`,children:r.audio})]}),t[82]=r.audio,t[83]=W);let G;t[84]!==H||t[85]!==U||t[86]!==W?(G=(0,S.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[H,U,W]}),t[84]=H,t[85]=U,t[86]=W,t[87]=G):G=t[87];let We,Ge;t[88]===Symbol.for(`react.memo_cache_sentinel`)?(We={scale:1.1},Ge={scale:.9},t[88]=We,t[89]=Ge):(We=t[88],Ge=t[89]);let Ke=`cursor-pointer transition-colors ${Ce?`fill-[#f42a41] text-[#f42a41]`:``}`,K;t[90]!==E||t[91]!==Ke?(K=(0,S.jsx)(p.div,{whileHover:We,whileTap:Ge,children:(0,S.jsx)(n,{size:28,strokeWidth:1.5,className:Ke,onClick:E})}),t[90]=E,t[91]=Ke,t[92]=K):K=t[92];let q;t[93]===r.likes?q=t[94]:(q=(0,S.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:r.likes}),t[93]=r.likes,t[94]=q);let J;t[95]!==K||t[96]!==q?(J=(0,S.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[K,q]}),t[95]=K,t[96]=q,t[97]=J):J=t[97];let qe,Je;t[98]===Symbol.for(`react.memo_cache_sentinel`)?(qe={scale:1.1},Je={scale:.9},t[98]=qe,t[99]=Je):(qe=t[98],Je=t[99]);let Y;t[100]!==r||t[101]!==f?(Y=(0,S.jsx)(p.div,{whileHover:qe,whileTap:Je,children:(0,S.jsx)(ne,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>f(r)})}),t[100]=r,t[101]=f,t[102]=Y):Y=t[102];let X;t[103]===r.comments?X=t[104]:(X=(0,S.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:r.comments}),t[103]=r.comments,t[104]=X);let Z;t[105]!==Y||t[106]!==X?(Z=(0,S.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[Y,X]}),t[105]=Y,t[106]=X,t[107]=Z):Z=t[107];let Ye,Xe;t[108]===Symbol.for(`react.memo_cache_sentinel`)?(Ye={scale:1.1},Xe={scale:.9},t[108]=Ye,t[109]=Xe):(Ye=t[108],Xe=t[109]);let Ze;t[110]===Symbol.for(`react.memo_cache_sentinel`)?(Ze=(0,S.jsx)(p.div,{whileHover:Ye,whileTap:Xe,children:(0,S.jsx)(re,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>be(!0)})}),t[110]=Ze):Ze=t[110];let Qe,$e;t[111]===Symbol.for(`react.memo_cache_sentinel`)?(Qe={scale:1.1},$e={scale:.9},t[111]=Qe,t[112]=$e):(Qe=t[111],$e=t[112]);let et;t[113]===Symbol.for(`react.memo_cache_sentinel`)?(et=(0,S.jsx)(p.div,{whileHover:Qe,whileTap:$e,children:(0,S.jsx)(o,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ve(!0)})}),t[113]=et):et=t[113];let tt;t[114]!==u||t[115]!==r.user?(tt=()=>u(r.user),t[114]=u,t[115]=r.user,t[116]=tt):tt=t[116];let Q;t[117]===r.user.avatar?Q=t[118]:(Q=(0,S.jsx)(ie,{src:r.user.avatar}),t[117]=r.user.avatar,t[118]=Q);let nt;t[119]===r.user.username[0]?nt=t[120]:(nt=r.user.username[0].toUpperCase(),t[119]=r.user.username[0],t[120]=nt);let rt;t[121]===nt?rt=t[122]:(rt=(0,S.jsx)(de,{children:nt}),t[121]=nt,t[122]=rt);let it;t[123]!==tt||t[124]!==Q||t[125]!==rt?(it=(0,S.jsxs)(h,{className:`w-6 h-6 border-2 border-white cursor-pointer mt-2`,onClick:tt,children:[Q,rt]}),t[123]=tt,t[124]=Q,t[125]=rt,t[126]=it):it=t[126];let at;t[127]!==J||t[128]!==Z||t[129]!==it?(at=(0,S.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[J,Z,Ze,et,it]}),t[127]=J,t[128]=Z,t[129]=it,t[130]=at):at=t[130];let $;t[131]!==Me||t[132]!==k||t[133]!==A||t[134]!==j||t[135]!==N||t[136]!==G||t[137]!==at?($=(0,S.jsxs)(`div`,{ref:xe,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-zinc-900 md:rounded-lg overflow-hidden border-zinc-800 md:border group shadow-2xl`,onDoubleClick:Me,children:[k,A,j,N,G,at]}),t[131]=Me,t[132]=k,t[133]=A,t[134]=j,t[135]=N,t[136]=G,t[137]=at,t[138]=$):$=t[138];let ot;return t[139]!==D||t[140]!==O||t[141]!==$?(ot=(0,S.jsxs)(p.div,{initial:Pe,whileInView:Fe,viewport:Ie,transition:Ne,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[D,O,$]}),t[139]=D,t[140]=O,t[141]=$,t[142]=ot):ot=t[142],ot}),me=c();const C=e=>[`reel`,e],he=(e,n)=>{let r=(0,me.c)(9),i=e||``,a;r[0]===i?a=r[1]:(a=C(i),r[0]=i,r[1]=a);let o=!!e,s;r[2]!==n||r[3]!==e?(s=async()=>{if(!e)throw Error(`Reel ID required`);let{data:t,error:r}=await g.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=t,a=!1,o=!1;if(n){let{count:t}=await g.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,n);a=!!t&&t>0;let{count:r}=await g.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,n).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},r[2]=n,r[3]=e,r[4]=s):s=r[4];let c;return r[5]!==a||r[6]!==o||r[7]!==s?(c={queryKey:a,enabled:o,queryFn:s},r[5]=a,r[6]=o,r[7]=s,r[8]=c):c=r[8],t(c)};var w=c(),ge=()=>{let e=(0,w.c)(39),{theme:t,showToast:n}=ae(),{user:i}=ue(),a=m(),{id:o}=l(),s=t===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,{data:c,isLoading:ee}=he(o,i?.id),{data:te,isLoading:ne,fetchNextPage:u,hasNextPage:d,isFetchingNextPage:f}=se(i?.id),p;bb0:{if(!te){let t;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t=[],e[0]=t):t=e[0],p=t;break bb0}let t;e[1]===te.pages?t=e[2]:(t=te.pages.flat(),e[1]=te.pages,e[2]=t),p=t}let re=p,ie;e[3]===a?ie=e[4]:(ie=e=>{a(`/profile/${e.username}`)},e[3]=a,e[4]=ie);let h=ie,oe=o?ee:ne,ce;e[5]!==re||e[6]!==o||e[7]!==c?(ce=o?c?[c]:[]:re,e[5]=re,e[6]=o,e[7]=c,e[8]=ce):ce=e[8];let le=ce;if(oe){let t;return e[9]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,S.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:`Loading reel...`}),e[9]=t):t=e[9],t}if(le.length===0){let t=o?`Reel not found`:`No reels yet`,n;return e[10]===t?n=e[11]:(n=(0,S.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:t}),e[10]=t,e[11]=n),n}let g;e[12]===a?g=e[13]:(g=()=>a(`/`),e[12]=a,e[13]=g);let de;e[14]===Symbol.for(`react.memo_cache_sentinel`)?(de=(0,S.jsx)(r,{size:28}),e[14]=de):de=e[14];let _;e[15]===g?_=e[16]:(_=(0,S.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:g,children:de}),e[15]=g,e[16]=_);let v;if(e[17]!==le||e[18]!==s||e[19]!==h||e[20]!==n||e[21]!==t){let r;e[23]!==s||e[24]!==h||e[25]!==n||e[26]!==t?(r=e=>(0,S.jsx)(pe,{reel:e,showToast:n,theme:t,onUserClick:h,glassModal:s},e.id),e[23]=s,e[24]=h,e[25]=n,e[26]=t,e[27]=r):r=e[27],v=le.map(r),e[17]=le,e[18]=s,e[19]=h,e[20]=n,e[21]=t,e[22]=v}else v=e[22];let y;e[28]!==u||e[29]!==d||e[30]!==o||e[31]!==f?(y=d&&!o&&(0,S.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center snap-start bg-black`,children:(0,S.jsx)(`button`,{onClick:()=>u(),disabled:f,className:`bg-white/10 hover:bg-white/20 text-white px-6 py-2 rounded-full border border-white/20 transition-colors`,children:f?`লোড হচ্ছে...`:`আরও ভিডিও দেখুন`})}),e[28]=u,e[29]=d,e[30]=o,e[31]=f,e[32]=y):y=e[32];let b;e[33]!==v||e[34]!==y?(b=(0,S.jsxs)(`div`,{className:`w-full md:w-[400px] h-full`,children:[v,y]}),e[33]=v,e[34]=y,e[35]=b):b=e[35];let x;return e[36]!==_||e[37]!==b?(x=(0,S.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[_,b]}),e[36]=_,e[37]=b,e[38]=x):x=e[38],x};export{ge as default};