import{a as e}from"./rolldown-runtime-DDUpfMIz.js";import{Ct as t,Ht as n,Jt as r,L as i,Mt as a,R as o,Tt as s,Ut as c,Wt as l,Zt as u,an as d,cn as f,et as ee,it as te,on as ne,p,pt as re,ut as ie}from"./vendor-D0puF6oi.js";import"./libs-DzpOAMaM.js";import"./supabase-BWb0WEDP.js";import{S as m,T as ae,b as h,c as oe,p as se,s as ce,u as le,v as g,w as ue,x as _}from"./index-K1d5U6WP.js";import{n as v,t as y}from"./ShareModal-DaKy1Tay.js";import"./useGetSuggestedUsers-CLxr2QAW.js";import{t as b}from"./useFollowUser-zsodLSaE.js";var x=l(),S=e(f(),1),C=e(u(),1),de=p,fe=(0,S.memo)(e=>{let r=(0,x.c)(143),{reel:a,showToast:l,theme:u,onUserClick:d,glassModal:f}=e,{setViewingReel:ne}=ae(),{user:p}=ue(),{mutate:se}=ce(),{mutate:g}=b(),[fe,pe]=(0,S.useState)(!1),[w,me]=(0,S.useState)(!0),[T,he]=(0,S.useState)(!0),[ge,_e]=(0,S.useState)(!1),[ve,ye]=(0,S.useState)(!1),be=(0,S.useRef)(null),xe=(0,S.useRef)(null),E=`${window.location.origin}/reels/${a.id}`,Se=a.hasLiked||!1,Ce;r[0]!==Se||r[1]!==a.id||r[2]!==l||r[3]!==se||r[4]!==p?(Ce=()=>{if(!p){l(`লাইক করতে লগ ইন করুন`);return}se({targetId:a.id,type:`reel`,userId:p.id,hasLiked:Se})},r[0]=Se,r[1]=a.id,r[2]=l,r[3]=se,r[4]=p,r[5]=Ce):Ce=r[5];let D=Ce,we;r[6]!==g||r[7]!==a.user.isFollowing||r[8]!==a.user.username||r[9]!==a.userId||r[10]!==l||r[11]!==p?(we=()=>{if(!p){l(`ফলো করতে লগ ইন করুন`);return}a.userId&&g({targetUserId:a.userId,currentUserId:p.id,isFollowing:a.user.isFollowing||!1,targetUsername:a.user.username},{onSuccess:()=>l(`ফলো করা হয়েছে`),onError:()=>l(`ফলো করতে সমস্যা হয়েছে`)})},r[6]=g,r[7]=a.user.isFollowing,r[8]=a.user.username,r[9]=a.userId,r[10]=l,r[11]=p,r[12]=we):we=r[12];let Te=we,Ee;r[13]===T?Ee=r[14]:(Ee=()=>{xe.current&&he(!T)},r[13]=T,r[14]=Ee);let De=Ee,Oe,ke;r[15]===Symbol.for(`react.memo_cache_sentinel`)?(Oe=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(he(!0),me(!1)):(he(!1),me(!0))},{threshold:.6});return be.current&&e.observe(be.current),()=>e.disconnect()},ke=[],r[15]=Oe,r[16]=ke):(Oe=r[15],ke=r[16]),(0,S.useEffect)(Oe,ke);let Ae;r[17]===D?Ae=r[18]:(Ae=()=>{D(),pe(!0),setTimeout(()=>pe(!1),1e3)},r[17]=D,r[18]=Ae);let je=Ae,Me,Ne,Pe,Fe;r[19]===Symbol.for(`react.memo_cache_sentinel`)?(Ne={opacity:0,scale:.95},Pe={opacity:1,scale:1},Fe={once:!0},Me={duration:.5},r[19]=Me,r[20]=Ne,r[21]=Pe,r[22]=Fe):(Me=r[19],Ne=r[20],Pe=r[21],Fe=r[22]);let O;r[23]!==f||r[24]!==ge||r[25]!==E||r[26]!==l||r[27]!==u?(O=ge&&(0,C.jsx)(v,{onClose:()=>_e(!1),showToast:l,theme:u,glassModal:f,shareUrl:E}),r[23]=f,r[24]=ge,r[25]=E,r[26]=l,r[27]=u,r[28]=O):O=r[28];let k;r[29]!==f||r[30]!==ve||r[31]!==E||r[32]!==l||r[33]!==u?(k=ve&&(0,C.jsx)(y,{onClose:()=>ye(!1),theme:u,showToast:l,glassModal:f,shareUrl:E}),r[29]=f,r[30]=ve,r[31]=E,r[32]=l,r[33]=u,r[34]=k):k=r[34];let A;r[35]!==w||r[36]!==T||r[37]!==a.src||r[38]!==De?(A=a.src?(0,C.jsx)(`div`,{className:`w-full h-full cursor-pointer`,onClick:De,children:(0,C.jsx)(de,{ref:xe,url:a.src,width:`100%`,height:`100%`,playing:T,muted:w,loop:!0,playsinline:!0,style:{objectFit:`cover`},className:`react-player pointer-events-none`})}):(0,C.jsx)(le,{src:a.src,width:400,className:`w-full h-full`,onClick:()=>me(!w),alt:`reel`}),r[35]=w,r[36]=T,r[37]=a.src,r[38]=De,r[39]=A):A=r[39];let j;r[40]===T?j=r[41]:(j=!T&&(0,C.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,C.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,C.jsx)(te,{className:`text-white w-10 h-10 fill-white`})})}),r[40]=T,r[41]=j);let M;r[42]===w?M=r[43]:(M=(0,C.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),me(!w)},children:w?(0,C.jsx)(i,{className:`text-white w-5 h-5`}):(0,C.jsx)(o,{className:`text-white w-5 h-5`})}),r[42]=w,r[43]=M);let N;r[44]===fe?N=r[45]:(N=fe&&(0,C.jsx)(n.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,C.jsx)(t,{size:100,className:`text-white fill-white drop-shadow-lg`})}),r[44]=fe,r[45]=N);let P;r[46]===N?P=r[47]:(P=(0,C.jsx)(c,{children:N}),r[46]=N,r[47]=P);let F;r[48]!==d||r[49]!==a.user?(F=()=>d(a.user),r[48]=d,r[49]=a.user,r[50]=F):F=r[50];let I;r[51]===a.user.avatar?I=r[52]:(I=(0,C.jsx)(m,{src:a.user.avatar}),r[51]=a.user.avatar,r[52]=I);let L;r[53]===a.user.username[0]?L=r[54]:(L=a.user.username[0].toUpperCase(),r[53]=a.user.username[0],r[54]=L);let R;r[55]===L?R=r[56]:(R=(0,C.jsx)(_,{children:L}),r[55]=L,r[56]=R);let Ie;r[57]!==I||r[58]!==R?(Ie=(0,C.jsxs)(h,{className:`w-8 h-8 border border-white/50 cursor-pointer`,children:[I,R]}),r[57]=I,r[58]=R,r[59]=Ie):Ie=r[59];let z;r[60]===a.user.username?z=r[61]:(z=(0,C.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:a.user.username}),r[60]=a.user.username,r[61]=z);let B;r[62]===a.user.isVerified?B=r[63]:(B=a.user.isVerified&&(0,C.jsx)(oe,{}),r[62]=a.user.isVerified,r[63]=B);let Le,Re;r[64]===Symbol.for(`react.memo_cache_sentinel`)?(Le={scale:1.05},Re={scale:.95},r[64]=Le,r[65]=Re):(Le=r[64],Re=r[65]);let ze=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${a.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,V;r[66]===Te?V=r[67]:(V=e=>{e.stopPropagation(),Te()},r[66]=Te,r[67]=V);let Be=a.user.isFollowing?`ফলো করছেন`:`ফলো`,H;r[68]!==ze||r[69]!==V||r[70]!==Be?(H=(0,C.jsx)(n.button,{whileHover:Le,whileTap:Re,className:ze,onClick:V,children:Be}),r[68]=ze,r[69]=V,r[70]=Be,r[71]=H):H=r[71];let U;r[72]!==F||r[73]!==Ie||r[74]!==z||r[75]!==B||r[76]!==H?(U=(0,C.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:F,children:[Ie,z,B,H]}),r[72]=F,r[73]=Ie,r[74]=z,r[75]=B,r[76]=H,r[77]=U):U=r[77];let Ve;r[78]===Symbol.for(`react.memo_cache_sentinel`)?(Ve=(0,C.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`আরও`}),r[78]=Ve):Ve=r[78];let W;r[79]===a.caption?W=r[80]:(W=(0,C.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[a.caption,` `,Ve]}),r[79]=a.caption,r[80]=W);let He;r[81]===Symbol.for(`react.memo_cache_sentinel`)?(He=(0,C.jsx)(ie,{size:12}),r[81]=He):He=r[81];let G;r[82]===a.audio?G=r[83]:(G=(0,C.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[He,(0,C.jsx)(`div`,{className:`truncate w-40`,children:a.audio})]}),r[82]=a.audio,r[83]=G);let K;r[84]!==U||r[85]!==W||r[86]!==G?(K=(0,C.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[U,W,G]}),r[84]=U,r[85]=W,r[86]=G,r[87]=K):K=r[87];let Ue,We;r[88]===Symbol.for(`react.memo_cache_sentinel`)?(Ue={scale:1.1},We={scale:.9},r[88]=Ue,r[89]=We):(Ue=r[88],We=r[89]);let Ge=`cursor-pointer transition-colors ${Se?`fill-[#f42a41] text-[#f42a41]`:``}`,q;r[90]!==D||r[91]!==Ge?(q=(0,C.jsx)(n.div,{whileHover:Ue,whileTap:We,children:(0,C.jsx)(t,{size:28,strokeWidth:1.5,className:Ge,onClick:D})}),r[90]=D,r[91]=Ge,r[92]=q):q=r[92];let J;r[93]===a.likes?J=r[94]:(J=(0,C.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:a.likes}),r[93]=a.likes,r[94]=J);let Y;r[95]!==q||r[96]!==J?(Y=(0,C.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[q,J]}),r[95]=q,r[96]=J,r[97]=Y):Y=r[97];let Ke,qe;r[98]===Symbol.for(`react.memo_cache_sentinel`)?(Ke={scale:1.1},qe={scale:.9},r[98]=Ke,r[99]=qe):(Ke=r[98],qe=r[99]);let X;r[100]!==a||r[101]!==ne?(X=(0,C.jsx)(n.div,{whileHover:Ke,whileTap:qe,children:(0,C.jsx)(re,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>ne(a)})}),r[100]=a,r[101]=ne,r[102]=X):X=r[102];let Z;r[103]===a.comments?Z=r[104]:(Z=(0,C.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:a.comments}),r[103]=a.comments,r[104]=Z);let Je;r[105]!==X||r[106]!==Z?(Je=(0,C.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[X,Z]}),r[105]=X,r[106]=Z,r[107]=Je):Je=r[107];let Ye,Xe;r[108]===Symbol.for(`react.memo_cache_sentinel`)?(Ye={scale:1.1},Xe={scale:.9},r[108]=Ye,r[109]=Xe):(Ye=r[108],Xe=r[109]);let Ze;r[110]===Symbol.for(`react.memo_cache_sentinel`)?(Ze=(0,C.jsx)(n.div,{whileHover:Ye,whileTap:Xe,children:(0,C.jsx)(ee,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ye(!0)})}),r[110]=Ze):Ze=r[110];let Qe,$e;r[111]===Symbol.for(`react.memo_cache_sentinel`)?(Qe={scale:1.1},$e={scale:.9},r[111]=Qe,r[112]=$e):(Qe=r[111],$e=r[112]);let et;r[113]===Symbol.for(`react.memo_cache_sentinel`)?(et=(0,C.jsx)(n.div,{whileHover:Qe,whileTap:$e,children:(0,C.jsx)(s,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>_e(!0)})}),r[113]=et):et=r[113];let tt;r[114]!==d||r[115]!==a.user?(tt=()=>d(a.user),r[114]=d,r[115]=a.user,r[116]=tt):tt=r[116];let nt;r[117]===a.user.avatar?nt=r[118]:(nt=(0,C.jsx)(m,{src:a.user.avatar}),r[117]=a.user.avatar,r[118]=nt);let rt;r[119]===a.user.username[0]?rt=r[120]:(rt=a.user.username[0].toUpperCase(),r[119]=a.user.username[0],r[120]=rt);let it;r[121]===rt?it=r[122]:(it=(0,C.jsx)(_,{children:rt}),r[121]=rt,r[122]=it);let at;r[123]!==tt||r[124]!==nt||r[125]!==it?(at=(0,C.jsxs)(h,{className:`w-6 h-6 border-2 border-white cursor-pointer mt-2`,onClick:tt,children:[nt,it]}),r[123]=tt,r[124]=nt,r[125]=it,r[126]=at):at=r[126];let Q;r[127]!==Y||r[128]!==Je||r[129]!==at?(Q=(0,C.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[Y,Je,Ze,et,at]}),r[127]=Y,r[128]=Je,r[129]=at,r[130]=Q):Q=r[130];let $;r[131]!==je||r[132]!==A||r[133]!==j||r[134]!==M||r[135]!==P||r[136]!==K||r[137]!==Q?($=(0,C.jsxs)(`div`,{ref:be,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-zinc-900 md:rounded-lg overflow-hidden border-zinc-800 md:border group shadow-2xl`,onDoubleClick:je,children:[A,j,M,P,K,Q]}),r[131]=je,r[132]=A,r[133]=j,r[134]=M,r[135]=P,r[136]=K,r[137]=Q,r[138]=$):$=r[138];let ot;return r[139]!==O||r[140]!==k||r[141]!==$?(ot=(0,C.jsxs)(n.div,{initial:Ne,whileInView:Pe,viewport:Fe,transition:Me,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[O,k,$]}),r[139]=O,r[140]=k,r[141]=$,r[142]=ot):ot=r[142],ot}),pe=l();const w=e=>[`reel`,e],me=(e,t)=>{let n=(0,pe.c)(9),i=e||``,a;n[0]===i?a=n[1]:(a=w(i),n[0]=i,n[1]=a);let o=!!e,s;n[2]!==t||n[3]!==e?(s=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await g.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await g.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await g.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},n[2]=t,n[3]=e,n[4]=s):s=n[4];let c;return n[5]!==a||n[6]!==o||n[7]!==s?(c={queryKey:a,enabled:o,queryFn:s},n[5]=a,n[6]=o,n[7]=s,n[8]=c):c=n[8],r(c)};var T=l(),he=()=>{let e=(0,T.c)(39),{theme:t,showToast:n}=ae(),{user:r}=ue(),i=d(),{id:o}=ne(),s=t===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,{data:c,isLoading:l}=me(o,r?.id),{data:u,isLoading:f,fetchNextPage:ee,hasNextPage:te,isFetchingNextPage:p}=se(r?.id),re;bb0:{if(!u){let t;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t=[],e[0]=t):t=e[0],re=t;break bb0}let t;e[1]===u.pages?t=e[2]:(t=u.pages.flat(),e[1]=u.pages,e[2]=t),re=t}let ie=re,m;e[3]===i?m=e[4]:(m=e=>{i(`/profile/${e.username}`)},e[3]=i,e[4]=m);let h=m,oe=o?l:f,ce;e[5]!==ie||e[6]!==o||e[7]!==c?(ce=o?c?[c]:[]:ie,e[5]=ie,e[6]=o,e[7]=c,e[8]=ce):ce=e[8];let le=ce;if(oe){let t;return e[9]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,C.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:`Loading reel...`}),e[9]=t):t=e[9],t}if(le.length===0){let t=o?`Reel not found`:`No reels yet`,n;return e[10]===t?n=e[11]:(n=(0,C.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:t}),e[10]=t,e[11]=n),n}let g;e[12]===i?g=e[13]:(g=()=>i(`/`),e[12]=i,e[13]=g);let _;e[14]===Symbol.for(`react.memo_cache_sentinel`)?(_=(0,C.jsx)(a,{size:28}),e[14]=_):_=e[14];let v;e[15]===g?v=e[16]:(v=(0,C.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:g,children:_}),e[15]=g,e[16]=v);let y;if(e[17]!==le||e[18]!==s||e[19]!==h||e[20]!==n||e[21]!==t){let r;e[23]!==s||e[24]!==h||e[25]!==n||e[26]!==t?(r=e=>(0,C.jsx)(fe,{reel:e,showToast:n,theme:t,onUserClick:h,glassModal:s},e.id),e[23]=s,e[24]=h,e[25]=n,e[26]=t,e[27]=r):r=e[27],y=le.map(r),e[17]=le,e[18]=s,e[19]=h,e[20]=n,e[21]=t,e[22]=y}else y=e[22];let b;e[28]!==ee||e[29]!==te||e[30]!==o||e[31]!==p?(b=te&&!o&&(0,C.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center snap-start bg-black`,children:(0,C.jsx)(`button`,{onClick:()=>ee(),disabled:p,className:`bg-white/10 hover:bg-white/20 text-white px-6 py-2 rounded-full border border-white/20 transition-colors`,children:p?`লোড হচ্ছে...`:`আরও ভিডিও দেখুন`})}),e[28]=ee,e[29]=te,e[30]=o,e[31]=p,e[32]=b):b=e[32];let x;e[33]!==y||e[34]!==b?(x=(0,C.jsxs)(`div`,{className:`w-full md:w-[400px] h-full`,children:[y,b]}),e[33]=y,e[34]=b,e[35]=x):x=e[35];let S;return e[36]!==v||e[37]!==x?(S=(0,C.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[v,x]}),e[36]=v,e[37]=x,e[38]=S):S=e[38],S};export{he as default};