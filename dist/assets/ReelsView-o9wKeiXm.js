import{a as e}from"./rolldown-runtime-DDUpfMIz.js";import{Dt as t,Gt as n,Kt as r,L as i,Pt as a,Qt as o,R as s,Tt as c,at as ee,cn as l,dn as u,dt as te,en as d,ht as ne,ln as f,p,qt as m,tt as re}from"./vendor-CfeBZ7ji.js";import"./libs-CiQH4q1H.js";import"./supabase-CCh8m61e.js";import{S as h,T as ie,b as g,c as ae,p as oe,s as se,u as ce,v as _,w as le,x as v}from"./index-EQgAvgkJ.js";import{n as y,t as b}from"./ShareModal-CCnTJ3jg.js";import"./useGetSuggestedUsers-BB7RwInn.js";import{t as x}from"./useFollowUser-D0ye-_hh.js";var S=m(),C=e(u(),1),w=e(d(),1),ue=p,de=(0,C.memo)(e=>{let a=(0,S.c)(143),{reel:o,showToast:l,theme:u,onUserClick:d,glassModal:f}=e,{setViewingReel:p}=ie(),{user:m}=le(),{mutate:oe}=se(),{mutate:_}=x(),[de,fe]=(0,C.useState)(!1),[T,pe]=(0,C.useState)(!0),[E,me]=(0,C.useState)(!0),[he,ge]=(0,C.useState)(!1),[_e,ve]=(0,C.useState)(!1),ye=(0,C.useRef)(null),be=(0,C.useRef)(null),D=`${window.location.origin}/reels/${o.id}`,xe=o.hasLiked||!1,Se;a[0]!==xe||a[1]!==o.id||a[2]!==l||a[3]!==oe||a[4]!==m?(Se=()=>{if(!m){l(`লাইক করতে লগ ইন করুন`);return}oe({targetId:o.id,type:`reel`,userId:m.id,hasLiked:xe})},a[0]=xe,a[1]=o.id,a[2]=l,a[3]=oe,a[4]=m,a[5]=Se):Se=a[5];let O=Se,Ce;a[6]!==_||a[7]!==o.user.isFollowing||a[8]!==o.user.username||a[9]!==o.userId||a[10]!==l||a[11]!==m?(Ce=()=>{if(!m){l(`ফলো করতে লগ ইন করুন`);return}o.userId&&_({targetUserId:o.userId,currentUserId:m.id,isFollowing:o.user.isFollowing||!1,targetUsername:o.user.username},{onSuccess:()=>l(`ফলো করা হয়েছে`),onError:()=>l(`ফলো করতে সমস্যা হয়েছে`)})},a[6]=_,a[7]=o.user.isFollowing,a[8]=o.user.username,a[9]=o.userId,a[10]=l,a[11]=m,a[12]=Ce):Ce=a[12];let we=Ce,Te;a[13]===E?Te=a[14]:(Te=()=>{be.current&&me(!E)},a[13]=E,a[14]=Te);let Ee=Te,De,Oe;a[15]===Symbol.for(`react.memo_cache_sentinel`)?(De=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(me(!0),pe(!1)):(me(!1),pe(!0))},{threshold:.6});return ye.current&&e.observe(ye.current),()=>e.disconnect()},Oe=[],a[15]=De,a[16]=Oe):(De=a[15],Oe=a[16]),(0,C.useEffect)(De,Oe);let ke;a[17]===O?ke=a[18]:(ke=()=>{O(),fe(!0),setTimeout(()=>fe(!1),1e3)},a[17]=O,a[18]=ke);let Ae=ke,je,Me,Ne,Pe;a[19]===Symbol.for(`react.memo_cache_sentinel`)?(Me={opacity:0,scale:.95},Ne={opacity:1,scale:1},Pe={once:!0},je={duration:.5},a[19]=je,a[20]=Me,a[21]=Ne,a[22]=Pe):(je=a[19],Me=a[20],Ne=a[21],Pe=a[22]);let k;a[23]!==f||a[24]!==he||a[25]!==D||a[26]!==l||a[27]!==u?(k=he&&(0,w.jsx)(y,{onClose:()=>ge(!1),showToast:l,theme:u,glassModal:f,shareUrl:D}),a[23]=f,a[24]=he,a[25]=D,a[26]=l,a[27]=u,a[28]=k):k=a[28];let A;a[29]!==f||a[30]!==_e||a[31]!==D||a[32]!==l||a[33]!==u?(A=_e&&(0,w.jsx)(b,{onClose:()=>ve(!1),theme:u,showToast:l,glassModal:f,shareUrl:D}),a[29]=f,a[30]=_e,a[31]=D,a[32]=l,a[33]=u,a[34]=A):A=a[34];let j;a[35]!==T||a[36]!==E||a[37]!==o.src||a[38]!==Ee?(j=o.src?(0,w.jsx)(`div`,{className:`w-full h-full cursor-pointer`,onClick:Ee,children:(0,w.jsx)(ue,{ref:be,url:o.src,width:`100%`,height:`100%`,playing:E,muted:T,loop:!0,playsinline:!0,style:{objectFit:`cover`},className:`react-player pointer-events-none`})}):(0,w.jsx)(ce,{src:o.src,width:400,className:`w-full h-full`,onClick:()=>pe(!T),alt:`reel`}),a[35]=T,a[36]=E,a[37]=o.src,a[38]=Ee,a[39]=j):j=a[39];let M;a[40]===E?M=a[41]:(M=!E&&(0,w.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,w.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,w.jsx)(ee,{className:`text-white w-10 h-10 fill-white`})})}),a[40]=E,a[41]=M);let N;a[42]===T?N=a[43]:(N=(0,w.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),pe(!T)},children:T?(0,w.jsx)(i,{className:`text-white w-5 h-5`}):(0,w.jsx)(s,{className:`text-white w-5 h-5`})}),a[42]=T,a[43]=N);let P;a[44]===de?P=a[45]:(P=de&&(0,w.jsx)(n.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,w.jsx)(c,{size:100,className:`text-white fill-white drop-shadow-lg`})}),a[44]=de,a[45]=P);let F;a[46]===P?F=a[47]:(F=(0,w.jsx)(r,{children:P}),a[46]=P,a[47]=F);let I;a[48]!==d||a[49]!==o.user?(I=()=>d(o.user),a[48]=d,a[49]=o.user,a[50]=I):I=a[50];let L;a[51]===o.user.avatar?L=a[52]:(L=(0,w.jsx)(h,{src:o.user.avatar}),a[51]=o.user.avatar,a[52]=L);let R;a[53]===o.user.username[0]?R=a[54]:(R=o.user.username[0].toUpperCase(),a[53]=o.user.username[0],a[54]=R);let z;a[55]===R?z=a[56]:(z=(0,w.jsx)(v,{children:R}),a[55]=R,a[56]=z);let Fe;a[57]!==L||a[58]!==z?(Fe=(0,w.jsxs)(g,{className:`w-8 h-8 border border-white/50 cursor-pointer`,children:[L,z]}),a[57]=L,a[58]=z,a[59]=Fe):Fe=a[59];let B;a[60]===o.user.username?B=a[61]:(B=(0,w.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:o.user.username}),a[60]=o.user.username,a[61]=B);let V;a[62]===o.user.isVerified?V=a[63]:(V=o.user.isVerified&&(0,w.jsx)(ae,{}),a[62]=o.user.isVerified,a[63]=V);let Ie,Le;a[64]===Symbol.for(`react.memo_cache_sentinel`)?(Ie={scale:1.05},Le={scale:.95},a[64]=Ie,a[65]=Le):(Ie=a[64],Le=a[65]);let Re=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${o.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,H;a[66]===we?H=a[67]:(H=e=>{e.stopPropagation(),we()},a[66]=we,a[67]=H);let ze=o.user.isFollowing?`ফলো করছেন`:`ফলো`,U;a[68]!==Re||a[69]!==H||a[70]!==ze?(U=(0,w.jsx)(n.button,{whileHover:Ie,whileTap:Le,className:Re,onClick:H,children:ze}),a[68]=Re,a[69]=H,a[70]=ze,a[71]=U):U=a[71];let W;a[72]!==I||a[73]!==Fe||a[74]!==B||a[75]!==V||a[76]!==U?(W=(0,w.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:I,children:[Fe,B,V,U]}),a[72]=I,a[73]=Fe,a[74]=B,a[75]=V,a[76]=U,a[77]=W):W=a[77];let Be;a[78]===Symbol.for(`react.memo_cache_sentinel`)?(Be=(0,w.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`আরও`}),a[78]=Be):Be=a[78];let G;a[79]===o.caption?G=a[80]:(G=(0,w.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[o.caption,` `,Be]}),a[79]=o.caption,a[80]=G);let Ve;a[81]===Symbol.for(`react.memo_cache_sentinel`)?(Ve=(0,w.jsx)(te,{size:12}),a[81]=Ve):Ve=a[81];let K;a[82]===o.audio?K=a[83]:(K=(0,w.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[Ve,(0,w.jsx)(`div`,{className:`truncate w-40`,children:o.audio})]}),a[82]=o.audio,a[83]=K);let q;a[84]!==W||a[85]!==G||a[86]!==K?(q=(0,w.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[W,G,K]}),a[84]=W,a[85]=G,a[86]=K,a[87]=q):q=a[87];let He,Ue;a[88]===Symbol.for(`react.memo_cache_sentinel`)?(He={scale:1.1},Ue={scale:.9},a[88]=He,a[89]=Ue):(He=a[88],Ue=a[89]);let We=`cursor-pointer transition-colors ${xe?`fill-[#f42a41] text-[#f42a41]`:``}`,J;a[90]!==O||a[91]!==We?(J=(0,w.jsx)(n.div,{whileHover:He,whileTap:Ue,children:(0,w.jsx)(c,{size:28,strokeWidth:1.5,className:We,onClick:O})}),a[90]=O,a[91]=We,a[92]=J):J=a[92];let Y;a[93]===o.likes?Y=a[94]:(Y=(0,w.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:o.likes}),a[93]=o.likes,a[94]=Y);let X;a[95]!==J||a[96]!==Y?(X=(0,w.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[J,Y]}),a[95]=J,a[96]=Y,a[97]=X):X=a[97];let Ge,Ke;a[98]===Symbol.for(`react.memo_cache_sentinel`)?(Ge={scale:1.1},Ke={scale:.9},a[98]=Ge,a[99]=Ke):(Ge=a[98],Ke=a[99]);let Z;a[100]!==o||a[101]!==p?(Z=(0,w.jsx)(n.div,{whileHover:Ge,whileTap:Ke,children:(0,w.jsx)(ne,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>p(o)})}),a[100]=o,a[101]=p,a[102]=Z):Z=a[102];let qe;a[103]===o.comments?qe=a[104]:(qe=(0,w.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:o.comments}),a[103]=o.comments,a[104]=qe);let Je;a[105]!==Z||a[106]!==qe?(Je=(0,w.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[Z,qe]}),a[105]=Z,a[106]=qe,a[107]=Je):Je=a[107];let Ye,Xe;a[108]===Symbol.for(`react.memo_cache_sentinel`)?(Ye={scale:1.1},Xe={scale:.9},a[108]=Ye,a[109]=Xe):(Ye=a[108],Xe=a[109]);let Ze;a[110]===Symbol.for(`react.memo_cache_sentinel`)?(Ze=(0,w.jsx)(n.div,{whileHover:Ye,whileTap:Xe,children:(0,w.jsx)(re,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ve(!0)})}),a[110]=Ze):Ze=a[110];let Qe,$e;a[111]===Symbol.for(`react.memo_cache_sentinel`)?(Qe={scale:1.1},$e={scale:.9},a[111]=Qe,a[112]=$e):(Qe=a[111],$e=a[112]);let et;a[113]===Symbol.for(`react.memo_cache_sentinel`)?(et=(0,w.jsx)(n.div,{whileHover:Qe,whileTap:$e,children:(0,w.jsx)(t,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ge(!0)})}),a[113]=et):et=a[113];let tt;a[114]!==d||a[115]!==o.user?(tt=()=>d(o.user),a[114]=d,a[115]=o.user,a[116]=tt):tt=a[116];let nt;a[117]===o.user.avatar?nt=a[118]:(nt=(0,w.jsx)(h,{src:o.user.avatar}),a[117]=o.user.avatar,a[118]=nt);let Q;a[119]===o.user.username[0]?Q=a[120]:(Q=o.user.username[0].toUpperCase(),a[119]=o.user.username[0],a[120]=Q);let rt;a[121]===Q?rt=a[122]:(rt=(0,w.jsx)(v,{children:Q}),a[121]=Q,a[122]=rt);let it;a[123]!==tt||a[124]!==nt||a[125]!==rt?(it=(0,w.jsxs)(g,{className:`w-6 h-6 border-2 border-white cursor-pointer mt-2`,onClick:tt,children:[nt,rt]}),a[123]=tt,a[124]=nt,a[125]=rt,a[126]=it):it=a[126];let at;a[127]!==X||a[128]!==Je||a[129]!==it?(at=(0,w.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[X,Je,Ze,et,it]}),a[127]=X,a[128]=Je,a[129]=it,a[130]=at):at=a[130];let $;a[131]!==Ae||a[132]!==j||a[133]!==M||a[134]!==N||a[135]!==F||a[136]!==q||a[137]!==at?($=(0,w.jsxs)(`div`,{ref:ye,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-zinc-900 md:rounded-lg overflow-hidden border-zinc-800 md:border group shadow-2xl`,onDoubleClick:Ae,children:[j,M,N,F,q,at]}),a[131]=Ae,a[132]=j,a[133]=M,a[134]=N,a[135]=F,a[136]=q,a[137]=at,a[138]=$):$=a[138];let ot;return a[139]!==k||a[140]!==A||a[141]!==$?(ot=(0,w.jsxs)(n.div,{initial:Me,whileInView:Ne,viewport:Pe,transition:je,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[k,A,$]}),a[139]=k,a[140]=A,a[141]=$,a[142]=ot):ot=a[142],ot}),fe=m();const T=e=>[`reel`,e],pe=(e,t)=>{let n=(0,fe.c)(9),r=e||``,i;n[0]===r?i=n[1]:(i=T(r),n[0]=r,n[1]=i);let a=!!e,s;n[2]!==t||n[3]!==e?(s=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await _.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await _.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await _.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},n[2]=t,n[3]=e,n[4]=s):s=n[4];let c;return n[5]!==i||n[6]!==a||n[7]!==s?(c={queryKey:i,enabled:a,queryFn:s},n[5]=i,n[6]=a,n[7]=s,n[8]=c):c=n[8],o(c)};var E=m(),me=()=>{let e=(0,E.c)(39),{theme:t,showToast:n}=ie(),{user:r}=le(),i=l(),{id:o}=f(),s=t===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,{data:c,isLoading:ee}=pe(o,r?.id),{data:u,isLoading:te,fetchNextPage:d,hasNextPage:ne,isFetchingNextPage:p}=oe(r?.id),m;bb0:{if(!u){let t;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t=[],e[0]=t):t=e[0],m=t;break bb0}let t;e[1]===u.pages?t=e[2]:(t=u.pages.flat(),e[1]=u.pages,e[2]=t),m=t}let re=m,h;e[3]===i?h=e[4]:(h=e=>{i(`/profile/${e.username}`)},e[3]=i,e[4]=h);let g=h,ae=o?ee:te,se;e[5]!==re||e[6]!==o||e[7]!==c?(se=o?c?[c]:[]:re,e[5]=re,e[6]=o,e[7]=c,e[8]=se):se=e[8];let ce=se;if(ae){let t;return e[9]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,w.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:`Loading reel...`}),e[9]=t):t=e[9],t}if(ce.length===0){let t=o?`Reel not found`:`No reels yet`,n;return e[10]===t?n=e[11]:(n=(0,w.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:t}),e[10]=t,e[11]=n),n}let _;e[12]===i?_=e[13]:(_=()=>i(`/`),e[12]=i,e[13]=_);let v;e[14]===Symbol.for(`react.memo_cache_sentinel`)?(v=(0,w.jsx)(a,{size:28}),e[14]=v):v=e[14];let y;e[15]===_?y=e[16]:(y=(0,w.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:_,children:v}),e[15]=_,e[16]=y);let b;if(e[17]!==ce||e[18]!==s||e[19]!==g||e[20]!==n||e[21]!==t){let r;e[23]!==s||e[24]!==g||e[25]!==n||e[26]!==t?(r=e=>(0,w.jsx)(de,{reel:e,showToast:n,theme:t,onUserClick:g,glassModal:s},e.id),e[23]=s,e[24]=g,e[25]=n,e[26]=t,e[27]=r):r=e[27],b=ce.map(r),e[17]=ce,e[18]=s,e[19]=g,e[20]=n,e[21]=t,e[22]=b}else b=e[22];let x;e[28]!==d||e[29]!==ne||e[30]!==o||e[31]!==p?(x=ne&&!o&&(0,w.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center snap-start bg-black`,children:(0,w.jsx)(`button`,{onClick:()=>d(),disabled:p,className:`bg-white/10 hover:bg-white/20 text-white px-6 py-2 rounded-full border border-white/20 transition-colors`,children:p?`লোড হচ্ছে...`:`আরও ভিডিও দেখুন`})}),e[28]=d,e[29]=ne,e[30]=o,e[31]=p,e[32]=x):x=e[32];let S;e[33]!==b||e[34]!==x?(S=(0,w.jsxs)(`div`,{className:`w-full md:w-[400px] h-full`,children:[b,x]}),e[33]=b,e[34]=x,e[35]=S):S=e[35];let C;return e[36]!==y||e[37]!==S?(C=(0,w.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[y,S]}),e[36]=y,e[37]=S,e[38]=C):C=e[38],C};export{me as default};