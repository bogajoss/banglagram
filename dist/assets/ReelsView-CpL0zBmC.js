import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{Dt as t,F as n,G as r,Gt as i,It as a,J as o,Nt as s,Ot as c,P as ee,Q as te,Wt as l,_t as u,et as ne,ft as re,kt as d,qt as f,t as p,ut as ie}from"./vendor-B5OVd975.js";import"./libs-Bghk4o3g.js";import"./tanstack-DEYdLxKO.js";import"./supabase-nYr-R5G6.js";import{_ as m,a as ae,i as h,l as oe,m as g,v as se,y as ce}from"./index-DLt9WKqV.js";import{n as _,t as v}from"./ShareModal-BPQNb7F1.js";import"./useGetSuggestedUsers-DiFrrEyE.js";import{t as y}from"./useFollowUser-yC6fDEVX.js";var le=d(),b=e(f(),1),x=a(),ue=p,de=(0,b.memo)(e=>{let i=(0,le.c)(132),{reel:a,showToast:s,theme:l,onUserClick:u,glassModal:d}=e,{setViewingReel:f}=ce(),{user:p}=se(),{mutate:oe}=h(),{mutate:g}=y(),[de,fe]=(0,b.useState)(!1),[S,pe]=(0,b.useState)(!0),[C,me]=(0,b.useState)(!0),[he,ge]=(0,b.useState)(!1),[_e,ve]=(0,b.useState)(!1),ye=(0,b.useRef)(null),be=(0,b.useRef)(null),w=`${window.location.origin}/reels/${a.id}`,xe=a.hasLiked||!1,Se;i[0]!==xe||i[1]!==a.id||i[2]!==s||i[3]!==oe||i[4]!==p?(Se=()=>{if(!p){s(`লাইক করতে লগ ইন করুন`);return}oe({targetId:a.id,type:`reel`,userId:p.id,hasLiked:xe})},i[0]=xe,i[1]=a.id,i[2]=s,i[3]=oe,i[4]=p,i[5]=Se):Se=i[5];let T=Se,Ce;i[6]!==g||i[7]!==a.user.isFollowing||i[8]!==a.user.username||i[9]!==a.userId||i[10]!==s||i[11]!==p?(Ce=()=>{if(!p){s(`ফলো করতে লগ ইন করুন`);return}a.userId&&g({targetUserId:a.userId,currentUserId:p.id,isFollowing:a.user.isFollowing||!1,targetUsername:a.user.username},{onSuccess:()=>s(`ফলো করা হয়েছে`),onError:()=>s(`ফলো করতে সমস্যা হয়েছে`)})},i[6]=g,i[7]=a.user.isFollowing,i[8]=a.user.username,i[9]=a.userId,i[10]=s,i[11]=p,i[12]=Ce):Ce=i[12];let we=Ce,Te;i[13]===C?Te=i[14]:(Te=()=>{be.current&&me(!C)},i[13]=C,i[14]=Te);let Ee=Te,De,Oe;i[15]===Symbol.for(`react.memo_cache_sentinel`)?(De=()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting?(me(!0),pe(!1)):(me(!1),pe(!0))},{threshold:.6});return ye.current&&e.observe(ye.current),()=>e.disconnect()},Oe=[],i[15]=De,i[16]=Oe):(De=i[15],Oe=i[16]),(0,b.useEffect)(De,Oe);let ke;i[17]===T?ke=i[18]:(ke=()=>{T(),fe(!0),setTimeout(()=>fe(!1),1e3)},i[17]=T,i[18]=ke);let Ae=ke,je,Me,Ne,Pe;i[19]===Symbol.for(`react.memo_cache_sentinel`)?(Me={opacity:0,scale:.95},Ne={opacity:1,scale:1},Pe={once:!0},je={duration:.5},i[19]=je,i[20]=Me,i[21]=Ne,i[22]=Pe):(je=i[19],Me=i[20],Ne=i[21],Pe=i[22]);let E;i[23]!==d||i[24]!==he||i[25]!==w||i[26]!==s||i[27]!==l?(E=he&&(0,x.jsx)(_,{onClose:()=>ge(!1),showToast:s,theme:l,glassModal:d,shareUrl:w}),i[23]=d,i[24]=he,i[25]=w,i[26]=s,i[27]=l,i[28]=E):E=i[28];let D;i[29]!==d||i[30]!==_e||i[31]!==w||i[32]!==s||i[33]!==l?(D=_e&&(0,x.jsx)(v,{onClose:()=>ve(!1),theme:l,showToast:s,glassModal:d,shareUrl:w}),i[29]=d,i[30]=_e,i[31]=w,i[32]=s,i[33]=l,i[34]=D):D=i[34];let O;i[35]!==S||i[36]!==C||i[37]!==a.src||i[38]!==Ee?(O=a.src?(0,x.jsx)(`div`,{className:`w-full h-full cursor-pointer`,onClick:Ee,children:(0,x.jsx)(ue,{ref:be,url:a.src,width:`100%`,height:`100%`,playing:C,muted:S,loop:!0,playsinline:!0,style:{objectFit:`cover`},className:`react-player pointer-events-none`})}):(0,x.jsx)(m,{src:a.src,width:400,className:`w-full h-full`,onClick:()=>pe(!S),alt:`reel`}),i[35]=S,i[36]=C,i[37]=a.src,i[38]=Ee,i[39]=O):O=i[39];let k;i[40]===C?k=i[41]:(k=!C&&(0,x.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center pointer-events-none z-20`,children:(0,x.jsx)(`div`,{className:`bg-black/40 p-5 rounded-full backdrop-blur-sm`,children:(0,x.jsx)(o,{className:`text-white w-10 h-10 fill-white`})})}),i[40]=C,i[41]=k);let A;i[42]===S?A=i[43]:(A=(0,x.jsx)(`div`,{className:`absolute top-4 right-4 bg-black/50 p-2 rounded-full cursor-pointer transition-opacity hover:bg-black/70 z-30`,onClick:e=>{e.stopPropagation(),pe(!S)},children:S?(0,x.jsx)(ee,{className:`text-white w-5 h-5`}):(0,x.jsx)(n,{className:`text-white w-5 h-5`})}),i[42]=S,i[43]=A);let j;i[44]===de?j=i[45]:(j=de&&(0,x.jsx)(t.div,{initial:{scale:0,opacity:0},animate:{scale:1.2,opacity:1},exit:{scale:0,opacity:0},className:`absolute inset-0 flex items-center justify-center pointer-events-none z-10`,children:(0,x.jsx)(ie,{size:100,className:`text-white fill-white drop-shadow-lg`})}),i[44]=de,i[45]=j);let M;i[46]===j?M=i[47]:(M=(0,x.jsx)(c,{children:j}),i[46]=j,i[47]=M);let N;i[48]!==u||i[49]!==a.user?(N=()=>u(a.user),i[48]=u,i[49]=a.user,i[50]=N):N=i[50];let P;i[51]===a.user.avatar?P=i[52]:(P=(0,x.jsx)(`div`,{className:`w-8 h-8 rounded-full border border-white/50 overflow-hidden cursor-pointer`,children:(0,x.jsx)(m,{src:a.user.avatar,width:100,className:`w-full h-full`,alt:`reel user`})}),i[51]=a.user.avatar,i[52]=P);let F;i[53]===a.user.username?F=i[54]:(F=(0,x.jsx)(`span`,{className:`font-semibold text-sm shadow-black drop-shadow-md text-white cursor-pointer hover:opacity-70 transition-opacity`,children:a.user.username}),i[53]=a.user.username,i[54]=F);let I;i[55]===a.user.isVerified?I=i[56]:(I=a.user.isVerified&&(0,x.jsx)(ae,{}),i[55]=a.user.isVerified,i[56]=I);let Fe,Ie;i[57]===Symbol.for(`react.memo_cache_sentinel`)?(Fe={scale:1.05},Ie={scale:.95},i[57]=Fe,i[58]=Ie):(Fe=i[57],Ie=i[58]);let Le=`border border-white/30 rounded-lg px-3 py-1 text-xs font-semibold backdrop-blur-sm transition-colors ${a.user.isFollowing?`bg-white/20 text-white`:`text-white hover:bg-white/10`}`,L;i[59]===we?L=i[60]:(L=e=>{e.stopPropagation(),we()},i[59]=we,i[60]=L);let Re=a.user.isFollowing?`ফলো করছেন`:`ফলো`,R;i[61]!==Le||i[62]!==L||i[63]!==Re?(R=(0,x.jsx)(t.button,{whileHover:Fe,whileTap:Ie,className:Le,onClick:L,children:Re}),i[61]=Le,i[62]=L,i[63]=Re,i[64]=R):R=i[64];let z;i[65]!==N||i[66]!==P||i[67]!==F||i[68]!==I||i[69]!==R?(z=(0,x.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,onClick:N,children:[P,F,I,R]}),i[65]=N,i[66]=P,i[67]=F,i[68]=I,i[69]=R,i[70]=z):z=i[70];let ze;i[71]===Symbol.for(`react.memo_cache_sentinel`)?(ze=(0,x.jsx)(`span`,{className:`text-zinc-300 cursor-pointer font-semibold hover:text-white`,children:`আরও`}),i[71]=ze):ze=i[71];let B;i[72]===a.caption?B=i[73]:(B=(0,x.jsxs)(`div`,{className:`text-sm mb-3 line-clamp-2 drop-shadow-md text-white`,children:[a.caption,` `,ze]}),i[72]=a.caption,i[73]=B);let Be;i[74]===Symbol.for(`react.memo_cache_sentinel`)?(Be=(0,x.jsx)(te,{size:12}),i[74]=Be):Be=i[74];let V;i[75]===a.audio?V=i[76]:(V=(0,x.jsxs)(`div`,{className:`flex items-center gap-2 text-xs drop-shadow-md text-white opacity-80`,children:[Be,(0,x.jsx)(`div`,{className:`truncate w-40`,children:a.audio})]}),i[75]=a.audio,i[76]=V);let H;i[77]!==z||i[78]!==B||i[79]!==V?(H=(0,x.jsxs)(`div`,{className:`absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-20 pb-20 md:pb-4`,children:[z,B,V]}),i[77]=z,i[78]=B,i[79]=V,i[80]=H):H=i[80];let Ve,He;i[81]===Symbol.for(`react.memo_cache_sentinel`)?(Ve={scale:1.1},He={scale:.9},i[81]=Ve,i[82]=He):(Ve=i[81],He=i[82]);let Ue=`cursor-pointer transition-colors ${xe?`fill-[#f42a41] text-[#f42a41]`:``}`,U;i[83]!==T||i[84]!==Ue?(U=(0,x.jsx)(t.div,{whileHover:Ve,whileTap:He,children:(0,x.jsx)(ie,{size:28,strokeWidth:1.5,className:Ue,onClick:T})}),i[83]=T,i[84]=Ue,i[85]=U):U=i[85];let W;i[86]===a.likes?W=i[87]:(W=(0,x.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:a.likes}),i[86]=a.likes,i[87]=W);let G;i[88]!==U||i[89]!==W?(G=(0,x.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[U,W]}),i[88]=U,i[89]=W,i[90]=G):G=i[90];let We,Ge;i[91]===Symbol.for(`react.memo_cache_sentinel`)?(We={scale:1.1},Ge={scale:.9},i[91]=We,i[92]=Ge):(We=i[91],Ge=i[92]);let K;i[93]!==a||i[94]!==f?(K=(0,x.jsx)(t.div,{whileHover:We,whileTap:Ge,children:(0,x.jsx)(ne,{size:28,strokeWidth:1.5,className:`-scale-x-100 drop-shadow-lg cursor-pointer hover:opacity-80`,onClick:()=>f(a)})}),i[93]=a,i[94]=f,i[95]=K):K=i[95];let q;i[96]===a.comments?q=i[97]:(q=(0,x.jsx)(`span`,{className:`text-xs font-semibold drop-shadow-md`,children:a.comments}),i[96]=a.comments,i[97]=q);let J;i[98]!==K||i[99]!==q?(J=(0,x.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[K,q]}),i[98]=K,i[99]=q,i[100]=J):J=i[100];let Ke,qe;i[101]===Symbol.for(`react.memo_cache_sentinel`)?(Ke={scale:1.1},qe={scale:.9},i[101]=Ke,i[102]=qe):(Ke=i[101],qe=i[102]);let Je;i[103]===Symbol.for(`react.memo_cache_sentinel`)?(Je=(0,x.jsx)(t.div,{whileHover:Ke,whileTap:qe,children:(0,x.jsx)(r,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ve(!0)})}),i[103]=Je):Je=i[103];let Ye,Xe;i[104]===Symbol.for(`react.memo_cache_sentinel`)?(Ye={scale:1.1},Xe={scale:.9},i[104]=Ye,i[105]=Xe):(Ye=i[104],Xe=i[105]);let Ze;i[106]===Symbol.for(`react.memo_cache_sentinel`)?(Ze=(0,x.jsx)(t.div,{whileHover:Ye,whileTap:Xe,children:(0,x.jsx)(re,{size:28,strokeWidth:1.5,className:`cursor-pointer hover:opacity-80`,onClick:()=>ge(!0)})}),i[106]=Ze):Ze=i[106];let Qe;i[107]===Symbol.for(`react.memo_cache_sentinel`)?(Qe={scale:1.1},i[107]=Qe):Qe=i[107];let Y;i[108]!==u||i[109]!==a.user?(Y=()=>u(a.user),i[108]=u,i[109]=a.user,i[110]=Y):Y=i[110];let X;i[111]===a.user.avatar?X=i[112]:(X=(0,x.jsx)(m,{src:a.user.avatar,width:100,className:`w-full h-full`,alt:`user thumb`}),i[111]=a.user.avatar,i[112]=X);let Z;i[113]!==Y||i[114]!==X?(Z=(0,x.jsx)(t.div,{whileHover:Qe,className:`w-6 h-6 border-2 border-white rounded-md overflow-hidden mt-2 cursor-pointer`,onClick:Y,children:X}),i[113]=Y,i[114]=X,i[115]=Z):Z=i[115];let Q;i[116]!==G||i[117]!==J||i[118]!==Z?(Q=(0,x.jsxs)(`div`,{className:`absolute bottom-20 md:bottom-4 right-2 flex flex-col items-center gap-6 md:gap-4 text-white pb-safe`,children:[G,J,Je,Ze,Z]}),i[116]=G,i[117]=J,i[118]=Z,i[119]=Q):Q=i[119];let $;i[120]!==Ae||i[121]!==O||i[122]!==k||i[123]!==A||i[124]!==M||i[125]!==H||i[126]!==Q?($=(0,x.jsxs)(`div`,{ref:ye,className:`relative h-full md:h-[95vh] w-full md:w-[400px] bg-zinc-900 md:rounded-lg overflow-hidden border-zinc-800 md:border group shadow-2xl`,onDoubleClick:Ae,children:[O,k,A,M,H,Q]}),i[120]=Ae,i[121]=O,i[122]=k,i[123]=A,i[124]=M,i[125]=H,i[126]=Q,i[127]=$):$=i[127];let $e;return i[128]!==E||i[129]!==D||i[130]!==$?($e=(0,x.jsxs)(t.div,{initial:Me,whileInView:Ne,viewport:Pe,transition:je,className:`h-full w-full flex justify-center items-center snap-start relative md:pt-0`,children:[E,D,$]}),i[128]=E,i[129]=D,i[130]=$,i[131]=$e):$e=i[131],$e}),fe=d();const S=e=>[`reel`,e],pe=(e,t)=>{let n=(0,fe.c)(9),r=e||``,i;n[0]===r?i=n[1]:(i=S(r),n[0]=r,n[1]=i);let a=!!e,o;n[2]!==t||n[3]!==e?(o=async()=>{if(!e)throw Error(`Reel ID required`);let{data:n,error:r}=await g.from(`reels`).select(`
          *,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).eq(`id`,e).single();if(r)throw r;let i=n,a=!1,o=!1;if(t){let{count:n}=await g.from(`likes`).select(`*`,{count:`exact`,head:!0}).eq(`reel_id`,e).eq(`user_id`,t);a=!!n&&n>0;let{count:r}=await g.from(`follows`).select(`*`,{count:`exact`,head:!0}).eq(`follower_id`,t).eq(`following_id`,i.user_id);o=!!r&&r>0}return{id:i.id,userId:i.user_id,user:{id:i.user_id,username:i.profiles?.username||`Unknown`,name:i.profiles?.full_name||`Unknown`,avatar:i.profiles?.avatar_url||``,isVerified:i.profiles?.is_verified||!1,isFollowing:o},src:i.video_url,likes:i.likes?.[0]?.count||0,comments:i.comments?.[0]?.count||0,caption:i.caption||``,audio:i.audio_track_name||`Original Audio`,hasLiked:a}},n[2]=t,n[3]=e,n[4]=o):o=n[4];let c;return n[5]!==i||n[6]!==a||n[7]!==o?(c={queryKey:i,enabled:a,queryFn:o},n[5]=i,n[6]=a,n[7]=o,n[8]=c):c=n[8],s(c)};var C=d(),me=()=>{let e=(0,C.c)(32),{theme:t,showToast:n}=ce(),{user:r}=se(),a=l(),{id:o}=i(),s=t===`dark`?`bg-[#121212]/90 backdrop-blur-2xl border border-white/10`:`bg-white/90 backdrop-blur-2xl border border-black/10`,{data:c,isLoading:ee}=pe(o,r?.id),{data:te,isLoading:ne}=oe(r?.id),re;e[0]===te?re=e[1]:(re=te===void 0?[]:te,e[0]=te,e[1]=re);let d=re,f;e[2]===a?f=e[3]:(f=e=>{a(`/profile/${e.username}`)},e[2]=a,e[3]=f);let p=f,ie=o?ee:ne,m;e[4]!==d||e[5]!==o||e[6]!==c?(m=o?c?[c]:[]:d,e[4]=d,e[5]=o,e[6]=c,e[7]=m):m=e[7];let ae=m;if(ie){let t;return e[8]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,x.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:`Loading reel...`}),e[8]=t):t=e[8],t}if(ae.length===0){let t=o?`Reel not found`:`No reels yet`,n;return e[9]===t?n=e[10]:(n=(0,x.jsx)(`div`,{className:`h-screen w-full flex items-center justify-center bg-black text-white`,children:t}),e[9]=t,e[10]=n),n}let h;e[11]===a?h=e[12]:(h=()=>a(`/`),e[11]=a,e[12]=h);let g;e[13]===Symbol.for(`react.memo_cache_sentinel`)?(g=(0,x.jsx)(u,{size:28}),e[13]=g):g=e[13];let _;e[14]===h?_=e[15]:(_=(0,x.jsx)(`div`,{className:`md:hidden fixed top-4 left-4 z-[60] p-2 bg-black/40 backdrop-blur-md rounded-full text-white cursor-pointer border border-white/10`,onClick:h,children:g}),e[14]=h,e[15]=_);let v;if(e[16]!==ae||e[17]!==s||e[18]!==p||e[19]!==n||e[20]!==t){let r;e[22]!==s||e[23]!==p||e[24]!==n||e[25]!==t?(r=e=>(0,x.jsx)(de,{reel:e,showToast:n,theme:t,onUserClick:p,glassModal:s},e.id),e[22]=s,e[23]=p,e[24]=n,e[25]=t,e[26]=r):r=e[26],v=ae.map(r),e[16]=ae,e[17]=s,e[18]=p,e[19]=n,e[20]=t,e[21]=v}else v=e[21];let y;e[27]===v?y=e[28]:(y=(0,x.jsx)(`div`,{className:`w-full md:w-[400px] h-full`,children:v}),e[27]=v,e[28]=y);let le;return e[29]!==_||e[30]!==y?(le=(0,x.jsxs)(`div`,{className:`h-screen w-full flex justify-center bg-black overflow-y-scroll snap-y snap-mandatory scrollbar-hide relative`,children:[_,y]}),e[29]=_,e[30]=y,e[31]=le):le=e[31],le};export{me as default};