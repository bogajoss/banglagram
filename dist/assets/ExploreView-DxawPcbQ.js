import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{At as t,Y as n,Yt as r,Zt as i,bt as a,en as o,fn as ee,hn as s,in as c,nn as l,o as u,ut as d}from"./vendor-CF4zx1nW.js";import{Xt as f}from"./libs-CDFYUT-j.js";import"./tanstack-CjdblyHw.js";import"./supabase-CW8wD_q0.js";import{A as p,E as m,N as te,O as ne,c as re,k as h,n as g}from"./index-BOeOaC4J.js";var _=e(s(),1),v=i();const y=[`explorePosts`],ie=()=>{let e=(0,v.c)(1),t;return e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t={queryKey:y,queryFn:x,initialPageParam:0,getNextPageParam:S},e[0]=t):t=e[0],o(t)};function b(e){let t=e.profiles;return{id:e.id,user:{id:e.user_id,username:t?.username||`Unknown`,name:t?.full_name||`Unknown`,avatar:t?.avatar_url||``,isVerified:t?.is_verified||!1},content:{type:`image`,src:e.image_url},likes:e.likes[0]?.count||0,comments:e.comments[0]?.count||0,caption:e.caption||``,time:``}}async function x(e){let{pageParam:t}=e,n=(t===void 0?0:t)*15,r=n+14,{data:i,error:a}=await m.from(`posts`).select(`
          id,
          image_url,
          user_id,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).order(`created_at`,{ascending:!1}).range(n,r);if(a)throw a;return i.map(b)}function S(e,t){return e.length===15?t.length:void 0}var C=i(),w=e(f(),1);const T=e=>[`searchPosts`,e],ae=e=>{let t=(0,C.c)(8),n;t[0]===e?n=t[1]:(n=T(e),t[0]=e,t[1]=n);let r=!!e&&e.length>0,i;t[2]===e?i=t[3]:(i=async()=>{let{data:t,error:n}=await m.from(`posts`).select(`
          id,
          created_at,
          caption,
          image_url,
          user_id,
          profiles (username, full_name, avatar_url, is_verified),
          likes (count),
          comments (count)
        `).ilike(`caption`,`%${e}%`).order(`created_at`,{ascending:!1}).limit(20);if(n)throw n;return(t||[]).map(E)},t[2]=e,t[3]=i);let a;return t[4]!==n||t[5]!==r||t[6]!==i?(a={queryKey:n,enabled:r,queryFn:i},t[4]=n,t[5]=r,t[6]=i,t[7]=a):a=t[7],l(a)};function E(e){let t=e.profiles;return{id:e.id,user:{id:e.user_id,username:t?.username||`Unknown`,name:t?.full_name||`Unknown`,avatar:t?.avatar_url||``,isVerified:t?.is_verified||!1},content:{type:`image`,src:e.image_url},likes:e.likes[0]?.count||0,caption:e.caption||``,comments:e.comments[0]?.count||0,time:(0,w.default)(e.created_at).fromNow(),createdAt:e.created_at,isVerified:t?.is_verified||!1}}var D=i(),O=c(),k=()=>{let e=(0,D.c)(48),{setViewingPost:i}=te(),o=ee(),[s,c]=(0,_.useState)(``),[l,f]=(0,_.useState)(`accounts`),g;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(g=[],e[0]=g):g=e[0];let[v,y]=(0,_.useState)(g),[b,x]=(0,_.useState)(!1),S;e[1]===Symbol.for(`react.memo_cache_sentinel`)?(S={rootMargin:`1200px`},e[1]=S):S=e[1];let{ref:C,inView:w}=u(S),{data:T,isLoading:E,fetchNextPage:k,hasNextPage:A,isFetchingNextPage:j}=ie(),{data:M,isLoading:N}=ae(l===`posts`?s:``),P;e[2]===M?P=e[3]:(P=M===void 0?[]:M,e[2]=M,e[3]=P);let F=P,I,L;e[4]!==k||e[5]!==A||e[6]!==w||e[7]!==s?(I=()=>{w&&A&&!s&&k()},L=[w,A,k,s],e[4]=k,e[5]=A,e[6]=w,e[7]=s,e[8]=I,e[9]=L):(I=e[8],L=e[9]),(0,_.useEffect)(I,L);let R,z;e[10]!==s||e[11]!==l?(R=()=>{let e=setTimeout(async()=>{if(s.trim().length>0){if(l===`accounts`){x(!0);let{data:e}=await m.from(`profiles`).select(`id, username, full_name, avatar_url, is_verified`).ilike(`username`,`%${s}%`).limit(10);e&&y(e.map(oe)),x(!1)}}else y([])},300);return()=>clearTimeout(e)},z=[s,l],e[10]=s,e[11]=l,e[12]=R,e[13]=z):(R=e[12],z=e[13]),(0,_.useEffect)(R,z);let B;e[14]===Symbol.for(`react.memo_cache_sentinel`)?(B={opacity:0},e[14]=B):B=e[14];let V;e[15]===Symbol.for(`react.memo_cache_sentinel`)?(V={hidden:B,visible:{opacity:1,transition:{staggerChildren:.05}}},e[15]=V):V=e[15];let H=V,U;e[16]===Symbol.for(`react.memo_cache_sentinel`)?(U={hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},e[16]=U):U=e[16];let W=U,G;e[17]===Symbol.for(`react.memo_cache_sentinel`)?(G=(0,O.jsx)(d,{size:18,className:`text-muted-foreground`}),e[17]=G):G=e[17];let K;e[18]===Symbol.for(`react.memo_cache_sentinel`)?(K=e=>c(e.target.value),e[18]=K):K=e[18];let q,J;e[19]===s?(q=e[20],J=e[21]):(q=(0,O.jsx)(`input`,{type:`text`,placeholder:`Search`,value:s,onChange:K,className:`bg-transparent border-none outline-none text-sm w-full p-0 h-auto text-foreground`}),J=s&&(0,O.jsx)(n,{size:18,className:`cursor-pointer text-muted-foreground`,onClick:()=>c(``)}),e[19]=s,e[20]=q,e[21]=J);let Y;e[22]!==q||e[23]!==J?(Y=(0,O.jsxs)(`div`,{className:`flex items-center gap-2 px-3 py-2 rounded-lg bg-muted`,children:[G,q,J]}),e[22]=q,e[23]=J,e[24]=Y):Y=e[24];let X;e[25]!==s||e[26]!==l?(X=s&&(0,O.jsxs)(`div`,{className:`flex mt-2 border-b border-border`,children:[(0,O.jsx)(`button`,{className:`flex-1 py-2 text-sm font-semibold transition-colors ${l===`accounts`?`text-foreground border-b-2 border-foreground`:`text-muted-foreground hover:text-foreground`}`,onClick:()=>f(`accounts`),children:`Accounts`}),(0,O.jsx)(`button`,{className:`flex-1 py-2 text-sm font-semibold transition-colors ${l===`posts`?`text-foreground border-b-2 border-foreground`:`text-muted-foreground hover:text-foreground`}`,onClick:()=>f(`posts`),children:`Posts`})]}),e[25]=s,e[26]=l,e[27]=X):X=e[27];let Z;e[28]!==Y||e[29]!==X?(Z=(0,O.jsxs)(`div`,{className:`mb-4 sticky top-0 z-30 py-2 bg-background`,children:[Y,X]}),e[28]=Y,e[29]=X,e[30]=Z):Z=e[30];let Q;e[31]!==T?.pages||e[32]!==A||e[33]!==E||e[34]!==j||e[35]!==N||e[36]!==b||e[37]!==o||e[38]!==F||e[39]!==C||e[40]!==s||e[41]!==l||e[42]!==i||e[43]!==v?(Q=s?(0,O.jsxs)(`div`,{className:`flex flex-col gap-2`,children:[l===`accounts`&&(0,O.jsxs)(O.Fragment,{children:[b&&(0,O.jsx)(`div`,{className:`space-y-2`,children:[1,2,3].map(se)}),!b&&v.length===0&&(0,O.jsx)(`div`,{className:`p-4 text-center text-muted-foreground`,children:`No accounts found`}),v.map(e=>(0,O.jsxs)(`div`,{onClick:()=>o(`/profile/${e.username}`),className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer hover:bg-muted transition-colors`,children:[(0,O.jsxs)(ne,{className:`w-10 h-10`,children:[(0,O.jsx)(p,{src:e.avatar}),(0,O.jsx)(h,{children:e.username?.[0]?.toUpperCase()||`?`})]}),(0,O.jsxs)(`div`,{className:`flex flex-col`,children:[(0,O.jsxs)(`div`,{className:`flex items-center gap-1 text-foreground`,children:[(0,O.jsx)(`span`,{className:`font-semibold text-sm`,children:e.username}),e.isVerified&&(0,O.jsx)(re,{})]}),(0,O.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.name})]})]},e.username))]}),l===`posts`&&(0,O.jsxs)(O.Fragment,{children:[N&&(0,O.jsx)(`div`,{className:`grid grid-cols-3 gap-1 md:gap-4`,children:[1,2,3,4,5,6].map(ce)}),!N&&F.length===0&&(0,O.jsx)(`div`,{className:`p-4 text-center text-muted-foreground`,children:`No posts found`}),(0,O.jsx)(`div`,{className:`grid grid-cols-3 gap-1 md:gap-4`,children:F.map(e=>(0,O.jsxs)(r.div,{variants:W,whileHover:{scale:.98},className:`relative aspect-square group cursor-pointer overflow-hidden`,onClick:()=>i(e),children:[(0,O.jsx)(`img`,{src:e.content.src||e.content.poster,className:`w-full h-full transition-transform duration-300 group-hover:scale-110 object-cover`,alt:`search result`,loading:`lazy`}),(0,O.jsxs)(`div`,{className:`absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-4 text-white font-bold transition-opacity duration-200 z-20`,children:[(0,O.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,O.jsx)(t,{fill:`white`,size:16}),` `,e.likes]}),(0,O.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,O.jsx)(a,{fill:`white`,size:16,className:`-scale-x-100`}),` `,e.comments]})]})]},e.id))})]})]}):(0,O.jsxs)(O.Fragment,{children:[E?(0,O.jsx)(`div`,{className:`grid grid-cols-3 gap-1 md:gap-4`,children:[1,2,3,4,5,6,7,8,9].map(le)}):(0,O.jsx)(r.div,{variants:H,initial:`hidden`,animate:`visible`,className:`grid grid-cols-3 gap-1 md:gap-4`,children:T?.pages.map((e,n)=>(0,O.jsx)(_.Fragment,{children:e.map(e=>(0,O.jsxs)(r.div,{variants:W,whileHover:{scale:.98},className:`relative aspect-square group cursor-pointer overflow-hidden`,onClick:()=>i(e),children:[(0,O.jsx)(`img`,{src:e.content.src||e.content.poster,className:`w-full h-full transition-transform duration-300 group-hover:scale-110 object-cover`,alt:`explore`,loading:`lazy`}),(0,O.jsxs)(`div`,{className:`absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-4 text-white font-bold transition-opacity duration-200 z-20`,children:[(0,O.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,O.jsx)(t,{fill:`white`,size:16}),` `,e.likes]}),(0,O.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,O.jsx)(a,{fill:`white`,size:16,className:`-scale-x-100`}),` `,e.comments]})]})]},e.id))},n))}),(0,O.jsx)(`div`,{ref:C,className:`h-10 text-center py-4 text-muted-foreground`,children:j?`Loading more...`:A?`See below`:``})]}),e[31]=T?.pages,e[32]=A,e[33]=E,e[34]=j,e[35]=N,e[36]=b,e[37]=o,e[38]=F,e[39]=C,e[40]=s,e[41]=l,e[42]=i,e[43]=v,e[44]=Q):Q=e[44];let $;return e[45]!==Z||e[46]!==Q?($=(0,O.jsxs)(`div`,{className:`w-full max-w-[935px] py-4 px-2`,children:[Z,Q]}),e[45]=Z,e[46]=Q,e[47]=$):$=e[47],$};function oe(e){return{id:e.id,username:e.username,name:e.full_name||e.username,avatar:e.avatar_url||``,isVerified:e.is_verified||!1}}function se(e){return(0,O.jsxs)(`div`,{className:`flex items-center gap-3 p-2`,children:[(0,O.jsx)(g,{className:`h-10 w-10 rounded-full`}),(0,O.jsxs)(`div`,{className:`space-y-2`,children:[(0,O.jsx)(g,{className:`h-4 w-32`}),(0,O.jsx)(g,{className:`h-3 w-24`})]})]},e)}function ce(e){return(0,O.jsx)(g,{className:`aspect-square`},e)}function le(e){return(0,O.jsx)(g,{className:`aspect-square`},e)}export{k as default};